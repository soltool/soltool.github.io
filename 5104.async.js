"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5104],{25104:function(e,t,n){n.d(t,{VZ:function(){return Ce},aC:function(){return Oe},oc:function(){return pe},ZJ:function(){return Ee},am:function(){return Be},Wo:function(){return d},UM:function(){return ie},PO:function(){return q},Af:function(){return J},Hp:function(){return re},Hm:function(){return ue},a1:function(){return Ue},nK:function(){return Ge},ZH:function(){return X},Dm:function(){return te}});var r=n(67294),a=n(5574),s=n.n(a),c=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function u(e,t){var n=t.format,r=void 0===n?"":n,a=new Date(e).getTime(),u=Date.now();return function(e,t){var n=e,r=/\[[^\]]*]/g,a=(t.match(r)||[]).map((function(e){return e.slice(1,-1)})),u=t.replace(r,"[]"),o=c.reduce((function(e,t){var r=s()(t,2),a=r[0],c=r[1];if(e.includes(a)){var u=Math.floor(n/c);return n-=u*c,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return u.toString().padStart(t,"0")}))}return e}),u),i=0;return o.replace(r,(function(){var e=a[i];return i+=1,e}))}(Math.max(a-u,0),r)}var o=n(40165),i=n(85893);var l=function(e){var t,n=e.value,a=e.format,c=void 0===a?"HH:mm:ss":a,l=e.onChange,d=e.onFinish,f=e.className,p=(t=(0,r.useReducer)((function(e){return e+1}),0),s()(t,2)[1]),h=r.useRef(null),m=function(){var e=function(e){return new Date(e).getTime()}(n);e>=Date.now()&&(h.current=(0,o.Zi)((function(){p(),null==l||l(e-Date.now()),e<Date.now()&&(null==d||d(),h.current&&((0,o.cv)(h.current),h.current=null))}),33.333333333333336))};return r.useEffect((function(){return m(),function(){h.current&&((0,o.cv)(h.current),h.current=null)}}),[n]),(0,i.jsx)("div",{className:f,children:u(n,{format:c})})},d=r.memo(l),f=n(15009),p=n.n(f),h=n(99289),m=n.n(h),v=n(64599),x=n.n(v),b=n(40956),k=n(49591),j=n(32427),y=n(88026),S=n(2453),P=n(16568),g=n(83622),w=n(85137),C=n(27484),F=n.n(C),L=n(70178),N=n.n(L),R=n(70609),M=n(64119),O=n(29363),I=n(49717),T=n(54306),_=n(43651),V=n(44718),A=n(28704),Z=n(30527),D=n(52434),E=n(71874);F().extend(N());var z=function(e){var t=e.handleCurrentProjectNfts,n=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=P.ZP.useNotification(),f=s()(l,2),h=f[0],v=f[1],C=(0,T.O)(),F=C.publicKey,L=C.signTransaction,N=C.wallet,z=C.signMessage,q=(0,_.z)(),Y=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV1})),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV1})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),G=(0,r.useMemo)((function(){var e=new Set;U.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],r=x()(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({text:a,value:a})}}catch(e){r.e(e)}finally{r.f()}return n}),[U]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,r.useMemo)((function(){var e=new Set;return U.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[U]),X=(0,r.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[U]),ee=(0,r.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[U]),te=(0,r.useState)([]),ne=s()(te,2),re=ne[0],ae=ne[1],se=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ce=(0,r.useCallback)((function(e){var t=e.ownerPubkey,r=U.filter((function(e){return e.ownerPubkey===t}));n(b.N.setCurrentProjectNftsDataSourceV1(r))}),[U]),ue=(0,r.useCallback)((function(){n(b.N.setCurrentProjectNftsDataSourceV1(K))}),[K]),oe=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:return e.next=5,(0,A.vo)(F.toString(),z);case 5:n=e.sent,r=n.user,a=r.referral,c=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),o=U.filter((function(e){return re.includes(e.key)})),i=[],l=5,d=x()(o.entries()),e.prev=13,d.s();case 15:if((f=d.n()).done){e.next=47;break}return m=s()(f.value,2),v=m[0],b=m[1],k=b.nftPubkey,j=b.ownerPubkey,y=F,S=a,2,e.next=24,(0,A.zt)({program:c,nftPubkey:k,currentOwnerPubkey:j,payerPubkey:y,currentProjectDataSource:W,userReferral:S,payMode:2});case 24:if(P=e.sent,i.push(P),(g=v+1)%l!=0&&g!==o.length){e.next=45;break}return e.next=30,Y.getLatestBlockhash();case 30:return w=e.sent,C=w.blockhash,R=w.lastValidBlockHeight,e.next=35,(0,E.fC)(Y,N,C,i,L,H);case 35:return O=e.sent,I=O.transaction,T=O.feeMode,e.next=40,(0,E.pR)(Y,N,I,T);case 40:return _=e.sent,V={signature:_,blockhash:C,lastValidBlockHeight:R},e.next=44,(0,E.fS)(B,Y,V,"confirmed",h,u);case 44:i=[];case 45:e.next=15;break;case 47:e.next=52;break;case 49:e.prev=49,e.t0=e.catch(13),d.e(e.t0);case 52:return e.prev=52,d.f(),e.finish(52);case 55:t(W.mintPubkey),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 61:case"end":return e.stop()}}),e,null,[[0,58],[13,49,52,55]])}))),[re,U,W,F,L,N,z,Y,B]),ie=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),r=U.filter((function(e){return re.includes(e.key)})),a=[],c=20,o=x()(r.entries()),e.prev=8,o.s();case 10:if((i=o.n()).done){e.next=39;break}return l=s()(i.value,2),d=l[0],f=l[1],m=F,v=f,e.next=16,(0,A.Km)({program:n,payerPubkey:m,currentProjectDataSource:W,currentProjectNftDataSource:v,index:d});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==r.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,y,a,L,H);case 27:return P=e.sent,g=P.transaction,w=P.feeMode,e.next=32,(0,E.pR)(Y,N,g,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:ae([]),t(W.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[re,U,W,F,L,N,z,Y,B]),le=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),r=U.filter((function(e){return re.includes(e.key)})),a=[],c=15,o=x()(r.entries()),e.prev=8,o.s();case 10:if((i=o.n()).done){e.next=39;break}return l=s()(i.value,2),d=l[0],f=l[1],m=F,v=f,e.next=16,(0,A.Q8)({program:n,payerPubkey:m,currentProjectDataSource:W,currentProjectNftDataSource:v});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==r.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,y,a,L,H);case 27:return P=e.sent,g=P.transaction,w=P.feeMode,e.next=32,(0,E.pR)(Y,N,g,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:ae([]),t(W.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[re,U,W,F,L,N,z,Y,B]),de=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:G,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(W.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,G,Q,ee,W]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:de,dataSource:U,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,n,r){return[r[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){t(W.mintPubkey),ae([])},children:"更新"},"update"),r[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:re,onChange:function(e){ae(e)}},onSubmit:ce,onReset:ue,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!re.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:oe,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ie,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:le,shape:"square"},"3")]}),o,v]})},q=(0,r.memo)(z),Y=n(9783),$=n.n(Y),B=n(97857),H=n.n(B),U=n(26024),K=n(85418),W=n(58868);F().extend(N());var G=function(e){var t=e.handleCurrentProjectNfts,n=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=P.ZP.useNotification(),f=s()(l,2),h=f[0],v=f[1],C=(0,T.O)(),F=C.publicKey,L=C.wallet,N=C.signMessage,D=C.signAllTransactions,z=(0,_.z)(),q=(0,V.R)().connection,Y=(0,I.A)(),B=Y.chain,G=Y.modalFeeRef,J=(0,r.useState)(!1),Q=s()(J,2),X=Q[0],ee=Q[1],te=(0,r.useState)({}),ne=s()(te,2),re=ne[0],ae=ne[1],se=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV2})),ce=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV2})),ue=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),oe=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsBuyDataV2})),ie=(0,r.useMemo)((function(){var e=new Set;se.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],r=x()(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({text:a,value:a})}}catch(e){r.e(e)}finally{r.f()}return n}),[se]),le=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),de=(0,r.useMemo)((function(){if(!se.length)return"";var e=new Set;return se.forEach((function(t){e.add(t.ownerPubkey)})),"(".concat(e.size,")")}),[se]),fe=(0,r.useMemo)((function(){if(!se.length)return"";var e=0;return se.forEach((function(t){e+=t.invest})),"(".concat((e/O.LAMPORTS_PER_SOL).toFixed(0),")")}),[se]),pe=(0,r.useMemo)((function(){if(!se.length)return"";var e=0;return se.forEach((function(t){e+=t.price})),"(".concat((e/O.LAMPORTS_PER_SOL).toFixed(0),")")}),[se]),he=(0,r.useMemo)((function(){var e=oe.durable;if(0===e)return"";if(e<60)return"(".concat(e.toFixed(0),"秒)");if(e>=60&&e<3600){var t=Math.floor(e/60),n=e%60;return"(".concat(t,"分").concat(n,"秒)")}var r=Math.floor(e/3600),a=(e-3600*r)/60;return"(".concat(r,"时").concat(a,"分)")}),[oe]),me=(0,r.useMemo)((function(){return ue.profitRate?"(".concat(ue.profitRate.toFixed(2),"%)"):""}),[ue]),ve=(0,r.useState)([]),xe=s()(ve,2),be=xe[0],ke=xe[1],je=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ye=(0,r.useCallback)((function(e){var t=e.ownerPubkey,r=se.filter((function(e){return e.ownerPubkey===t}));n(b.N.setCurrentProjectNftsDataSourceV2(r))}),[se]),Se=(0,r.useCallback)((function(){n(b.N.setCurrentProjectNftsDataSourceV2(ce))}),[ce]),Pe=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(je));case 3:return e.next=5,(0,A.qj)(F.toString(),N);case 5:n=e.sent,r=n.user,a=r.referral,c=new Z.$r(W,new Z.Y7(q,z,Z.Y7.defaultOptions())),o=se.filter((function(e){return be.includes(e.key)})),i=5,l=[],d=[],f=x()(o.entries()),e.prev=14,f.s();case 16:if((m=f.n()).done){e.next=31;break}return v=s()(m.value,2),b=v[0],k=v[1],j=k.nftPubkey,y=k.ownerPubkey,S=F,P=a,2,e.next=25,(0,A.G4)({program:c,nftPubkey:j,currentOwnerPubkey:y,payerPubkey:S,currentProjectDataSource:ue,userReferral:P,payMode:2});case 25:g=e.sent,l.push(g),(w=b+1)%i!=0&&w!==o.length||(d.push(l),l=[]);case 29:e.next=16;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(14),f.e(e.t0);case 36:return e.prev=36,f.f(),e.finish(36);case 39:return e.next=41,q.getLatestBlockhash();case 41:return C=e.sent,R=C.blockhash,O=C.lastValidBlockHeight,I=new Array(d.length).fill(R),e.next=47,(0,E.Gw)(q,L,I,d,D,G);case 47:return T=e.sent,_=T.transactions,V=T.feeMode,Y=I.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:O}})),e.next=53,(0,E.fv)({chain:B,connection:q,wallet:L,transactions:_,strategys:Y,notificationApi:h,feeMode:V});case 53:t(ue.mintPubkey),e.next=59;break;case 56:e.prev=56,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 59:case"end":return e.stop()}}),e,null,[[0,56],[14,33,36,39]])}))),[be,se,ue,F,D,L,N,q,B]),ge=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(je));case 3:n=new Z.$r(W,new Z.Y7(q,z,Z.Y7.defaultOptions())),r=se.filter((function(e){return be.includes(e.key)})),a=18,c=[],o=[],i=x()(r.entries()),e.prev=9,i.s();case 11:if((l=i.n()).done){e.next=23;break}return d=s()(l.value,2),f=d[0],m=d[1],v=F,b=m,e.next=17,(0,A.Q9)({program:n,payerPubkey:v,currentProjectDataSource:ue,currentProjectNftDataSource:b,index:f});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==r.length||(o.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,P=y.lastValidBlockHeight,g=new Array(o.length).fill(S),e.next=39,(0,E.Gw)(q,L,g,o,D,G);case 39:w=e.sent,C=w.transactions,R=w.feeMode,O=x()(C),e.prev=43,O.s();case 45:if((I=O.n()).done){e.next=55;break}return T=I.value,e.next=49,(0,E.pR)(q,L,T,R);case 49:return _=e.sent,V={signature:_,blockhash:S,lastValidBlockHeight:P},e.next=53,(0,E.fS)(B,q,V,"confirmed",h,u);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),O.e(e.t1);case 60:return e.prev=60,O.f(),e.finish(60);case 63:ke([]),t(ue.mintPubkey),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,u,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[be,se,ue,F,D,L,N,q,B]),we=(0,r.useCallback)(m()(p()().mark((function e(){var n,r,a,c,o,i,l,d,f,m,v,b,k,j,y,S,P,g,w,C,R,O;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(je));case 3:n=new Z.$r(W,new Z.Y7(q,z,Z.Y7.defaultOptions())),r=se.filter((function(e){return be.includes(e.key)})),a=5,c=[],o=[],i=x()(r.entries()),e.prev=9,i.s();case 11:if((l=i.n()).done){e.next=23;break}return d=s()(l.value,2),f=d[0],m=d[1],v=F,b=m,e.next=17,(0,A.mn)({program:n,payerPubkey:v,currentProjectDataSource:ue,currentProjectNftDataSource:b});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==r.length||(o.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,P=y.lastValidBlockHeight,g=new Array(o.length).fill(S),e.next=39,(0,E.Gw)(q,L,g,o,D,G);case 39:return w=e.sent,C=w.transactions,R=w.feeMode,O=g.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:P}})),e.next=45,(0,E.fv)({chain:B,connection:q,wallet:L,transactions:C,strategys:O,notificationApi:h,feeMode:R});case 45:ke([]),t(ue.mintPubkey),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[be,se,ue,F,D,L,N,q,B]),Ce=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,hidden:re.key,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,hidden:re.nftId,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",hidden:re.status,filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者".concat(de),dataIndex:"ownerPubkey",key:"ownerPubkey",hidden:re.ownerPubkey,filters:ie,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本".concat(fe),dataIndex:"invest",key:"invest",hidden:re.invest,sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格".concat(pe),dataIndex:"price",key:"price",hidden:re.price,sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润".concat(me),dataIndex:"profit",key:"profit",hidden:re.profit,sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间".concat(he),dataIndex:"lastTrade",key:"buyTime",hidden:re.buyTime,sorter:function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"burnTime",hidden:re.burnTime,sorter:function(e,t){return e.burnTimeLocalValue-t.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"burnCountdown",hidden:re.burnCountdown,search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[fe,ie,de,pe,ue,he,re]),Fe=(0,r.useMemo)((function(){return[{label:"key",key:"key"},{label:"nftId",key:"nftId"},{label:"状态",key:"status"},{label:"持有者",key:"ownerPubkey"},{label:"投入成本",key:"invest"},{label:"当前价格",key:"price"},{label:"卖出利润",key:"profit"},{label:"购买时间",key:"buyTime"},{label:"销毁时间",key:"burnTime"},{label:"销毁倒计时",key:"burnCountdown"}]}),[]),Le=(0,r.useCallback)((function(e,t){("trigger"===t.source||e)&&ee(e)}),[]),Ne=(0,r.useCallback)((function(e){re[e.key]?ae(H()(H()({},re),{},$()({},e.key,!1))):ae(H()(H()({},re),{},$()({},e.key,!0)))}),[re]),Re=(0,r.useCallback)((function(t,n,r){return[(0,i.jsx)(K.Z,{menu:{items:Fe,selectable:!0,multiple:!0,onClick:Ne},trigger:["click"],placement:"bottomRight",arrow:!0,onOpenChange:Le,open:X,children:(0,i.jsx)(g.ZP,{type:"primary",children:(0,i.jsx)(U.Z,{})})},"filter"),r[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(ue.mintPubkey)},children:"更新"},"update"),r[0]]}),[e,ue,Fe,X,Ne]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:le,size:"large"},scroll:{x:!0},size:"small",columns:Ce,dataSource:se,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:Re},rowSelection:{type:"checkbox",selectedRowKeys:be,onChange:function(e){ke(e)}},onSubmit:ye,onReset:Se,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!be.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:Pe,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ge,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:we,shape:"square"},"3")]}),o,v]})},J=(0,r.memo)(G);F().extend(N());var Q=function(e){var t=e.handleCurrentProjectUserNfts,n=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),o=s()(u,2),l=o[0],f=o[1],h=P.ZP.useNotification(),v=s()(h,2),b=v[0],g=v[1],C=(0,T.O)(),F=C.publicKey,L=C.signTransaction,N=C.wallet,z=C.signMessage,q=(0,_.z)(),Y=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,r.useMemo)((function(){var e=new Set;n.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],a=x()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;r.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return r}),[n]),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),W=(0,r.useMemo)((function(){var e=new Set;return n.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[n]),G=(0,r.useMemo)((function(){var e=0;return n.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[n]),J=(0,r.useMemo)((function(){var e=0;return n.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[n]),Q=(0,r.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],ne=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),re=(0,r.useCallback)(m()(p()().mark((function e(){var r,c,u,o,i,d,f,h,m,v,k,j,y,S,P,g,w,C,R,O,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",l.error(ne));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=n.filter((function(e){return ee.includes(e.key)})),u=[],o=20,i=x()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],m=f[1],v=F,k=m,e.next=16,(0,A.Km)({program:r,payerPubkey:v,currentProjectDataSource:a,currentProjectNftDataSource:k,index:h});case 16:if(j=e.sent,u.push(j),(y=h+1)%o!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,P=S.blockhash,g=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,P,u,L,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,N,C,R);case 32:return O=e.sent,I={signature:O,blockhash:P,lastValidBlockHeight:g},e.next=36,(0,E.fS)(B,Y,I,"confirmed",b,l);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),i.e(e.t0);case 44:return e.prev=44,i.f(),e.finish(44);case 47:te([]),t(a.mintPubkey,F.toString()),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,n,a,F,L,N,z,Y,B]),ae=(0,r.useCallback)(m()(p()().mark((function e(){var r,c,u,o,i,d,f,h,m,v,k,j,y,S,P,g,w,C,R,O,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",l.error(ne));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=n.filter((function(e){return ee.includes(e.key)})),u=[],o=15,i=x()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],m=f[1],v=F,k=m,e.next=16,(0,A.Q8)({program:r,payerPubkey:v,currentProjectDataSource:a,currentProjectNftDataSource:k});case 16:if(j=e.sent,u.push(j),(y=h+1)%o!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,P=S.blockhash,g=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,P,u,L,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,N,C,R);case 32:return O=e.sent,I={signature:O,blockhash:P,lastValidBlockHeight:g},e.next=36,(0,E.fS)(B,Y,I,"confirmed",b,l);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),i.e(e.t0);case 44:return e.prev=44,i.f(),e.finish(44);case 47:te([]),t(a.mintPubkey,F.toString()),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,n,a,F,L,N,z,Y,B]),se=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(W,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:U,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,U,W,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:K,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:n,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:re,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,g]})},X=(0,r.memo)(Q);F().extend(N());var ee=function(e){var t=e.handleCurrentProjectUserNfts,n=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),o=s()(u,2),l=o[0],f=o[1],h=P.ZP.useNotification(),v=s()(h,2),b=v[0],g=v[1],C=(0,T.O)(),F=C.publicKey,L=C.signAllTransactions,N=C.wallet,D=C.signMessage,z=(0,_.z)(),q=(0,V.R)().connection,Y=(0,I.A)(),$=Y.chain,B=Y.modalFeeRef,H=(0,r.useMemo)((function(){var e=new Set;n.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],a=x()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;r.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return r}),[n]),U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),K=(0,r.useMemo)((function(){var e=new Set;return n.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[n]),G=(0,r.useMemo)((function(){var e=0;return n.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[n]),J=(0,r.useMemo)((function(){var e=0;return n.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[n]),Q=(0,r.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],ne=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),re=(0,r.useCallback)(m()(p()().mark((function e(){var r,c,u,o,i,d,f,h,m,v,k,j,y,S,P,g,w,C,R,O,I,T,_,V,Y,H;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&D&&z){e.next=3;break}return e.abrupt("return",l.error(ne));case 3:r=new Z.$r(W,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=n.filter((function(e){return ee.includes(e.key)})),u=18,o=[],i=[],d=x()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),m=h[0],v=h[1],k=F,j=v,e.next=17,(0,A.Q9)({program:r,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j,index:m});case 17:y=e.sent,o.push(y),(S=m+1)%u!=0&&S!==c.length||(i.push(o),o=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return P=e.sent,g=P.blockhash,w=P.lastValidBlockHeight,C=new Array(i.length).fill(g),e.next=39,(0,E.Gw)(q,N,C,i,L,B);case 39:R=e.sent,O=R.transactions,I=R.feeMode,T=x()(O),e.prev=43,T.s();case 45:if((_=T.n()).done){e.next=55;break}return V=_.value,e.next=49,(0,E.pR)(q,N,V,I);case 49:return Y=e.sent,H={signature:Y,blockhash:g,lastValidBlockHeight:w},e.next=53,(0,E.fS)($,q,H,"confirmed",b,l);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),T.e(e.t1);case 60:return e.prev=60,T.f(),e.finish(60);case 63:te([]),t(a.mintPubkey,F.toString()),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,l,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[ee,n,a,F,L,N,D,q,$]),ae=(0,r.useCallback)(m()(p()().mark((function e(){var r,c,u,o,i,d,f,h,m,v,k,j,y,S,P,g,w,C,R,O,I,T;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&D&&z){e.next=3;break}return e.abrupt("return",l.error(ne));case 3:r=new Z.$r(W,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=n.filter((function(e){return ee.includes(e.key)})),u=5,o=[],i=[],d=x()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),m=h[0],v=h[1],k=F,j=v,e.next=17,(0,A.mn)({program:r,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j});case 17:y=e.sent,o.push(y),(S=m+1)%u!=0&&S!==c.length||(i.push(o),o=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return P=e.sent,g=P.blockhash,w=P.lastValidBlockHeight,C=new Array(i.length).fill(g),e.next=39,(0,E.Gw)(q,N,C,i,L,B);case 39:return R=e.sent,O=R.transactions,I=R.feeMode,T=C.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:w}})),e.next=45,(0,E.fv)({chain:$,connection:q,wallet:N,transactions:O,strategys:T,notificationApi:b,feeMode:I});case 45:te([]),t(a.mintPubkey,F.toString()),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[ee,n,a,F,L,N,D,q,$]),se=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(K,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:H,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:$})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,H,K,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:U,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:n,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:re,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,g]})},te=(0,r.memo)(ee);F().extend(N());var ne=function(e){var t=(0,y.useDispatch)(),n=(0,I.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV1})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV1})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV1})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),o=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV1})),l=(0,r.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,n=[],r=x()(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({text:a,value:a})}}catch(e){r.e(e)}finally{r.f()}return n}),[s]),d=(0,r.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,r.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[s]),p=(0,r.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[s]),h=(0,r.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[s]),m=(0,r.useCallback)((function(e){var n=e.owner,r=s.filter((function(e){return e.owner===n}));t(b.N.setCurrentProjectNftsRankDataSourceV1(r))}),[s]),v=(0,r.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV1(a))}),[a]),k=(0,r.useCallback)((function(t,n,r){return[r[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),r[0]]}),[e,u]),S=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:l,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:n})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}}]}),[l,d,p,d,c,h,n]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:o,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:m,onReset:v,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},re=(0,r.memo)(ne),ae=n(83062),se=n(25035);F().extend(N());var ce=function(e){var t=(0,y.useDispatch)(),n=(0,r.useState)(!1),a=s()(n,2),c=a[0],u=a[1],o=(0,r.useState)({}),l=s()(o,2),d=l[0],f=l[1],p=(0,I.A)().chain,h=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV2})),m=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV2})),v=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV2})),k=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),S=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),P=(0,r.useMemo)((function(){var e=new Set;m.forEach((function(t){e.add(t.owner)}));var t,n=[],r=x()(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push({text:a,value:a})}}catch(e){r.e(e)}finally{r.f()}return n}),[m]),w=(0,r.useMemo)((function(){var e=new Set;return m.forEach((function(t){e.add(t.owner)})),e.size}),[m]),C=(0,r.useMemo)((function(){var e=0;return m.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[m]),F=(0,r.useMemo)((function(){var e=0;return m.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[m]),L=(0,r.useMemo)((function(){var e=0;return m.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[m]),N=(0,r.useCallback)((function(){return(0,i.jsxs)("div",{children:["抢图时长(秒)",(0,i.jsx)(ae.Z,{title:"抢图时长只统计成功的交易，失败的交易没有统计进去。抢图数量大并且时间短的并不一定是速度快，很有可能是存在很多失败的交易，实际情况以链上的记录为准，这里只是做简单的参考。",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),[]),T=(0,r.useCallback)((function(){return(0,i.jsxs)("div",{children:["网络费SOL",(0,i.jsx)(ae.Z,{title:"只统计成功交易的GAS费用，失败交易损耗的GAS费用不统计",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),[]),_=(0,r.useCallback)((function(e){var n=e.owner,r=m.filter((function(e){return e.owner===n}));t(b.N.setCurrentProjectNftsRankDataSourceV2(r))}),[m]),V=(0,r.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV2(h))}),[h]),A=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,hidden:d.key,render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"持有者(".concat(w,")"),dataIndex:"owner",key:"owner",hidden:d.owner,filters:P,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:p})}},{title:"持有数量(".concat(v.nftNumber,")"),dataIndex:"number",key:"number",hidden:d.number,sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",hidden:d.percent,search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(L.toFixed(4),")"),dataIndex:"balance",key:"balance",hidden:d.balance,sorter:function(e,t){return e.balance-t.balance},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(C.toFixed(4),")"),dataIndex:"invest",key:"invest",hidden:d.invest,sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(F.toFixed(4),")"),dataIndex:"profit",key:"profit",hidden:d.profit,sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:T(),dataIndex:"fee",key:"fee",hidden:d.fee,sorter:function(e,t){return e.fee+e.tip-t.durable-t.tip},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)((t.fee+t.tip)/O.LAMPORTS_PER_SOL,6)})}},{title:"空投DFS(".concat((C/10).toFixed(2),")"),dataIndex:"invest",key:"airdrop",hidden:d.airdrop,sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(t.invest/O.LAMPORTS_PER_SOL/10).toFixed(2)})}},{title:N(),dataIndex:"durable",key:"durable",hidden:d.durable,sorter:function(e,t){return e.durable-t.durable},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.durable})}}]}),[P,w,F,w,v,L,d,p]),Z=(0,r.useMemo)((function(){return[{label:"key",key:"key"},{label:"持有者",key:"owner"},{label:"持有数量",key:"number"},{label:"持有占比",key:"percent"},{label:"账号余额",key:"balance"},{label:"投入成本",key:"invest"},{label:"卖出利润",key:"profit"},{label:"网络费SOL",key:"fee"},{label:"空投DFS",key:"airdrop"},{label:"抢图时长",key:"durable"}]}),[]),D=(0,r.useCallback)((function(e,t){("trigger"===t.source||e)&&u(e)}),[]),E=(0,r.useCallback)((function(e){d[e.key]?f(H()(H()({},d),{},$()({},e.key,!1))):f(H()(H()({},d),{},$()({},e.key,!0)))}),[d]),z=(0,r.useCallback)((function(t,n,r){return[(0,i.jsx)(K.Z,{menu:{items:Z,selectable:!0,multiple:!0,onClick:E},trigger:["click"],placement:"bottomRight",arrow:!0,onOpenChange:D,open:c,children:(0,i.jsx)(g.ZP,{type:"primary",children:(0,i.jsx)(U.Z,{})})},"filter"),r[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(k.mintPubkey)},children:"更新"},"update"),r[0]]}),[e,k,Z,c,E]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:S,size:"large"},scroll:{x:!0},size:"small",columns:A,dataSource:m,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:z},onSubmit:_,onReset:V,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},ue=(0,r.memo)(ce);F().extend(N());var oe=function(){var e=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsGrowV2})),t=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),n=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),a=(0,r.useMemo)((function(){return t.secPerRound/3600+"小时"}),[t]),s=(0,r.useMemo)((function(){return t.profitRate.toFixed(2)+"%"}),[t]),c=(0,r.useMemo)((function(){return t.profitRateCreator.toFixed(1)+"%"}),[t]),u=(0,r.useMemo)((function(){return t.profitRateInviter.toFixed(1)+"%"}),[t]),o=(0,r.useMemo)((function(){return t.profitRatePlatform.toFixed(1)+"%"}),[t]),l=(0,r.useMemo)((function(){return(t.tradeFeeRate-t.profitRateCreator-t.profitRateInviter).toFixed(1)+"%"}),[t]),d=(0,r.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,i.jsx)("span",{children:n+1})}},{title:"轮次时间(".concat(a,")"),dataIndex:"roundLocalFormat",key:"roundLocalFormat",render:function(e,t){return(0,i.jsx)("div",{children:t.roundLocalFormat})}},{title:"NFT数量",dataIndex:"nftCount",key:"nftCount",render:function(e,t){return(0,i.jsx)("div",{children:t.nftCount})}},{title:"投入成本",dataIndex:"invest",key:"invest",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,2)})}},{title:"抢图利润(".concat(s,")"),dataIndex:"profitUser",key:"profitUser",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitUser/O.LAMPORTS_PER_SOL)})}},{title:"创建者利润(".concat(c,")"),dataIndex:"profitCreator",key:"profitCreator",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitCreator/O.LAMPORTS_PER_SOL)})}},{title:"邀请人利润(".concat(u,")"),dataIndex:"profitInviter",key:"profitInviter",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitInviter/O.LAMPORTS_PER_SOL)})}},{title:"平台利润(".concat(o,")"),dataIndex:"profitPlatform",key:"profitPlatform",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitPlatform/O.LAMPORTS_PER_SOL)})}},{title:"资金池(".concat(l,")"),dataIndex:"vaultSol",key:"vaultSol",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.vaultSol/O.LAMPORTS_PER_SOL)})}}]}),[a,s,c,u,o,l]);return(0,i.jsx)("div",{className:"ppp-tab-grow",children:(0,i.jsx)(j.Z,{loading:{spinning:n,size:"large"},scroll:{x:!0},size:"small",columns:d,dataSource:e,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})})},ie=(0,r.memo)(oe),le=n(87603),de=n(38345),fe=function(){return(0,i.jsxs)(de.Z,{title:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"400px"},children:[(0,i.jsx)("div",{className:"font-semibold mb-2",children:"1. 操作步骤："}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["1） 连接钱包 ",(0,i.jsx)(le.Z,{})," 打开“PPP-Nonce账号”页面 ",(0,i.jsx)(le.Z,{})," 创建Nonce账号：根据你想要抢到图片的数量3-5倍来创建；"]}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["2）打开“PPP-自动抢图”页面 ",(0,i.jsx)(le.Z,{})," 在“创建交易”表单输入：项目，购买方式，购买数量，每张图GAS费用（表单其项按需输入） ",(0,i.jsx)(le.Z,{})," 点击“运行”按钮 ",(0,i.jsx)(le.Z,{})," 签名（无时间限制）；"]}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["3）在“发送交易”表单，抢图会自动进行倒计时 ",(0,i.jsx)(le.Z,{})," 等待倒计时结束即可，表单输入项按需调整，发送设备要保持前台活跃状态；"]}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"4）倒计时结束后会自动进行发送，发送完成后可点击“校对”按钮，检查抢到的图片数量。"}),(0,i.jsx)("div",{className:"font-semibold mb-2",children:"2. 注意事项："}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"1）只需在抢图前进行签名即可，无时间限制；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"2）不支持OK钱包，因为预检交易通不过，钱包不让提前签名；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"3）以账号余额来控制你想要抢到图片的数量上限，而不是以购买数量和Nonce账号数量，同时购买数量和Nonce账号数量需要远远大于你想要抢到的图片数量上限，这有利于提高成功率；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"3）Nonce账号的数量需要根据你一次性抢多少张图来决定，假如你想一次性抢10张，建议创建30-50个Nonce账号，数量不要超过当前NFT流通量即可，超过了也不影响；Nonce账号只需要创建一次，会重复使用，也可以随时进行删除回收；Nonce账号数量决定了当前账号抢图数量的上限，Nonce账号数量多一些，有利于提高抢图成功率；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"4）关于每张图GAS费用，费用越高，出块节点打包你交易的优先权也越高，抢图成功率就越大。交易失败，不会扣除任何费用。"}),(0,i.jsx)("div",{className:"font-semibold mb-2",children:"3. 费用说明："}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"有两种方式可选择"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"1）免费：填写本工具的邀请码，工具会自动填入，无需手动操作；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"2）付费：按账号实际绑定的邀请码进行填写，无需手动操作。用户使用工具抢到的NFT，每个收取0.1%费用。例如工具抢到一个价值为0.1 SOL的NFT，则工具会收取0.0001 SOL作为费用，抢购成功了，才会收取。"})]})},pe=(0,r.memo)(fe),he=n(19632),me=n.n(he),ve=n(98165),xe=n(97269),be=n(64317),ke=n(31199),je=n(25054),ye=n(5966),Se=n(39678),Pe=n(7134),ge=n(48764).Buffer,we=function(){var e,t,n,a,c,u,o,l,d,f,h,v=(0,y.useIntl)(),k=v.formatMessage({id:"common.intlInputException"}),j=v.formatMessage({id:"common.intlPleaseConnectWallet"}),P=(0,y.useDispatch)(),g=S.ZP.useMessage(),w=s()(g,2),C=w[0],L=w[1],N=(0,r.useRef)(),R=(0,T.O)(),I=R.publicKey,z=R.signTransaction,q=R.signMessage,Y=R.wallet,$=(0,V.R)().connection,B=(0,_.z)(),H=(0,r.useState)(0),U=s()(H,2),K=U[0],W=U[1],G=(0,r.useState)(0),J=s()(G,2),Q=J[0],X=J[1],ee=(0,r.useState)(0),te=s()(ee,2),ne=te[0],re=te[1],ce=(0,r.useState)(!1),ue=s()(ce,2),oe=ue[0],ie=ue[1],le=(0,r.useState)(!1),fe=s()(le,2),pe=fe[0],he=fe[1],we=(0,r.useState)(),Ce=s()(we,2),Fe=Ce[0],Le=Ce[1],Ne=(0,r.useState)([]),Re=s()(Ne,2),Me=Re[0],Oe=Re[1],Ie=(0,r.useState)([]),Te=s()(Ie,2),_e=Te[0],Ve=Te[1],Ae=(0,r.useState)(0),Ze=s()(Ae,2),De=Ze[0],Ee=Ze[1],ze=(0,r.useState)(!1),qe=s()(ze,2),Ye=qe[0],$e=qe[1],Be=(0,r.useState)(!1),He=s()(Be,2),Ue=He[0],Ke=He[1],We=(0,r.useState)(1),Ge=s()(We,2),Je=Ge[0],Qe=Ge[1],Xe=(0,r.useState)([]),et=s()(Xe,2),tt=et[0],nt=et[1],rt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV1})),at=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),st=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),ct=(0,r.useState)([]),ut=s()(ct,2),ot=ut[0],it=ut[1],lt=(0,r.useState)({}),dt=s()(lt,2),ft=dt[0],pt=dt[1],ht=(0,r.useState)([]),mt=s()(ht,2),vt=mt[0],xt=mt[1],bt=(0,r.useState)([]),kt=s()(bt,2),jt=kt[0],yt=kt[1],St=(0,r.useState)(0),Pt=s()(St,2),gt=Pt[0],wt=Pt[1],Ct=(0,r.useCallback)((function(){wt(0),yt([]),xt([]),Ee(0),Ke(!1),$e(!1),Le(void 0),Oe([]),Ve([])}),[]),Ft=(0,r.useCallback)((function(){var e,t,n=null===(e=N.current)||void 0===e?void 0:e.getFieldsValue(),r=Object.keys(n).filter((function(e){return"projectId"!==e}));null===(t=N.current)||void 0===t||t.resetFields(r),Ct()}),[]),Lt=(0,r.useCallback)((function(){var e;null===(e=N.current)||void 0===e||e.resetFields(),Ct()}),[]),Nt=(0,r.useMemo)((function(){var e=(0,M.uf)(K/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(K/O.LAMPORTS_PER_SOL*Q,6);return Q?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[K,Q]),Rt=(0,r.useMemo)((function(){var e=(0,M.uf)(ne/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(ne/O.LAMPORTS_PER_SOL*Q,6);return Q?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[K,Q]),Mt=(0,r.useCallback)((function(e,t){var n=[];if(1===e)n=t.toSorted((function(){return Math.random()-.5}));else if(2===e)n=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)n=t.toSorted((function(e,t){var n=e.price;return t.price-n}));else if(4===e)n=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)n=t.filter((function(e){return e.split}));else if(6===e){var r,a=null===(r=N.current)||void 0===r?void 0:r.getFieldValue("accounts");a=a||[],n=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(7===e){var s,c=null===(s=N.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(n=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(8===e){var u,o=null===(u=N.current)||void 0===u?void 0:u.getFieldValue("nftIds");o=o||[],n=t.filter((function(e){return o.includes(e.nftId)}))}return Ve(n),n}),[]),Ot=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n,r,a){var s,c,u,o,i,l,d,f,h,m,v,b,k,j,y,S;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.buyCount,c=r.startNumber,u=r.endNumber,o=r.buyMode,i=Mt(o,a),!(c>i.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(i.length));case 4:if(!u){e.next=11;break}if(!(c>u)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:l=i.length>u?u:i.length,i=i.slice(c-1,l),e.next=12;break;case 11:i=i.slice(c-1);case 12:return d=function(e){var t,r=0,a=x()(e);try{for(a.s();!(t=a.n()).done;){if(t.value.ownerPubkey!==n.toString()){if(r>=s)return r;if(r>=1e3)return r;r+=1}}}catch(e){a.e(e)}finally{a.f()}return r},f=d(i),"#####NonceCountAccount#####",e.next=17,O.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",O.SystemProgram.programId);case 17:return h=e.sent,e.next=20,t.getAccountInfo(h);case 20:if(m=e.sent,v=[],b=[],k=0,m){e.next=26;break}throw Error("请先创建Nonce账号");case 26:if(k=(0,E.sT)(m.lamports),!(f>k)){e.next=29;break}throw Error("Nonce账号数量不足，需要大于等于图片购买数量");case 29:j=0;case 30:if(!(j<k)){e.next=40;break}return y="#####NonceAccount".concat(j+1,"#####"),e.next=35,O.PublicKey.createWithSeed(n,y,O.SystemProgram.programId);case 35:S=e.sent,v.push(S);case 37:++j,e.next=30;break;case 40:if(!v.length){e.next=45;break}return e.next=43,t.getMultipleParsedAccounts(v);case 43:e.sent.value.forEach((function(e,t){b.push({key:t,nonceAccount:v[t],authority:new O.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 45:return e.abrupt("return",{nonceAccounts:v,nonceAccountsData:b,nftsDataSource:i});case 46:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[]),It=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n,r,a,s,c,u,o,i,l,d,f,h,m,v,b,k,j,y,S,P,g,w,C,F,L,N,R,M,I,T,_,V,z,q,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.connection,r=t.payer,a=t.anchorWallet,s=t.signMessage,c=t.signTransaction,u=t.nftsDataSource,o=t.formData,i=t.nonceAccounts,l=t.nonceAccountsData,d=t.currentProjectDataSource,f=t.tipAccounts,h=t.tipFee,m=0,v=0,b=0,k=[],j=o.buyCount,y=o.payMode,e.next=8,(0,A.vo)(r.toString(),s);case 8:S=e.sent,P=S.user,g=P.referral,w=new Z.$r(D,new Z.Y7(n,a,Z.Y7.defaultOptions())),C=x()(u),e.prev=13,C.s();case 15:if((F=C.n()).done){e.next=48;break}if(L=F.value,L.ownerPubkey!==r.toString()){e.next=20;break}return e.abrupt("continue",46);case 20:if(!(m>=j)){e.next=22;break}return e.abrupt("break",48);case 22:return m+=1,(N=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:l[b].nonceAccount,authorizedPubkey:l[b].authority})),N.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:132284})),R=L.nftPubkey,M=L.ownerPubkey,I=r,T=g,e.next=32,(0,A.zt)({program:w,nftPubkey:R,currentOwnerPubkey:M,payerPubkey:I,currentProjectDataSource:d,userReferral:T,payMode:y});case 32:return _=e.sent,N.push(_),2===y&&g&&(V=Number((.001*L.price).toFixed(0)),N.push(O.SystemProgram.transfer({fromPubkey:r,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:V}))),N.push(O.SystemProgram.transfer({fromPubkey:r,toPubkey:new O.PublicKey(f[v]),lamports:h<1e3?1e3:Number(h.toFixed(0))})),z=new O.TransactionMessage({payerKey:r,recentBlockhash:l[b].blockhash,instructions:N}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),e.next=41,c(q);case 41:Y=e.sent,k.push({instructions:N,transaction:Y,transactionBase64:ge.from(Y.serialize()).toString("base64"),nft:L,tipFee:h,referral:g}),b=(b+1)%i.length,v=(v+1)%f.length,Ee(m);case 46:e.next=15;break;case 48:e.next=53;break;case 50:e.prev=50,e.t0=e.catch(13),C.e(e.t0);case 53:return e.prev=53,C.f(),e.finish(53);case 56:return e.abrupt("return",k);case 57:case"end":return e.stop()}}),e,null,[[13,50,53,56]])})));return function(t){return e.apply(this,arguments)}}(),[]),Tt=(0,r.useCallback)((function(e,t,n,r,a){var s,c,u=0,o=t.projectId,i=t.splitCount,l=r.tokenSymbol,d=r.nextRoundLocalFormat,f=n.length,p=e.toString(),h=(0,M.uf)(n[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),m=n[0].referral;n.forEach((function(e){u+=e.nft.price}));for(var v=a.includes(p)?(0,M.uf)(u/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*u/O.LAMPORTS_PER_SOL,8,"SOL"),x=F()().format("YYYY-MM-DDTHH:mm:ss"),b=Math.ceil(n.length/i),k=1,j=function(){var e=0,s=[],c=n.splice(0,b),u=c.length;c.forEach((function(t){s.push(t.nft.nftId),e+=t.nft.price}));var f=a.includes(p)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");s.sort((function(e,t){return e-t}));var v={projectId:o,instruction:"buy",totalTxCount:u,totalAmount:f,tipFee:h,referral:m,tokenSymbol:l,from:p,startNftId:s[0],endNftId:s[s.length-1],nftIds:s,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:r,transactions:c},j=JSON.stringify(v,null,2),y="data:,".concat(j),S=document.createElement("a");S.href=y,S.download=1===i||1===b?"".concat(l,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_").concat(x,"_buy.json"):"".concat(l,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_part").concat(k++,"_").concat(x,"_buy.json"),S.click()};n.length;)j();null===(s=N.current)||void 0===s||s.setFieldValue("totalAmountCreate",v),null===(c=N.current)||void 0===c||c.setFieldValue("totalTxCount",f),C.success("创建完成")}),[]),_t=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n,r,a,s,c;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Y&&I&&z&&B&&q&&Fe){e.next=4;break}return C.error(j),e.abrupt("return",!0);case 4:if("Simple Wallet"===Y.adapter.name){e.next=7;break}return C.error("只支持Simple Wallet"),e.abrupt("return",!0);case 7:return e.next=9,Ot($,I,t,Me);case 9:return n=e.sent,r=n.nonceAccounts,a=n.nonceAccountsData,s=n.nftsDataSource,e.next=15,It({connection:$,payer:I,anchorWallet:B,signMessage:q,signTransaction:z,nftsDataSource:s,formData:t,nonceAccounts:r,nonceAccountsData:a,currentProjectDataSource:Fe,tipAccounts:at,tipFee:K});case 15:if((c=e.sent).length){e.next=19;break}return C.info("没有需要创建的内容"),e.abrupt("return",!0);case 19:Tt(I,t,c,Fe,st),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),Ee(0),(0,M.Tv)(e.t0,C,"handleFinish");case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),[K,I,Y,z,B,q,Fe,Me,$,at,st]),Vt=(0,r.useCallback)((function(e,t,n,r){var a=Math.min.apply(Math,me()(e.map((function(e){return e.profit})))),s=0;1===n?s=a*t/100:2===n?s=r[t]*O.LAMPORTS_PER_SOL:3===n&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),W(s),re(a)}),[]),At=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n){var r,a,s,c,u,o,l,d,f,h,m,v,x,b,k,j,y,S,P;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,he(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*n,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,o={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},l=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),m=c(a["95th"]),v=c(a["99th"]),x=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),o["25th"]={sol:l,usd:x},o["50th"]={sol:d,usd:b},o["50th_ema"]={sol:f,usd:k},o["75th"]={sol:h,usd:j},o["95th"]={sol:m,usd:y},o["99th"]={sol:v,usd:S},(P=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),P.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),P.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),P.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),P.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),P.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),pt(a),it(P),he(!1),null===(r=N.current)||void 0===r||r.setFieldValue("tipFeeCreate","50th_ema"),Vt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),he(!1),(0,M.Tv)(e.t0,C,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),Zt=(0,r.useCallback)((function(e,t){var n,r=null===(n=N.current)||void 0===n?void 0:n.getFieldsValue(),a=r.buyMode,s=r.tipFeeCreate,c=r.tipMode,u=Mt(a,e);return Vt(u,s,c,t),wt(u.length),u.length}),[]),Dt=(0,r.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var n=Array.from(t),r=[];n.forEach((function(e){r.push({value:e,label:(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e})})})),xt(r)}),[]),Et=(0,r.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),yt(t)}),[]),zt=(0,r.useCallback)((function(e,t){var n,r,a,s,c=(null===(n=N.current)||void 0===n?void 0:n.getFieldsValue()).buyMode;6===c||7===c?($e(!0),Dt(e)):($e(!1),xt([]),null===(a=N.current)||void 0===a||a.setFieldValue("accounts",void 0));8===c?(Ke(!0),Et(e)):(Ke(!1),yt([]),null===(s=N.current)||void 0===s||s.setFieldValue("nftIds",void 0));Zt(e,t),null===(r=N.current)||void 0===r||r.resetFields(["buyCount","startNumber","endNumber"])}),[]),qt=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n){var r,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ie(!0),a=null===(r=N.current)||void 0===r?void 0:r.getFieldsValue(),s=a.projectId,Ft(),c=t.find((function(e){return e.mintPubkey===s})),e.next=7,(0,A.LE)(s,c);case 7:u=e.sent,o=u.currentProjectNftsDataSource,Zt(o,n),Oe(o),Le(c),ie(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),ie(!1),(0,M.Tv)(e.t0,C,"handleCurrentProjectNfts");case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),Yt=(0,r.useCallback)((function(e,t){var n,r,a=Zt(e,t);a?null===(n=N.current)||void 0===n||n.setFieldValue("buyCount",a):null===(r=N.current)||void 0===r||r.setFieldValue("buyCount",void 0)}),[]),$t=(0,r.useCallback)((function(e,t){var n,r,a=Zt(e,t);a?null===(n=N.current)||void 0===n||n.setFieldValue("buyCount",a):null===(r=N.current)||void 0===r||r.setFieldValue("buyCount",void 0)}),[]),Bt=(0,r.useCallback)((function(e,t){var n,r=null===(n=N.current)||void 0===n?void 0:n.getFieldsValue(),a=r.tipFeeCreate,s=r.tipMode;Vt(e,a,s,t)}),[]),Ht=(0,r.useCallback)((function(e,t,n){var r,a=(null===(r=N.current)||void 0===r?void 0:r.getFieldsValue()).tipMode;if(1===a){var s;null===(s=N.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),Vt(e,.1,a,t)}else if(2===a)At(e,n);else if(3===a){var c,u="0.000001";null===(c=N.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),Vt(e,u,a,t)}Qe(a)}),[]),Ut=(0,r.useCallback)((function(e){e.projectId&&qt(rt,ft),e.buyMode&&zt(Me,ft),e.nftIds&&Yt(Me,ft),e.accounts&&$t(Me,ft),e.tipMode&&Ht(Me,ft,Q),e.tipFeeCreate&&Bt(_e,ft)}),[rt,Me,gt,_e,ft,Q]),Kt=(0,r.useCallback)((function(e){var t=[];e.forEach((function(e){var n=e.nftIssueCount,r=e.nftBurnCount;if(0!==e.round&&n!==r){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(Pe.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),nt(t)}),[]),Wt=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ie(!0),e.next=4,(0,A.p5)();case 4:return t=e.sent,n=t.projects,r=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,Kt(r),X(a),P(b.N.setProjectsV1(n)),P(b.N.setProjectsDataSourceV1(r)),ie(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),ie(!1),(0,M.Tv)(e.t0,C,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]);return(0,r.useEffect)((function(){Wt()}),[]),(0,i.jsxs)(de.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(xe.A,{formRef:N,onFinish:_t,onValuesChange:Ut,onReset:Lt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:.1,payMode:1,tipMode:1,splitCount:1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],t[0],(0,i.jsx)("div",{children:De||""},"sign")]}},children:[(0,i.jsx)(be.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(ve.Z,{spin:oe,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:Wt})]}),options:tt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,n=e.tokenSymbol,r=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(Pe.C,{className:"mr-2",size:"default",src:r}),(0,M.Mn)()?(0,i.jsx)("div",{children:"".concat(n)}):(0,i.jsx)("div",{children:"".concat(n," - ").concat((0,M.LH)(t))})]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(be.Z,{name:"buyMode",label:"购买方式",options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 指定账号(顺序)"},{value:7,label:"7 指定账号(随机)"},{value:8,label:"8 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(e=N.current)&&void 0!==e&&e.getFieldValue("projectId"))}}),!!Ye&&(0,i.jsx)(be.Z,{name:"accounts",label:"选择账号",options:vt,fieldProps:{mode:"multiple",disabled:!(null!==(t=N.current)&&void 0!==t&&t.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),!!Ue&&(0,i.jsx)(be.Z,{name:"nftIds",label:"选择序号",options:jt,fieldProps:{mode:"multiple",disabled:!(null!==(n=N.current)&&void 0!==n&&n.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),(0,i.jsx)(ke.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=N.current)||void 0===e||e.setFieldValue("buyCount",gt),null===(t=N.current)||void 0===t||t.validateFields(["buyCount"])},children:gt?"(".concat(gt,")"):""})]}),placeholder:"",min:1,max:gt,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(a=N.current)&&void 0!==a&&a.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=N.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=N.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(be.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(o=N.current)&&void 0!==o&&o.getFieldValue("projectId"))}}),1===Je?(0,i.jsx)(je.Z,{name:"tipFeeCreate",label:Nt,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(l=N.current)&&void 0!==l&&l.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,2===Je?(0,i.jsx)(be.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(ve.Z,{spin:pe,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return At(Me,Q)}})]}),options:ot,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,3===Je?(0,i.jsx)(ye.Z,{name:"tipFeeCreate",label:Nt,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,(0,i.jsx)(be.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(d=N.current)&&void 0!==d&&d.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["交易文件数量",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(ye.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(f=N.current)&&void 0!==f&&f.getFieldValue("projectId"))}}),(0,i.jsx)(ye.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(h=N.current)&&void 0!==h&&h.getFieldValue("projectId"))}})]}),L]})},Ce=(0,r.memo)(we),Fe=n(84567),Le=n(20640),Ne=n.n(Le),Re=n(48764).Buffer,Me=function(e){var t,n,a,c,u,o,l,d,f,h,v,k,j,P=e.autoSweepSendRef,w=(0,y.useIntl)(),C=w.formatMessage({id:"common.intlInputException"}),L=w.formatMessage({id:"common.intlPleaseConnectWallet"}),N=(0,y.useDispatch)(),R=S.ZP.useMessage(),I=s()(R,2),D=I[0],z=I[1],q=(0,r.useRef)(),Y=(0,T.O)(),$=Y.publicKey,B=Y.signAllTransactions,H=Y.signMessage,U=Y.wallet,K=(0,V.R)().connection,G=(0,_.z)(),J=(0,r.useState)(0),Q=s()(J,2),X=Q[0],ee=Q[1],te=(0,r.useState)(0),ne=s()(te,2),re=ne[0],ce=ne[1],ue=(0,r.useState)(0),oe=s()(ue,2),ie=oe[0],le=oe[1],fe=(0,r.useState)(!1),pe=s()(fe,2),he=pe[0],ge=pe[1],we=(0,r.useState)(!1),Ce=s()(we,2),Le=Ce[0],Me=Ce[1],Oe=(0,r.useState)(),Ie=s()(Oe,2),Te=Ie[0],_e=Ie[1],Ve=(0,r.useState)([]),Ae=s()(Ve,2),Ze=Ae[0],De=Ae[1],Ee=(0,r.useState)([]),ze=s()(Ee,2),qe=ze[0],Ye=ze[1],$e=(0,r.useState)(0),Be=s()($e,2),He=Be[0],Ue=Be[1],Ke=(0,r.useState)(!1),We=s()(Ke,2),Ge=We[0],Je=We[1],Qe=(0,r.useState)(!1),Xe=s()(Qe,2),et=Xe[0],tt=Xe[1],nt=(0,r.useState)(2),rt=s()(nt,2),at=rt[0],st=rt[1],ct=(0,r.useState)(!0),ut=s()(ct,2),ot=ut[0],it=ut[1],lt=(0,r.useState)(),dt=s()(lt,2),ft=dt[0],pt=dt[1],ht=(0,r.useState)([]),mt=s()(ht,2),vt=mt[0],xt=mt[1],bt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV2})),kt=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),jt=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),yt=(0,r.useState)([]),St=s()(yt,2),Pt=St[0],gt=St[1],wt=(0,r.useState)({}),Ct=s()(wt,2),Ft=Ct[0],Lt=Ct[1],Nt=(0,r.useState)([]),Rt=s()(Nt,2),Mt=Rt[0],Ot=Rt[1],It=(0,r.useState)([]),Tt=s()(It,2),_t=Tt[0],Vt=Tt[1],At=(0,r.useState)(0),Zt=s()(At,2),Dt=Zt[0],Et=Zt[1],zt=(0,r.useCallback)((function(){Et(0),Vt([]),Ot([]),Ue(0),tt(!1),Je(!1),_e(void 0),De([]),Ye([]),pt(void 0)}),[]),qt=(0,r.useCallback)((function(){var e,t,n=null===(e=q.current)||void 0===e?void 0:e.getFieldsValue(),r=Object.keys(n).filter((function(e){return"projectId"!==e}));null===(t=q.current)||void 0===t||t.resetFields(r),zt()}),[]),Yt=(0,r.useCallback)((function(){var e;null===(e=q.current)||void 0===e||e.resetFields(),zt()}),[]),$t=(0,r.useMemo)((function(){var e=(0,M.uf)(X/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(X/O.LAMPORTS_PER_SOL*re,6);return re?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[X,re]),Bt=(0,r.useMemo)((function(){var e=(0,M.uf)(ie/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(ie/O.LAMPORTS_PER_SOL*re,6);return re?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[X,re]),Ht=(0,r.useCallback)((function(e,t){var n=[];if(1===e)n=t.toSorted((function(){return Math.random()-.5}));else if(2===e)n=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)n=t.toSorted((function(e,t){var n=e.price;return t.price-n}));else if(4===e)n=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)n=t.filter((function(e){return e.split}));else if(6===e)n=t.filter((function(e){return!e.split})).sort((function(){return Math.random()-.5}));else if(7===e){var r,a=null===(r=q.current)||void 0===r?void 0:r.getFieldValue("accounts");a=a||[],n=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(8===e){var s,c=null===(s=q.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(n=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(9===e){var u,o=null===(u=q.current)||void 0===u?void 0:u.getFieldValue("nftIds");o=o||[],n=t.filter((function(e){return o.includes(e.nftId)}))}return Ye(n),n}),[]),Ut=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n,r,a){var s,c,u,o,i,l,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.startNumber,c=r.endNumber,u=r.buyMode,o=Ht(u,a),!(s>o.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(o.length));case 4:if(!c){e.next=11;break}if(!(s>c)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:i=o.length>c?c:o.length,o=o.slice(s-1,i),e.next=12;break;case 11:o=o.slice(s-1);case 12:return l=[],e.next=15,(0,E.JH)(n,t);case 15:if((d=e.sent).forEach((function(e){l.push(e.nonceAccount)})),d.length){e.next=20;break}throw Error("请先创建Nonce账号");case 20:return e.abrupt("return",{nonceAccounts:l,nonceAccountsData:d,nftsDataSource:o});case 21:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[]),Kt=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n,r,a,s,c,u,o,i,l,d,f,h,m,v,b,k,j,y,S,P,g,w,C,F,L,N,R,M,I,T,_,V,D,z,q,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.connection,r=t.wallet,a=t.payer,s=t.anchorWallet,c=t.signMessage,u=t.signAllTransactions,o=t.nftsDataSource,i=t.formData,l=t.nonceAccounts,d=t.nonceAccountsData,f=t.currentProjectDataSource,h=t.tipAccounts,m=t.tipFee,v=0,b=0,k=0,j=[],y=i.buyCount,S=i.payMode,e.next=8,(0,A.qj)(a.toString(),c);case 8:P=e.sent,g=P.user,w=g.referral,C=new Z.$r(W,new Z.Y7(n,s,Z.Y7.defaultOptions())),F=x()(o),e.prev=13,F.s();case 15:if((L=F.n()).done){e.next=43;break}if(N=L.value,!(v>=y)){e.next=19;break}return e.abrupt("break",43);case 19:return v+=1,(R=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:d[k].nonceAccount,authorizedPubkey:d[k].authority})),R.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:47258})),"Simple Wallet"!==r.adapter.name&&R.push(O.ComputeBudgetProgram.setComputeUnitPrice({microLamports:0})),M=N.nftPubkey,I=N.ownerPubkey,T=a,_=w,e.next=30,(0,A.G4)({program:C,nftPubkey:M,currentOwnerPubkey:I,payerPubkey:T,currentProjectDataSource:f,userReferral:_,payMode:S});case 30:V=e.sent,R.push(V),2===S&&w&&(D=Number((.001*N.price).toFixed(0)),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:D}))),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey(h[b]),lamports:m<1e3?1e3:Number(m.toFixed(0))})),z=new O.TransactionMessage({payerKey:a,recentBlockhash:d[k].blockhash,instructions:R}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),j.push({instructions:R,transaction:q,transactionBase64:"",nft:N,tipFee:m,referral:w}),k=(k+1)%l.length,b=(b+1)%h.length,Ue(v);case 41:e.next=15;break;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(13),F.e(e.t0);case 48:return e.prev=48,F.f(),e.finish(48);case 51:return Y=j.map((function(e){return e.transaction})),e.next=54,u(Y);case 54:return e.sent.forEach((function(e,t){j[t].transaction=e,j[t].transactionBase64=Re.from(e.serialize()).toString("base64")})),e.abrupt("return",j);case 57:case"end":return e.stop()}}),e,null,[[13,45,48,51]])})));return function(t){return e.apply(this,arguments)}}(),[]),Wt=(0,r.useCallback)((function(e,t,n,r,a,s){var c,u,o=0,i=t.projectId,l=t.splitCount,d=r.tokenSymbol,f=r.nextRoundLocalFormat,p=n.length,h=a.length,m=e.toString(),v=(0,M.uf)(n[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),x=n[0].referral;n.forEach((function(e){o+=e.nft.price}));for(var b=s.includes(m)?(0,M.uf)(o/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*o/O.LAMPORTS_PER_SOL,8,"SOL"),k=F()().format("YYYY-MM-DDTHH:mm:ss"),j=Math.ceil(n.length/l),y=1,S=function(){var e=0,a=[],c=n.splice(0,j),u=c.length;c.forEach((function(t){a.push(t.nft.nftId),e+=t.nft.price}));var o=s.includes(m)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");a.sort((function(e,t){return e-t}));var p={projectId:i,instruction:"buy",totalTxCount:u,totalAmount:o,totalNonceCount:h,tipFee:v,referral:x,tokenSymbol:d,from:m,startNftId:a[0],endNftId:a[a.length-1],nftIds:a,nextRoundLocalFormat:f,formData:t,currentProjectDataSource:r,transactions:c},b=JSON.stringify(p,null,2),S="data:,".concat(b),P=document.createElement("a");P.href=S,P.download=1===l||1===j?"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_").concat(k,"_buy.json"):"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_part").concat(y++,"_").concat(k,"_buy.json"),P.click()};n.length;)S();null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",p),pt(void 0),D.success("创建完成")}),[]),Gt=(0,r.useCallback)((function(e,t,n,r,a,s){var c,u,o=0,i=t.projectId,l=r.tokenSymbol,d=r.nextRoundLocalFormat,f=n.length,p=a.length,h=e.toString(),m=(0,M.uf)(n[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),v=n[0].referral,x=[];n.forEach((function(e){x.push(e.nft.nftId),o+=e.nft.price}));var b=s.includes(h)?(0,M.uf)(o/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*o/O.LAMPORTS_PER_SOL,8,"SOL");x.sort((function(e,t){return e-t}));var k={projectId:i,instruction:"buy",totalTxCount:f,totalAmount:b,totalNonceCount:p,tipFee:m,referral:v,tokenSymbol:l,from:h,startNftId:x[0],endNftId:x[x.length-1],nftIds:x,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:r,transactions:n};null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",f),P.current.handleReset(),P.current.handleTransactionFileContent(k),pt(k),D.success("开始成功")}),[]),Jt=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a,s,c,u;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=null===(t=q.current)||void 0===t?void 0:t.getFieldsValue(),U&&$&&B&&G&&H&&Te){e.next=5;break}return D.error(L),e.abrupt("return",!0);case 5:if("OKX Wallet"!==U.adapter.name){e.next=8;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 8:return e.next=10,Ut(K,$,n,Ze);case 10:return r=e.sent,a=r.nonceAccounts,s=r.nonceAccountsData,c=r.nftsDataSource,e.next=16,Kt({connection:K,wallet:U,payer:$,anchorWallet:G,signMessage:H,signAllTransactions:B,nftsDataSource:c,formData:n,nonceAccounts:a,nonceAccountsData:s,currentProjectDataSource:Te,tipAccounts:kt,tipFee:X});case 16:if((u=e.sent).length){e.next=20;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 20:Gt($,n,u,Te,a,jt),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),Ue(0),(0,M.Tv)(e.t0,D,"handleFinishRun");case 27:case"end":return e.stop()}}),e,null,[[0,23]])}))),[X,$,U,B,G,H,Te,Ze,K,kt,jt]),Qt=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=q.current)||void 0===t?void 0:t.validateFields();case 2:if(e.prev=2,r=null===(n=q.current)||void 0===n?void 0:n.getFieldsValue(),U&&$&&B&&G&&H&&Te){e.next=7;break}return D.error(L),e.abrupt("return",!0);case 7:if("OKX Wallet"!==U.adapter.name){e.next=10;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 10:return e.next=12,Ut(K,$,r,Ze);case 12:return a=e.sent,s=a.nonceAccounts,c=a.nonceAccountsData,u=a.nftsDataSource,e.next=18,Kt({connection:K,wallet:U,payer:$,anchorWallet:G,signMessage:H,signAllTransactions:B,nftsDataSource:u,formData:r,nonceAccounts:s,nonceAccountsData:c,currentProjectDataSource:Te,tipAccounts:kt,tipFee:X});case 18:if((o=e.sent).length){e.next=22;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 22:Wt($,r,o,Te,s,jt),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(2),Ue(0),(0,M.Tv)(e.t0,D,"handleFinishCreate");case 29:case"end":return e.stop()}}),e,null,[[2,25]])}))),[X,$,U,B,G,H,Te,Ze,K,kt,jt]),Xt=(0,r.useCallback)((function(e,t,n,r){var a=Math.min.apply(Math,me()(e.map((function(e){return e.profit})))),s=0;1===n?s=a*t/100:2===n?s=r[t]*O.LAMPORTS_PER_SOL:3===n&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),ee(s),le(a)}),[]),en=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n){var r,a,s,c,u,o,l,d,f,h,m,v,x,b,k,j,y,S,P;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Me(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*n,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,o={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},l=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),m=c(a["95th"]),v=c(a["99th"]),x=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),o["25th"]={sol:l,usd:x},o["50th"]={sol:d,usd:b},o["50th_ema"]={sol:f,usd:k},o["75th"]={sol:h,usd:j},o["95th"]={sol:m,usd:y},o["99th"]={sol:v,usd:S},(P=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),P.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),P.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),P.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),P.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),P.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),Lt(a),gt(P),Me(!1),null===(r=q.current)||void 0===r||r.setFieldValue("tipFeeCreate","50th_ema"),Xt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),Me(!1),(0,M.Tv)(e.t0,D,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),tn=(0,r.useCallback)((function(e,t){var n,r=null===(n=q.current)||void 0===n?void 0:n.getFieldsValue(),a=r.buyMode,s=r.tipFeeCreate,c=r.tipMode,u=Ht(a,e);return Xt(u,s,c,t),Et(u.length),u.length}),[]),nn=(0,r.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var n=Array.from(t),r=[];n.forEach((function(e){r.push({value:e,label:(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e})})})),Ot(r)}),[]),rn=(0,r.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),Vt(t)}),[]),an=(0,r.useCallback)((function(e,t){var n,r,a,s,c=(null===(n=q.current)||void 0===n?void 0:n.getFieldsValue()).buyMode;7===c||8===c?(Je(!0),nn(e)):(Je(!1),Ot([]),null===(a=q.current)||void 0===a||a.setFieldValue("accounts",void 0));9===c?(tt(!0),rn(e)):(tt(!1),Vt([]),null===(s=q.current)||void 0===s||s.setFieldValue("nftIds",void 0));tn(e,t),null===(r=q.current)||void 0===r||r.resetFields(["buyCount","startNumber","endNumber"])}),[]),sn=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n,r,a){var s,c,u,o,i,l,d,f;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ge(!0),c=null===(s=q.current)||void 0===s?void 0:s.getFieldsValue(),u=c.projectId,qt(),o=t.find((function(e){return e.mintPubkey===u})),e.next=7,(0,A.D3)(u,o);case 7:return i=e.sent,l=i.currentProjectNftsDataSource,d=[],d=r&&n?l.filter((function(e){return e.ownerPubkey!==n.toString()})):l,e.next=13,en(d,a);case 13:f=e.sent,tn(d,f.levels),De(d),_e(o),ge(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),ge(!1),(0,M.Tv)(e.t0,D,"handleCurrentProjectNfts");case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),[]),cn=(0,r.useCallback)((function(e,t){var n,r,a=tn(e,t);a?null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",a):null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",void 0)}),[]),un=(0,r.useCallback)((function(e,t){var n,r,a=tn(e,t);a?null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",a):null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",void 0)}),[]),on=(0,r.useCallback)((function(e,t){var n,r=null===(n=q.current)||void 0===n?void 0:n.getFieldsValue(),a=r.tipFeeCreate,s=r.tipMode;Xt(e,a,s,t)}),[]),ln=(0,r.useCallback)((function(e,t,n){var r,a=(null===(r=q.current)||void 0===r?void 0:r.getFieldsValue()).tipMode;if(1===a){var s;null===(s=q.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),Xt(e,.1,a,t)}else if(2===a)en(e,n);else if(3===a){var c,u="0.000001";null===(c=q.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),Xt(e,u,a,t)}st(a)}),[]),dn=(0,r.useCallback)((function(e){e.projectId&&sn(bt,$,ot,re),e.buyMode&&an(Ze,Ft),e.nftIds&&cn(Ze,Ft),e.accounts&&un(Ze,Ft),e.tipMode&&ln(Ze,Ft,re),e.tipFeeCreate&&on(qe,Ft)}),[bt,Ze,Dt,qe,Ft,re,ot,$]),fn=(0,r.useCallback)((function(e){var t=[];e.forEach((function(e){var n=e.nftIssueCount,r=e.nftBurnCount;if(!(e.initNftSupply>n||r>0)){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(Pe.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),xt(t)}),[]),pn=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ge(!0),e.next=4,(0,A.yC)();case 4:return t=e.sent,n=t.projects,r=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,fn(r),ce(a),N(b.N.setProjectsV2(n)),N(b.N.setProjectsDataSourceV2(r)),ge(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),ge(!1),(0,M.Tv)(e.t0,D,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]),hn=(0,r.useCallback)((function(e){var t=e.target.checked;it(t),Yt()}),[]),mn=(0,r.useCallback)((function(){ft?Ne()(JSON.stringify(ft,null,2))?D.success("复制成功"):D.error("复制失败"):D.info("先运行，再进行复制")}),[ft]);return(0,r.useEffect)((function(){pn()}),[]),(0,i.jsxs)(de.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(xe.A,{formRef:q,onFinish:Jt,onValuesChange:dn,onReset:Yt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:"50th_ema",payMode:1,tipMode:2,splitCount:1},submitter:{searchConfig:{submitText:"运行"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{onClick:Qt,children:"创建"},"create"),(0,i.jsx)(g.ZP,{onClick:mn,children:"复制"},"copy"),t[0],(0,i.jsx)("div",{children:He||""},"sign")]}},children:[(0,i.jsx)(be.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(ve.Z,{spin:he,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:pn})]}),options:vt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,n=e.tokenSymbol,r=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(Pe.C,{className:"mr-2",size:"default",src:r}),(0,M.Mn)()?(0,i.jsx)("div",{children:"".concat(n)}):(0,i.jsx)("div",{children:"".concat(n," - ").concat((0,M.LH)(t))})]}),(0,i.jsx)(Se.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(be.Z,{name:"buyMode",label:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{children:"购买方式"}),(0,i.jsx)(Fe.Z,{checked:ot,onChange:hn,className:"ml-4",children:"不含本账号图片"})]}),options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 不抢拆分(随机)"},{value:7,label:"7 指定账号(顺序)"},{value:8,label:"8 指定账号(随机)"},{value:9,label:"9 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(t=q.current)&&void 0!==t&&t.getFieldValue("projectId"))}}),!!Ge&&(0,i.jsx)(be.Z,{name:"accounts",label:"选择账号",options:Mt,fieldProps:{mode:"multiple",disabled:!(null!==(n=q.current)&&void 0!==n&&n.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),!!et&&(0,i.jsx)(be.Z,{name:"nftIds",label:"选择序号",options:_t,fieldProps:{mode:"multiple",disabled:!(null!==(a=q.current)&&void 0!==a&&a.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),(0,i.jsx)(ke.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=q.current)||void 0===e||e.setFieldValue("buyCount",Dt),null===(t=q.current)||void 0===t||t.validateFields(["buyCount"])},children:Dt?"(".concat(Dt,")"):""})]}),placeholder:"",min:1,max:Dt,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=q.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=q.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(o=q.current)&&void 0!==o&&o.getFieldValue("projectId"))}}),(0,i.jsx)(be.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(l=q.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),1===at?(0,i.jsx)(je.Z,{name:"tipFeeCreate",label:$t,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(d=q.current)&&void 0!==d&&d.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,2===at?(0,i.jsx)(be.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(ve.Z,{spin:Le,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return en(Ze,re)}})]}),options:Pt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(f=q.current)&&void 0!==f&&f.getFieldValue("projectId"))},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,3===at?(0,i.jsx)(ye.Z,{name:"tipFeeCreate",label:$t,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(h=q.current)&&void 0!==h&&h.getFieldValue("projectId"))},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,(0,i.jsx)(be.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(v=q.current)&&void 0!==v&&v.getFieldValue("projectId"))}}),(0,i.jsx)(ke.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["拆分文件数量",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(ye.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(k=q.current)&&void 0!==k&&k.getFieldValue("projectId"))}}),(0,i.jsx)(ye.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(j=q.current)&&void 0!==j&&j.getFieldValue("projectId"))}})]}),z]})},Oe=(0,r.memo)(Me),Ie=n(91604),Te=n(52688),_e=n(66309),Ve=n(9669),Ae=n.n(Ve),Ze=[],De=function(){var e=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),t=S.ZP.useMessage(),n=s()(t,2),a=n[0],c=n[1],u=(0,r.useRef)(),o=(0,r.useRef)(),l=(0,r.useState)([]),f=s()(l,2),h=f[0],v=f[1],x=(0,r.useState)(),b=s()(x,2),k=b[0],j=b[1],P=(0,r.useState)(0),w=s()(P,2),C=w[0],L=w[1],N=(0,r.useState)(0),O=s()(N,2),I=O[0],T=O[1],_=(0,r.useState)(0),V=s()(_,2),Z=V[0],D=V[1],E=(0,r.useState)(0),z=s()(E,2),q=z[0],Y=z[1],$=(0,r.useState)(0),B=s()($,2),H=B[0],U=B[1],K=(0,r.useState)(0),W=s()(K,2),G=W[0],J=W[1],Q=(0,r.useState)(!1),X=s()(Q,2),ee=X[0],te=X[1],ne=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),re=(0,r.useRef)(!0),ce=(0,r.useRef)({}),ue=(0,r.useState)({}),oe=s()(ue,2),ie=oe[0],le=oe[1],fe=(0,r.useMemo)((function(){return k?"(".concat(k.tokenSymbol," ").concat(k.projectId.slice(0,4),"...").concat(k.projectId.slice(-4),")"):""}),[k]),pe=(0,r.useMemo)((function(){return k?"".concat(null==k?void 0:k.currentProjectDataSource.nextRoundLocalFormat):""}),[k]),he=(0,r.useCallback)((function(e){var t,n,r=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(r).filter((function(e){return"transactionFile"!==e}));if(null===(n=u.current)||void 0===n||n.resetFields(a),e){var s,c,o=e.currentProjectDataSource.lastRoundLocalValue,i=e.currentProjectDataSource.secPerRound,l=e.totalAmount,d=e.tipFee;L(o+1e3*i),j(e),null===(s=u.current)||void 0===s||s.setFieldValue("totalAmountSend",l),null===(c=u.current)||void 0===c||c.setFieldValue("tipFeeSend",d);var f={};e.nftIds.forEach((function(e){ce.current[e]="default",f[e]="default"})),le(f)}else{var p,h;L(0),j(void 0),null===(p=u.current)||void 0===p||p.setFieldValue("totalAmountSend",""),null===(h=u.current)||void 0===h||h.setFieldValue("tipFeeSend",""),ce.current={},le({})}T(0),D(0),Y(0),U(0),J(0)}),[]),me=(0,r.useCallback)((function(){var e,t,n;null===(e=u.current)||void 0===e||e.resetFields(),v([]),L(0),j(void 0),null===(t=u.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(n=u.current)||void 0===n||n.setFieldValue("tipFeeSend",""),ce.current={},le({}),T(0),D(0),Y(0),U(0),J(0)}),[]),ve=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return v(t.fileList),he(void 0),e.abrupt("return");case 5:(n=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),n.onload=function(){var e=JSON.parse(n.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(v(t.fileList),he(e),a.success("上传成功")):a.error("指令类型错误"):a.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,a,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),be=(0,r.useCallback)((function(){var e=0,t=0,n=0,r=0;for(var a in ce.current)"success"===ce.current[a]?t+=1:"error"===ce.current[a]?n+=1:"processing"===ce.current[a]?r+=1:"default"===ce.current[a]&&(e+=1);T(t),D(n),Y(r),U(e)}),[]),je=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n,r){var s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0;case 1:if(!(s<r)){e.next=16;break}Object.keys(ce.current).forEach((function(e){ce.current[e]="processing"})),be();case 4:return t.transactions.forEach(function(){var e=m()(p()().mark((function e(t,n){var r,a,s,c,u,o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.transactionBase64,a=t.nft.nftId,"success"!==(s=ce.current[a])&&"error"!==s){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,c=n%ne.length,u=ne[c]+"/api/v1/transactions?bundleOnly=true",e.next=10,Ae().post(u,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[r,{encoding:"base64",maxTry:0}]},{timeout:5e3});case 10:200===(o=e.sent).status?ce.current[a]="success":(ce.current[a]="error",Ze.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(o),pos:"try"})),e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(i=e.t0.response)||void 0===i?void 0:i.status)){e.next=18;break}return e.abrupt("return");case 18:ce.current[a]="error",Ze.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(e.t0),pos:"catch"});case 20:be();case 21:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,n){return e.apply(this,arguments)}}()),e.next=8,new Promise((function(e){setTimeout(e,n)}));case 8:if(0!==Object.values(ce.current).filter((function(e){return"processing"===e})).length){e.next=11;break}return e.abrupt("break",13);case 11:e.next=4;break;case 13:++s,e.next=1;break;case 16:a.success("发送完成");case 17:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[a]),Se=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return n=t.disorderSend,r=t.intervalSend,n&&k.transactions.sort((function(){return Math.random()-.5})),je(k,r,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),Pe=(0,r.useCallback)((function(){var e;if(!k)return a.error("请先上传交易文件"),!1;var t=(null===(e=u.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;je(k,t,1)}),[k]),ge=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),r=n.disorderSend,a=n.repeatSend,s=n.intervalSend,n.autoSend&&k){e.next=3;break}return e.abrupt("return");case 3:return r&&k.transactions.sort((function(){return Math.random()-.5})),je(k,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[k]),we=(0,r.useCallback)((function(e){var t,n,r=null===(t=u.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");r&&e<r&&re.current&&(re.current=!1,null===(n=u.current)||void 0===n||n.submit())}),[]),Ce=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,te(!0),t={},e.next=9,(0,A.tt)({mintPubkey:k.projectId});case 9:n=e.sent,r=0,k.nftIds.forEach((function(e){var a=k.from,s=n.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",r+=1):t[e]="default"})),J(r),le(t),te(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),te(!1),(0,M.Tv)(e.t0,a,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[a,k]),Fe=(0,r.useCallback)((function(){if(k&&Ze.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Ze,null,2),n="data:,".concat(t),r=document.createElement("a"),s=k.tokenSymbol,c=k.projectId;r.href=n,r.download="Log_".concat(s,"_").concat(c.slice(0,4),"_").concat(c.slice(-4),"_").concat(e,".json"),r.click()}else a.info("无日志信息")}),[k]);return(0,i.jsxs)(de.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(xe.A,{formRef:u,onFinish:Se,onReset:me,layout:"vertical",initialValues:{disorderSend:!0,autoSend:!0,repeatSend:3,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{onClick:Pe,children:"预检"},"preflight"),(0,i.jsx)(g.ZP,{loading:ee,onClick:Ce,children:"校对"},"check"),(0,i.jsx)(g.ZP,{onClick:Fe,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(Ie.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:ve,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return o.current.handleOpen(e)},fileList:h},rules:[{required:!0,whitespace:!0,message:"".concat(e),pattern:/.*/}]}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!k}}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:300,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!k}}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!k}}),(0,i.jsx)(Te.Z,{name:"disorderSend",label:(0,i.jsxs)("div",{children:["是否乱序",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"是否以乱序的方式来发送交易",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(Te.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(ye.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(ye.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(xe.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),fe]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:C,onFinish:ge,onChange:we}),(0,i.jsx)("div",{className:"text-2xl",children:pe})]})}),(0,i.jsxs)(xe.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),k?"(".concat(k.totalTxCount,")"):""]}),children:[(0,i.jsx)("div",{children:"完成：".concat(I,"，失败：").concat(Z,"，处理中：").concat(q,"，待处理：").concat(H)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(ce.current).map((function(e,t){return(0,i.jsx)(_e.Z,{color:ce.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(xe.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),k?"(".concat(k.totalTxCount,")"):"",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(G)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(ie).map((function(e,t){return(0,i.jsx)(_e.Z,{color:ie[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(R.VY,{ref:o}),c]})},Ee=(0,r.memo)(De),ze=n(99611),qe=n(90420),Ye=[],$e=(0,r.forwardRef)((function(e,t){var n=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=(0,r.useRef)(),f=(0,r.useRef)(),h=(0,r.useState)([]),v=s()(h,2),x=v[0],b=v[1],k=(0,r.useState)(),j=s()(k,2),P=j[0],w=j[1],C=(0,r.useState)(0),L=s()(C,2),N=L[0],O=L[1],I=(0,r.useState)(0),T=s()(I,2),_=T[0],V=T[1],Z=(0,r.useState)(0),D=s()(Z,2),E=D[0],z=D[1],q=(0,r.useState)(0),Y=s()(q,2),$=Y[0],B=Y[1],H=(0,r.useState)(0),U=s()(H,2),K=U[0],W=U[1],G=(0,r.useState)(0),J=s()(G,2),Q=J[0],X=J[1],ee=(0,r.useState)(0),te=s()(ee,2),ne=te[0],re=te[1],ce=(0,r.useState)(!1),ue=s()(ce,2),oe=ue[0],ie=ue[1],le=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),fe=(0,r.useRef)(0),pe=(0,r.useRef)(!0),he=(0,r.useRef)({}),me=(0,r.useState)({}),ve=s()(me,2),be=ve[0],je=ve[1],Se=(0,r.useState)(!1),Pe=s()(Se,2),ge=Pe[0],we=Pe[1],Ce=(0,r.useState)(!1),Fe=s()(Ce,2),Le=Fe[0],Ne=Fe[1],Re=(0,r.useMemo)((function(){return P?"(".concat(P.tokenSymbol," ").concat(P.projectId.slice(0,4),"...").concat(P.projectId.slice(-4),")"):""}),[P]),Me=(0,r.useMemo)((function(){return P?"".concat(null==P?void 0:P.currentProjectDataSource.nextRoundLocalFormat):""}),[P]),Oe=(0,r.useCallback)((function(e){var t,n,r=null===(t=l.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(r).filter((function(e){return"transactionFile"!==e}));if(null===(n=l.current)||void 0===n||n.resetFields(a),e){var s,c,u=e.currentProjectDataSource.nextRoundLocalValue,o=e.totalAmount,i=e.tipFee;O(u),w(e),null===(s=l.current)||void 0===s||s.setFieldValue("totalAmountSend",o),null===(c=l.current)||void 0===c||c.setFieldValue("tipFeeSend",i);var d={};he.current={},e.nftIds.forEach((function(e){he.current[e]="default",d[e]="default"})),je(d)}else{var f,p;O(0),w(void 0),null===(f=l.current)||void 0===f||f.setFieldValue("totalAmountSend",""),null===(p=l.current)||void 0===p||p.setFieldValue("tipFeeSend",""),he.current={},je({})}V(0),z(0),B(0),W(0),X(0),re(0)}),[]),Ve=(0,r.useCallback)((function(){var e,t,n;null===(e=l.current)||void 0===e||e.resetFields(),b([]),O(0),w(void 0),null===(t=l.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(n=l.current)||void 0===n||n.setFieldValue("tipFeeSend",""),he.current={},je({}),V(0),z(0),B(0),W(0),X(0),re(0)}),[]);(0,r.useImperativeHandle)(t,(function(){return{handleTransactionFileContent:Oe,handleReset:Ve}}));var Ze=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return b(t.fileList),Oe(void 0),e.abrupt("return");case 5:(n=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),n.onload=function(){var e=JSON.parse(n.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(b(t.fileList),Oe(e),u.success("上传成功")):u.error("指令类型错误"):u.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,u,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),De=(0,r.useCallback)((function(){var e=0,t=0,n=0,r=0,a=0;for(var s in he.current)"success"===he.current[s]?t+=1:"error"===he.current[s]?n+=1:"processing"===he.current[s]?a+=1:"default"===he.current[s]?e+=1:"warning"===he.current[s]&&(r+=1);V(t),z(n),B(r),W(a),X(e)}),[]),Ee=(0,r.useCallback)((function(e){e.forEach(function(){var e=m()(p()().mark((function e(t){var n,r,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.transactionBase64,r=t.nft.nftId,"success"!==(a=he.current[r])&&"error"!==a&&"warning"!==a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,s=fe.current++%le.length,c=le[s]+"/api/v1/transactions?bundleOnly=true",e.next=10,Ae().post(c,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[n,{encoding:"base64"}]},{timeout:3e3});case 10:200===(u=e.sent).status?he.current[r]="success":(he.current[r]="error",Ye.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:r,error:JSON.stringify(u),pos:"try"})),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(o=e.t0.response)||void 0===o?void 0:o.status)){e.next=19;break}return he.current[r]="default",e.abrupt("return");case 19:he.current[r]="error",Ye.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:r,error:JSON.stringify(e.t0),pos:"catch"});case 21:De();case 22:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}())}),[]),$e=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,n)}));case 2:if(r=0,t.forEach((function(e){var t=e.nft.nftId,n=he.current[t];"processing"===n?(r+=1,he.current[t]="warning"):"default"===n?he.current[t]="processing":r+=1})),r!==t.length){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),Be=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t,n,r){var a,s,c,o,i,l,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.current=0,a=0;case 2:if(!(a<r)){e.next=25;break}Object.keys(he.current).forEach((function(e){he.current[e]="processing"})),De(),s=t.totalNonceCount,c=t.totalTxCount,o=Math.ceil(c/s),i=0;case 9:if(!(i<o)){e.next=22;break}l=t.transactions.slice(0,(i+1)*s);case 11:return Ee(l),e.next=15,$e(l,n);case 15:if(!e.sent){e.next=17;break}return e.abrupt("break",19);case 17:e.next=11;break;case 19:++i,e.next=9;break;case 22:++a,e.next=2;break;case 25:return d=t.transactions,Ee(d),e.next=29,$e(d,n);case 29:u.success("发送完成");case 30:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[u]),He=(0,r.useCallback)(function(){var e=m()(p()().mark((function e(t){var n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return u.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return n=t.reverseOrder,r=t.intervalSend,n&&(P.transactions=P.transactions.toReversed()),Be(P,r,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[P]),Ue=(0,r.useCallback)((function(){var e;if(!P)return u.error("请先上传交易文件"),!1;var t=(null===(e=l.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;Be(P,t,1)}),[P]),Ke=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(t=l.current)||void 0===t?void 0:t.getFieldsValue(),r=n.reverseOrder,a=n.repeatSend,s=n.intervalSend,n.autoSend&&P){e.next=3;break}return e.abrupt("return");case 3:return r&&(P.transactions=P.transactions.toReversed()),Be(P,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[P]),We=(0,r.useCallback)((function(e){var t,n,r=null===(t=l.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");r&&e<r&&pe.current&&(pe.current=!1,null===(n=l.current)||void 0===n||n.submit())}),[]),Ge=(0,r.useCallback)(m()(p()().mark((function e(){var t,n,r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return u.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,ie(!0),t={},e.next=9,(0,A.II)({mintPubkey:P.projectId});case 9:n=e.sent,r=0,P.nftIds.forEach((function(e){var a=P.from,s=n.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",r+=1):t[e]="default"})),re(r),je(t),ie(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),ie(!1),(0,M.Tv)(e.t0,u,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[u,P]),Je=(0,r.useCallback)((function(){if(P&&Ye.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Ye,null,2),n="data:,".concat(t),r=document.createElement("a"),a=P.tokenSymbol,s=P.projectId;r.href=n,r.download="Log_".concat(a,"_").concat(s.slice(0,4),"_").concat(s.slice(-4),"_").concat(e,".json"),r.click()}else u.info("无日志信息")}),[P]);return(0,i.jsxs)(de.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(xe.A,{formRef:l,onFinish:He,onReset:Ve,layout:"vertical",initialValues:{reverseOrder:!1,autoSend:!0,repeatSend:2,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{loading:oe,onClick:Ge,children:"校对"},"check"),(0,i.jsx)(g.ZP,{onClick:Ue,children:"预检"},"preflight"),(0,i.jsx)(g.ZP,{onClick:Je,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(Ie.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:Ze,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return f.current.handleOpen(e)},fileList:x},rules:[{whitespace:!0,message:"".concat(n),pattern:/.*/}]}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(n),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!P}}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:100,rules:[{required:!0,message:"".concat(n),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!P}}),(0,i.jsx)(ke.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(n),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!P}}),(0,i.jsx)(Te.Z,{name:"reverseOrder",label:(0,i.jsxs)("div",{children:["是否倒序",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"是否以倒序的方式来发送交易",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(n),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!P}}),(0,i.jsx)(Te.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(n),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!P}}),(0,i.jsx)(ye.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!P}}),(0,i.jsx)(ye.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(ae.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(se.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!P}}),(0,i.jsx)(xe.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),Re]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:N,onFinish:Ke,onChange:We}),(0,i.jsx)("div",{className:"text-2xl",children:Me})]})}),(0,i.jsxs)(xe.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),P?"(".concat(P.totalTxCount,")"):"",(0,i.jsx)("span",{className:"ml-2",style:{color:"#1677ff"},onClick:function(){return we((function(e){return!e}))},children:ge?(0,i.jsx)(ze.Z,{}):(0,i.jsx)(qe.Z,{})})]}),children:[(0,i.jsx)("div",{children:"完成：".concat(_,"，失败：").concat(E,"，超时：").concat($,"，处理中：").concat(K,"，待处理：").concat(Q)}),!(!P||!ge)&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(he.current).map((function(e,t){return(0,i.jsx)(_e.Z,{color:he.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(xe.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),P?"(".concat(P.totalTxCount,")"):"",(0,i.jsx)("span",{className:"ml-2",style:{color:"#1677ff"},onClick:function(){return Ne((function(e){return!e}))},children:Le?(0,i.jsx)(ze.Z,{}):(0,i.jsx)(qe.Z,{})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(ne)}),!(!P||!Le)&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(be).map((function(e,t){return(0,i.jsx)(_e.Z,{color:be[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(R.VY,{ref:f}),o]})})),Be=(0,r.memo)($e),He=function(e){var t=e.roundDataSource,n=e.loading,a=e.formData,s=e.profitRate,c=(0,r.useMemo)((function(){if(a){var e=t[0].roundLocalValue,n=t[t.length-1].roundLocalValue;return"(".concat(((n-e)/1e3/60/60/24).toFixed(1),"天/").concat(a.timePerRound,"小时)")}return""}),[a,t]),u=(0,r.useMemo)((function(){return a?"(".concat(a.maxNftSupply,")"):""}),[a]),o=(0,r.useMemo)((function(){return a?"(".concat(a.creatorFeeRate,"%) / 累计"):""}),[a]),l=(0,r.useMemo)((function(){return a?"(".concat(a.inviterFeeRate,"%) / 累计"):""}),[a]),d=(0,r.useMemo)((function(){return a?"(".concat(a.platformFeeRate,"%) / 累计"):""}),[a]),f=(0,r.useMemo)((function(){return a?"(".concat((0,M.uf)(a.nftTradeFeeRate-a.creatorFeeRate-a.inviterFeeRate,2),"%) / 累计"):""}),[a]),p=(0,r.useMemo)((function(){return s?"(".concat((0,M.uf)(100*s,2),"%) / 累计"):""}),[s]),h=(0,r.useMemo)((function(){return t.length?"(".concat(t.length-1,")"):""}),[t]),m=(0,r.useMemo)((function(){return[{title:"轮次".concat(h),dataIndex:"key",key:"key",render:function(e,t){return 0===t.key?"mint":(0,i.jsx)("span",{children:t.key})}},{title:"轮次时间".concat(c),dataIndex:"roundLocalFormat",key:"roundLocalFormat",sorter:function(e,t){return t.roundLocalValue-e.roundLocalValue},render:function(e,t){return(0,i.jsx)("div",{children:t.roundLocalFormat})}},{title:"NFT数量",dataIndex:"nftCount",key:"nftCount",render:function(e,t){return(0,i.jsx)("div",{children:t.nftCount})}},{title:"NFT价格",dataIndex:"nftPrice",key:"nftPrice",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPrice)})}},{title:"投入成本",dataIndex:"invest",key:"invest",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest,2)})}},{title:"抢图利润".concat(p),dataIndex:"profitUser",key:"profitUser",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitUser)," / ",(0,M.uf)(t.profitUserSum)]})}},{title:"创建者利润".concat(o),dataIndex:"profitCreator",key:"profitCreator",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitCreator)," / ",(0,M.uf)(t.profitCreatorSum)]})}},{title:"邀请人利润".concat(l),dataIndex:"profitInviter",key:"profitInviter",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitInviter)," / ",(0,M.uf)(t.profitInviterSum)]})}},{title:"平台利润".concat(d),dataIndex:"profitPlatform",key:"profitPlatform",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitPlatform)," / ",(0,M.uf)(t.profitPlatformSum)]})}},{title:"资金池".concat(f),dataIndex:"vaultSol",key:"vaultSol",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.vaultSol)," / ",(0,M.uf)(t.vaultSolSum)]})}}]}),[c,u,o,l,d,f]);return(0,i.jsx)("div",{className:"ppp-tab-round",children:(0,i.jsx)(j.Z,{loading:{spinning:n,size:"large"},scroll:{x:!0},size:"small",columns:m,dataSource:t,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})})},Ue=(0,r.memo)(He),Ke=n(78045),We=function(e){var t=e.sellDataSource,n=e.loading,a=e.formData,c=(0,r.useState)("last"),u=s()(c,2),o=u[0],l=u[1],d=(0,r.useMemo)((function(){if(t.length){var e="";if("last"===o){var n=t.length-1,r=t[0].solPoolLast;e=(t[n].solPoolLast/r*100).toFixed(1)}else{var a=t.length-1,s=t[0].solPoolPenultimate;e=(t[a].solPoolPenultimate/s*100).toFixed(1)}return"(锁死".concat(e,"%)")}return""}),[t,o]),f=(0,r.useMemo)((function(){return[{title:"卖出次序",dataIndex:"key",key:"key",sorter:function(e,t){return t.key-e.key},render:function(e,t){return 0===t.key?"未开始":(0,i.jsx)("div",{children:t.key})}},{title:"NFT成本",dataIndex:"nftPriceLast",key:"nftPriceLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPriceLast)})}},{title:"Token数量",dataIndex:"tokenPerNft",key:"tokenPerNft",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPerNft)})}},{title:"卖出获得SOL",dataIndex:"solOutputLast",key:"solOutputLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solOutputLast)})}},{title:"利润",dataIndex:"profitLast",key:"profitLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitLast)})}},{title:"池子余额SOL ".concat(d),dataIndex:"solPoolLast",key:"solPoolLast",sorter:function(e,t){return e.solPoolLast-t.solPoolLast},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solPoolLast)})}},{title:"池子余额Token",dataIndex:"tokenPoolLast",key:"tokenPoolLast",sorter:function(e,t){return e.tokenPoolLast-t.tokenPoolLast},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPoolLast)})}}]}),[d]),p=(0,r.useMemo)((function(){return[{title:"卖出次序",dataIndex:"key",key:"key",sorter:function(e,t){return t.key-e.key},render:function(e,t){return 0===t.key?"未开始":(0,i.jsx)("div",{children:t.key})}},{title:"NFT平均成本",dataIndex:"nftPricePenultimate",key:"nftPricePenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPricePenultimate)})}},{title:"Token数量",dataIndex:"tokenPerNft",key:"tokenPerNft",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPerNft)})}},{title:"卖出获得SOL",dataIndex:"solOutputPenultimate",key:"solOutputPenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solOutputPenultimate)})}},{title:"利润",dataIndex:"profitPenultimate",key:"profitPenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitPenultimate)})}},{title:"池子余额SOL ".concat(d),dataIndex:"solPoolPenultimate",key:"solPoolPenultimate",sorter:function(e,t){return e.solPoolPenultimate-t.solPoolPenultimate},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solPoolPenultimate)})}},{title:"池子余额Token",dataIndex:"tokenPoolPenultimate",key:"tokenPoolPenultimate",sorter:function(e,t){return e.tokenPoolPenultimate-t.tokenPoolPenultimate},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPoolPenultimate)})}}]}),[d]);return(0,i.jsxs)("div",{className:"ppp-tab-sell",children:[(0,i.jsxs)("div",{className:"my-4 flex gap-4",children:[(0,i.jsx)(Ke.ZP.Group,{value:o,onChange:function(e){return l(e.target.value)},options:[{value:"last",label:"最后一轮"},{value:"penultimate",label:"倒数第二轮"}]}),a?(0,i.jsxs)("div",{className:"mr-2",children:["Token池子占比：",null==a?void 0:a.lpTokenRate,"%"]}):null,a?(0,i.jsxs)("div",{children:["SOL池子占比：",100-(null==a?void 0:a.lpTokenRate),"%"]}):null]}),(0,i.jsx)(j.Z,{loading:{spinning:n,size:"large"},scroll:{x:!0},size:"small",columns:"last"===o?f:p,dataSource:t,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},Ge=(0,r.memo)(We)}}]);