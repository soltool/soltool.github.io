"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[109],{3567:function(e,t,r){r.d(t,{Wo:function(){return f},tw:function(){return E},SX:function(){return A}});var n=r(67294),a=r(5574),o=r.n(a),u=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function c(e,t){var r=t.format,n=void 0===r?"":r,a=new Date(e).getTime(),c=Date.now();return function(e,t){var r=e,n=/\[[^\]]*]/g,a=(t.match(n)||[]).map((function(e){return e.slice(1,-1)})),c=t.replace(n,"[]"),i=u.reduce((function(e,t){var n=o()(t,2),a=n[0],u=n[1];if(e.includes(a)){var c=Math.floor(r/u);return r-=c*u,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return c.toString().padStart(t,"0")}))}return e}),c),s=0;return i.replace(n,(function(){var e=a[s];return s+=1,e}))}(Math.max(a-c,0),n)}var i=r(40165),s=r(85893);var l=function(e){var t,r=e.value,a=e.format,u=void 0===a?"HH:mm:ss":a,l=e.onChange,f=e.onFinish,p=e.className,d=(t=(0,n.useReducer)((function(e){return e+1}),0),o()(t,2)[1]),y=n.useRef(null),h=function(){var e=function(e){return new Date(e).getTime()}(r);e>=Date.now()&&(y.current=(0,i.Zi)((function(){d(),null==l||l(e-Date.now()),e<Date.now()&&(null==f||f(),y.current&&((0,i.cv)(y.current),y.current=null))}),33.333333333333336))};return n.useEffect((function(){return h(),function(){y.current&&((0,i.cv)(y.current),y.current=null)}}),[r]),(0,s.jsx)("div",{className:p,children:c(r,{format:u})})},f=n.memo(l),p=r(15009),d=r.n(p),y=r(99289),h=r.n(y),m=r(64599),b=r.n(m),P=r(40956),k=r(49591),x=r(64435),v=r(88026),g=r(2453),S=r(83622),w=r(85137),j=r(27484),T=r.n(j),C=r(70178),K=r.n(C),L=r(70609),M=r(64119),N=r(87713),R=r(49717);T().extend(K());var _=function(e){var t=e.handleCurrentProjectNfts,r=(0,v.useDispatch)(),a=g.ZP.useMessage(),u=o()(a,2),c=u[0],i=u[1],l=(0,R.A)().chain,p=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsDataSource})),y=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceReset})),m=(0,v.useSelector)((function(e){return e.ppp.currentProjectDataSource})),j=(0,n.useMemo)((function(){var e=new Set;p.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=b()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[p]),T=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),C=(0,n.useMemo)((function(){var e=new Set;return p.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[p]),K=(0,n.useMemo)((function(){var e=0;return p.forEach((function(t){e+=t.invest})),e/N.LAMPORTS_PER_SOL}),[p]),_=(0,n.useMemo)((function(){var e=0;return p.forEach((function(t){e+=t.price})),e/N.LAMPORTS_PER_SOL}),[p]),E=(0,n.useState)([]),O=o()(E,2),A=O[0],I=O[1],D=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=p.filter((function(e){return e.ownerPubkey===t}));r(P.N.setCurrentProjectNftsDataSource(n))}),[p]),B=(0,n.useCallback)((function(){r(P.N.setCurrentProjectNftsDataSource(y))}),[y]),H=(0,n.useCallback)(h()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.info("敬请期待");case 1:case"end":return e.stop()}}),e)}))),[]),F=(0,n.useCallback)(h()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.info("敬请期待");case 1:case"end":return e.stop()}}),e)}))),[]),V=(0,n.useCallback)(h()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.info("敬请期待");case 1:case"end":return e.stop()}}),e)}))),[]),Z=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,s.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,s.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:t.status})}},{title:"持有者(".concat(C,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:j,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,s.jsx)(L.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:l})}},{title:"投入成本(".concat(K.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.invest/N.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(_.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.price/N.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(m.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.profit/N.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,s.jsx)(f,{value:t.burnTimeLocalValue})}}]}),[K,j,C,_,m]);return(0,s.jsxs)("div",{className:"ppp-tab-nft",children:[(0,s.jsx)(x.Z,{loading:{spinning:T,size:"large"},scroll:{x:!0},size:"small",columns:Z,dataSource:p,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,s.jsx)(S.ZP,{type:"primary",onClick:function(){t(m.mintPubkey),I([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:A,onChange:function(e){I(e)}},onSubmit:D,onReset:B,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!A.length&&(0,s.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,s.jsx)(k.Z,{}),children:[(0,s.jsx)(w.Z,{type:"primary",description:"购买",onClick:H},"1"),(0,s.jsx)(w.Z,{type:"primary",description:"拆分",onClick:F},"2"),(0,s.jsx)(w.Z,{type:"primary",description:"销毁",onClick:V},"3")]}),i]})},E=(0,n.memo)(_);T().extend(K());var O=function(e){var t=(0,v.useDispatch)(),r=(0,R.A)().chain,a=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceReset})),o=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSource})),u=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsStatus})),c=(0,v.useSelector)((function(e){return e.ppp.currentProjectDataSource})),i=(0,v.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),l=(0,n.useMemo)((function(){var e=new Set;o.forEach((function(t){e.add(t.owner)}));var t,r=[],n=b()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[o]),f=(0,n.useMemo)((function(){var e=new Set;return o.forEach((function(t){e.add(t.owner)})),e.size}),[o]),p=(0,n.useMemo)((function(){var e=0;return o.forEach((function(t){e+=t.invest})),e/N.LAMPORTS_PER_SOL}),[o]),d=(0,n.useMemo)((function(){var e=0;return o.forEach((function(t){e+=t.profit})),e/N.LAMPORTS_PER_SOL}),[o]),y=(0,n.useMemo)((function(){var e=0;return o.forEach((function(t){e+=t.balance})),e/N.LAMPORTS_PER_SOL}),[o]),h=(0,n.useCallback)((function(e){var r=e.owner,n=o.filter((function(e){return e.owner===r}));t(P.N.setCurrentProjectNftsRankDataSource(n))}),[o]),m=(0,n.useCallback)((function(){t(P.N.setCurrentProjectNftsRankDataSource(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,s.jsx)(S.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(c.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,c]),g=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,s.jsx)("span",{children:r+1})}},{title:"持有者(".concat(f,")"),dataIndex:"owner",key:"owner",filters:l,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,s.jsx)(L.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(u.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,s.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(y.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.balance/N.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(p.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.invest/N.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(d.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,s.jsx)("div",{children:(0,M.uf)(t.profit/N.LAMPORTS_PER_SOL,6)})}}]}),[l,f,d,f,u,y,r]);return(0,s.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,s.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,s.jsx)(x.Z,{loading:{spinning:i,size:"large"},scroll:{x:!0},size:"small",columns:g,dataSource:o,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:h,onReset:m,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},A=(0,n.memo)(O)},69988:function(e,t,r){r.d(t,{EA:function(){return K},T7:function(){return M},VY:function(){return x},a4:function(){return g},mW:function(){return P}});var n=r(15009),a=r.n(n),o=r(5574),u=r.n(o),c=r(99289),i=r.n(c),s=r(9669),l=r.n(s),f=r(87713),p=r(58467),d=r(45423),y=r(61202),h=r(27484),m=r.n(h),b=r(48764).Buffer;function P(e){return k.apply(this,arguments)}function k(){return(k=i()(a()().mark((function e(t){var r,n,o,u,c,i,s,f,p;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=100,n=1,o="",u="",c=[],t&&(r=t.limit?t.limit:100,n=t.page?t.page:1,o=t.keyword?t.keyword:"",u=t.sort?t.sort:"");case 7:return e.next=10,l().get("https://api.ppp.fun/projects?limit=".concat(r,"&page=").concat(n,"&keyword=").concat(o,"&sort=").concat(u));case 10:if(200===(i=e.sent).status&&i.data.success){e.next=13;break}throw Error("获取projects数据失败");case 13:if(s=i.data,f=s.data,p=s.meta,f.forEach((function(e){return c.push(e)})),!p.has_more){e.next=18;break}return n+=1,e.abrupt("continue",7);case 18:return e.abrupt("break",21);case 21:return e.abrupt("return",c);case 24:throw e.prev=24,e.t0=e.catch(0),Error("获取SOL价格失败");case 27:case"end":return e.stop()}}),e,null,[[0,24]])})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=i()(a()().mark((function e(t){var r,n,o,u,c,i,s,f,p,d,y,h;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r="",n=200,o=1,u="",c="",i="",s="",f=[],t&&(n=t.limit?t.limit:200,o=t.page?t.page:1,u=t.keyword?t.keyword:"",c=t.sort?t.sort:"",i=t.nft_id?t.nft_id:"",s=t.owner_pubkey?t.owner_pubkey:"",r=t.mintPubkey);case 10:return e.next=13,l().get("https://api.ppp.fun/project/".concat(r,"/nfts?limit=").concat(n,"&page=").concat(o,"&keyword=").concat(u,"&sort=").concat(c,"&nft_id=").concat(i,"&owner_pubkey=").concat(s));case 13:if(200===(p=e.sent).status&&p.data.success){e.next=16;break}throw Error("获取projectNfts数据失败");case 16:if(d=p.data,y=d.data,h=d.meta,y.forEach((function(e){return f.push(e)})),!h.has_more){e.next=21;break}return o+=1,e.abrupt("continue",10);case 21:return e.abrupt("break",24);case 24:return e.abrupt("return",f);case 27:throw e.prev=27,e.t0=e.catch(0),Error("获取projectNfts数据失败");case 30:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function g(e,t){return S.apply(this,arguments)}function S(){return(S=i()(a()().mark((function e(t,r){var n,o,u,c,i,s,f,p,d,h;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=JSON.parse(localStorage.getItem("jwt")),o=JSON.parse(localStorage.getItem("user")),!n||!o){e.next=9;break}if(u=(0,y.o)(n),c=u.exp,!(m()().unix()+3600<c)){e.next=9;break}return e.abrupt("return",{jwt:n,user:o});case 9:return e.next=11,l().get("https://api.ppp.fun/auth/".concat(t));case 11:if(200===(i=e.sent).status&&0===i.data.code){e.next=14;break}throw Error("获取auth数据失败");case 14:return s=i.data.data.message,e.next=17,r(b.from(s));case 17:return f=e.sent,e.next=20,l().post("https://api.ppp.fun/auth/verify",{message:s,publicKey:t,refCode:"",signature:Array.from(f)});case 20:if(200===(i=e.sent).status&&0===i.data.code){e.next=23;break}throw Error("验证失败");case 23:return p=i.data.data.token,e.next=26,l().post("https://api.ppp.fun/auth/verifyToken",{publicKey:t},{headers:{Authorization:"Bearer ".concat(p)}});case 26:if(200===(i=e.sent).status&&0===i.data.code){e.next=29;break}throw Error("验证token失败");case 29:return o=i.data.data.user,n=p,d=JSON.stringify(i.data.data.user),h=JSON.stringify(p),localStorage.setItem("jwt",h),localStorage.setItem("user",d),e.abrupt("return",{jwt:n,user:o});case 38:throw e.prev=38,e.t0=e.catch(0),Error("获取JWT失败");case 41:case"end":return e.stop()}}),e,null,[[0,38]])})))).apply(this,arguments)}function w(e,t,r){var n=t,a=r,o=[b.from("pool"),new f.PublicKey(e).toBuffer(),new f.PublicKey(n).toBuffer(),new f.PublicKey(a).toBuffer()],c=new f.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),i=f.PublicKey.findProgramAddressSync(o,c);return u()(i,1)[0]}function j(e,t){var r=[b.from("pool_vault"),new f.PublicKey(e).toBuffer(),new f.PublicKey(t).toBuffer()],n=new f.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),a=f.PublicKey.findProgramAddressSync(r,n);return u()(a,1)[0]}function T(){var e=[b.from("vault_and_lp_mint_auth_seed")],t=new f.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),r=f.PublicKey.findProgramAddressSync(e,t);return u()(r,1)[0]}function C(e){var t=[b.from("observation"),new f.PublicKey(e).toBuffer()],r=new f.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),n=f.PublicKey.findProgramAddressSync(t,r);return u()(n,1)[0]}function K(e,t,r,n,a,o){return L.apply(this,arguments)}function L(){return(L=i()(a()().mark((function e(t,r,n,o,u,c){var i,s,l,y,h,m,b,P,k,x,v,g,S,K,L,M,N,R,_,E,O,A,I,D,B,H,F,V,Z,q;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ",c&&(s=c),l=p.Gd.toString(),y=u.mintPubkey,h=u.authorityPubkey,m=u.projectPubkey,b=u.creatorPubkey,"CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C",P=o.toString(),k=T().toString(),v=w(x="D4FPEruKEHrG5TenZ2mpDGEfu1iUvTiqBxvpU8HLBvC2",l,y).toString(),g=(0,d.MO)(p.Gd,new f.PublicKey(h),!0).toString(),S=(0,d.MO)(new f.PublicKey(y),new f.PublicKey(h),!0).toString(),K=j(v,l).toString(),L=j(v,y).toString(),M=p.H_.toString(),N=p.H_.toString(),R=l,_=y,E=C(v).toString(),O=f.SystemProgram.programId.toString(),A=p.H_.toString(),I=m,D=r,B=n,H=l,F=(0,d.MO)(p.Gd,new f.PublicKey(h),!0).toString(),"DFShmtUPnJaxKSX6wg2zbyWEAVs9HuBeKNeGihg8o2oV",V={cpSwapProgram:"CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C",payer:P,authority:k,ammConfig:x,poolState:v,inputTokenAccount:g,outputTokenAccount:S,inputVault:K,outputVault:L,inputTokenProgram:M,outputTokenProgram:N,inputTokenMint:R,outputTokenMint:_,observationState:E,systemProgram:O,tokenProgram:A,project:I,nft:D,currentOwner:B,wsolMint:H,poolWsolVault:F,poolAuth:h,protocolFee:"DFShmtUPnJaxKSX6wg2zbyWEAVs9HuBeKNeGihg8o2oV",referral:s,creator:b},Z=[],e.next=35,(i=t.methods).buy.apply(i,Z).accounts(V).instruction();case 35:return q=e.sent,e.abrupt("return",q);case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,r,n){return N.apply(this,arguments)}function N(){return(N=i()(a()().mark((function e(t,r,n,o){var u,c,i,s,l,y,h,m,b,P,k,x,v,g;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=o.nftPubkey,i=n.authorityPubkey,s=n.mintPubkey,l=(0,d.MO)(new f.PublicKey(s),new f.PublicKey(i),!0).toString(),y=(0,d.MO)(new f.PublicKey(s),r,!0).toString(),h=n.projectPubkey,m=r.toString(),b=p.H_.toString(),P=p._u.toString(),k=f.SystemProgram.programId.toString(),x={nft:c,authority:i,mint:s,outputVault:l,outputTokenAccount:y,project:h,payer:m,tokenProgram:b,associatedTokenProgram:P,systemProgram:k},v=[],e.next=14,(u=t.methods).burn.apply(u,v).accounts(x).instruction();case 14:return g=e.sent,e.abrupt("return",g);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);