"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5104],{25104:function(e,t,r){r.d(t,{VZ:function(){return je},aC:function(){return Ce},oc:function(){return ue},ZJ:function(){return Te},am:function(){return De},Wo:function(){return d},UM:function(){return ne},PO:function(){return q},Af:function(){return B},Hp:function(){return J},Hm:function(){return te},a1:function(){return ze},nK:function(){return $e},ZH:function(){return U},Dm:function(){return W}});var n=r(67294),a=r(5574),s=r.n(a),c=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function u(e,t){var r=t.format,n=void 0===r?"":r,a=new Date(e).getTime(),u=Date.now();return function(e,t){var r=e,n=/\[[^\]]*]/g,a=(t.match(n)||[]).map((function(e){return e.slice(1,-1)})),u=t.replace(n,"[]"),o=c.reduce((function(e,t){var n=s()(t,2),a=n[0],c=n[1];if(e.includes(a)){var u=Math.floor(r/c);return r-=u*c,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return u.toString().padStart(t,"0")}))}return e}),u),i=0;return o.replace(n,(function(){var e=a[i];return i+=1,e}))}(Math.max(a-u,0),n)}var o=r(40165),i=r(85893);var l=function(e){var t,r=e.value,a=e.format,c=void 0===a?"HH:mm:ss":a,l=e.onChange,d=e.onFinish,f=e.className,p=(t=(0,n.useReducer)((function(e){return e+1}),0),s()(t,2)[1]),h=n.useRef(null),v=function(){var e=function(e){return new Date(e).getTime()}(r);e>=Date.now()&&(h.current=(0,o.Zi)((function(){p(),null==l||l(e-Date.now()),e<Date.now()&&(null==d||d(),h.current&&((0,o.cv)(h.current),h.current=null))}),33.333333333333336))};return n.useEffect((function(){return v(),function(){h.current&&((0,o.cv)(h.current),h.current=null)}}),[r]),(0,i.jsx)("div",{className:f,children:u(r,{format:c})})},d=n.memo(l),f=r(15009),p=r.n(f),h=r(99289),v=r.n(h),x=r(64599),m=r.n(x),b=r(40956),k=r(49591),j=r(64435),y=r(88026),S=r(2453),P=r(16568),g=r(83622),w=r(85137),C=r(27484),F=r.n(C),L=r(70178),N=r.n(L),R=r(70609),M=r(64119),O=r(29363),I=r(49717),T=r(54306),_=r(43651),V=r(44718),A=r(28704),Z=r(30527),D=r(52434),E=r(71874);F().extend(N());var z=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=P.ZP.useNotification(),f=s()(l,2),h=f[0],x=f[1],C=(0,T.O)(),F=C.publicKey,L=C.signTransaction,N=C.wallet,z=C.signMessage,q=(0,_.z)(),Y=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV1})),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV1})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),G=(0,n.useMemo)((function(){var e=new Set;U.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[U]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,n.useMemo)((function(){var e=new Set;return U.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[U]),X=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[U]),ee=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[U]),te=(0,n.useState)([]),re=s()(te,2),ne=re[0],ae=re[1],se=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ce=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=U.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV1(n))}),[U]),ue=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV1(K))}),[K]),oe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:return e.next=5,(0,A.vo)(F.toString(),z);case 5:r=e.sent,n=r.user,a=n.referral,c=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),o=U.filter((function(e){return ne.includes(e.key)})),i=[],l=5,d=m()(o.entries()),e.prev=13,d.s();case 15:if((f=d.n()).done){e.next=47;break}return v=s()(f.value,2),x=v[0],b=v[1],k=b.nftPubkey,j=b.ownerPubkey,y=F,S=a,2,e.next=24,(0,A.zt)({program:c,nftPubkey:k,currentOwnerPubkey:j,payerPubkey:y,currentProjectDataSource:W,userReferral:S,payMode:2});case 24:if(P=e.sent,i.push(P),(g=x+1)%l!=0&&g!==o.length){e.next=45;break}return e.next=30,Y.getLatestBlockhash();case 30:return w=e.sent,C=w.blockhash,R=w.lastValidBlockHeight,e.next=35,(0,E.fC)(Y,N,C,i,L,H);case 35:return O=e.sent,I=O.transaction,T=O.feeMode,e.next=40,(0,E.pR)(Y,N,I,T);case 40:return _=e.sent,V={signature:_,blockhash:C,lastValidBlockHeight:R},e.next=44,(0,E.fS)(B,Y,V,"confirmed",h,u);case 44:i=[];case 45:e.next=15;break;case 47:e.next=52;break;case 49:e.prev=49,e.t0=e.catch(13),d.e(e.t0);case 52:return e.prev=52,d.f(),e.finish(52);case 55:t(W.mintPubkey),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 61:case"end":return e.stop()}}),e,null,[[0,58],[13,49,52,55]])}))),[ne,U,W,F,L,N,z,Y,B]),ie=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=[],c=20,o=m()(n.entries()),e.prev=8,o.s();case 10:if((i=o.n()).done){e.next=39;break}return l=s()(i.value,2),d=l[0],f=l[1],v=F,x=f,e.next=16,(0,A.Km)({program:r,payerPubkey:v,currentProjectDataSource:W,currentProjectNftDataSource:x,index:d});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,y,a,L,H);case 27:return P=e.sent,g=P.transaction,w=P.feeMode,e.next=32,(0,E.pR)(Y,N,g,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:ae([]),t(W.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ne,U,W,F,L,N,z,Y,B]),le=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=[],c=15,o=m()(n.entries()),e.prev=8,o.s();case 10:if((i=o.n()).done){e.next=39;break}return l=s()(i.value,2),d=l[0],f=l[1],v=F,x=f,e.next=16,(0,A.Q8)({program:r,payerPubkey:v,currentProjectDataSource:W,currentProjectNftDataSource:x});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,y,a,L,H);case 27:return P=e.sent,g=P.transaction,w=P.feeMode,e.next=32,(0,E.pR)(Y,N,g,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:ae([]),t(W.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ne,U,W,F,L,N,z,Y,B]),de=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:G,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(W.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,G,Q,ee,W]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:de,dataSource:U,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){t(W.mintPubkey),ae([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ne,onChange:function(e){ae(e)}},onSubmit:ce,onReset:ue,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ne.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:oe,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ie,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:le,shape:"square"},"3")]}),o,x]})},q=(0,n.memo)(z),Y=r(58868);F().extend(N());var $=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=P.ZP.useNotification(),f=s()(l,2),h=f[0],x=f[1],C=(0,T.O)(),F=C.publicKey,L=C.wallet,N=C.signMessage,D=C.signAllTransactions,z=(0,_.z)(),q=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV2})),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV2})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),G=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsBuyDurableV2})),J=(0,n.useMemo)((function(){var e=new Set;U.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[U]),Q=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),X=(0,n.useMemo)((function(){if(!U.length)return"";var e=new Set;return U.forEach((function(t){e.add(t.ownerPubkey)})),"(".concat(e.size,")")}),[U]),ee=(0,n.useMemo)((function(){if(!U.length)return"";var e=0;return U.forEach((function(t){e+=t.invest})),"(".concat((e/O.LAMPORTS_PER_SOL).toFixed(0),")")}),[U]),te=(0,n.useMemo)((function(){if(!U.length)return"";var e=0;return U.forEach((function(t){e+=t.price})),"(".concat((e/O.LAMPORTS_PER_SOL).toFixed(0),")")}),[U]),re=(0,n.useMemo)((function(){var e=G.durable;if(0===e)return"";if(e<60)return"(".concat(e.toFixed(0),"秒)");if(e>=60&&e<3600){var t=Math.floor(e/60),r=e%60;return"(".concat(t,"分").concat(r,"秒)")}var n=Math.floor(e/3600),a=(e-3600*n)/60;return"(".concat(n,"时").concat(a,"分)")}),[G]),ne=(0,n.useMemo)((function(){return W.profitRate?"(".concat(W.profitRate.toFixed(2),"%)"):""}),[W]),ae=(0,n.useState)([]),se=s()(ae,2),ce=se[0],ue=se[1],oe=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ie=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=U.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV2(n))}),[U]),le=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV2(K))}),[K]),de=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V,$;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(oe));case 3:return e.next=5,(0,A.qj)(F.toString(),N);case 5:r=e.sent,n=r.user,a=n.referral,c=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),o=U.filter((function(e){return ce.includes(e.key)})),i=5,l=[],d=[],f=m()(o.entries()),e.prev=14,f.s();case 16:if((v=f.n()).done){e.next=31;break}return x=s()(v.value,2),b=x[0],k=x[1],j=k.nftPubkey,y=k.ownerPubkey,S=F,P=a,2,e.next=25,(0,A.G4)({program:c,nftPubkey:j,currentOwnerPubkey:y,payerPubkey:S,currentProjectDataSource:W,userReferral:P,payMode:2});case 25:g=e.sent,l.push(g),(w=b+1)%i!=0&&w!==o.length||(d.push(l),l=[]);case 29:e.next=16;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(14),f.e(e.t0);case 36:return e.prev=36,f.f(),e.finish(36);case 39:return e.next=41,q.getLatestBlockhash();case 41:return C=e.sent,R=C.blockhash,O=C.lastValidBlockHeight,I=new Array(d.length).fill(R),e.next=47,(0,E.Gw)(q,L,I,d,D,H);case 47:return T=e.sent,_=T.transactions,V=T.feeMode,$=I.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:O}})),e.next=53,(0,E.fv)({chain:B,connection:q,wallet:L,transactions:_,strategys:$,notificationApi:h,feeMode:V});case 53:t(W.mintPubkey),e.next=59;break;case 56:e.prev=56,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 59:case"end":return e.stop()}}),e,null,[[0,56],[14,33,36,39]])}))),[ce,U,W,F,D,L,N,q,B]),fe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R,O,I,T,_,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(oe));case 3:r=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),n=U.filter((function(e){return ce.includes(e.key)})),a=18,c=[],o=[],i=m()(n.entries()),e.prev=9,i.s();case 11:if((l=i.n()).done){e.next=23;break}return d=s()(l.value,2),f=d[0],v=d[1],x=F,b=v,e.next=17,(0,A.Q9)({program:r,payerPubkey:x,currentProjectDataSource:W,currentProjectNftDataSource:b,index:f});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(o.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,P=y.lastValidBlockHeight,g=new Array(o.length).fill(S),e.next=39,(0,E.Gw)(q,L,g,o,D,H);case 39:w=e.sent,C=w.transactions,R=w.feeMode,O=m()(C),e.prev=43,O.s();case 45:if((I=O.n()).done){e.next=55;break}return T=I.value,e.next=49,(0,E.pR)(q,L,T,R);case 49:return _=e.sent,V={signature:_,blockhash:S,lastValidBlockHeight:P},e.next=53,(0,E.fS)(B,q,V,"confirmed",h,u);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),O.e(e.t1);case 60:return e.prev=60,O.f(),e.finish(60);case 63:ue([]),t(W.mintPubkey),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,u,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[ce,U,W,F,D,L,N,q,B]),pe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,o,i,l,d,f,v,x,b,k,j,y,S,P,g,w,C,R,O;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&L&&N&&z){e.next=3;break}return e.abrupt("return",u.error(oe));case 3:r=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),n=U.filter((function(e){return ce.includes(e.key)})),a=5,c=[],o=[],i=m()(n.entries()),e.prev=9,i.s();case 11:if((l=i.n()).done){e.next=23;break}return d=s()(l.value,2),f=d[0],v=d[1],x=F,b=v,e.next=17,(0,A.mn)({program:r,payerPubkey:x,currentProjectDataSource:W,currentProjectNftDataSource:b});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(o.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,P=y.lastValidBlockHeight,g=new Array(o.length).fill(S),e.next=39,(0,E.Gw)(q,L,g,o,D,H);case 39:return w=e.sent,C=w.transactions,R=w.feeMode,O=g.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:P}})),e.next=45,(0,E.fv)({chain:B,connection:q,wallet:L,transactions:C,strategys:O,notificationApi:h,feeMode:R});case 45:ue([]),t(W.mintPubkey),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[ce,U,W,F,D,L,N,q,B]),he=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者".concat(X),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:J,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本".concat(ee),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格".concat(te),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润".concat(ne),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间".concat(re),dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.burnTimeLocalValue-t.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[ee,J,X,te,W,re]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:Q,size:"large"},scroll:{x:!0},size:"small",columns:he,dataSource:U,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){t(W.mintPubkey),ue([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ce,onChange:function(e){ue(e)}},onSubmit:ie,onReset:le,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ce.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:de,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:fe,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:pe,shape:"square"},"3")]}),o,x]})},B=(0,n.memo)($);F().extend(N());var H=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),o=s()(u,2),l=o[0],f=o[1],h=P.ZP.useNotification(),x=s()(h,2),b=x[0],g=x[1],C=(0,T.O)(),F=C.publicKey,L=C.signTransaction,N=C.wallet,z=C.signMessage,q=(0,_.z)(),Y=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=m()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),W=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),G=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,o,i,d,f,h,v,x,k,j,y,S,P,g,w,C,R,O,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",l.error(re));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],o=20,i=m()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],v=f[1],x=F,k=v,e.next=16,(0,A.Km)({program:n,payerPubkey:x,currentProjectDataSource:a,currentProjectNftDataSource:k,index:h});case 16:if(j=e.sent,u.push(j),(y=h+1)%o!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,P=S.blockhash,g=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,P,u,L,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,N,C,R);case 32:return O=e.sent,I={signature:O,blockhash:P,lastValidBlockHeight:g},e.next=36,(0,E.fS)(B,Y,I,"confirmed",b,l);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),i.e(e.t0);case 44:return e.prev=44,i.f(),e.finish(44);case 47:te([]),t(a.mintPubkey,F.toString()),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,r,a,F,L,N,z,Y,B]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,o,i,d,f,h,v,x,k,j,y,S,P,g,w,C,R,O,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&z&&q){e.next=3;break}return e.abrupt("return",l.error(re));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],o=15,i=m()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],v=f[1],x=F,k=v,e.next=16,(0,A.Q8)({program:n,payerPubkey:x,currentProjectDataSource:a,currentProjectNftDataSource:k});case 16:if(j=e.sent,u.push(j),(y=h+1)%o!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,P=S.blockhash,g=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,N,P,u,L,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,N,C,R);case 32:return O=e.sent,I={signature:O,blockhash:P,lastValidBlockHeight:g},e.next=36,(0,E.fS)(B,Y,I,"confirmed",b,l);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),i.e(e.t0);case 44:return e.prev=44,i.f(),e.finish(44);case 47:te([]),t(a.mintPubkey,F.toString()),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,r,a,F,L,N,z,Y,B]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(W,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:U,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,U,W,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:K,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,g]})},U=(0,n.memo)(H);F().extend(N());var K=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),o=s()(u,2),l=o[0],f=o[1],h=P.ZP.useNotification(),x=s()(h,2),b=x[0],g=x[1],C=(0,T.O)(),F=C.publicKey,L=C.signAllTransactions,N=C.wallet,D=C.signMessage,z=(0,_.z)(),q=(0,V.R)().connection,$=(0,I.A)(),B=$.chain,H=$.modalFeeRef,U=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=m()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),W=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),G=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,o,i,d,f,h,v,x,k,j,y,S,P,g,w,C,R,O,I,T,_,V,$,U;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&D&&z){e.next=3;break}return e.abrupt("return",l.error(re));case 3:n=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=18,o=[],i=[],d=m()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],x=h[1],k=F,j=x,e.next=17,(0,A.Q9)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j,index:v});case 17:y=e.sent,o.push(y),(S=v+1)%u!=0&&S!==c.length||(i.push(o),o=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return P=e.sent,g=P.blockhash,w=P.lastValidBlockHeight,C=new Array(i.length).fill(g),e.next=39,(0,E.Gw)(q,N,C,i,L,H);case 39:R=e.sent,O=R.transactions,I=R.feeMode,T=m()(O),e.prev=43,T.s();case 45:if((_=T.n()).done){e.next=55;break}return V=_.value,e.next=49,(0,E.pR)(q,N,V,I);case 49:return $=e.sent,U={signature:$,blockhash:g,lastValidBlockHeight:w},e.next=53,(0,E.fS)(B,q,U,"confirmed",b,l);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),T.e(e.t1);case 60:return e.prev=60,T.f(),e.finish(60);case 63:te([]),t(a.mintPubkey,F.toString()),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,l,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[ee,r,a,F,L,N,D,q,B]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,o,i,d,f,h,v,x,k,j,y,S,P,g,w,C,R,O,I,T;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&L&&N&&D&&z){e.next=3;break}return e.abrupt("return",l.error(re));case 3:n=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=5,o=[],i=[],d=m()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],x=h[1],k=F,j=x,e.next=17,(0,A.mn)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j});case 17:y=e.sent,o.push(y),(S=v+1)%u!=0&&S!==c.length||(i.push(o),o=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return P=e.sent,g=P.blockhash,w=P.lastValidBlockHeight,C=new Array(i.length).fill(g),e.next=39,(0,E.Gw)(q,N,C,i,L,H);case 39:return R=e.sent,O=R.transactions,I=R.feeMode,T=C.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:w}})),e.next=45,(0,E.fv)({chain:B,connection:q,wallet:N,transactions:O,strategys:T,notificationApi:b,feeMode:I});case 45:te([]),t(a.mintPubkey,F.toString()),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,l,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[ee,r,a,F,L,N,D,q,B]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(W,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:U,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,U,W,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:K,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,g]})},W=(0,n.memo)(K);F().extend(N());var G=function(e){var t=(0,y.useDispatch)(),r=(0,I.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV1})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV1})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV1})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),o=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV1})),l=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV1(n))}),[s]),x=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV1(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),S=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:l,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}}]}),[l,d,p,d,c,h,r]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:o,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:v,onReset:x,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},J=(0,n.memo)(G),Q=r(83062),X=r(25035);F().extend(N());var ee=function(e){var t=(0,y.useDispatch)(),r=(0,I.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV2})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV2})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV2})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),o=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),l=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(){return(0,i.jsxs)("div",{children:["抢图时长(秒)",(0,i.jsx)(Q.Z,{title:"抢图时长只计算成功的交易",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),[]),x=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV2(n))}),[s]),k=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV2(a))}),[a]),S=(0,n.useCallback)((function(t,r,n){return[n[1],(0,i.jsx)(g.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),P=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:l,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:v(),dataIndex:"durable",key:"durable",sorter:function(e,t){return e.durable-t.durable},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.durable})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",sorter:function(e,t){return e.balance-t.balance},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"空投DFS(".concat((f/10).toFixed(2),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(t.invest/O.LAMPORTS_PER_SOL/10).toFixed(2)})}}]}),[l,d,p,d,c,h,r]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:o,size:"large"},scroll:{x:!0},size:"small",columns:P,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:S},onSubmit:x,onReset:k,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},te=(0,n.memo)(ee);F().extend(N());var re=function(){var e=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsGrowV2})),t=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),r=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),a=(0,n.useMemo)((function(){return t.secPerRound/3600+"小时"}),[t]),s=(0,n.useMemo)((function(){return t.profitRate.toFixed(2)+"%"}),[t]),c=(0,n.useMemo)((function(){return t.profitRateCreator.toFixed(1)+"%"}),[t]),u=(0,n.useMemo)((function(){return t.profitRateInviter.toFixed(1)+"%"}),[t]),o=(0,n.useMemo)((function(){return t.profitRatePlatform.toFixed(1)+"%"}),[t]),l=(0,n.useMemo)((function(){return(t.tradeFeeRate/100).toFixed(1)+"%"}),[t]),d=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"轮次时间(".concat(a,")"),dataIndex:"roundLocalFormat",key:"roundLocalFormat",render:function(e,t){return(0,i.jsx)("div",{children:t.roundLocalFormat})}},{title:"NFT数量",dataIndex:"nftCount",key:"nftCount",render:function(e,t){return(0,i.jsx)("div",{children:t.nftCount})}},{title:"投入成本",dataIndex:"invest",key:"invest",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,2)})}},{title:"抢图利润(".concat(s,")"),dataIndex:"profitUser",key:"profitUser",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitUser/O.LAMPORTS_PER_SOL)})}},{title:"创建者利润(".concat(c,")"),dataIndex:"profitCreator",key:"profitCreator",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitCreator/O.LAMPORTS_PER_SOL)})}},{title:"邀请人利润(".concat(u,")"),dataIndex:"profitInviter",key:"profitInviter",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitInviter/O.LAMPORTS_PER_SOL)})}},{title:"平台利润(".concat(o,")"),dataIndex:"profitPlatform",key:"profitPlatform",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitPlatform/O.LAMPORTS_PER_SOL)})}},{title:"资金池(".concat(l,")"),dataIndex:"vaultSol",key:"vaultSol",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.vaultSol/O.LAMPORTS_PER_SOL)})}}]}),[a,s,c,u,o,l]);return(0,i.jsx)("div",{className:"ppp-tab-grow",children:(0,i.jsx)(j.Z,{loading:{spinning:r,size:"large"},scroll:{x:!0},size:"small",columns:d,dataSource:e,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})})},ne=(0,n.memo)(re),ae=r(87603),se=r(38345),ce=function(){return(0,i.jsxs)(se.Z,{title:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"400px"},children:[(0,i.jsx)("div",{className:"font-semibold mb-2",children:"1. 操作步骤："}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["1） 连接钱包 ",(0,i.jsx)(ae.Z,{})," 打开“PPP-Nonce账号”页面 ",(0,i.jsx)(ae.Z,{})," 创建Nonce账号：根据你想要抢到图片的数量3-5倍来创建；"]}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["2）打开“PPP-自动抢图”页面 ",(0,i.jsx)(ae.Z,{})," 在“创建交易”表单输入：项目，购买方式，购买数量，每张图GAS费用（表单其项按需输入） ",(0,i.jsx)(ae.Z,{})," 点击“运行”按钮 ",(0,i.jsx)(ae.Z,{})," 签名（无时间限制）；"]}),(0,i.jsxs)("div",{className:"ml-3 mb-2",children:["3）在“发送交易”表单，抢图会自动进行倒计时 ",(0,i.jsx)(ae.Z,{})," 等待倒计时结束即可，表单输入项按需调整，发送设备要保持前台活跃状态；"]}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"4）倒计时结束后会自动进行发送，发送完成后可点击“校对”按钮，检查抢到的图片数量。"}),(0,i.jsx)("div",{className:"font-semibold mb-2",children:"2. 注意事项："}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"1）只需在抢图前进行签名即可，无时间限制；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"2）不支持OK钱包，因为预检交易通不过，钱包不让提前签名；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"3）以账号余额来控制你想要抢到图片的数量上限，而不是以购买数量和Nonce账号数量，同时购买数量和Nonce账号数量需要远远大于你想要抢到的图片数量上限，这有利于提高成功率；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"3）Nonce账号的数量需要根据你一次性抢多少张图来决定，假如你想一次性抢10张，建议创建30-50个Nonce账号，数量不要超过当前NFT流通量即可，超过了也不影响；Nonce账号只需要创建一次，会重复使用，也可以随时进行删除回收；Nonce账号数量决定了当前账号抢图数量的上限，Nonce账号数量多一些，有利于提高抢图成功率；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"4）关于每张图GAS费用，费用越高，出块节点打包你交易的优先权也越高，抢图成功率就越大。交易失败，不会扣除任何费用。"}),(0,i.jsx)("div",{className:"font-semibold mb-2",children:"3. 费用说明："}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"有两种方式可选择"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"1）免费：填写本工具的邀请码，工具会自动填入，无需手动操作；"}),(0,i.jsx)("div",{className:"ml-3 mb-2",children:"2）付费：按账号实际绑定的邀请码进行填写，无需手动操作。用户使用工具抢到的NFT，每个收取0.1%费用。例如工具抢到一个价值为0.1 SOL的NFT，则工具会收取0.0001 SOL作为费用，抢购成功了，才会收取。"})]})},ue=(0,n.memo)(ce),oe=r(19632),ie=r.n(oe),le=r(98165),de=r(97269),fe=r(64317),pe=r(31199),he=r(25054),ve=r(5966),xe=r(39678),me=r(7134),be=r(48764).Buffer,ke=function(){var e,t,r,a,c,u,o,l,d,f,h,x=(0,y.useIntl)(),k=x.formatMessage({id:"common.intlInputException"}),j=x.formatMessage({id:"common.intlPleaseConnectWallet"}),P=(0,y.useDispatch)(),g=S.ZP.useMessage(),w=s()(g,2),C=w[0],L=w[1],N=(0,n.useRef)(),R=(0,T.O)(),I=R.publicKey,z=R.signTransaction,q=R.signMessage,Y=R.wallet,$=(0,V.R)().connection,B=(0,_.z)(),H=(0,n.useState)(0),U=s()(H,2),K=U[0],W=U[1],G=(0,n.useState)(0),J=s()(G,2),ee=J[0],te=J[1],re=(0,n.useState)(0),ne=s()(re,2),ae=ne[0],ce=ne[1],ue=(0,n.useState)(!1),oe=s()(ue,2),ke=oe[0],je=oe[1],ye=(0,n.useState)(!1),Se=s()(ye,2),Pe=Se[0],ge=Se[1],we=(0,n.useState)(),Ce=s()(we,2),Fe=Ce[0],Le=Ce[1],Ne=(0,n.useState)([]),Re=s()(Ne,2),Me=Re[0],Oe=Re[1],Ie=(0,n.useState)([]),Te=s()(Ie,2),_e=Te[0],Ve=Te[1],Ae=(0,n.useState)(0),Ze=s()(Ae,2),De=Ze[0],Ee=Ze[1],ze=(0,n.useState)(!1),qe=s()(ze,2),Ye=qe[0],$e=qe[1],Be=(0,n.useState)(!1),He=s()(Be,2),Ue=He[0],Ke=He[1],We=(0,n.useState)(1),Ge=s()(We,2),Je=Ge[0],Qe=Ge[1],Xe=(0,n.useState)([]),et=s()(Xe,2),tt=et[0],rt=et[1],nt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV1})),at=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),st=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),ct=(0,n.useState)([]),ut=s()(ct,2),ot=ut[0],it=ut[1],lt=(0,n.useState)({}),dt=s()(lt,2),ft=dt[0],pt=dt[1],ht=(0,n.useState)([]),vt=s()(ht,2),xt=vt[0],mt=vt[1],bt=(0,n.useState)([]),kt=s()(bt,2),jt=kt[0],yt=kt[1],St=(0,n.useState)(0),Pt=s()(St,2),gt=Pt[0],wt=Pt[1],Ct=(0,n.useCallback)((function(){wt(0),yt([]),mt([]),Ee(0),Ke(!1),$e(!1),Le(void 0),Oe([]),Ve([])}),[]),Ft=(0,n.useCallback)((function(){var e,t,r=null===(e=N.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=N.current)||void 0===t||t.resetFields(n),Ct()}),[]),Lt=(0,n.useCallback)((function(){var e;null===(e=N.current)||void 0===e||e.resetFields(),Ct()}),[]),Nt=(0,n.useMemo)((function(){var e=(0,M.uf)(K/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(K/O.LAMPORTS_PER_SOL*ee,6);return ee?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[K,ee]),Rt=(0,n.useMemo)((function(){var e=(0,M.uf)(ae/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(ae/O.LAMPORTS_PER_SOL*ee,6);return ee?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[K,ee]),Mt=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e){var n,a=null===(n=N.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(7===e){var s,c=null===(s=N.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(8===e){var u,o=null===(u=N.current)||void 0===u?void 0:u.getFieldValue("nftIds");o=o||[],r=t.filter((function(e){return o.includes(e.nftId)}))}return Ve(r),r}),[]),Ot=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,o,i,l,d,f,h,v,x,b,k,j,y,S;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.buyCount,c=n.startNumber,u=n.endNumber,o=n.buyMode,i=Mt(o,a),!(c>i.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(i.length));case 4:if(!u){e.next=11;break}if(!(c>u)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:l=i.length>u?u:i.length,i=i.slice(c-1,l),e.next=12;break;case 11:i=i.slice(c-1);case 12:return d=function(e){var t,n=0,a=m()(e);try{for(a.s();!(t=a.n()).done;){if(t.value.ownerPubkey!==r.toString()){if(n>=s)return n;if(n>=1e3)return n;n+=1}}}catch(e){a.e(e)}finally{a.f()}return n},f=d(i),"#####NonceCountAccount#####",e.next=17,O.PublicKey.createWithSeed(r,"#####NonceCountAccount#####",O.SystemProgram.programId);case 17:return h=e.sent,e.next=20,t.getAccountInfo(h);case 20:if(v=e.sent,x=[],b=[],k=0,v){e.next=26;break}throw Error("请先创建Nonce账号");case 26:if(k=(0,E.sT)(v.lamports),!(f>k)){e.next=29;break}throw Error("Nonce账号数量不足，需要大于等于图片购买数量");case 29:j=0;case 30:if(!(j<k)){e.next=40;break}return y="#####NonceAccount".concat(j+1,"#####"),e.next=35,O.PublicKey.createWithSeed(r,y,O.SystemProgram.programId);case 35:S=e.sent,x.push(S);case 37:++j,e.next=30;break;case 40:if(!x.length){e.next=45;break}return e.next=43,t.getMultipleParsedAccounts(x);case 43:e.sent.value.forEach((function(e,t){b.push({key:t,nonceAccount:x[t],authority:new O.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 45:return e.abrupt("return",{nonceAccounts:x,nonceAccountsData:b,nftsDataSource:i});case 46:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),It=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,o,i,l,d,f,h,v,x,b,k,j,y,S,P,g,w,C,F,L,N,R,M,I,T,_,V,z,q,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.payer,a=t.anchorWallet,s=t.signMessage,c=t.signTransaction,u=t.nftsDataSource,o=t.formData,i=t.nonceAccounts,l=t.nonceAccountsData,d=t.currentProjectDataSource,f=t.tipAccounts,h=t.tipFee,v=0,x=0,b=0,k=[],j=o.buyCount,y=o.payMode,e.next=8,(0,A.vo)(n.toString(),s);case 8:S=e.sent,P=S.user,g=P.referral,w=new Z.$r(D,new Z.Y7(r,a,Z.Y7.defaultOptions())),C=m()(u),e.prev=13,C.s();case 15:if((F=C.n()).done){e.next=48;break}if(L=F.value,L.ownerPubkey!==n.toString()){e.next=20;break}return e.abrupt("continue",46);case 20:if(!(v>=j)){e.next=22;break}return e.abrupt("break",48);case 22:return v+=1,(N=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:l[b].nonceAccount,authorizedPubkey:l[b].authority})),N.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:132284})),R=L.nftPubkey,M=L.ownerPubkey,I=n,T=g,e.next=32,(0,A.zt)({program:w,nftPubkey:R,currentOwnerPubkey:M,payerPubkey:I,currentProjectDataSource:d,userReferral:T,payMode:y});case 32:return _=e.sent,N.push(_),2===y&&g&&(V=Number((.001*L.price).toFixed(0)),N.push(O.SystemProgram.transfer({fromPubkey:n,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:V}))),N.push(O.SystemProgram.transfer({fromPubkey:n,toPubkey:new O.PublicKey(f[x]),lamports:h<1e3?1e3:Number(h.toFixed(0))})),z=new O.TransactionMessage({payerKey:n,recentBlockhash:l[b].blockhash,instructions:N}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),e.next=41,c(q);case 41:Y=e.sent,k.push({instructions:N,transaction:Y,transactionBase64:be.from(Y.serialize()).toString("base64"),nft:L,tipFee:h,referral:g}),b=(b+1)%i.length,x=(x+1)%f.length,Ee(v);case 46:e.next=15;break;case 48:e.next=53;break;case 50:e.prev=50,e.t0=e.catch(13),C.e(e.t0);case 53:return e.prev=53,C.f(),e.finish(53);case 56:return e.abrupt("return",k);case 57:case"end":return e.stop()}}),e,null,[[13,50,53,56]])})));return function(t){return e.apply(this,arguments)}}(),[]),Tt=(0,n.useCallback)((function(e,t,r,n,a){var s,c,u=0,o=t.projectId,i=t.splitCount,l=n.tokenSymbol,d=n.nextRoundLocalFormat,f=r.length,p=e.toString(),h=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),v=r[0].referral;r.forEach((function(e){u+=e.nft.price}));for(var x=a.includes(p)?(0,M.uf)(u/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*u/O.LAMPORTS_PER_SOL,8,"SOL"),m=F()().format("YYYY-MM-DDTHH:mm:ss"),b=Math.ceil(r.length/i),k=1,j=function(){var e=0,s=[],c=r.splice(0,b),u=c.length;c.forEach((function(t){s.push(t.nft.nftId),e+=t.nft.price}));var f=a.includes(p)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");s.sort((function(e,t){return e-t}));var x={projectId:o,instruction:"buy",totalTxCount:u,totalAmount:f,tipFee:h,referral:v,tokenSymbol:l,from:p,startNftId:s[0],endNftId:s[s.length-1],nftIds:s,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:n,transactions:c},j=JSON.stringify(x,null,2),y="data:,".concat(j),S=document.createElement("a");S.href=y,S.download=1===i||1===b?"".concat(l,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_").concat(m,"_buy.json"):"".concat(l,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_part").concat(k++,"_").concat(m,"_buy.json"),S.click()};r.length;)j();null===(s=N.current)||void 0===s||s.setFieldValue("totalAmountCreate",x),null===(c=N.current)||void 0===c||c.setFieldValue("totalTxCount",f),C.success("创建完成")}),[]),_t=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Y&&I&&z&&B&&q&&Fe){e.next=4;break}return C.error(j),e.abrupt("return",!0);case 4:if("Simple Wallet"===Y.adapter.name){e.next=7;break}return C.error("只支持Simple Wallet"),e.abrupt("return",!0);case 7:return e.next=9,Ot($,I,t,Me);case 9:return r=e.sent,n=r.nonceAccounts,a=r.nonceAccountsData,s=r.nftsDataSource,e.next=15,It({connection:$,payer:I,anchorWallet:B,signMessage:q,signTransaction:z,nftsDataSource:s,formData:t,nonceAccounts:n,nonceAccountsData:a,currentProjectDataSource:Fe,tipAccounts:at,tipFee:K});case 15:if((c=e.sent).length){e.next=19;break}return C.info("没有需要创建的内容"),e.abrupt("return",!0);case 19:Tt(I,t,c,Fe,st),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),Ee(0),(0,M.Tv)(e.t0,C,"handleFinish");case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),[K,I,Y,z,B,q,Fe,Me,$,at,st]),Vt=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,ie()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*O.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),W(s),ce(a)}),[]),At=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,o,l,d,f,h,v,x,m,b,k,j,y,S,P;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ge(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,o={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},l=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),x=c(a["99th"]),m=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),o["25th"]={sol:l,usd:m},o["50th"]={sol:d,usd:b},o["50th_ema"]={sol:f,usd:k},o["75th"]={sol:h,usd:j},o["95th"]={sol:v,usd:y},o["99th"]={sol:x,usd:S},(P=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),P.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),P.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),P.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),P.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),P.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),pt(a),it(P),ge(!1),null===(n=N.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),Vt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),ge(!1),(0,M.Tv)(e.t0,C,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Zt=(0,n.useCallback)((function(e,t){var r,n=null===(r=N.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=Mt(a,e);return Vt(u,s,c,t),wt(u.length),u.length}),[]),Dt=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e})})})),mt(n)}),[]),Et=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),yt(t)}),[]),zt=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=N.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;6===c||7===c?($e(!0),Dt(e)):($e(!1),mt([]),null===(a=N.current)||void 0===a||a.setFieldValue("accounts",void 0));8===c?(Ke(!0),Et(e)):(Ke(!1),yt([]),null===(s=N.current)||void 0===s||s.setFieldValue("nftIds",void 0));Zt(e,t),null===(n=N.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),qt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),a=null===(n=N.current)||void 0===n?void 0:n.getFieldsValue(),s=a.projectId,Ft(),c=t.find((function(e){return e.mintPubkey===s})),e.next=7,(0,A.LE)(s,c);case 7:u=e.sent,o=u.currentProjectNftsDataSource,Zt(o,r),Oe(o),Le(c),je(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),je(!1),(0,M.Tv)(e.t0,C,"handleCurrentProjectNfts");case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Yt=(0,n.useCallback)((function(e,t){var r,n,a=Zt(e,t);a?null===(r=N.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=N.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),$t=(0,n.useCallback)((function(e,t){var r,n,a=Zt(e,t);a?null===(r=N.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=N.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),Bt=(0,n.useCallback)((function(e,t){var r,n=null===(r=N.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;Vt(e,a,s,t)}),[]),Ht=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=N.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=N.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),Vt(e,.1,a,t)}else if(2===a)At(e,r);else if(3===a){var c,u="0.000001";null===(c=N.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),Vt(e,u,a,t)}Qe(a)}),[]),Ut=(0,n.useCallback)((function(e){e.projectId&&qt(nt,ft),e.buyMode&&zt(Me,ft),e.nftIds&&Yt(Me,ft),e.accounts&&$t(Me,ft),e.tipMode&&Ht(Me,ft,ee),e.tipFeeCreate&&Bt(_e,ft)}),[nt,Me,gt,_e,ft,ee]),Kt=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(0!==e.round&&r!==n){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(me.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),rt(t)}),[]),Wt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),e.next=4,(0,A.p5)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,Kt(n),te(a),P(b.N.setProjectsV1(r)),P(b.N.setProjectsDataSourceV1(n)),je(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),je(!1),(0,M.Tv)(e.t0,C,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]);return(0,n.useEffect)((function(){Wt()}),[]),(0,i.jsxs)(se.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(de.A,{formRef:N,onFinish:_t,onValuesChange:Ut,onReset:Lt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:.1,payMode:1,tipMode:1,splitCount:1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],t[0],(0,i.jsx)("div",{children:De||""},"sign")]}},children:[(0,i.jsx)(fe.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(le.Z,{spin:ke,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:Wt})]}),options:tt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(me.C,{className:"mr-2",size:"default",src:n}),(0,M.Mn)()?(0,i.jsx)("div",{children:"".concat(r)}):(0,i.jsx)("div",{children:"".concat(r," - ").concat((0,M.LH)(t))})]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(fe.Z,{name:"buyMode",label:"购买方式",options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 指定账号(顺序)"},{value:7,label:"7 指定账号(随机)"},{value:8,label:"8 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(e=N.current)&&void 0!==e&&e.getFieldValue("projectId"))}}),!!Ye&&(0,i.jsx)(fe.Z,{name:"accounts",label:"选择账号",options:xt,fieldProps:{mode:"multiple",disabled:!(null!==(t=N.current)&&void 0!==t&&t.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),!!Ue&&(0,i.jsx)(fe.Z,{name:"nftIds",label:"选择序号",options:jt,fieldProps:{mode:"multiple",disabled:!(null!==(r=N.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),(0,i.jsx)(pe.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=N.current)||void 0===e||e.setFieldValue("buyCount",gt),null===(t=N.current)||void 0===t||t.validateFields(["buyCount"])},children:gt?"(".concat(gt,")"):""})]}),placeholder:"",min:1,max:gt,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(a=N.current)&&void 0!==a&&a.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=N.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=N.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(fe.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(o=N.current)&&void 0!==o&&o.getFieldValue("projectId"))}}),1===Je?(0,i.jsx)(he.Z,{name:"tipFeeCreate",label:Nt,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(l=N.current)&&void 0!==l&&l.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,2===Je?(0,i.jsx)(fe.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(le.Z,{spin:Pe,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return At(Me,ee)}})]}),options:ot,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,3===Je?(0,i.jsx)(ve.Z,{name:"tipFeeCreate",label:Nt,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,(0,i.jsx)(fe.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(d=N.current)&&void 0!==d&&d.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["交易文件数量",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(ve.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(f=N.current)&&void 0!==f&&f.getFieldValue("projectId"))}}),(0,i.jsx)(ve.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(h=N.current)&&void 0!==h&&h.getFieldValue("projectId"))}})]}),L]})},je=(0,n.memo)(ke),ye=r(84567),Se=r(20640),Pe=r.n(Se),ge=r(48764).Buffer,we=function(e){var t,r,a,c,u,o,l,d,f,h,x,k,j,P=e.autoSweepSendRef,w=(0,y.useIntl)(),C=w.formatMessage({id:"common.intlInputException"}),L=w.formatMessage({id:"common.intlPleaseConnectWallet"}),N=(0,y.useDispatch)(),R=S.ZP.useMessage(),I=s()(R,2),D=I[0],z=I[1],q=(0,n.useRef)(),$=(0,T.O)(),B=$.publicKey,H=$.signAllTransactions,U=$.signMessage,K=$.wallet,W=(0,V.R)().connection,G=(0,_.z)(),J=(0,n.useState)(0),ee=s()(J,2),te=ee[0],re=ee[1],ne=(0,n.useState)(0),ae=s()(ne,2),ce=ae[0],ue=ae[1],oe=(0,n.useState)(0),be=s()(oe,2),ke=be[0],je=be[1],Se=(0,n.useState)(!1),we=s()(Se,2),Ce=we[0],Fe=we[1],Le=(0,n.useState)(!1),Ne=s()(Le,2),Re=Ne[0],Me=Ne[1],Oe=(0,n.useState)(),Ie=s()(Oe,2),Te=Ie[0],_e=Ie[1],Ve=(0,n.useState)([]),Ae=s()(Ve,2),Ze=Ae[0],De=Ae[1],Ee=(0,n.useState)([]),ze=s()(Ee,2),qe=ze[0],Ye=ze[1],$e=(0,n.useState)(0),Be=s()($e,2),He=Be[0],Ue=Be[1],Ke=(0,n.useState)(!1),We=s()(Ke,2),Ge=We[0],Je=We[1],Qe=(0,n.useState)(!1),Xe=s()(Qe,2),et=Xe[0],tt=Xe[1],rt=(0,n.useState)(2),nt=s()(rt,2),at=nt[0],st=nt[1],ct=(0,n.useState)(!0),ut=s()(ct,2),ot=ut[0],it=ut[1],lt=(0,n.useState)(),dt=s()(lt,2),ft=dt[0],pt=dt[1],ht=(0,n.useState)([]),vt=s()(ht,2),xt=vt[0],mt=vt[1],bt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV2})),kt=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),jt=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),yt=(0,n.useState)([]),St=s()(yt,2),Pt=St[0],gt=St[1],wt=(0,n.useState)({}),Ct=s()(wt,2),Ft=Ct[0],Lt=Ct[1],Nt=(0,n.useState)([]),Rt=s()(Nt,2),Mt=Rt[0],Ot=Rt[1],It=(0,n.useState)([]),Tt=s()(It,2),_t=Tt[0],Vt=Tt[1],At=(0,n.useState)(0),Zt=s()(At,2),Dt=Zt[0],Et=Zt[1],zt=(0,n.useCallback)((function(){Et(0),Vt([]),Ot([]),Ue(0),tt(!1),Je(!1),_e(void 0),De([]),Ye([]),pt(void 0)}),[]),qt=(0,n.useCallback)((function(){var e,t,r=null===(e=q.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=q.current)||void 0===t||t.resetFields(n),zt()}),[]),Yt=(0,n.useCallback)((function(){var e;null===(e=q.current)||void 0===e||e.resetFields(),zt()}),[]),$t=(0,n.useMemo)((function(){var e=(0,M.uf)(te/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(te/O.LAMPORTS_PER_SOL*ce,6);return ce?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[te,ce]),Bt=(0,n.useMemo)((function(){var e=(0,M.uf)(ke/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(ke/O.LAMPORTS_PER_SOL*ce,6);return ce?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[te,ce]),Ht=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e)r=t.filter((function(e){return!e.split})).sort((function(){return Math.random()-.5}));else if(7===e){var n,a=null===(n=q.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(8===e){var s,c=null===(s=q.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(9===e){var u,o=null===(u=q.current)||void 0===u?void 0:u.getFieldValue("nftIds");o=o||[],r=t.filter((function(e){return o.includes(e.nftId)}))}return Ye(r),r}),[]),Ut=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,o,i,l,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.startNumber,c=n.endNumber,u=n.buyMode,o=Ht(u,a),!(s>o.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(o.length));case 4:if(!c){e.next=11;break}if(!(s>c)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:i=o.length>c?c:o.length,o=o.slice(s-1,i),e.next=12;break;case 11:o=o.slice(s-1);case 12:return l=[],e.next=15,(0,E.JH)(r,t);case 15:if((d=e.sent).forEach((function(e){l.push(e.nonceAccount)})),d.length){e.next=20;break}throw Error("请先创建Nonce账号");case 20:return e.abrupt("return",{nonceAccounts:l,nonceAccountsData:d,nftsDataSource:o});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),Kt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,o,i,l,d,f,h,v,x,b,k,j,y,S,P,g,w,C,F,L,N,R,M,I,T,_,V,D,z,q,$;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.wallet,a=t.payer,s=t.anchorWallet,c=t.signMessage,u=t.signAllTransactions,o=t.nftsDataSource,i=t.formData,l=t.nonceAccounts,d=t.nonceAccountsData,f=t.currentProjectDataSource,h=t.tipAccounts,v=t.tipFee,x=0,b=0,k=0,j=[],y=i.buyCount,S=i.payMode,e.next=8,(0,A.qj)(a.toString(),c);case 8:P=e.sent,g=P.user,w=g.referral,C=new Z.$r(Y,new Z.Y7(r,s,Z.Y7.defaultOptions())),F=m()(o),e.prev=13,F.s();case 15:if((L=F.n()).done){e.next=43;break}if(N=L.value,!(x>=y)){e.next=19;break}return e.abrupt("break",43);case 19:return x+=1,(R=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:d[k].nonceAccount,authorizedPubkey:d[k].authority})),R.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:47258})),"Simple Wallet"!==n.adapter.name&&R.push(O.ComputeBudgetProgram.setComputeUnitPrice({microLamports:0})),M=N.nftPubkey,I=N.ownerPubkey,T=a,_=w,e.next=30,(0,A.G4)({program:C,nftPubkey:M,currentOwnerPubkey:I,payerPubkey:T,currentProjectDataSource:f,userReferral:_,payMode:S});case 30:V=e.sent,R.push(V),2===S&&w&&(D=Number((.001*N.price).toFixed(0)),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:D}))),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey(h[b]),lamports:v<1e3?1e3:Number(v.toFixed(0))})),z=new O.TransactionMessage({payerKey:a,recentBlockhash:d[k].blockhash,instructions:R}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),j.push({instructions:R,transaction:q,transactionBase64:"",nft:N,tipFee:v,referral:w}),k=(k+1)%l.length,b=(b+1)%h.length,Ue(x);case 41:e.next=15;break;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(13),F.e(e.t0);case 48:return e.prev=48,F.f(),e.finish(48);case 51:return $=j.map((function(e){return e.transaction})),e.next=54,u($);case 54:return e.sent.forEach((function(e,t){j[t].transaction=e,j[t].transactionBase64=ge.from(e.serialize()).toString("base64")})),e.abrupt("return",j);case 57:case"end":return e.stop()}}),e,null,[[13,45,48,51]])})));return function(t){return e.apply(this,arguments)}}(),[]),Wt=(0,n.useCallback)((function(e,t,r,n,a,s){var c,u,o=0,i=t.projectId,l=t.splitCount,d=n.tokenSymbol,f=n.nextRoundLocalFormat,p=r.length,h=a.length,v=e.toString(),x=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),m=r[0].referral;r.forEach((function(e){o+=e.nft.price}));for(var b=s.includes(v)?(0,M.uf)(o/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*o/O.LAMPORTS_PER_SOL,8,"SOL"),k=F()().format("YYYY-MM-DDTHH:mm:ss"),j=Math.ceil(r.length/l),y=1,S=function(){var e=0,a=[],c=r.splice(0,j),u=c.length;c.forEach((function(t){a.push(t.nft.nftId),e+=t.nft.price}));var o=s.includes(v)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");a.sort((function(e,t){return e-t}));var p={projectId:i,instruction:"buy",totalTxCount:u,totalAmount:o,totalNonceCount:h,tipFee:x,referral:m,tokenSymbol:d,from:v,startNftId:a[0],endNftId:a[a.length-1],nftIds:a,nextRoundLocalFormat:f,formData:t,currentProjectDataSource:n,transactions:c},b=JSON.stringify(p,null,2),S="data:,".concat(b),P=document.createElement("a");P.href=S,P.download=1===l||1===j?"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_").concat(k,"_buy.json"):"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_part").concat(y++,"_").concat(k,"_buy.json"),P.click()};r.length;)S();null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",p),pt(void 0),D.success("创建完成")}),[]),Gt=(0,n.useCallback)((function(e,t,r,n,a,s){var c,u,o=0,i=t.projectId,l=n.tokenSymbol,d=n.nextRoundLocalFormat,f=r.length,p=a.length,h=e.toString(),v=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),x=r[0].referral,m=[];r.forEach((function(e){m.push(e.nft.nftId),o+=e.nft.price}));var b=s.includes(h)?(0,M.uf)(o/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*o/O.LAMPORTS_PER_SOL,8,"SOL");m.sort((function(e,t){return e-t}));var k={projectId:i,instruction:"buy",totalTxCount:f,totalAmount:b,totalNonceCount:p,tipFee:v,referral:x,tokenSymbol:l,from:h,startNftId:m[0],endNftId:m[m.length-1],nftIds:m,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:n,transactions:r};null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",f),P.current.handleReset(),P.current.handleTransactionFileContent(k),pt(k),D.success("开始成功")}),[]),Jt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s,c,u;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(t=q.current)||void 0===t?void 0:t.getFieldsValue(),K&&B&&H&&G&&U&&Te){e.next=5;break}return D.error(L),e.abrupt("return",!0);case 5:if("OKX Wallet"!==K.adapter.name){e.next=8;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 8:return e.next=10,Ut(W,B,r,Ze);case 10:return n=e.sent,a=n.nonceAccounts,s=n.nonceAccountsData,c=n.nftsDataSource,e.next=16,Kt({connection:W,wallet:K,payer:B,anchorWallet:G,signMessage:U,signAllTransactions:H,nftsDataSource:c,formData:r,nonceAccounts:a,nonceAccountsData:s,currentProjectDataSource:Te,tipAccounts:kt,tipFee:te});case 16:if((u=e.sent).length){e.next=20;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 20:Gt(B,r,u,Te,a,jt),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),Ue(0),(0,M.Tv)(e.t0,D,"handleFinishRun");case 27:case"end":return e.stop()}}),e,null,[[0,23]])}))),[te,B,K,H,G,U,Te,Ze,W,kt,jt]),Qt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=q.current)||void 0===t?void 0:t.validateFields();case 2:if(e.prev=2,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),K&&B&&H&&G&&U&&Te){e.next=7;break}return D.error(L),e.abrupt("return",!0);case 7:if("OKX Wallet"!==K.adapter.name){e.next=10;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 10:return e.next=12,Ut(W,B,n,Ze);case 12:return a=e.sent,s=a.nonceAccounts,c=a.nonceAccountsData,u=a.nftsDataSource,e.next=18,Kt({connection:W,wallet:K,payer:B,anchorWallet:G,signMessage:U,signAllTransactions:H,nftsDataSource:u,formData:n,nonceAccounts:s,nonceAccountsData:c,currentProjectDataSource:Te,tipAccounts:kt,tipFee:te});case 18:if((o=e.sent).length){e.next=22;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 22:Wt(B,n,o,Te,s,jt),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(2),Ue(0),(0,M.Tv)(e.t0,D,"handleFinishCreate");case 29:case"end":return e.stop()}}),e,null,[[2,25]])}))),[te,B,K,H,G,U,Te,Ze,W,kt,jt]),Xt=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,ie()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*O.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),re(s),je(a)}),[]),er=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,o,l,d,f,h,v,x,m,b,k,j,y,S,P;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Me(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,o={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},l=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),x=c(a["99th"]),m=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),o["25th"]={sol:l,usd:m},o["50th"]={sol:d,usd:b},o["50th_ema"]={sol:f,usd:k},o["75th"]={sol:h,usd:j},o["95th"]={sol:v,usd:y},o["99th"]={sol:x,usd:S},(P=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),P.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),P.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),P.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),P.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),P.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),Lt(a),gt(P),Me(!1),null===(n=q.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),Xt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),Me(!1),(0,M.Tv)(e.t0,D,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),tr=(0,n.useCallback)((function(e,t){var r,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=Ht(a,e);return Xt(u,s,c,t),Et(u.length),u.length}),[]),rr=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e})})})),Ot(n)}),[]),nr=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),Vt(t)}),[]),ar=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=q.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;7===c||8===c?(Je(!0),rr(e)):(Je(!1),Ot([]),null===(a=q.current)||void 0===a||a.setFieldValue("accounts",void 0));9===c?(tt(!0),nr(e)):(tt(!1),Vt([]),null===(s=q.current)||void 0===s||s.setFieldValue("nftIds",void 0));tr(e,t),null===(n=q.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),sr=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,o,i,l,d,f;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Fe(!0),c=null===(s=q.current)||void 0===s?void 0:s.getFieldsValue(),u=c.projectId,qt(),o=t.find((function(e){return e.mintPubkey===u})),e.next=7,(0,A.D3)(u,o);case 7:return i=e.sent,l=i.currentProjectNftsDataSource,d=[],d=n&&r?l.filter((function(e){return e.ownerPubkey!==r.toString()})):l,e.next=13,er(d,a);case 13:f=e.sent,tr(d,f.levels),De(d),_e(o),Fe(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),Fe(!1),(0,M.Tv)(e.t0,D,"handleCurrentProjectNfts");case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),cr=(0,n.useCallback)((function(e,t){var r,n,a=tr(e,t);a?null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),ur=(0,n.useCallback)((function(e,t){var r,n,a=tr(e,t);a?null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),or=(0,n.useCallback)((function(e,t){var r,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;Xt(e,a,s,t)}),[]),ir=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=q.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=q.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),Xt(e,.1,a,t)}else if(2===a)er(e,r);else if(3===a){var c,u="0.000001";null===(c=q.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),Xt(e,u,a,t)}st(a)}),[]),lr=(0,n.useCallback)((function(e){e.projectId&&sr(bt,B,ot,ce),e.buyMode&&ar(Ze,Ft),e.nftIds&&cr(Ze,Ft),e.accounts&&ur(Ze,Ft),e.tipMode&&ir(Ze,Ft,ce),e.tipFeeCreate&&or(qe,Ft)}),[bt,Ze,Dt,qe,Ft,ce,ot,B]),dr=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(!(e.initNftSupply>r||n>0)){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(me.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),mt(t)}),[]),fr=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Fe(!0),e.next=4,(0,A.yC)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,dr(n),ue(a),N(b.N.setProjectsV2(r)),N(b.N.setProjectsDataSourceV2(n)),Fe(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),Fe(!1),(0,M.Tv)(e.t0,D,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]),pr=(0,n.useCallback)((function(e){var t=e.target.checked;it(t),Yt()}),[]),hr=(0,n.useCallback)((function(){ft?Pe()(JSON.stringify(ft,null,2))?D.success("复制成功"):D.error("复制失败"):D.info("先运行，再进行复制")}),[ft]);return(0,n.useEffect)((function(){fr()}),[]),(0,i.jsxs)(se.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(de.A,{formRef:q,onFinish:Jt,onValuesChange:lr,onReset:Yt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:"50th_ema",payMode:1,tipMode:2,splitCount:1},submitter:{searchConfig:{submitText:"运行"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{onClick:Qt,children:"创建"},"create"),(0,i.jsx)(g.ZP,{onClick:hr,children:"复制"},"copy"),t[0],(0,i.jsx)("div",{children:He||""},"sign")]}},children:[(0,i.jsx)(fe.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(le.Z,{spin:Ce,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:fr})]}),options:xt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(me.C,{className:"mr-2",size:"default",src:n}),(0,M.Mn)()?(0,i.jsx)("div",{children:"".concat(r)}):(0,i.jsx)("div",{children:"".concat(r," - ").concat((0,M.LH)(t))})]}),(0,i.jsx)(xe.k,{addressPrefix:"",ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(fe.Z,{name:"buyMode",label:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{children:"购买方式"}),(0,i.jsx)(ye.Z,{checked:ot,onChange:pr,className:"ml-4",children:"不含本账号图片"})]}),options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 不抢拆分(随机)"},{value:7,label:"7 指定账号(顺序)"},{value:8,label:"8 指定账号(随机)"},{value:9,label:"9 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(t=q.current)&&void 0!==t&&t.getFieldValue("projectId"))}}),!!Ge&&(0,i.jsx)(fe.Z,{name:"accounts",label:"选择账号",options:Mt,fieldProps:{mode:"multiple",disabled:!(null!==(r=q.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),!!et&&(0,i.jsx)(fe.Z,{name:"nftIds",label:"选择序号",options:_t,fieldProps:{mode:"multiple",disabled:!(null!==(a=q.current)&&void 0!==a&&a.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),(0,i.jsx)(pe.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=q.current)||void 0===e||e.setFieldValue("buyCount",Dt),null===(t=q.current)||void 0===t||t.validateFields(["buyCount"])},children:Dt?"(".concat(Dt,")"):""})]}),placeholder:"",min:1,max:Dt,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=q.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=q.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(o=q.current)&&void 0!==o&&o.getFieldValue("projectId"))}}),(0,i.jsx)(fe.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(l=q.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),1===at?(0,i.jsx)(he.Z,{name:"tipFeeCreate",label:$t,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(d=q.current)&&void 0!==d&&d.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,2===at?(0,i.jsx)(fe.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(le.Z,{spin:Re,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return er(Ze,ce)}})]}),options:Pt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(f=q.current)&&void 0!==f&&f.getFieldValue("projectId"))},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,3===at?(0,i.jsx)(ve.Z,{name:"tipFeeCreate",label:$t,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(h=q.current)&&void 0!==h&&h.getFieldValue("projectId"))},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,(0,i.jsx)(fe.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(x=q.current)&&void 0!==x&&x.getFieldValue("projectId"))}}),(0,i.jsx)(pe.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["拆分文件数量",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(ve.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(k=q.current)&&void 0!==k&&k.getFieldValue("projectId"))}}),(0,i.jsx)(ve.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(j=q.current)&&void 0!==j&&j.getFieldValue("projectId"))}})]}),z]})},Ce=(0,n.memo)(we),Fe=r(91604),Le=r(52688),Ne=r(66309),Re=r(9669),Me=r.n(Re),Oe=[],Ie=function(){var e=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),t=S.ZP.useMessage(),r=s()(t,2),a=r[0],c=r[1],u=(0,n.useRef)(),o=(0,n.useRef)(),l=(0,n.useState)([]),f=s()(l,2),h=f[0],x=f[1],m=(0,n.useState)(),b=s()(m,2),k=b[0],j=b[1],P=(0,n.useState)(0),w=s()(P,2),C=w[0],L=w[1],N=(0,n.useState)(0),O=s()(N,2),I=O[0],T=O[1],_=(0,n.useState)(0),V=s()(_,2),Z=V[0],D=V[1],E=(0,n.useState)(0),z=s()(E,2),q=z[0],Y=z[1],$=(0,n.useState)(0),B=s()($,2),H=B[0],U=B[1],K=(0,n.useState)(0),W=s()(K,2),G=W[0],J=W[1],ee=(0,n.useState)(!1),te=s()(ee,2),re=te[0],ne=te[1],ae=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),ce=(0,n.useRef)(!0),ue=(0,n.useRef)({}),oe=(0,n.useState)({}),ie=s()(oe,2),le=ie[0],fe=ie[1],he=(0,n.useMemo)((function(){return k?"(".concat(k.tokenSymbol," ").concat(k.projectId.slice(0,4),"...").concat(k.projectId.slice(-4),")"):""}),[k]),xe=(0,n.useMemo)((function(){return k?"".concat(null==k?void 0:k.currentProjectDataSource.nextRoundLocalFormat):""}),[k]),me=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=u.current)||void 0===r||r.resetFields(a),e){var s,c,o=e.currentProjectDataSource.lastRoundLocalValue,i=e.currentProjectDataSource.secPerRound,l=e.totalAmount,d=e.tipFee;L(o+1e3*i),j(e),null===(s=u.current)||void 0===s||s.setFieldValue("totalAmountSend",l),null===(c=u.current)||void 0===c||c.setFieldValue("tipFeeSend",d);var f={};e.nftIds.forEach((function(e){ue.current[e]="default",f[e]="default"})),fe(f)}else{var p,h;L(0),j(void 0),null===(p=u.current)||void 0===p||p.setFieldValue("totalAmountSend",""),null===(h=u.current)||void 0===h||h.setFieldValue("tipFeeSend",""),ue.current={},fe({})}T(0),D(0),Y(0),U(0),J(0)}),[]),be=(0,n.useCallback)((function(){var e,t,r;null===(e=u.current)||void 0===e||e.resetFields(),x([]),L(0),j(void 0),null===(t=u.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=u.current)||void 0===r||r.setFieldValue("tipFeeSend",""),ue.current={},fe({}),T(0),D(0),Y(0),U(0),J(0)}),[]),ke=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return x(t.fileList),me(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(x(t.fileList),me(e),a.success("上传成功")):a.error("指令类型错误"):a.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,a,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),je=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var a in ue.current)"success"===ue.current[a]?t+=1:"error"===ue.current[a]?r+=1:"processing"===ue.current[a]?n+=1:"default"===ue.current[a]&&(e+=1);T(t),D(r),Y(n),U(e)}),[]),ye=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0;case 1:if(!(s<n)){e.next=16;break}Object.keys(ue.current).forEach((function(e){ue.current[e]="processing"})),je();case 4:return t.transactions.forEach(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,o,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.transactionBase64,a=t.nft.nftId,"success"!==(s=ue.current[a])&&"error"!==s){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,c=r%ae.length,u=ae[c]+"/api/v1/transactions?bundleOnly=true",e.next=10,Me().post(u,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[n,{encoding:"base64",maxTry:0}]},{timeout:5e3});case 10:200===(o=e.sent).status?ue.current[a]="success":(ue.current[a]="error",Oe.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(o),pos:"try"})),e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(i=e.t0.response)||void 0===i?void 0:i.status)){e.next=18;break}return e.abrupt("return");case 18:ue.current[a]="error",Oe.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(e.t0),pos:"catch"});case 20:je();case 21:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,r){return e.apply(this,arguments)}}()),e.next=8,new Promise((function(e){setTimeout(e,r)}));case 8:if(0!==Object.values(ue.current).filter((function(e){return"processing"===e})).length){e.next=11;break}return e.abrupt("break",13);case 11:e.next=4;break;case 13:++s,e.next=1;break;case 16:a.success("发送完成");case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[a]),Se=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.disorderSend,n=t.intervalSend,r&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),Pe=(0,n.useCallback)((function(){var e;if(!k)return a.error("请先上传交易文件"),!1;var t=(null===(e=u.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;ye(k,t,1)}),[k]),ge=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),n=r.disorderSend,a=r.repeatSend,s=r.intervalSend,r.autoSend&&k){e.next=3;break}return e.abrupt("return");case 3:return n&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[k]),we=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&ce.current&&(ce.current=!1,null===(r=u.current)||void 0===r||r.submit())}),[]),Ce=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,ne(!0),t={},e.next=9,(0,A.tt)({mintPubkey:k.projectId});case 9:r=e.sent,n=0,k.nftIds.forEach((function(e){var a=k.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),J(n),fe(t),ne(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),ne(!1),(0,M.Tv)(e.t0,a,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[a,k]),Re=(0,n.useCallback)((function(){if(k&&Oe.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Oe,null,2),r="data:,".concat(t),n=document.createElement("a"),s=k.tokenSymbol,c=k.projectId;n.href=r,n.download="Log_".concat(s,"_").concat(c.slice(0,4),"_").concat(c.slice(-4),"_").concat(e,".json"),n.click()}else a.info("无日志信息")}),[k]);return(0,i.jsxs)(se.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(de.A,{formRef:u,onFinish:Se,onReset:be,layout:"vertical",initialValues:{disorderSend:!0,autoSend:!0,repeatSend:3,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{onClick:Pe,children:"预检"},"preflight"),(0,i.jsx)(g.ZP,{loading:re,onClick:Ce,children:"校对"},"check"),(0,i.jsx)(g.ZP,{onClick:Re,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(Fe.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:ke,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return o.current.handleOpen(e)},fileList:h},rules:[{required:!0,whitespace:!0,message:"".concat(e),pattern:/.*/}]}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!k}}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:300,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!k}}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!k}}),(0,i.jsx)(Le.Z,{name:"disorderSend",label:(0,i.jsxs)("div",{children:["是否乱序",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"是否以乱序的方式来发送交易",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(Le.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(ve.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(ve.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(de.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),he]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:C,onFinish:ge,onChange:we}),(0,i.jsx)("div",{className:"text-2xl",children:xe})]})}),(0,i.jsxs)(de.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),k?"(".concat(k.totalTxCount,")"):""]}),children:[(0,i.jsx)("div",{children:"完成：".concat(I,"，失败：").concat(Z,"，处理中：").concat(q,"，待处理：").concat(H)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(ue.current).map((function(e,t){return(0,i.jsx)(Ne.Z,{color:ue.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(de.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),k?"(".concat(k.totalTxCount,")"):"",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(G)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(le).map((function(e,t){return(0,i.jsx)(Ne.Z,{color:le[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(R.VY,{ref:o}),c]})},Te=(0,n.memo)(Ie),_e=r(99611),Ve=r(90420),Ae=[],Ze=(0,n.forwardRef)((function(e,t){var r=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],o=c[1],l=(0,n.useRef)(),f=(0,n.useRef)(),h=(0,n.useState)([]),x=s()(h,2),m=x[0],b=x[1],k=(0,n.useState)(),j=s()(k,2),P=j[0],w=j[1],C=(0,n.useState)(0),L=s()(C,2),N=L[0],O=L[1],I=(0,n.useState)(0),T=s()(I,2),_=T[0],V=T[1],Z=(0,n.useState)(0),D=s()(Z,2),E=D[0],z=D[1],q=(0,n.useState)(0),Y=s()(q,2),$=Y[0],B=Y[1],H=(0,n.useState)(0),U=s()(H,2),K=U[0],W=U[1],G=(0,n.useState)(0),J=s()(G,2),ee=J[0],te=J[1],re=(0,n.useState)(0),ne=s()(re,2),ae=ne[0],ce=ne[1],ue=(0,n.useState)(!1),oe=s()(ue,2),ie=oe[0],le=oe[1],fe=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),he=(0,n.useRef)(0),xe=(0,n.useRef)(!0),me=(0,n.useRef)({}),be=(0,n.useState)({}),ke=s()(be,2),je=ke[0],ye=ke[1],Se=(0,n.useState)(!1),Pe=s()(Se,2),ge=Pe[0],we=Pe[1],Ce=(0,n.useState)(!1),Re=s()(Ce,2),Oe=Re[0],Ie=Re[1],Te=(0,n.useMemo)((function(){return P?"(".concat(P.tokenSymbol," ").concat(P.projectId.slice(0,4),"...").concat(P.projectId.slice(-4),")"):""}),[P]),Ze=(0,n.useMemo)((function(){return P?"".concat(null==P?void 0:P.currentProjectDataSource.nextRoundLocalFormat):""}),[P]),De=(0,n.useCallback)((function(e){var t,r,n=null===(t=l.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=l.current)||void 0===r||r.resetFields(a),e){var s,c,u=e.currentProjectDataSource.nextRoundLocalValue,o=e.totalAmount,i=e.tipFee;O(u),w(e),null===(s=l.current)||void 0===s||s.setFieldValue("totalAmountSend",o),null===(c=l.current)||void 0===c||c.setFieldValue("tipFeeSend",i);var d={};me.current={},e.nftIds.forEach((function(e){me.current[e]="default",d[e]="default"})),ye(d)}else{var f,p;O(0),w(void 0),null===(f=l.current)||void 0===f||f.setFieldValue("totalAmountSend",""),null===(p=l.current)||void 0===p||p.setFieldValue("tipFeeSend",""),me.current={},ye({})}V(0),z(0),B(0),W(0),te(0),ce(0)}),[]),Ee=(0,n.useCallback)((function(){var e,t,r;null===(e=l.current)||void 0===e||e.resetFields(),b([]),O(0),w(void 0),null===(t=l.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=l.current)||void 0===r||r.setFieldValue("tipFeeSend",""),me.current={},ye({}),V(0),z(0),B(0),W(0),te(0),ce(0)}),[]);(0,n.useImperativeHandle)(t,(function(){return{handleTransactionFileContent:De,handleReset:Ee}}));var ze=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return b(t.fileList),De(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(b(t.fileList),De(e),u.success("上传成功")):u.error("指令类型错误"):u.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,u,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),qe=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0,a=0;for(var s in me.current)"success"===me.current[s]?t+=1:"error"===me.current[s]?r+=1:"processing"===me.current[s]?a+=1:"default"===me.current[s]?e+=1:"warning"===me.current[s]&&(n+=1);V(t),z(r),B(n),W(a),te(e)}),[]),Ye=(0,n.useCallback)((function(e){e.forEach(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.transactionBase64,n=t.nft.nftId,"success"!==(a=me.current[n])&&"error"!==a&&"warning"!==a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,s=he.current++%fe.length,c=fe[s]+"/api/v1/transactions?bundleOnly=true",e.next=10,Me().post(c,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[r,{encoding:"base64"}]},{timeout:3e3});case 10:200===(u=e.sent).status?me.current[n]="success":(me.current[n]="error",Ae.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(u),pos:"try"})),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(o=e.t0.response)||void 0===o?void 0:o.status)){e.next=19;break}return me.current[n]="default",e.abrupt("return");case 19:me.current[n]="error",Ae.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(e.t0),pos:"catch"});case 21:qe();case 22:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}())}),[]),$e=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,r)}));case 2:if(n=0,t.forEach((function(e){var t=e.nft.nftId,r=me.current[t];"processing"===r?(n+=1,me.current[t]="warning"):"default"===r?me.current[t]="processing":n+=1})),n!==t.length){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[]),Be=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var a,s,c,o,i,l,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:he.current=0,a=0;case 2:if(!(a<n)){e.next=25;break}Object.keys(me.current).forEach((function(e){me.current[e]="processing"})),qe(),s=t.totalNonceCount,c=t.totalTxCount,o=Math.ceil(c/s),i=0;case 9:if(!(i<o)){e.next=22;break}l=t.transactions.slice(0,(i+1)*s);case 11:return Ye(l),e.next=15,$e(l,r);case 15:if(!e.sent){e.next=17;break}return e.abrupt("break",19);case 17:e.next=11;break;case 19:++i,e.next=9;break;case 22:++a,e.next=2;break;case 25:return d=t.transactions,Ye(d),e.next=29,$e(d,r);case 29:u.success("发送完成");case 30:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[u]),He=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return u.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.reverseOrder,n=t.intervalSend,r&&(P.transactions=P.transactions.toReversed()),Be(P,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[P]),Ue=(0,n.useCallback)((function(){var e;if(!P)return u.error("请先上传交易文件"),!1;var t=(null===(e=l.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;Be(P,t,1)}),[P]),Ke=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=l.current)||void 0===t?void 0:t.getFieldsValue(),n=r.reverseOrder,a=r.repeatSend,s=r.intervalSend,r.autoSend&&P){e.next=3;break}return e.abrupt("return");case 3:return n&&(P.transactions=P.transactions.toReversed()),Be(P,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[P]),We=(0,n.useCallback)((function(e){var t,r,n=null===(t=l.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&xe.current&&(xe.current=!1,null===(r=l.current)||void 0===r||r.submit())}),[]),Ge=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=3;break}return u.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,le(!0),t={},e.next=9,(0,A.II)({mintPubkey:P.projectId});case 9:r=e.sent,n=0,P.nftIds.forEach((function(e){var a=P.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),ce(n),ye(t),le(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),le(!1),(0,M.Tv)(e.t0,u,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[u,P]),Je=(0,n.useCallback)((function(){if(P&&Ae.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Ae,null,2),r="data:,".concat(t),n=document.createElement("a"),a=P.tokenSymbol,s=P.projectId;n.href=r,n.download="Log_".concat(a,"_").concat(s.slice(0,4),"_").concat(s.slice(-4),"_").concat(e,".json"),n.click()}else u.info("无日志信息")}),[P]);return(0,i.jsxs)(se.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(de.A,{formRef:l,onFinish:He,onReset:Ee,layout:"vertical",initialValues:{reverseOrder:!1,autoSend:!0,repeatSend:2,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(g.ZP,{loading:ie,onClick:Ge,children:"校对"},"check"),(0,i.jsx)(g.ZP,{onClick:Ue,children:"预检"},"preflight"),(0,i.jsx)(g.ZP,{onClick:Je,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(Fe.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:ze,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return f.current.handleOpen(e)},fileList:m},rules:[{whitespace:!0,message:"".concat(r),pattern:/.*/}]}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!P}}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:100,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!P}}),(0,i.jsx)(pe.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!P}}),(0,i.jsx)(Le.Z,{name:"reverseOrder",label:(0,i.jsxs)("div",{children:["是否倒序",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"是否以倒序的方式来发送交易",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!P}}),(0,i.jsx)(Le.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!P}}),(0,i.jsx)(ve.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!P}}),(0,i.jsx)(ve.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(Q.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(X.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!P}}),(0,i.jsx)(de.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),Te]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:N,onFinish:Ke,onChange:We}),(0,i.jsx)("div",{className:"text-2xl",children:Ze})]})}),(0,i.jsxs)(de.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),P?"(".concat(P.totalTxCount,")"):"",(0,i.jsx)("span",{className:"ml-2",style:{color:"#1677ff"},onClick:function(){return we((function(e){return!e}))},children:ge?(0,i.jsx)(_e.Z,{}):(0,i.jsx)(Ve.Z,{})})]}),children:[(0,i.jsx)("div",{children:"完成：".concat(_,"，失败：").concat(E,"，超时：").concat($,"，处理中：").concat(K,"，待处理：").concat(ee)}),!(!P||!ge)&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(me.current).map((function(e,t){return(0,i.jsx)(Ne.Z,{color:me.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(de.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),P?"(".concat(P.totalTxCount,")"):"",(0,i.jsx)("span",{className:"ml-2",style:{color:"#1677ff"},onClick:function(){return Ie((function(e){return!e}))},children:Oe?(0,i.jsx)(_e.Z,{}):(0,i.jsx)(Ve.Z,{})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(ae)}),!(!P||!Oe)&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(je).map((function(e,t){return(0,i.jsx)(Ne.Z,{color:je[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(R.VY,{ref:f}),o]})})),De=(0,n.memo)(Ze),Ee=function(e){var t=e.roundDataSource,r=e.loading,a=e.formData,s=e.profitRate,c=(0,n.useMemo)((function(){if(a){var e=t[0].roundLocalValue,r=t[t.length-1].roundLocalValue;return"(".concat(((r-e)/1e3/60/60/24).toFixed(1),"天/").concat(a.timePerRound,"小时)")}return""}),[a,t]),u=(0,n.useMemo)((function(){return a?"(".concat(a.maxNftSupply,")"):""}),[a]),o=(0,n.useMemo)((function(){return a?"(".concat(a.creatorFeeRate,"%) / 累计"):""}),[a]),l=(0,n.useMemo)((function(){return a?"(".concat(a.inviterFeeRate,"%) / 累计"):""}),[a]),d=(0,n.useMemo)((function(){return a?"(".concat(a.platformFeeRate,"%) / 累计"):""}),[a]),f=(0,n.useMemo)((function(){return a?"(".concat(a.nftTradeFeeRate,"%) / 累计"):""}),[a]),p=(0,n.useMemo)((function(){return s?"(".concat((0,M.uf)(100*s,2),"%) / 累计"):""}),[s]),h=(0,n.useMemo)((function(){return t.length?"(".concat(t.length-1,")"):""}),[t]),v=(0,n.useMemo)((function(){return[{title:"轮次".concat(h),dataIndex:"key",key:"key",render:function(e,t){return 0===t.key?"mint":(0,i.jsx)("span",{children:t.key})}},{title:"轮次时间".concat(c),dataIndex:"roundLocalFormat",key:"roundLocalFormat",sorter:function(e,t){return t.roundLocalValue-e.roundLocalValue},render:function(e,t){return(0,i.jsx)("div",{children:t.roundLocalFormat})}},{title:"NFT数量",dataIndex:"nftCount",key:"nftCount",render:function(e,t){return(0,i.jsx)("div",{children:t.nftCount})}},{title:"NFT价格",dataIndex:"nftPrice",key:"nftPrice",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPrice)})}},{title:"投入成本",dataIndex:"invest",key:"invest",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.invest,2)})}},{title:"抢图利润".concat(p),dataIndex:"profitUser",key:"profitUser",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitUser)," / ",(0,M.uf)(t.profitUserSum)]})}},{title:"创建者利润".concat(o),dataIndex:"profitCreator",key:"profitCreator",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitCreator)," / ",(0,M.uf)(t.profitCreatorSum)]})}},{title:"邀请人利润".concat(l),dataIndex:"profitInviter",key:"profitInviter",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitInviter)," / ",(0,M.uf)(t.profitInviterSum)]})}},{title:"平台利润".concat(d),dataIndex:"profitPlatform",key:"profitPlatform",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.profitPlatform)," / ",(0,M.uf)(t.profitPlatformSum)]})}},{title:"资金池".concat(f),dataIndex:"vaultSol",key:"vaultSol",render:function(e,t){return(0,i.jsxs)("div",{children:[(0,M.uf)(t.vaultSol)," / ",(0,M.uf)(t.vaultSolSum)]})}}]}),[c,u,o,l,d,f]);return(0,i.jsx)("div",{className:"ppp-tab-round",children:(0,i.jsx)(j.Z,{loading:{spinning:r,size:"large"},scroll:{x:!0},size:"small",columns:v,dataSource:t,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})})},ze=(0,n.memo)(Ee),qe=r(78045),Ye=function(e){var t=e.sellDataSource,r=e.loading,a=e.formData,c=(0,n.useState)("last"),u=s()(c,2),o=u[0],l=u[1],d=(0,n.useMemo)((function(){if(t.length){var e="";if("last"===o){var r=t.length-1,n=t[0].solPoolLast;e=(t[r].solPoolLast/n*100).toFixed(1)}else{var a=t.length-1,s=t[0].solPoolPenultimate;e=(t[a].solPoolPenultimate/s*100).toFixed(1)}return"(锁死".concat(e,"%)")}return""}),[t,o]),f=(0,n.useMemo)((function(){return[{title:"卖出次序",dataIndex:"key",key:"key",sorter:function(e,t){return t.key-e.key},render:function(e,t){return 0===t.key?"未开始":(0,i.jsx)("div",{children:t.key})}},{title:"NFT成本",dataIndex:"nftPriceLast",key:"nftPriceLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPriceLast)})}},{title:"Token数量",dataIndex:"tokenPerNft",key:"tokenPerNft",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPerNft)})}},{title:"卖出获得SOL",dataIndex:"solOutputLast",key:"solOutputLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solOutputLast)})}},{title:"利润",dataIndex:"profitLast",key:"profitLast",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitLast)})}},{title:"池子余额SOL ".concat(d),dataIndex:"solPoolLast",key:"solPoolLast",sorter:function(e,t){return e.solPoolLast-t.solPoolLast},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solPoolLast)})}},{title:"池子余额Token",dataIndex:"tokenPoolLast",key:"tokenPoolLast",sorter:function(e,t){return e.tokenPoolLast-t.tokenPoolLast},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPoolLast)})}}]}),[d]),p=(0,n.useMemo)((function(){return[{title:"卖出次序",dataIndex:"key",key:"key",sorter:function(e,t){return t.key-e.key},render:function(e,t){return 0===t.key?"未开始":(0,i.jsx)("div",{children:t.key})}},{title:"NFT平均成本",dataIndex:"nftPricePenultimate",key:"nftPricePenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.nftPricePenultimate)})}},{title:"Token数量",dataIndex:"tokenPerNft",key:"tokenPerNft",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPerNft)})}},{title:"卖出获得SOL",dataIndex:"solOutputPenultimate",key:"solOutputPenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solOutputPenultimate)})}},{title:"利润",dataIndex:"profitPenultimate",key:"profitPenultimate",render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.profitPenultimate)})}},{title:"池子余额SOL ".concat(d),dataIndex:"solPoolPenultimate",key:"solPoolPenultimate",sorter:function(e,t){return e.solPoolPenultimate-t.solPoolPenultimate},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.solPoolPenultimate)})}},{title:"池子余额Token",dataIndex:"tokenPoolPenultimate",key:"tokenPoolPenultimate",sorter:function(e,t){return e.tokenPoolPenultimate-t.tokenPoolPenultimate},render:function(e,t){return(0,i.jsx)("div",{children:(0,M.uf)(t.tokenPoolPenultimate)})}}]}),[d]);return(0,i.jsxs)("div",{className:"ppp-tab-sell",children:[(0,i.jsxs)("div",{className:"my-4 flex gap-4",children:[(0,i.jsx)(qe.ZP.Group,{value:o,onChange:function(e){return l(e.target.value)},options:[{value:"last",label:"最后一轮"},{value:"penultimate",label:"倒数第二轮"}]}),a?(0,i.jsxs)("div",{className:"mr-2",children:["Token池子占比：",null==a?void 0:a.lpTokenRate,"%"]}):null,a?(0,i.jsxs)("div",{children:["SOL池子占比：",100-(null==a?void 0:a.lpTokenRate),"%"]}):null]}),(0,i.jsx)(j.Z,{loading:{spinning:r,size:"large"},scroll:{x:!0},size:"small",columns:"last"===o?f:p,dataSource:t,defaultData:[],options:!1,search:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},$e=(0,n.memo)(Ye)}}]);