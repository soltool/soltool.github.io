"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[262],{62741:function(e,t,n){n.d(t,{l:function(){return A}});var r=n(15009),a=n.n(r),o=n(99289),c=n.n(o),s=n(5574),u=n.n(s),i=n(64119),l=n(13451),d=n(5966),m=n(44718),h=n(54306),p=n(29363),f=n(88026),k=n(2453),b=n(67294),g=n(49717),y=n(71874),x=n(85893),P=b.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,o=k.ZP.useMessage(),s=u()(o,2),P=s[0],A=s[1],v=(0,m.R)().connection,S=(0,h.O)(),C=S.publicKey,N=S.signTransaction,I=S.wallet,M=(0,g.A)(),w=M.chain,j=M.modalFeeRef,R=(0,f.useIntl)(),B=R.formatMessage({id:"common.intlInputException"}),T=R.formatMessage({id:"common.intlPleaseConnectWallet"}),H=R.formatMessage({id:"common.intlCreateAccount"}),O=R.formatMessage({id:"common.intlQuantity"}),E=(0,b.useRef)(),W=(0,b.useState)(!1),Z=u()(W,2),z=Z[0],F=Z[1],K=(0,b.useCallback)((function(){F(!0)}),[]);(0,b.useImperativeHandle)(t,(function(){return{handleOpen:K}}));var U=(0,b.useCallback)(function(){var e=c()(a()().mark((function e(t){var o,c,s,u,l,d,m,h,f,k,b,g,x,A,S,M,R,B,H;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C&&N&&I){e.next=3;break}return P.error(T),e.abrupt("return",!0);case 3:if(!((o=Number(t.count))>4)){e.next=7;break}return P.info("每次只能创建4个账号"),e.abrupt("return",!1);case 7:return e.prev=7,c=C,e.next=11,v.getMinimumBalanceForRentExemption(p.NONCE_ACCOUNT_LENGTH);case 11:return s=e.sent,u="#####NonceCountAccount#####",e.next=15,p.PublicKey.createWithSeed(c,u,p.SystemProgram.programId);case 15:return l=e.sent,e.next=18,v.getAccountInfo(l);case 18:d=e.sent,m=[],f=(h=1)+o,d?(h=Math.floor(d.lamports/1e6)+1,f=h+o,m.push(p.SystemProgram.transfer({fromPubkey:c,toPubkey:l,lamports:1e6*o}))):(f=(h=1)+o,m.push(p.SystemProgram.createAccountWithSeed({fromPubkey:c,newAccountPubkey:l,basePubkey:c,seed:u,lamports:1e6*o,space:0,programId:p.SystemProgram.programId}))),k=h;case 24:if(!(k<f)){e.next=34;break}return b="#####NonceAccount".concat(k,"#####"),e.next=28,p.PublicKey.createWithSeed(c,b,p.SystemProgram.programId);case 28:g=e.sent,m.push(p.SystemProgram.createAccountWithSeed({fromPubkey:c,newAccountPubkey:g,basePubkey:c,seed:b,lamports:s,space:p.NONCE_ACCOUNT_LENGTH,programId:p.SystemProgram.programId})),m.push(p.SystemProgram.nonceInitialize({noncePubkey:g,authorizedPubkey:c}));case 31:++k,e.next=24;break;case 34:return e.next=36,v.getLatestBlockhash();case 36:return x=e.sent,A=x.blockhash,S=x.lastValidBlockHeight,e.next=41,(0,y.fC)(v,I,A,m,N,j);case 41:return M=e.sent,R=M.transaction,B=M.feeMode,e.next=46,(0,y.pR)(v,I,R,B);case 46:return H=e.sent,e.next=49,(0,y.fS)(w,v,{signature:H,blockhash:A,lastValidBlockHeight:S},"confirmed",n,P);case 49:return e.sent&&(r(c,v),F(!1)),e.abrupt("return",!0);case 54:return e.prev=54,e.t0=e.catch(7),(0,i.Tv)(e.t0,P,"handleFinish"),e.abrupt("return",!0);case 58:case"end":return e.stop()}}),e,null,[[7,54]])})));return function(t){return e.apply(this,arguments)}}(),[C,N,v,w,n,I,j]);return(0,x.jsxs)(l.Y,{formRef:E,title:H,open:z,onFinish:U,onOpenChange:function(e){F(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,x.jsx)(d.Z,{name:"count",label:O,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(B),pattern:/^[1-9]\d*$/}]}),A]})})),A=(0,b.memo)(P)},96358:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var r=n(15009),a=n.n(r),o=n(99289),c=n.n(o),s=n(5574),u=n.n(s),i=n(39380),l=n(64435),d=n(88026),m=n(67294),h=n(94036),p=n(2453),f=n(16568),k=n(78957),b=n(83622),g=n(54306),y=n(44718),x=n(29363),P=n(39678),A=n(62741),v=n(64119),S=n(9437),C=n(71874),N=n(85893),I=function(){var e=(0,d.useDispatch)(),t=(0,m.useState)(!1),n=u()(t,2),r=n[0],o=n[1],s=p.ZP.useMessage(),I=u()(s,2),M=I[0],w=I[1],j=f.ZP.useNotification(),R=u()(j,2),B=R[0],T=R[1],H=(0,d.useSelector)((function(e){return e.nonce.dataSource})),O=(0,d.useSelector)((function(e){return e.nonce.totalCount})),E=(0,d.useSelector)((function(e){return e.nonce.nonceCountAccount})),W=(0,S.Ab)(),Z=W.chain,z=W.modalFeeRef,F=(0,m.useState)([]),K=u()(F,2),U=K[0],V=K[1],D=(0,g.O)(),L=D.publicKey,_=D.signTransaction,G=D.wallet,q=(0,y.R)().connection,Q=(0,m.useRef)(),Y=(0,d.useIntl)(),$=Y.formatMessage({id:"common.intlPleaseConnectWallet"}),J=Y.formatMessage({id:"common.intlAuthorityAddress"}),X=Y.formatMessage({id:"common.intlNonceAddress"}),ee=Y.formatMessage({id:"common.intlBlockHash"}),te=Y.formatMessage({id:"common.intlDelFromBackToFront"}),ne=Y.formatMessage({id:"common.intlCreateAccount"}),re=Y.formatMessage({id:"common.intlBatchDelete"}),ae=Y.formatMessage({id:"common.intlUpdateNonce"}),oe=Y.formatMessage({id:"common.intlStatus"}),ce=(0,m.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,N.jsx)("span",{children:n+1})}},{title:"".concat(X),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,N.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.nonceAccount.toString()})}},{title:"".concat(J),dataIndex:"authority",key:"authority",render:function(e,t){return(0,N.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.authority.toString()})}},{title:"".concat(oe),dataIndex:"status",key:"status",render:function(e,t){return(0,N.jsx)("span",{children:t.status})}},{title:"".concat(ee),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,N.jsx)(P.k,{copyable:!0,address:t.blockhash})}}]}),[]),se=(0,m.useCallback)(function(){var t=c()(a()().mark((function t(n,r){var c,s,u,i,l,d,m,p;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o(!0),"#####NonceCountAccount#####",t.next=5,x.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",x.SystemProgram.programId);case 5:return c=t.sent,t.next=8,r.getAccountInfo(c);case 8:if(s=t.sent,u=[],i=[],l=0,!s){t.next=30;break}l=Math.floor(s.lamports/1e6),d=0;case 15:if(!(d<l)){t.next=25;break}return m="#####NonceAccount".concat(d+1,"#####"),t.next=20,x.PublicKey.createWithSeed(n,m,x.SystemProgram.programId);case 20:p=t.sent,i.push(p);case 22:++d,t.next=15;break;case 25:if(!i.length){t.next=30;break}return t.next=28,r.getMultipleParsedAccounts(i);case 28:t.sent.value.forEach((function(e,t){u.push({key:t,nonceAccount:i[t],authority:new x.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 30:o(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCount(l)),e(h.N.setNonceCountAccount(c)),t.next=40;break;case 36:t.prev=36,t.t0=t.catch(0),o(!1),(0,v.Tv)(t.t0,M,"handleUpdateNonceAccount");case 40:case"end":return t.stop()}}),t,null,[[0,36]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),ue=(0,m.useCallback)(c()(a()().mark((function e(){var t,n,r,c,s,u,i,l,d,m,h,p,f,k,b,g,y,P;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&_&&G){e.next=2;break}return e.abrupt("return",M.error($));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,t=L,n=U.toSorted().reverse(),r=H.toReversed(),c=[E],s="#####NonceCountAccount#####",u=0;case 11:if(!(u<n.length)){e.next=18;break}if(n[u]===r[u].key){e.next=14;break}return e.abrupt("return",M.error("".concat(te)));case 14:c.push(r[u].nonceAccount);case 15:++u,e.next=11;break;case 18:return i=[],e.next=21,q.getMultipleParsedAccounts(c);case 21:for(l=e.sent,d=1;d<l.value.length;++d)m=l.value[d].lamports,i.push(x.SystemProgram.nonceWithdraw({noncePubkey:r[d-1].nonceAccount,authorizedPubkey:r[d-1].authority,toPubkey:r[d-1].authority,lamports:m}));return r.length===n.length?(h=l.value[0].lamports,i.push(x.SystemProgram.transfer({fromPubkey:E,basePubkey:t,toPubkey:t,lamports:h,seed:s,programId:x.SystemProgram.programId}))):i.push(x.SystemProgram.transfer({fromPubkey:E,basePubkey:t,toPubkey:t,lamports:1e6*n.length,seed:s,programId:x.SystemProgram.programId})),e.next=26,q.getLatestBlockhash();case 26:return p=e.sent,f=p.blockhash,k=p.lastValidBlockHeight,e.next=31,(0,C.fC)(q,G,f,i,_,z);case 31:return b=e.sent,g=b.transaction,y=b.feeMode,e.next=36,(0,C.pR)(q,G,g,y);case 36:return P=e.sent,e.next=39,(0,C.fS)(Z,q,{signature:P,blockhash:f,lastValidBlockHeight:k},"confirmed",B,M);case 39:e.sent&&se(t,q),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(4),o(!1),(0,v.Tv)(e.t0,M,"handleBatchDelete");case 47:case"end":return e.stop()}}),e,null,[[4,43]])}))),[U,L,_,H,E,q,Z,G,z]),ie=(0,m.useCallback)(c()(a()().mark((function e(){var t,n,r,o,c,s,u,i,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&_&&G){e.next=2;break}return e.abrupt("return",M.error($));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,t=L,n=[],U.forEach((function(e){var t=H[e].nonceAccount,r=H[e].authority;n.push(x.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),e.next=10,q.getLatestBlockhash();case 10:return r=e.sent,o=r.blockhash,c=r.lastValidBlockHeight,e.next=15,(0,C.fC)(q,G,o,n,_,z);case 15:return s=e.sent,u=s.transaction,i=s.feeMode,e.next=20,(0,C.pR)(q,G,u,i);case 20:return l=e.sent,e.next=23,(0,C.fS)(Z,q,{signature:l,blockhash:o,lastValidBlockHeight:c},"confirmed",B,M);case 23:e.sent&&se(t,q),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),(0,v.Tv)(e.t0,M,"handleUpdateNonce");case 30:case"end":return e.stop()}}),e,null,[[4,27]])}))),[U,L,_,H,q,Z,G,z]);return(0,m.useEffect)((function(){L&&q&&se(L,q)}),[L,q]),(0,N.jsxs)(i._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,N.jsx)(l.Z,{scroll:{x:!0},size:"small",columns:ce,dataSource:H,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,N.jsx)("div",{children:(0,N.jsxs)(k.Z,{wrap:!0,className:"mb-[16px]",children:[(0,N.jsx)(b.ZP,{type:"primary",onClick:function(){return Q.current.handleOpen()},children:ne}),(0,N.jsx)(b.ZP,{type:"primary",onClick:function(){return ue()},children:re}),(0,N.jsx)(b.ZP,{type:"primary",onClick:function(){return ie()},children:ae}),(0,N.jsx)("div",{children:O})]})}),rowSelection:{type:"checkbox",selectedRowKeys:U,onChange:function(e){V(e)}}}),(0,N.jsx)(A.l,{ref:Q,notificationApi:B,handleUpdateNonceAccount:se}),w,T]})}}}]);