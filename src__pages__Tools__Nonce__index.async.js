"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[262],{62741:function(e,t,n){n.d(t,{l:function(){return v}});var r=n(15009),a=n.n(r),o=n(99289),s=n.n(o),c=n(5574),u=n.n(c),i=n(64119),l=n(13451),m=n(5966),d=n(44718),h=n(54306),p=n(87713),f=n(88026),g=n(2453),k=n(67294),y=n(70609),b=n(49717),x=n(85893),P=k.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,o=g.ZP.useMessage(),c=u()(o,2),P=c[0],v=c[1],A=(0,d.R)().connection,S=(0,h.O)(),C=S.publicKey,w=S.signTransaction,M=(0,b.A)().chain,T=(0,f.useIntl)(),N=T.formatMessage({id:"common.intlInputException"}),I=T.formatMessage({id:"common.intlTxSuccess"}),j=T.formatMessage({id:"common.intlPleaseConnectWallet"}),B=T.formatMessage({id:"common.intlCreateAccount"}),V=T.formatMessage({id:"common.intlQuantity"}),K=(0,k.useRef)(),R=(0,k.useState)(!1),H=u()(R,2),O=H[0],E=H[1],U=(0,k.useCallback)((function(){E(!0)}),[]);(0,k.useImperativeHandle)(t,(function(){return{handleOpen:U}}));var W=(0,k.useCallback)(function(){var e=s()(a()().mark((function e(t){var o,s,c,u,l,m,d,h,f,g,k,b,v,S,T,N,B,V,K,R;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(C&&w){e.next=2;break}return e.abrupt("return",P.error(j));case 2:return e.prev=2,o=C,s=Number(t.count),e.next=7,A.getMinimumBalanceForRentExemption(p.NONCE_ACCOUNT_LENGTH);case 7:return c=e.sent,u="#####NonceCountAccount#####",e.next=11,p.PublicKey.createWithSeed(o,u,p.SystemProgram.programId);case 11:return l=e.sent,e.next=14,A.getAccountInfo(l);case 14:m=e.sent,d=[],f=(h=1)+s,m?(h=Math.floor(m.lamports/1e6)+1,f=h+s,d.push(p.SystemProgram.transfer({fromPubkey:o,toPubkey:l,lamports:1e6*s}))):(f=(h=1)+s,d.push(p.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:l,basePubkey:o,seed:u,lamports:1e6*s,space:0,programId:p.SystemProgram.programId}))),g=h;case 20:if(!(g<f)){e.next=30;break}return k="#####NonceAccount".concat(g,"#####"),e.next=24,p.PublicKey.createWithSeed(o,k,p.SystemProgram.programId);case 24:b=e.sent,d.push(p.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:b,basePubkey:o,seed:k,lamports:c,space:p.NONCE_ACCOUNT_LENGTH,programId:p.SystemProgram.programId})),d.push(p.SystemProgram.nonceInitialize({noncePubkey:b,authorizedPubkey:o}));case 27:++g,e.next=20;break;case 30:return e.next=32,A.getLatestBlockhash();case 32:return v=e.sent,S=v.blockhash,T=v.lastValidBlockHeight,N=new p.TransactionMessage({payerKey:o,recentBlockhash:S,instructions:d}).compileToLegacyMessage(),B=new p.VersionedTransaction(N),e.next=39,w(B);case 39:return V=e.sent,e.next=42,A.sendTransaction(V);case 42:return K=e.sent,e.next=45,A.confirmTransaction({signature:K,blockhash:S,lastValidBlockHeight:T},"confirmed");case 45:return(R=e.sent).value.err?(console.log(R.value.err),P.error("".concat(R.value.err))):(n.success({message:I,description:(0,x.jsx)(y.VU,{type:"tx",content:K,chain:M}),placement:"top",showProgress:!0}),r(o,A),E(!1)),e.abrupt("return",!0);case 50:e.prev=50,e.t0=e.catch(2),(0,i.Tv)(e.t0,P,"handleFinish");case 53:case"end":return e.stop()}}),e,null,[[2,50]])})));return function(t){return e.apply(this,arguments)}}(),[C,w,A,M,n]);return(0,x.jsxs)(l.Y,{formRef:K,title:B,open:O,onFinish:W,onOpenChange:function(e){E(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,x.jsx)(m.Z,{name:"count",label:V,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(N),pattern:/^[1-9]\d*$/}]}),v]})})),v=(0,k.memo)(P)},96358:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var r=n(15009),a=n.n(r),o=n(99289),s=n.n(o),c=n(5574),u=n.n(c),i=n(39380),l=n(64435),m=n(88026),d=n(67294),h=n(94036),p=n(2453),f=n(16568),g=n(78957),k=n(83622),y=n(54306),b=n(44718),x=n(87713),P=n(39678),v=n(62741),A=n(64119),S=n(70609),C=n(29599),w=n(85893),M=function(){var e=(0,m.useDispatch)(),t=(0,d.useState)(!1),n=u()(t,2),r=n[0],o=n[1],c=p.ZP.useMessage(),M=u()(c,2),T=M[0],N=M[1],I=f.ZP.useNotification(),j=u()(I,2),B=j[0],V=j[1],K=(0,m.useSelector)((function(e){return e.nonce.dataSource})),R=(0,m.useSelector)((function(e){return e.nonce.totalCount})),H=(0,m.useSelector)((function(e){return e.nonce.nonceCountAccount})),O=(0,C.Ab)().chain,E=(0,d.useState)([]),U=u()(E,2),W=U[0],Z=U[1],z=(0,y.O)(),L=z.publicKey,D=z.signTransaction,F=(0,b.R)().connection,_=(0,d.useRef)(),G=(0,m.useIntl)(),q=G.formatMessage({id:"common.intlPleaseConnectWallet"}),Q=G.formatMessage({id:"common.intlTxSuccess"}),Y=G.formatMessage({id:"common.intlAuthorityAddress"}),$=G.formatMessage({id:"common.intlNonceAddress"}),J=G.formatMessage({id:"common.intlBlockHash"}),X=G.formatMessage({id:"common.intlDelFromBackToFront"}),ee=G.formatMessage({id:"common.intlCreateAccount"}),te=G.formatMessage({id:"common.intlBatchDelete"}),ne=G.formatMessage({id:"common.intlUpdateNonce"}),re=G.formatMessage({id:"common.intlStatus"}),ae=(0,d.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,w.jsx)("span",{children:n+1})}},{title:"".concat($),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,w.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.nonceAccount.toString()})}},{title:"".concat(Y),dataIndex:"authority",key:"authority",render:function(e,t){return(0,w.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.authority.toString()})}},{title:"".concat(re),dataIndex:"status",key:"status",render:function(e,t){return(0,w.jsx)("span",{children:t.status})}},{title:"".concat(J),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,w.jsx)(P.k,{copyable:!0,address:t.blockhash})}}]}),[]),oe=(0,d.useCallback)(function(){var t=s()(a()().mark((function t(n,r){var s,c,u,i,l,m,d,p;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o(!0),"#####NonceCountAccount#####",t.next=5,x.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",x.SystemProgram.programId);case 5:return s=t.sent,t.next=8,r.getAccountInfo(s);case 8:if(c=t.sent,u=[],i=[],l=0,!c){t.next=30;break}l=Math.floor(c.lamports/1e6),m=0;case 15:if(!(m<l)){t.next=25;break}return d="#####NonceAccount".concat(m+1,"#####"),t.next=20,x.PublicKey.createWithSeed(n,d,x.SystemProgram.programId);case 20:p=t.sent,i.push(p);case 22:++m,t.next=15;break;case 25:if(!i.length){t.next=30;break}return t.next=28,r.getMultipleParsedAccounts(i);case 28:t.sent.value.forEach((function(e,t){u.push({key:t,nonceAccount:i[t],authority:new x.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 30:o(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCount(l)),e(h.N.setNonceCountAccount(s)),t.next=40;break;case 36:t.prev=36,t.t0=t.catch(0),o(!1),(0,A.Tv)(t.t0,T,"handleUpdateNonceAccount");case 40:case"end":return t.stop()}}),t,null,[[0,36]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),se=(0,d.useCallback)(s()(a()().mark((function e(){var t,n,r,s,c,u,i,l,m,d,h,p,f,g,k,y,b,P,v;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&D){e.next=2;break}return e.abrupt("return",T.error(q));case 2:if(W.length){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,t=L,n=W.toSorted().reverse(),r=K.toReversed(),s=[H],c="#####NonceCountAccount#####",u=0;case 11:if(!(u<n.length)){e.next=18;break}if(n[u]===r[u].key){e.next=14;break}return e.abrupt("return",T.error("".concat(X)));case 14:s.push(r[u].nonceAccount);case 15:++u,e.next=11;break;case 18:return i=[],e.next=21,F.getMultipleParsedAccounts(s);case 21:for(l=e.sent,m=1;m<l.value.length;++m)d=l.value[m].lamports,i.push(x.SystemProgram.nonceWithdraw({noncePubkey:r[m-1].nonceAccount,authorizedPubkey:r[m-1].authority,toPubkey:r[m-1].authority,lamports:d}));return r.length===n.length?(h=l.value[0].lamports,i.push(x.SystemProgram.transfer({fromPubkey:H,basePubkey:t,toPubkey:t,lamports:h,seed:c,programId:x.SystemProgram.programId}))):i.push(x.SystemProgram.transfer({fromPubkey:H,basePubkey:t,toPubkey:t,lamports:1e6*n.length,seed:c,programId:x.SystemProgram.programId})),e.next=26,F.getLatestBlockhash();case 26:return p=e.sent,f=p.blockhash,g=p.lastValidBlockHeight,k=new x.TransactionMessage({payerKey:t,recentBlockhash:f,instructions:i}).compileToLegacyMessage(),y=new x.VersionedTransaction(k),e.next=33,D(y);case 33:return b=e.sent,e.next=36,F.sendTransaction(b);case 36:return P=e.sent,e.next=39,F.confirmTransaction({signature:P,blockhash:f,lastValidBlockHeight:g},"confirmed");case 39:(v=e.sent).value.err?(console.log(v.value.err),T.error("".concat(v.value.err))):(B.success({message:Q,description:(0,w.jsx)(S.VU,{type:"tx",content:P,chain:O}),placement:"top",showProgress:!0}),oe(t,F)),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(4),o(!1),(0,A.Tv)(e.t0,T,"handleBatchDelete");case 47:case"end":return e.stop()}}),e,null,[[4,43]])}))),[W,L,D,K,H,F,O]),ce=(0,d.useCallback)(s()(a()().mark((function e(){var t,n,r,o,s,c,u,i,l,m;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&D){e.next=2;break}return e.abrupt("return",T.error(q));case 2:if(W.length){e.next=4;break}return e.abrupt("return");case 4:return t=L,n=[],W.forEach((function(e){var t=K[e].nonceAccount,r=K[e].authority;n.push(x.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),e.next=9,F.getLatestBlockhash();case 9:return r=e.sent,o=r.blockhash,s=r.lastValidBlockHeight,c=new x.TransactionMessage({payerKey:t,recentBlockhash:o,instructions:n}).compileToLegacyMessage(),u=new x.VersionedTransaction(c),e.next=16,D(u);case 16:return i=e.sent,e.next=19,F.sendTransaction(i);case 19:return l=e.sent,e.next=22,F.confirmTransaction({signature:l,blockhash:o,lastValidBlockHeight:s},"confirmed");case 22:(m=e.sent).value.err?(console.log(m.value.err),T.error("".concat(m.value.err))):(B.success({message:Q,description:(0,w.jsx)(S.VU,{type:"tx",content:l,chain:O}),placement:"top",showProgress:!0}),oe(t,F));case 24:case"end":return e.stop()}}),e)}))),[W,L,D,K,F,O]);return(0,d.useEffect)((function(){L&&F&&oe(L,F)}),[L,F]),(0,w.jsxs)(i._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,w.jsx)(l.Z,{scroll:{x:!0},size:"small",columns:ae,dataSource:K,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,w.jsx)("div",{children:(0,w.jsxs)(g.Z,{wrap:!0,className:"mb-[16px]",children:[(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return _.current.handleOpen()},children:ee}),(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return se()},children:te}),(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return ce()},children:ne}),(0,w.jsx)("div",{children:R})]})}),rowSelection:{type:"checkbox",selectedRowKeys:W,onChange:function(e){Z(e)}}}),(0,w.jsx)(v.l,{ref:_,notificationApi:B,handleUpdateNonceAccount:oe}),N,V]})}}}]);