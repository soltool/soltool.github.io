"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[183],{87603:function(e,t,r){r.d(t,{Z:function(){return o}});var n=r(87462),a=r(67294),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},c=r(84089),i=function(e,t){return a.createElement(c.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var o=a.forwardRef(i)},63434:function(e,t,r){var n=r(1413),a=r(91),s=r(22270),c=r(84567),i=r(67294),o=r(90789),l=r(63053),u=r(85893),d=["options","fieldProps","proFieldProps","valueEnum"],f=i.forwardRef((function(e,t){var r=e.options,c=e.fieldProps,i=e.proFieldProps,o=e.valueEnum,f=(0,a.Z)(e,d);return(0,u.jsx)(l.Z,(0,n.Z)({ref:t,valueType:"checkbox",valueEnum:(0,s.h)(o,void 0),fieldProps:(0,n.Z)({options:r},c),lightProps:(0,n.Z)({labelFormatter:function(){return(0,u.jsx)(l.Z,(0,n.Z)({ref:t,valueType:"checkbox",mode:"read",valueEnum:(0,s.h)(o,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:r},c),proFieldProps:i},f))}},f.lightProps),proFieldProps:i},f))})),p=i.forwardRef((function(e,t){var r=e.fieldProps,a=e.children;return(0,u.jsx)(c.Z,(0,n.Z)((0,n.Z)({ref:t},r),{},{children:a}))})),m=(0,o.G)(p,{valuePropName:"checked"});m.Group=f,t.Z=m},31199:function(e,t,r){var n=r(1413),a=r(91),s=r(67294),c=r(63053),i=r(85893),o=["fieldProps","min","proFieldProps","max"],l=function(e,t){var r=e.fieldProps,s=e.min,l=e.proFieldProps,u=e.max,d=(0,a.Z)(e,o);return(0,i.jsx)(c.Z,(0,n.Z)({valueType:"digit",fieldProps:(0,n.Z)({min:s,max:u},r),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:l},d))},u=s.forwardRef(l);t.Z=u},25054:function(e,t,r){var n=r(1413),a=r(91),s=r(67294),c=r(63053),i=r(85893),o=["fieldProps","proFieldProps","min","max","step","marks","vertical","range"],l=s.forwardRef((function(e,t){var r=e.fieldProps,s=e.proFieldProps,l=e.min,u=e.max,d=e.step,f=e.marks,p=e.vertical,m=e.range,h=(0,a.Z)(e,o);return(0,i.jsx)(c.Z,(0,n.Z)({valueType:"slider",fieldProps:(0,n.Z)((0,n.Z)({},r),{},{min:l,max:u,step:d,marks:f,vertical:p,range:m,style:null==r?void 0:r.style}),ref:t,proFieldProps:s,filedConfig:{ignoreWidth:!0}},h))}));t.Z=l},52688:function(e,t,r){var n=r(1413),a=r(91),s=r(67294),c=r(63053),i=r(85893),o=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],l=s.forwardRef((function(e,t){var r=e.fieldProps,s=e.unCheckedChildren,l=e.checkedChildren,u=e.proFieldProps,d=(0,a.Z)(e,o);return(0,i.jsx)(c.Z,(0,n.Z)({valueType:"switch",fieldProps:(0,n.Z)({unCheckedChildren:s,checkedChildren:l},r),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=l},84995:function(e,t,r){r.r(t);var n=r(19632),a=r.n(n),s=r(64599),c=r.n(s),i=r(15009),o=r.n(i),l=r(99289),u=r.n(l),d=r(5574),f=r.n(d),p=r(3567),m=r(40956),h=r(69988),v=r(64119),x=r(87603),b=r(98165),j=r(25035),k=r(39380),g=r(38345),y=r(97269),P=r(64317),_=r(63434),w=r(52688),S=r(25054),C=r(91604),N=r(31199),Z=r(5966),T=r(39678),F=r(88026),L=r(54306),O=r(44718),R=r(43651),V=r(2453),M=r(7134),Y=r(83622),E=r(83062),A=r(66309),D=r(9669),I=r.n(D),H=r(27484),z=r.n(H),$=r(70178),q=r.n($),B=r(67294),U=r(40165),W=r(70609),K=r(87713),G=r(30527),J=r(8257),Q=r(20640),X=r.n(Q),ee=r(85893),te=r(48764).Buffer;z().extend(q());var re=[];t.default=function(){var e=(0,F.useDispatch)(),t=V.ZP.useMessage(),r=f()(t,2),n=r[0],s=r[1],i=(0,B.useState)([]),l=f()(i,2),d=l[0],D=l[1],H=(0,B.useState)(0),$=f()(H,2),q=$[0],Q=$[1],ne=(0,B.useState)(0),ae=f()(ne,2),se=ae[0],ce=ae[1],ie=(0,B.useState)(0),oe=f()(ie,2),le=oe[0],ue=oe[1],de=(0,B.useState)(0),fe=f()(de,2),pe=fe[0],me=fe[1],he=(0,B.useState)(0),ve=f()(he,2),xe=ve[0],be=ve[1],je=(0,B.useState)([]),ke=f()(je,2),ge=ke[0],ye=ke[1],Pe=(0,B.useState)(0),_e=f()(Pe,2),we=_e[0],Se=_e[1],Ce=(0,B.useState)({}),Ne=f()(Ce,2),Ze=Ne[0],Te=Ne[1],Fe=(0,B.useState)({}),Le=f()(Fe,2),Oe=Le[0],Re=Le[1],Ve=(0,B.useState)(!1),Me=f()(Ve,2),Ye=Me[0],Ee=Me[1],Ae=(0,B.useState)(!1),De=f()(Ae,2),Ie=De[0],He=De[1],ze=(0,B.useState)(!1),$e=f()(ze,2),qe=$e[0],Be=$e[1],Ue=(0,B.useState)(!1),We=f()(Ue,2),Ke=We[0],Ge=We[1],Je=(0,B.useState)([]),Qe=f()(Je,2),Xe=Qe[0],et=Qe[1],tt=(0,B.useState)(0),rt=f()(tt,2),nt=rt[0],at=rt[1],st=(0,F.useIntl)(),ct=st.formatMessage({id:"common.intlInputException"}),it=st.formatMessage({id:"common.intlPleaseConnectWallet"}),ot=(0,B.useState)(""),lt=f()(ot,2),ut=lt[0],dt=lt[1],ft=(0,B.useState)(0),pt=f()(ft,2),mt=pt[0],ht=pt[1],vt=(0,B.useState)(0),xt=f()(vt,2),bt=xt[0],jt=xt[1],kt=(0,B.useState)(0),gt=f()(kt,2),yt=gt[0],Pt=gt[1],_t=(0,L.O)(),wt=_t.signTransaction,St=_t.signMessage,Ct=_t.publicKey,Nt=(0,O.R)().connection,Zt=(0,R.z)(),Tt=(0,F.useSelector)((function(e){return e.ppp.projectsOption})),Ft=(0,F.useSelector)((function(e){return e.ppp.projectsDataSource})),Lt=(0,F.useSelector)((function(e){return e.ppp.currentProjectDataSource})),Ot=(0,F.useSelector)((function(e){return e.ppp.currentProjectNftsDataSource})),Rt=(0,F.useSelector)((function(e){return e.ppp.vipAccounts})),Vt=(0,F.useSelector)((function(e){return e.wallet.endpoint})),Mt=(0,F.useSelector)((function(e){return e.wallet.tipAccounts})),Yt=(0,F.useSelector)((function(e){return e.wallet.jitoRpcs})),Et=(0,B.useMemo)((function(){var e=(0,v.uf)(mt/K.LAMPORTS_PER_SOL,8,"SOL"),t=(0,v.uf)(mt/K.LAMPORTS_PER_SOL*bt,6);return bt?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[mt,bt]),At=(0,B.useMemo)((function(){var e=(0,v.uf)(yt/K.LAMPORTS_PER_SOL,8,"SOL"),t=(0,v.uf)(yt/K.LAMPORTS_PER_SOL*bt,6);return bt?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[mt,bt]),Dt=(0,B.useCallback)((function(){X()(ut)?n.success("复制成功"):n.error("复制失败")}),[ut]),It=(0,B.useCallback)(function(){var t=u()(o()().mark((function t(r){var a;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{a=[],r.forEach((function(e){var t=e.nftImageUrl,r=e.tokenSymbol,n=e.projectName,s=e.mintPubkey;a.push({value:s,label:(0,ee.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ee.jsxs)("div",{className:"flex items-center",children:[(0,ee.jsx)(M.C,{className:"mr-2",size:"default",src:t}),(0,ee.jsx)("div",{children:"".concat(r," - ").concat(n)})]}),(0,ee.jsx)(T.k,{ellipsis:!0,tooltip:!1,address:s})]}),nftImageUrl:t,projectName:n,tokenSymbol:r,mintPubkey:s})})),e(m.N.setProjectsOption(a))}catch(e){(0,v.Tv)(e,n,"handleProjectsOption")}case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[]),Ht=(0,B.useCallback)(function(){var t=u()(o()().mark((function t(r){var a,s,c;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,Ge(!0),t.next=4,(0,h.VY)({mintPubkey:r});case 4:return a=t.sent,s=Ft.find((function(e){return e.mintPubkey===r})),c=[],a.forEach((function(e,t){var r=e.nft_pubkey,n=e.bump,a=e.mint_pubkey,i=e.owner_pubkey,o=e.nft_id,l=e.round,u=e.price,d=e.split_count,f=e.last_split,p=e.last_trade,m=e.create_time,h=e.unix_ts,v=e.is_burned,x=e.updated_at,b=u/(s.increasePerRound/1e4+1),j=u*s.profitRate/100,k=u>=s.splitNftPrice,g=z().unix(e.last_trade).utcOffset(8).format("YYYY-MM-DDTHH:mm:ss"),y=z().unix(e.last_trade).utcOffset(8).valueOf(),P=z().unix(e.last_trade).utcOffset(8).add(s.secToBurnNft,"seconds"),_=P.valueOf(),w=P.format("YYYY-MM-DDTHH:mm:ss");c.push({nftPubkey:r,bump:n,mintPubkey:a,ownerPubkey:i,nftId:o,round:l,price:u,splitCount:d,lastSplit:f,lastTrade:p,createTime:m,unixTs:h,isBurned:v,updatedAt:x,key:t,invest:b,profit:j,split:k,status:"",lastTradeLocalFormat:g,lastTradeLocalValue:y,burnTimeLocalValue:_,burnTimeLocalFormat:w})})),e(m.N.setCurrentProjectNftsDataSource(c)),e(m.N.setCurrentProjectDataSource(s)),Ge(!1),t.abrupt("return",c);case 14:return t.prev=14,t.t0=t.catch(0),Ge(!1),(0,v.Tv)(t.t0,n,"handleCurrentProjectNfts"),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e){return t.apply(this,arguments)}}(),[Ft]),zt=(0,B.useCallback)(function(){var t=u()(o()().mark((function t(r){var a,s,c;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,h.mW)();case 3:return a=t.sent,t.next=6,(0,v.o8)(Vt);case 6:s=t.sent,a.sort((function(e,t){return t.volume_24h-e.volume_24h})),c=[],a.forEach((function(e,t){var r=e.project_pubkey,n=e.bump,a=e.creator_pubkey,s=e.mint_pubkey,i=e.authority_pubkey,o=e.project_name,l=e.project_desc,u=e.token_symbol,d=e.token_uri,f=e.init_token_supply,p=e.max_token_supply,m=e.init_nft_supply,h=e.max_nft_supply,v=e.token_per_nft,x=e.init_nft_price,b=e.increase_per_round,j=e.trade_fee_rate,k=e.sec_per_round,g=e.sec_to_burn_nft,y=e.nft_id,P=e.aid,_=e.nft_issue_count,w=e.nft_burn_count,S=e.round,C=e.last_round,N=e.create_time,Z=e.unix_ts,T=e.image_url,F=e.nft_name,L=e.nft_image_url,O=e.bgm_url,R=e.website,V=e.twitter,M=e.telegram,Y=e.discord,E=e.market_cap,A=e.fdv,D=e.circulation_supply,I=e.updated_at,H=e.project_mint,$=e.volume_24h,q=e.tx_24h,B=_-w,U=2*x,W=z().unix(e.last_round).utcOffset(8).format("YYYY-MM-DDTHH:mm:ss"),K=z().unix(e.last_round).utcOffset(8).valueOf(),G=z().utc(e.create_time).utcOffset(16).format("YYYY-MM-DDTHH:mm:ss"),J=z().utc(e.create_time).utcOffset(16).valueOf(),Q=b/100-(b/100+100)*(.01+j/1e4),X=86400/k*Q,ee=2592e3/k*Q,te=31536e3/k*Q,re=z().unix(e.last_round).utcOffset(8).add(k,"seconds"),ne=re.valueOf(),ae=re.format("YYYY-MM-DDTHH:mm:ss");c.push({projectPubkey:r,bump:n,creatorPubkey:a,mintPubkey:s,authorityPubkey:i,projectName:o,projectDesc:l,tokenSymbol:u,tokenUri:d,initTokenSupply:f,maxTokenSupply:p,initNftSupply:m,maxNftSupply:h,tokenPerNft:v,initNftPrice:x,increasePerRound:b,tradeFeeRate:j,secPerRound:k,secToBurnNft:g,nftId:y,aid:P,nftIssueCount:_,nftBurnCount:w,round:S,lastRound:C,createTime:N,unixTs:Z,imageUrl:T,nftName:F,nftImageUrl:L,bgmUrl:O,website:R,twitter:V,telegram:M,discord:Y,marketCap:E,fdv:A,circulationSupply:D,updatedAt:I,projectMint:H,volume24h:$,tx24h:q,key:t,nftSupply:B,splitNftPrice:U,profitRate:Q,profitRateYear:te,profitRateDay:X,profitRateMonth:ee,nextRoundLocalValue:ne,nextRoundLocalFormat:ae,lastRoundLocalFormat:W,lastRoundLocalValue:K,createTimeLocalFormat:G,createTimeLocalValue:J})})),jt(s),e(m.N.setProjects(a)),e(m.N.setProjectsDataSource(c)),r(!1),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(0),r(!1),(0,v.Tv)(t.t0,n,"handleGetProjects");case 20:case"end":return t.stop()}}),t,null,[[0,16]])})));return function(e){return t.apply(this,arguments)}}(),[]),$t=(0,B.useRef)({}),qt=(0,B.useRef)(),Bt=(0,B.useRef)(),Ut=(0,B.useRef)(),Wt=(0,B.useRef)(!0),Kt=(0,B.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var a in $t.current)"success"===$t.current[a].status?t+=1:"error"===$t.current[a].status?r+=1:"processing"===$t.current[a].status?n+=1:"default"===$t.current[a].status&&(e+=1);Q(t),ce(r),ue(n),me(e)}),[]),Gt=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.forEach(function(){var e=u()(o()().mark((function e(t,r){var n,a,s,c;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,$t.current[t.cid].status="processing",Kt(),a=r%Yt.length,s=Yt[a]+"/api/v1/transactions?bundleOnly=true",e.next=7,I().post(s,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[t.signedTransactionBase64,{encoding:"base64"}]});case 7:null!=(c=e.sent)&&null!==(n=c.data)&&void 0!==n&&n.result?$t.current[t.cid].status="success":re.push({cid:t.cid,error:JSON.stringify(c),pos:"catch"}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),$t.current[t.cid].status="error",re.push({cid:t.cid,error:JSON.stringify(e.t0),pos:"catch"});case 15:Kt();case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Nt,Kt,Yt]),Jt=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){var r,a,s,i,l,u,d,f,p,m,x,b,j,k,g,y,P,_,w,S,C,N,Z,T,F,L,O,R,V,M,Y,E,A;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Ct&&wt&&Zt){e.next=3;break}return e.abrupt("return",n.error(it));case 3:if(He(!0),a=Ct,s=t.pidCreate,i=t.burnCreate,t.sellCreate,t.tipCreate,0!==i.length){e.next=10;break}return n.error("请选择图片"),He(!1),e.abrupt("return");case 10:return l=s,u=Lt.tokenPerNft,d=i.length,"#####NonceCountAccount#####",e.next=16,K.PublicKey.createWithSeed(a,"#####NonceCountAccount#####",K.SystemProgram.programId);case 16:return f=e.sent,e.next=19,Nt.getAccountInfo(f);case 19:if(p=e.sent,m=[],x=[],b=0,p){e.next=25;break}throw Error("请先创建Nonce账号");case 25:if(b=Math.floor(p.lamports/1e6),!(d>b)){e.next=28;break}throw Error("Nonce账号数量不足，需要大于等于图片购买数量");case 28:j=0;case 29:if(!(j<b)){e.next=39;break}return k="#####NonceAccount".concat(j+1,"#####"),e.next=34,K.PublicKey.createWithSeed(a,k,K.SystemProgram.programId);case 34:g=e.sent,m.push(g);case 36:++j,e.next=29;break;case 39:if(!m.length){e.next=44;break}return e.next=42,Nt.getMultipleParsedAccounts(m);case 42:e.sent.value.forEach((function(e,t){x.push({key:t,nonceAccount:m[t],authority:new K.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 44:y=0,P=0,_=0,w=[],S=new G.$r(J,new G.Y7(Nt,Zt,G.Y7.defaultOptions())),C=c()(i),e.prev=50,Z=o()().mark((function e(){var t,r,n,s,c,i,l;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=N.value,r=Ot.find((function(e){return e.nftId===Number(t)})),(n=[]).push(K.SystemProgram.nonceAdvance({noncePubkey:x[_].nonceAccount,authorizedPubkey:x[_].authority})),e.next=6,(0,h.T7)(S,a,Lt,r);case 6:return s=e.sent,n.push(s),n.push(K.SystemProgram.transfer({fromPubkey:a,toPubkey:new K.PublicKey(Mt[P]),lamports:Number(mt.toFixed(0))})),c=new K.TransactionMessage({payerKey:a,recentBlockhash:x[_].blockhash,instructions:n}).compileToLegacyMessage(),i=new K.VersionedTransaction(c),e.next=13,wt(i);case 13:l=e.sent,w.push({instructions:n,signedTransaction:l,signedTransactionRaw:te.from(l.serialize()).toString("base64"),nft:r,cid:r.nftId,nftid:r.nftId,amount:u,from:a,burn_time:r.burnTimeLocalValue}),at(y),_=(_+1)%m.length,P=(P+1)%Mt.length;case 18:case"end":return e.stop()}}),e)})),C.s();case 53:if((N=C.n()).done){e.next=57;break}return e.delegateYield(Z(),"t0",55);case 55:e.next=53;break;case 57:e.next=62;break;case 59:e.prev=59,e.t1=e.catch(50),C.e(e.t1);case 62:return e.prev=62,C.f(),e.finish(62);case 65:if(w.length){e.next=69;break}return n.info("没有需要创建的内容"),He(!1),e.abrupt("return",!0);case 69:return T=[],F=[],w.forEach((function(e){T.push(e.nft.nftId),F.push(e.nft.nftId)})),L=Lt.nftName,O=Lt.creatorPubkey,R=Lt.tokenSymbol,T.sort(),F.sort(),V={infos:{type:"burn",pid:l,creator:O,project_name:Lt.projectName,nft_name:L,token_symbol:R,last_round:Lt.lastRoundLocalFormat,sec_per_round:Lt.secPerRound,from:a.toString(),start:T[0],end:T[T.length-1],count:w.length,amount:0,cid_array:T,nftid_array:F,tipFee:mt},transactions:w},M=z()().format("YYYY-MM-DDTHH:mm:ss"),Y=JSON.stringify(V,null,2),E="data:,".concat(Y),(A=document.createElement("a")).href=E,A.download="".concat(R,"_").concat(l.slice(0,4),"_").concat(l.slice(-4),"_").concat(y,"_").concat(M,"_buy.json"),A.click(),dt(Y),null===(r=qt.current)||void 0===r||r.setFieldValue("amountCreate",0),n.success("创建完成"),He(!1),e.abrupt("return",!0);case 92:e.prev=92,e.t2=e.catch(0),at(0),He(!1),(0,v.Tv)(e.t2,n,"handleFinishCreate");case 97:return e.abrupt("return",!0);case 98:case"end":return e.stop()}}),e,null,[[0,92],[50,59,62,65]])})));return function(t){return e.apply(this,arguments)}}(),[Ct,Zt,J,Rt,Lt,Ot,Nt,mt,Mt,St,wt]),Qt=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ge.length){e.next=3;break}return n.error("交易信息为空"),e.abrupt("return",!1);case 3:return e.prev=3,Gt(ge),e.abrupt("return",!0);case 8:e.prev=8,e.t0=e.catch(3),(0,v.Tv)(e.t0,n,"handleFinishSend");case 11:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),[ge,Gt]),Xt=(0,B.useCallback)((function(e){var t=z()(e).valueOf();Se(t)}),[]),er=(0,B.useCallback)((function(e){var t,r,n=null===(t=Bt.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&Wt.current&&(Wt.current=!1,null===(r=Bt.current)||void 0===r||r.submit())}),[]),tr=(0,B.useCallback)((function(){var e;if(null!==(e=Bt.current)&&void 0!==e&&e.getFieldValue("auto")){if(0===ge.length)return n.error("交易信息为空"),!1;var t=Bt.current.getFieldsValue(),r=t.repeatSend,a=t.intervalSend;try{Gt(ge);for(var s=1;s<r;s++)(0,U.iK)(Gt,a*s,ge);return!0}catch(e){(0,v.Tv)(e,n,"handleCountDownFinishSend")}}}),[ge,Gt]),rr=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){var r,a,s,i,l,u,d,f,p,m,h,x,b,j,k,g,y,P,_,w,S,C,N;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=16;break}return $t.current={},Re({}),ce(0),Q(0),ue(0),me(0),ye([]),Se(0),Te({}),be(0),null===(r=Bt.current)||void 0===r||r.setFieldValue("amountSend",""),null===(a=Bt.current)||void 0===a||a.setFieldValue("startTime",""),null===(s=Bt.current)||void 0===s||s.setFieldValue("endTime",""),Wt.current=!0,e.abrupt("return");case 16:e.prev=16,p=[],m=new Set,h=[],x={},b=0,j={infos:{},transactions:[]},k=c()(t),e.prev=24,y=o()().mark((function e(){var t,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g.value,e.next=3,new Promise((function(e){var r=new FileReader;r.readAsText(t.originFileObj),r.onload=function(){return e(r.result)}}));case 3:r=e.sent,(j=JSON.parse(r)).transactions.forEach((function(e){m.has(e.cid)||(h.push(e),m.add(e.cid))}));case 6:case"end":return e.stop()}}),e)})),k.s();case 27:if((g=k.n()).done){e.next=31;break}return e.delegateYield(y(),"t0",29);case 29:e.next=27;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(24),k.e(e.t1);case 36:return e.prev=36,k.f(),e.finish(36);case 39:P=j.infos.start,_=z()(P).valueOf(),w=j.infos.end,S=z()(w).valueOf(),C=Math.ceil((S-_)/1e3),Xt(P),j.infos.token_symbol,h.forEach((function(e){var t=e.signedTransactionRaw,r=te.from(e.signedTransactionRaw,"base64");p.push({cid:e.cid,nftid:e.nftid,amount:e.amount,from:e.from,signedTransaction:r,signedTransactionBase64:t}),x[e.cid]={status:"default",message:""},b+=e.amount})),null===(i=Bt.current)||void 0===i||i.setFieldValue("amountSend",b),null===(l=Bt.current)||void 0===l||l.setFieldValue("startTime",P),null===(u=Bt.current)||void 0===u||u.setFieldValue("endTime",w),N=C+10+Math.ceil(C/60),null===(d=Bt.current)||void 0===d||d.setFieldValue("repeatSend",N),null===(f=Bt.current)||void 0===f||f.setFieldValue("intervalSend",1e3),$t.current=x,Re({}),ce(0),Q(0),ue(0),me(p.length),ye(p),Te(j.infos),be(0),Wt.current=!0,e.next=68;break;case 65:e.prev=65,e.t2=e.catch(16),(0,v.Tv)(e.t2,n,"handleFileList");case 68:case"end":return e.stop()}}),e,null,[[16,65],[24,33,36,39]])})));return function(t){return e.apply(this,arguments)}}(),[Xt]),nr=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){var r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("removed"!==t.file.status){e.next=4;break}return D(t.fileList),rr(t.fileList),e.abrupt("return");case 4:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){try{var e=JSON.parse(r.result);e?e.hasOwnProperty("infos")&&"burn"===e.infos.type?(D(t.fileList),rr(t.fileList),n.success("上传成功")):n.error("文件类型错误"):n.error("上传失败")}catch(e){(0,v.Tv)(e,n,"handleUpload")}};case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[rr]),ar=(0,B.useCallback)((function(){var e;null===(e=Bt.current)||void 0===e||e.resetFields(),D([]),ce(0),Q(0),ue(0),me(0),ye([]),Se(0),$t.current={},Re({}),Te({}),be(0),Kt(),Wt.current=!0}),[Kt]),sr=(0,B.useCallback)((function(){Ge(!0),zt(Ge)}),[]),cr=(0,B.useCallback)(u()(o()().mark((function e(){var t,r,a,s,c;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge.length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,Ee(!0),t={},r=[],e.next=8,(0,h.VY)({mintPubkey:Ze.pid});case 8:a=e.sent,s=Ze.from,a.forEach((function(e){e.owner_pubkey===s&&r.push(e.nft_id)})),c=0,ge.forEach((function(e){var n=e.cid;r.includes(n)?t[n]="default":(t[n]="success",c+=1)})),be(c),Re(t),Ee(!1),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),Ee(!1),(0,v.Tv)(e.t0,n,"handleCheckOwnCountSend");case 22:case"end":return e.stop()}}),e,null,[[2,18]])}))),[n,Ze,ge]),ir=(0,B.useCallback)((function(e,t){var r=Math.min.apply(Math,a()(e.map((function(e){return e.profit}))));ht(r*t/100),Pt(r)}),[]),or=(0,B.useCallback)((function(e,t){var r,n=null===(r=qt.current)||void 0===r?void 0:r.getFieldsValue(),a=n.pidCreate,s=n.tipCreate;if(!a)return ht(0),void Pt(0);var c=e.filter((function(e){return e.ownerPubkey===(null==t?void 0:t.toString())}));c.sort((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue})),ir(c,s)}),[]),lr=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t,r){var n,a,s,c,i,l,u,d;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be(!0),s=null===(n=qt.current)||void 0===n?void 0:n.getFieldsValue(),c=s.pidCreate,i=s.tipCreate,e.next=4,t(c);case 4:l=e.sent,(u=l.filter((function(e){return e.ownerPubkey===(null==r?void 0:r.toString())}))).sort((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue})),d=[],u.forEach((function(e){var t=e.nftId,r=e.burnTimeLocalFormat;d.push({label:(0,ee.jsxs)("div",{className:"flex justify-between w-[300px]",children:[(0,ee.jsxs)("div",{children:["#",t]}),(0,ee.jsxs)("div",{children:["销毁时间：",r]})]}),value:t.toString(),time:r})})),ir(u,i),Be(!1),et(d),at(0),null===(a=qt.current)||void 0===a||a.setFieldValue("burnCreate",[]);case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[]),ur=(0,B.useCallback)(function(){var e=u()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.hasOwnProperty("pidCreate")&&lr(Ht,Ct),t.hasOwnProperty("tipCreate")&&or(Ot,Ct);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Ht,Ot,Ct]),dr=(0,B.useCallback)((function(){var e,t,r,n=Xe.map((function(e){return e.value})),a=null===(e=qt.current)||void 0===e?void 0:e.getFieldValue("burnCreate");n.length===a.length?null===(t=qt.current)||void 0===t||t.setFieldValue("burnCreate",[]):null===(r=qt.current)||void 0===r||r.setFieldValue("burnCreate",n)}),[Xe]),fr=(0,B.useCallback)((function(){var e=z()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(re,null,2),r="data:,".concat(t),n=document.createElement("a");n.href=r,n.download="log_".concat(e,".json"),n.click()}),[]);return(0,B.useEffect)((function(){Ge(!0),zt(Ge)}),[]),(0,B.useEffect)((function(){Ft.length&&It(Ft)}),[Ft]),(0,ee.jsx)(k._z,{className:"",ghost:!0,children:(0,ee.jsxs)("div",{className:"flex flex-wrap justify-center gap-5",children:[(0,ee.jsxs)(g.Z,{title:(0,ee.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"400px"},children:[(0,ee.jsx)("div",{children:"1. 操作步骤如下："}),(0,ee.jsxs)("div",{className:"ml-3",children:["连接钱包 ",(0,ee.jsx)(x.Z,{})," 创建交易 ",(0,ee.jsx)(x.Z,{})," ","发送交易"]}),(0,ee.jsxs)("div",{className:"ml-3",children:["创建交易： 选择项目 ",(0,ee.jsx)(x.Z,{})," 选择图片"," ",(0,ee.jsx)(x.Z,{})," 点击创建按钮 ",(0,ee.jsx)(x.Z,{})," ","保存交易文件"]}),(0,ee.jsxs)("div",{className:"ml-3",children:["发送交易：上传交易文件 ",(0,ee.jsx)(x.Z,{})," 等待倒计时结束"]}),(0,ee.jsx)("div",{className:"mt-3",children:"2. 注意事项："}),(0,ee.jsx)("div",{className:"ml-3",children:"a）交易文件的有效时间是一个小时，所以要在销毁前一个小时内提前生成；"}),(0,ee.jsx)("div",{className:"ml-3",children:"b）交易文件的生成过程中，需要用户重复进行多次签名，虽然繁琐，但很安全，无需用户导入私钥；"}),(0,ee.jsx)("div",{className:"ml-3",children:"c）每次切换账号前，都需要先断开账号的连接。"}),(0,ee.jsx)("div",{className:"mt-3",children:"3. 费用说明："}),(0,ee.jsx)("div",{className:"ml-3",children:"免费使用。"})]}),(0,ee.jsx)(g.Z,{title:(0,ee.jsx)("div",{className:" font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:(0,ee.jsxs)(y.A,{formRef:qt,onFinish:Jt,onValuesChange:ur,layout:"vertical",loading:Ie,initialValues:{burnCreate:[],sellCreate:!0,tipCreate:.1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],(0,ee.jsx)(Y.ZP,{onClick:dr,children:"全选"},"all"),(0,ee.jsx)(Y.ZP,{onClick:Dt,children:"复制"},"copy"),t[0],(0,ee.jsx)("div",{children:nt||""},"sign")]}},children:[(0,ee.jsx)(P.Z,{name:"pidCreate",label:(0,ee.jsxs)("div",{children:["项目",(0,ee.jsx)(b.Z,{spin:Ke,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:sr})]}),options:Tt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(ct),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,ee.jsxs)("div",{className:"flex items-center justify-between",children:[(0,ee.jsxs)("div",{className:"flex items-center",children:[(0,ee.jsx)(M.C,{className:"mr-2",size:"default",src:n}),(0,v.Mn)()?(0,ee.jsx)("div",{children:"".concat(r)}):(0,ee.jsx)("div",{children:"".concat(r," - ").concat((0,v.LH)(t))})]}),(0,ee.jsx)(T.k,{ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,ee.jsx)(_.Z.Group,{name:"burnCreate",label:(0,ee.jsxs)("div",{children:[(0,ee.jsx)("span",{children:"图片 "}),Xe.length?"(".concat(Xe.length,")"):"",(0,ee.jsx)(b.Z,{spin:qe,className:"ml-[5px]",style:{color:"#1677ff"}})]}),options:Xe,rules:[{required:!0,whitespace:!0,message:"".concat(ct),pattern:/.*/}]}),(0,ee.jsx)(w.Z,{name:"sellCreate",label:(0,ee.jsxs)("div",{children:["销毁并卖出",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"销毁获得代币后，是否立即卖出",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(ct),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0}}),(0,ee.jsx)(S.Z,{name:"tipCreate",label:Et,min:.1,max:50,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}}},rules:[{required:!0,whitespace:!0,message:"".concat(ct),pattern:/^.*$/}],help:(0,ee.jsx)("div",{className:"text-red-600 mb-5",children:At})})]})}),(0,ee.jsx)(g.Z,{title:(0,ee.jsx)("div",{className:" font-semibold text-lg hardline",children:"交易"}),style:{width:"400px"},children:(0,ee.jsxs)(y.A,{formRef:Bt,onFinish:Qt,onReset:ar,submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,ee.jsx)(Y.ZP,{loading:Ye,onClick:cr,children:"校对"},"check"),(0,ee.jsx)(Y.ZP,{onClick:fr,children:"日志"},"log"),t[0]]}},initialValues:{disorderSend:!0,auto:!0,repeatSend:10,intervalSend:1e3,leadTimeSend:0},children:[(0,ee.jsx)(C.Z,{label:"交易文件",name:"transactionInfo",action:"upload.do",fieldProps:{accept:".json",onChange:nr,beforeUpload:function(){return!1},listType:"picture",onPreview:function(e){return Ut.current.handleOpen(e)},fileList:d,maxCount:1},rules:[{required:!0,whitespace:!0,message:"".concat(ct),pattern:/.*/}]}),(0,ee.jsx)(N.Z,{label:(0,ee.jsxs)("div",{children:["整体重复发送次数",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(ct),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:10}}),(0,ee.jsx)(N.Z,{label:(0,ee.jsxs)("div",{children:["整体重复发送间隔(毫秒)",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复的间隔时间",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:300,rules:[{required:!0,message:"".concat(ct),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3}}),(0,ee.jsx)(N.Z,{label:(0,ee.jsxs)("div",{children:["提前发送时间(毫秒)",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:2e3,min:0,rules:[{required:!0,message:"".concat(ct),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0}}),(0,ee.jsx)(w.Z,{name:"auto",label:(0,ee.jsxs)("div",{children:["是否自动发送",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(ct),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0}}),(0,ee.jsx)(Z.Z,{name:"startTime",label:(0,ee.jsxs)("div",{children:["开始时间",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"销毁程序开始时间",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0}}),(0,ee.jsx)(Z.Z,{name:"endTime",label:(0,ee.jsxs)("div",{children:["结束时间",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"销毁程序结束时间",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0}}),(0,ee.jsx)(Z.Z,{name:"amountSend",label:(0,ee.jsx)("div",{children:"销毁所得代币总量"}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0}}),(0,ee.jsx)(y.A.Item,{label:(0,ee.jsxs)("div",{className:" font-semibold text-lg ",children:[(0,ee.jsx)("span",{className:"hardline",children:"倒计时 "}),Ze.pid?"(".concat(Ze.token_symbol," ").concat(Ze.pid.slice(0,4),"...").concat(Ze.pid.slice(-4),")"):""]}),children:(0,ee.jsx)("div",{className:"flex items-center gap-x-5",children:(0,ee.jsx)(p.Wo,{className:"text-2xl",value:we,onFinish:tr,onChange:er})})}),(0,ee.jsxs)(y.A.Item,{label:(0,ee.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,ee.jsx)("span",{children:"结果 "}),ge.length?"(".concat(ge.length,")"):""]}),children:[(0,ee.jsx)("div",{children:"成功：".concat(q,"，失败：").concat(se,"，处理中：").concat(le,"，待处理：").concat(pe)}),!!ge.length&&(0,ee.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys($t.current).map((function(e,t){return(0,ee.jsx)(A.Z,{color:$t.current[e].status,children:"#".concat(e)},t)}))})]}),(0,ee.jsxs)(y.A.Item,{label:(0,ee.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,ee.jsxs)("div",{children:[(0,ee.jsx)("span",{children:"校对 "}),ge.length?"(".concat(ge.length,")"):"",(0,ee.jsx)(E.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,ee.jsx)(j.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,ee.jsx)("div",{children:"拥有：".concat(xe)}),!!ge.length&&(0,ee.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(Oe).map((function(e,t){return(0,ee.jsx)(A.Z,{color:Oe[e],children:"#".concat(e)},t)}))})]})]})}),s,(0,ee.jsx)(W.VY,{ref:Ut})]})})}}}]);