"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[538],{43044:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(64599),a=n.n(r),s=n(15009),c=n.n(s),o=n(99289),l=n.n(o),i=n(5574),u=n.n(i),p=n(28104),d=n(64119),m=n(90930),f=n(38345),h=n(64350),x=n(2453),b=n(16568),k=n(25593),g=n(83622),y=n(2058),v=n(34041),w=n(67294),C=n(38592),P=n(51941),M=n(88026),A=n(54306),j=n(44718),T=n(70794),N=n(93233),K=n(70609),S=n(39578),B=n(27484),Z=n.n(B),V=n(85893),O=function(){var e=(0,M.useDispatch)(),t=x.ZP.useMessage(),n=u()(t,2),r=n[0],s=n[1],o=b.ZP.useNotification(),i=u()(o,2),B=i[0],O=i[1],R=(0,M.useSelector)((function(e){return e.wallet.dataSource})),W=(0,M.useSelector)((function(e){return e.wallet.wallet})),U=(0,M.useSelector)((function(e){return e.wallet.walletOptions})),D=(0,M.useSelector)((function(e){return e.wallet.chain})),L=(0,A.O)(),I=L.publicKey,H=L.signTransaction,E=(0,j.R)().connection,F=(0,w.useState)(!1),_=u()(F,2),z=_[0],Y=_[1],q=(0,w.useState)([]),G=u()(q,2),J=G[0],Q=G[1],X=(0,w.useRef)(),$=(0,w.useRef)(),ee=(0,w.useRef)(),te=(0,w.useRef)(),ne=(0,w.useRef)(),re=(0,M.useIntl)(),ae=re.formatMessage({id:"common.intlWalletAttention"}),se=re.formatMessage({id:"common.intlPleaseConnectWallet"}),ce=re.formatMessage({id:"common.intlTxSuccess"}),oe=re.formatMessage({id:"common.intlDelFromBackToFront"}),le=re.formatMessage({id:"common.intlBackupSuccess"}),ie=re.formatMessage({id:"common.intlRestoreSuccess"}),ue=re.formatMessage({id:"common.intlRestoreFail"}),pe=re.formatMessage({id:"common.intlSelectWallet"}),de=re.formatMessage({id:"common.intlDeleteAccountThenAddress"}),me=re.formatMessage({id:"common.intlSelectAddress"}),fe=re.formatMessage({id:"common.intlDeleteNonceFirst"}),he=re.formatMessage({id:"common.intlNoDeleteAccount"}),xe=re.formatMessage({id:"common.intlNoCreateAccount"}),be=re.formatMessage({id:"common.intlCreateAccountThenNonce"}),ke=re.formatMessage({id:"common.intlNoCreateNonceAccount"}),ge=re.formatMessage({id:"common.intlAddress"}),ye=re.formatMessage({id:"common.intlBalance"}),ve=re.formatMessage({id:"common.intlStatus"}),we=re.formatMessage({id:"common.intlCreated"}),Ce=re.formatMessage({id:"common.intlNotCreated"}),Pe=re.formatMessage({id:"common.intlAccount"}),Me=re.formatMessage({id:"common.intlNotes"}),Ae=re.formatMessage({id:"common.intlCreateWallet"}),je=re.formatMessage({id:"common.intlImportWallet"}),Te=re.formatMessage({id:"common.intlCreateAddress"}),Ne=re.formatMessage({id:"common.intlDeleteAddress"}),Ke=re.formatMessage({id:"common.intlCreateAccount"}),Se=re.formatMessage({id:"common.intlDeleteAccount"}),Be=re.formatMessage({id:"common.intlWalletRename"}),Ze=re.formatMessage({id:"common.intlBackupWallet"}),Ve=re.formatMessage({id:"common.intlCreateNonce"}),Oe=re.formatMessage({id:"common.intlDeleteNonce"}),Re=re.formatMessage({id:"common.intlRestoreWallet"}),We=re.formatMessage({id:"common.intlTransferSOL"}),Ue=re.formatMessage({id:"common.intlWallet"}),De=(0,w.useCallback)((function(){W?te.current.handleOpen():r.error(pe)}),[W]),Le=(0,w.useCallback)((function(){W?ne.current.handleOpen():r.error(pe)}),[W]),Ie=(0,w.useCallback)(function(){var t=l()(c()().mark((function t(n){var a,s,o,l,i,u,p,m,f;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=[],s=[],!n){t.next=17;break}return Y(!0),t.next=7,P.db.accounts.where("wallet").equals(n).sortBy("index");case 7:return s=t.sent,o=s.map((function(e){return new N.PublicKey(e.publicKey)})),l=s.map((function(e){return new N.PublicKey(e.nonce)})),t.next=12,E.getMultipleAccountsInfo(o);case 12:return i=t.sent,t.next=15,E.getMultipleAccountsInfo(l);case 15:for(u=t.sent,p=0;p<s.length;++p)m=i[p],f=u[p],a.push({key:p,wallet:n,hash:s[p].hash,publicKey:s[p].publicKey,secretKey:s[p].secretKey,notes:s[p].notes,nonce:s[p].nonce,created:!!m,nonceCreated:!!f,lamports:(0,T.Z)(m?m.lamports:0)});case 17:e(C.Nw.setAccounts(s)),e(C.Nw.setDataSource(a)),Y(!1),t.next=26;break;case 22:t.prev=22,t.t0=t.catch(0),Y(!1),(0,d.Tv)(t.t0,r,"handleUpdateAccounts");case 26:case"end":return t.stop()}}),t,null,[[0,22]])})));return function(e){return t.apply(this,arguments)}}(),[]),He=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,a,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W){e.next=3;break}return r.error(pe),e.abrupt("return");case 3:e.prev=3,t=J.toSorted().toReversed(),n=R.toReversed(),a=[],s=n.length-t.length,o=0;case 9:if(!(o<t.length)){e.next=18;break}if(t[o]===n[o].key){e.next=12;break}return e.abrupt("return",r.error("".concat(oe)));case 12:if(!n[o].created){e.next=14;break}return e.abrupt("return",r.error(de));case 14:a.push(n[o].hash);case 15:++o,e.next=9;break;case 18:return e.next=20,P.db.accounts.bulkDelete(a);case 20:return e.next=22,P.db.wallets.update(W,{count:s});case 22:Ie(W),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(3),(0,d.Tv)(e.t0,r,"handleDeleteAddress");case 28:case"end":return e.stop()}}),e,null,[[3,25]])}))),[W,J,R]),Ee=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,s,o,l,i,u,p,m,f,h,x,b,k,g,y,v,w,C,P,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&H){e.next=2;break}return e.abrupt("return",r.error(se));case 2:if(J.length){e.next=4;break}return e.abrupt("return",r.error(me));case 4:e.prev=4,t=I,n=[],s=[],o=a()(J),e.prev=9,o.s();case 11:if((l=o.n()).done){e.next=27;break}if(i=l.value,u=R[i].publicKey,p=R[i].created,m=R[i].nonceCreated,f=BigInt(R[i].lamports.toString()),h=R[i].secretKey,x=S.Z.decode(h),b=N.Keypair.fromSecretKey(x),!p){e.next=25;break}if(!m){e.next=23;break}return e.abrupt("return",r.error(fe));case 23:n.push(N.SystemProgram.transfer({fromPubkey:new N.PublicKey(u),toPubkey:t,lamports:f})),s.push(b);case 25:e.next=11;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(9),o.e(e.t0);case 32:return e.prev=32,o.f(),e.finish(32);case 35:if(n.length){e.next=37;break}return e.abrupt("return",r.info(he));case 37:return e.next=39,E.getLatestBlockhash();case 39:return k=e.sent,g=k.blockhash,y=k.lastValidBlockHeight,v=new N.TransactionMessage({payerKey:t,recentBlockhash:g,instructions:n}).compileToLegacyMessage(),w=new N.VersionedTransaction(v),e.next=46,H(w);case 46:return(C=e.sent).sign(s),e.next=50,E.sendTransaction(C);case 50:return P=e.sent,e.next=53,E.confirmTransaction({signature:P,blockhash:g,lastValidBlockHeight:y},"confirmed");case 53:(M=e.sent).value.err?(console.log(M.value.err),r.error("".concat(M.value.err))):(B.success({message:ce,description:(0,V.jsx)(K.VU,{type:"tx",content:P,chain:D}),placement:"top",showProgress:!0}),Ie(W)),e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),(0,d.Tv)(e.t1,r,"handleCreateAccount");case 60:case"end":return e.stop()}}),e,null,[[4,57],[9,29,32,35]])}))),[J,I,H,R,E,D,W]),Fe=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,a,s,o,l,i,u,p,m;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&H){e.next=2;break}return e.abrupt("return",r.error(se));case 2:if(J.length){e.next=4;break}return e.abrupt("return",r.error(me));case 4:if(e.prev=4,t=I,n=[],J.forEach((function(e){var r=R[e].publicKey;R[e].created||n.push(N.SystemProgram.transfer({fromPubkey:t,toPubkey:new N.PublicKey(r),lamports:890880}))})),n.length){e.next=10;break}return e.abrupt("return",r.info(xe));case 10:return e.next=12,E.getLatestBlockhash();case 12:return a=e.sent,s=a.blockhash,o=a.lastValidBlockHeight,l=new N.TransactionMessage({payerKey:t,recentBlockhash:s,instructions:n}).compileToLegacyMessage(),i=new N.VersionedTransaction(l),e.next=19,H(i);case 19:return u=e.sent,e.next=22,E.sendTransaction(u);case 22:return p=e.sent,e.next=25,E.confirmTransaction({signature:p,blockhash:s,lastValidBlockHeight:o},"confirmed");case 25:(m=e.sent).value.err?(console.log(m.value.err),r.error("".concat(m.value.err))):(B.success({message:ce,description:(0,V.jsx)(K.VU,{type:"tx",content:p,chain:D}),placement:"top",showProgress:!0}),Ie(W)),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(4),(0,d.Tv)(e.t0,r,"handleCreateAccount");case 32:case"end":return e.stop()}}),e,null,[[4,29]])}))),[J,I,H,R,E,D,W]),_e=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,s,o,l,i,u,p,m,f,h,x,b,k,g,y,v,w,C,P,M,A;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&H){e.next=2;break}return e.abrupt("return",r.error(se));case 2:if(J.length){e.next=4;break}return e.abrupt("return",r.error(me));case 4:return e.prev=4,t=I,n=[],e.next=9,E.getMinimumBalanceForRentExemption(N.NONCE_ACCOUNT_LENGTH);case 9:s=e.sent,o=[],l=a()(J),e.prev=12,l.s();case 14:if((i=l.n()).done){e.next=28;break}if(u=i.value,p=R[u].publicKey,m=R[u].created,f=R[u].nonceCreated,h=R[u].nonce,x=R[u].secretKey,b=S.Z.decode(x),k=N.Keypair.fromSecretKey(b),m){e.next=25;break}return e.abrupt("return",r.error(be));case 25:f||("#####NonceAccount#####",o.push(k),n.push(N.SystemProgram.createAccountWithSeed({fromPubkey:t,newAccountPubkey:new N.PublicKey(h),basePubkey:new N.PublicKey(p),seed:"#####NonceAccount#####",lamports:s,space:N.NONCE_ACCOUNT_LENGTH,programId:N.SystemProgram.programId})),n.push(N.SystemProgram.nonceInitialize({noncePubkey:new N.PublicKey(h),authorizedPubkey:new N.PublicKey(p)})));case 26:e.next=14;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(12),l.e(e.t0);case 33:return e.prev=33,l.f(),e.finish(33);case 36:if(n.length){e.next=38;break}return e.abrupt("return",r.info(ke));case 38:return e.next=40,E.getLatestBlockhash();case 40:return g=e.sent,y=g.blockhash,v=g.lastValidBlockHeight,w=new N.TransactionMessage({payerKey:t,recentBlockhash:y,instructions:n}).compileToLegacyMessage(),C=new N.VersionedTransaction(w),e.next=47,H(C);case 47:return(P=e.sent).sign(o),e.next=51,E.sendTransaction(P);case 51:return M=e.sent,e.next=54,E.confirmTransaction({signature:M,blockhash:y,lastValidBlockHeight:v},"confirmed");case 54:(A=e.sent).value.err?(console.log(A.value.err),r.error("".concat(A.value.err))):(B.success({message:ce,description:(0,V.jsx)(K.VU,{type:"tx",content:M,chain:D}),placement:"top",showProgress:!0}),Ie(W)),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(4),(0,d.Tv)(e.t1,r,"handleCreateNonce");case 61:case"end":return e.stop()}}),e,null,[[4,58],[12,30,33,36]])}))),[J,I,H,R,E,D,W]),ze=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,s,o,l,i,u,p,m,f,h,x,b,k,g,y,v,w,C,P,M,A,j;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&H){e.next=2;break}return e.abrupt("return",r.error(se));case 2:if(J.length){e.next=4;break}return e.abrupt("return",r.error(me));case 4:return e.prev=4,t=I,n=[],s=[],o=J.filter((function(e){return R[e].created&&R[e].nonceCreated})),l=o.map((function(e){return new N.PublicKey(R[e].nonce)})),e.next=12,E.getMultipleParsedAccounts(l);case 12:i=e.sent,u=a()(o);try{for(u.s();!(p=u.n()).done;)m=p.value,f=R[m].publicKey,h=R[m].nonce,x=R[m].secretKey,b=S.Z.decode(x),k=N.Keypair.fromSecretKey(b),g=i.value[m].lamports,s.push(k),n.push(N.SystemProgram.nonceWithdraw({noncePubkey:new N.PublicKey(h),authorizedPubkey:new N.PublicKey(f),toPubkey:t,lamports:g}))}catch(e){u.e(e)}finally{u.f()}if(n.length){e.next=17;break}return e.abrupt("return",r.info(ke));case 17:return e.next=19,E.getLatestBlockhash();case 19:return y=e.sent,v=y.blockhash,w=y.lastValidBlockHeight,C=new N.TransactionMessage({payerKey:t,recentBlockhash:v,instructions:n}).compileToLegacyMessage(),P=new N.VersionedTransaction(C),e.next=26,H(P);case 26:return(M=e.sent).sign(s),e.next=30,E.sendTransaction(M);case 30:return A=e.sent,e.next=33,E.confirmTransaction({signature:A,blockhash:v,lastValidBlockHeight:w},"confirmed");case 33:(j=e.sent).value.err?(console.log(j.value.err),r.error("".concat(j.value.err))):(B.success({message:ce,description:(0,V.jsx)(K.VU,{type:"tx",content:A,chain:D}),placement:"top",showProgress:!0}),Ie(W)),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(4),(0,d.Tv)(e.t0,r,"handleDeleteNonce");case 40:case"end":return e.stop()}}),e,null,[[4,37]])}))),[J,I,H,R,E,D,W]),Ye=(0,w.useCallback)(function(){var t=l()(c()().mark((function t(n){var s,o,l,i,u;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=[],t.next=4,P.db.wallets.where("chain").equals(n.network).toArray();case 4:o=t.sent,l=a()(o);try{for(l.s();!(i=l.n()).done;)u=i.value,s.push({label:u.name,value:u.hash})}catch(e){l.e(e)}finally{l.f()}s.sort((function(e,t){return e.label.localeCompare(t.label)})),e(C.Nw.setWallets(o)),e(C.Nw.setWalletOptions(s)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),(0,d.Tv)(t.t0,r,"handleUpdateWallets");case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),[]),qe=(0,w.useCallback)((function(t){Q([]),e(C.Nw.setWallet(t))}),[]),Ge=(0,w.useCallback)(function(){var e=l()(c()().mark((function e(t,n){var a,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=n.hash,s=n.wallet,e.next=4,P.db.accounts.update(a,{notes:t});case 4:Ie(s),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),(0,d.Tv)(e.t0,r,"handleNotes");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),[]),Je=(0,w.useCallback)(l()(c()().mark((function e(){var t,n,a,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.db.wallets.toArray();case 3:return t=e.sent,e.next=6,P.db.accounts.toArray();case 6:n=e.sent,a={wallets:t,accounts:n},s="data:,".concat(JSON.stringify(a,null,2)),(o=document.createElement("a")).href=s,o.download="wallets_".concat(Z()().format("YYYY-MM-DD_HH-mm"),".json"),o.click(),r.success(le),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),(0,d.Tv)(e.t0,r,"handleBackup");case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),[]),Qe=(0,w.useCallback)(function(){var e=l()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new FileReader).readAsText(t.fileList[0].originFileObj),n.onload=l()(c()().mark((function e(){var t,a,s,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=n.result,!(a=JSON.parse(t))){e.next=22;break}if(!a.wallets.length){e.next=11;break}return e.next=7,P.db.wallets.toArray();case 7:return s=e.sent,a.wallets.forEach((function(e){var t=s.find((function(t){return t.hash===e.hash}));t?t.count<e.count&&(t.count=e.count):s.push(e)})),e.next=11,P.db.wallets.bulkPut(s);case 11:if(!a.accounts.length){e.next=18;break}return e.next=14,P.db.accounts.toArray();case 14:return o=e.sent,a.accounts.forEach((function(e){o.find((function(t){return t.hash===e.hash}))||o.push(e)})),e.next=18,P.db.accounts.bulkPut(o);case 18:Ie(W),r.success(ie),e.next=23;break;case 22:r.error(ue);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),(0,d.Tv)(e.t0,r,"handleRestore");case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[W]),Xe=(0,w.useCallback)((function(){if(W)return J.length?void X.current.handleOpen(J):r.error(me);r.error(pe)}),[W,J]),$e=(0,w.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,V.jsx)("span",{children:n+1})}},{title:"".concat(ge),dataIndex:"publicKey",key:"publicKey",render:function(e,t){return(0,V.jsx)(K.VU,{content:t.publicKey,ellipsis:!0,chain:D,copyable:{tooltips:!1}})}},{title:"".concat(ye),dataIndex:"lamports",key:"lamports",render:function(e,t){return(0,V.jsx)("span",{children:t.lamports.dividedBy(1e9).toString()+" SOL"})}},{title:"".concat(ve),dataIndex:"created",key:"created",render:function(e,t){return(0,V.jsx)("span",{children:t.created?we:Ce})}},{title:"Nonce".concat(Pe),dataIndex:"nonceCreated",key:"nonceCreated",render:function(e,t){return(0,V.jsx)("span",{children:t.nonceCreated?(0,V.jsx)(K.VU,{content:t.nonce,ellipsis:!0,chain:D,copyable:{tooltips:!1}}):Ce})}},{title:"".concat(Me),dataIndex:"notes",key:"notes",render:function(e,t){return(0,V.jsx)(k.Z.Paragraph,{editable:{onChange:function(e){return Ge(e,t)}},children:t.notes})}}]}),[D]);return(0,w.useEffect)((function(){Ye(D),Ie(W)}),[W,D]),(0,V.jsxs)(m._z,{className:"wallet",ghost:!0,children:[(0,V.jsx)(f.Z,{className:"",title:(0,V.jsx)("div",{className:"text-red-600",children:ae}),children:(0,V.jsxs)("div",{className:"grid gap-2",children:[(0,V.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,V.jsx)(g.ZP,{type:"primary",onClick:function(){return $.current.handleOpen()},children:Ae}),(0,V.jsx)(g.ZP,{type:"primary",onClick:De,children:Te}),(0,V.jsx)(g.ZP,{type:"primary",onClick:Fe,children:Ke}),(0,V.jsx)(g.ZP,{type:"primary",onClick:_e,children:Ve}),(0,V.jsx)(g.ZP,{type:"primary",onClick:Je,children:Ze}),(0,V.jsx)(g.ZP,{type:"primary",onClick:function(){return ee.current.handleOpen()},children:je}),(0,V.jsx)(g.ZP,{type:"primary",onClick:Le,children:Be})]}),(0,V.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,V.jsx)(g.ZP,{type:"primary",children:"删除钱包"}),(0,V.jsx)(g.ZP,{type:"primary",onClick:He,children:Ne}),(0,V.jsx)(g.ZP,{type:"primary",onClick:Ee,children:Se}),(0,V.jsx)(g.ZP,{type:"primary",onClick:ze,children:Oe}),(0,V.jsx)(y.Z,{accept:".json",maxCount:1,showUploadList:!1,onChange:Qe,beforeUpload:function(){return!1},children:(0,V.jsx)(g.ZP,{type:"primary",children:Re})},"restore")]}),(0,V.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,V.jsx)(g.ZP,{type:"primary",onClick:Xe,children:We})}),(0,V.jsxs)("div",{className:"my-2",children:[W?"".concat(Ue,"-").concat(W.slice(0,3),"："):"".concat(Ue,"："),(0,V.jsx)(v.Z,{style:{width:"200px",height:"32px"},showSearch:!0,placeholder:pe,optionFilterProp:"label",onChange:qe,value:W,options:U})]})]})}),(0,V.jsx)(h.Z,{scroll:{x:!0},size:"small",columns:$e,dataSource:R,defaultData:[],loading:{spinning:z,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,rowSelection:{type:"checkbox",selectedRowKeys:J,onChange:function(e){Q(e)}}}),(0,V.jsx)(p.LV,{ref:$,messageApi:r,handleUpdateWallets:Ye}),(0,V.jsx)(p.Tc,{ref:X,messageApi:r,handleUpdateAccounts:Ie,notificationApi:B}),(0,V.jsx)(p.rf,{ref:ee,messageApi:r,handleUpdateWallets:Ye}),(0,V.jsx)(p.vA,{ref:te,messageApi:r,handleUpdateAccounts:Ie}),(0,V.jsx)(p.fd,{ref:ne,messageApi:r,handleUpdateWallets:Ye}),s,O]})}}}]);