"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[262],{62741:function(e,t,n){n.d(t,{l:function(){return S}});var r=n(15009),a=n.n(r),s=n(64599),c=n.n(s),o=n(99289),u=n.n(o),i=n(5574),l=n.n(i),d=n(64119),p=n(13451),f=n(5966),m=n(44718),h=n(54306),b=n(29363),k=n(88026),x=n(2453),g=n(67294),y=n(49717),P=n(71874),v=n(85893),A=g.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,s=x.ZP.useMessage(),o=l()(s,2),i=o[0],A=o[1],S=(0,m.R)().connection,C=(0,h.O)(),N=C.publicKey,w=C.signAllTransactions,I=C.wallet,M=(0,y.A)(),T=M.chain,j=M.modalFeeRef,R=(0,k.useIntl)(),B=R.formatMessage({id:"common.intlInputException"}),H=R.formatMessage({id:"common.intlPleaseConnectWallet"}),V=R.formatMessage({id:"common.intlCreateAccount"}),O=R.formatMessage({id:"common.intlQuantity"}),W=(0,g.useRef)(),Z=(0,g.useState)(!1),K=l()(Z,2),z=K[0],E=K[1],F=(0,g.useCallback)((function(){E(!0)}),[]);(0,g.useImperativeHandle)(t,(function(){return{handleOpen:F}}));var U=(0,g.useCallback)(function(){var e=u()(a()().mark((function e(t){var s,o,u,l,p,f,m,h,k,x,g,y,v,A,C,M,R,B,V,O,W,Z,K,z,F,U,D,L;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N&&w&&I){e.next=3;break}return i.error(H),e.abrupt("return",!0);case 3:return s=N,e.prev=4,o=Number(t.count),e.next=8,S.getMinimumBalanceForRentExemption(b.NONCE_ACCOUNT_LENGTH);case 8:return u=e.sent,l="#####NonceCountAccount#####",e.next=12,b.PublicKey.createWithSeed(s,l,b.SystemProgram.programId);case 12:return p=e.sent,e.next=15,S.getAccountInfo(p);case 15:f=e.sent,m=[],h=[],x=(k=1)+o,f?(k=(0,P.sT)(f.lamports)+1,x=k+o):(x=(k=1)+o,0,890880,(g=[]).push(b.SystemProgram.createAccountWithSeed({fromPubkey:s,newAccountPubkey:p,basePubkey:s,seed:l,lamports:890880,space:0,programId:b.SystemProgram.programId})),h.push(g)),y=0,v=4,A=k;case 24:if(!(A<x)){e.next=36;break}return C="#####NonceAccount".concat(A,"#####"),e.next=28,b.PublicKey.createWithSeed(s,C,b.SystemProgram.programId);case 28:M=e.sent,m.push(b.SystemProgram.createAccountWithSeed({fromPubkey:s,newAccountPubkey:M,basePubkey:s,seed:C,lamports:u,space:b.NONCE_ACCOUNT_LENGTH,programId:b.SystemProgram.programId})),m.push(b.SystemProgram.nonceInitialize({noncePubkey:M,authorizedPubkey:s})),(y+=1)%v!=0&&y+k!==x||(B=0===(R=y%v)?v:R,m.push(b.SystemProgram.transfer({fromPubkey:s,toPubkey:p,lamports:B})),h.push(m),m=[]);case 33:++A,e.next=24;break;case 36:if(!h.length){e.next=72;break}return e.next=39,S.getLatestBlockhash();case 39:return V=e.sent,O=V.blockhash,W=V.lastValidBlockHeight,e.next=44,(0,P.Gw)(S,I,O,h,w,j);case 44:Z=e.sent,K=Z.transactions,z=Z.feeMode,F=c()(K),e.prev=48,F.s();case 50:if((U=F.n()).done){e.next=62;break}return D=U.value,e.next=54,(0,P.pR)(S,I,D,z);case 54:return L=e.sent,e.next=57,(0,P.fS)(T,S,{signature:L,blockhash:O,lastValidBlockHeight:W},"confirmed",n,i);case 57:if(e.sent){e.next=60;break}return e.abrupt("break",62);case 60:e.next=50;break;case 62:e.next=67;break;case 64:e.prev=64,e.t0=e.catch(48),F.e(e.t0);case 67:return e.prev=67,F.f(),e.finish(67);case 70:r(s,S),E(!1);case 72:return e.abrupt("return",!0);case 75:return e.prev=75,e.t1=e.catch(4),r(s,S),(0,d.Tv)(e.t1,i,"handleFinish"),e.abrupt("return",!0);case 80:case"end":return e.stop()}}),e,null,[[4,75],[48,64,67,70]])})));return function(t){return e.apply(this,arguments)}}(),[N,S,T,n,I,j]);return(0,v.jsxs)(p.Y,{formRef:W,title:V,open:z,onFinish:U,onOpenChange:function(e){E(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,v.jsx)(f.Z,{name:"count",label:O,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(B),pattern:/^[1-9]\d*$/}]}),A]})})),S=(0,g.memo)(A)},96358:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var r=n(64599),a=n.n(r),s=n(15009),c=n.n(s),o=n(99289),u=n.n(o),i=n(5574),l=n.n(i),d=n(39380),p=n(64435),f=n(88026),m=n(67294),h=n(94036),b=n(2453),k=n(16568),x=n(78957),g=n(83622),y=n(54306),P=n(44718),v=n(29363),A=n(39678),S=n(62741),C=n(64119),N=n(9437),w=n(71874),I=n(85893),M=function(){var e=(0,f.useDispatch)(),t=(0,m.useState)(!1),n=l()(t,2),r=n[0],s=n[1],o=b.ZP.useMessage(),i=l()(o,2),M=i[0],T=i[1],j=k.ZP.useNotification(),R=l()(j,2),B=R[0],H=R[1],V=(0,f.useSelector)((function(e){return e.nonce.dataSource})),O=(0,f.useSelector)((function(e){return e.nonce.totalCountCreate})),W=(0,f.useSelector)((function(e){return e.nonce.totalCountRecord})),Z=(0,f.useSelector)((function(e){return e.nonce.nonceCountAccount})),K=(0,N.Ab)(),z=K.chain,E=K.modalFeeRef,F=(0,m.useState)([]),U=l()(F,2),D=U[0],L=U[1],G=(0,y.O)(),_=G.publicKey,q=G.signTransaction,Q=G.signAllTransactions,Y=G.wallet,$=(0,P.R)().connection,J=(0,m.useRef)(),X=(0,f.useIntl)(),ee=X.formatMessage({id:"common.intlPleaseConnectWallet"}),te=X.formatMessage({id:"common.intlAuthorityAddress"}),ne=X.formatMessage({id:"common.intlNonceAddress"}),re=X.formatMessage({id:"common.intlBlockHash"}),ae=X.formatMessage({id:"common.intlDelFromBackToFront"}),se=X.formatMessage({id:"common.intlCreateAccount"}),ce=X.formatMessage({id:"common.intlBatchDelete"}),oe=X.formatMessage({id:"common.intlUpdateNonce"}),ue=X.formatMessage({id:"common.intlStatus"}),ie=X.formatMessage({id:"common.intlVerifyNonce"}),le=X.formatMessage({id:"common.intlVerifyComplete"}),de=X.formatMessage({id:"common.intlPleaseVerify"}),pe=(0,m.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,I.jsx)("span",{children:n+1})}},{title:"".concat(ne),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,I.jsx)(A.k,{ellipsis:!0,copyable:!0,addressPrefix:"",address:t.nonceAccount.toString()})}},{title:"".concat(te),dataIndex:"authority",key:"authority",render:function(e,t){return(0,I.jsx)(A.k,{ellipsis:!0,copyable:!0,addressPrefix:"",address:t.authority.toString()})}},{title:"".concat(ue),dataIndex:"status",key:"status",render:function(e,t){return(0,I.jsx)("span",{children:t.status})}},{title:"".concat(re),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,I.jsx)(A.k,{copyable:!0,addressPrefix:"",address:t.blockhash})}}]}),[]),fe=(0,m.useCallback)(function(){var e=u()(c()().mark((function e(t,n){var r,a,s,o,u,i,l,d,p,f,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=1e3,s=100,o=0;case 4:if(!(o<a/s)){e.next=36;break}u=!1,i=[],l=0;case 8:if(!(l<s)){e.next=18;break}return d="#####NonceAccount".concat(o*s+l+1,"#####"),e.next=13,v.PublicKey.createWithSeed(t,d,v.SystemProgram.programId);case 13:p=e.sent,i.push(p);case 15:++l,e.next=8;break;case 18:return e.next=20,n.getMultipleParsedAccounts(i);case 20:f=e.sent,m=0;case 22:if(!(m<f.value.length)){e.next=31;break}if(h=f.value[m]){e.next=27;break}return u=!0,e.abrupt("break",31);case 27:r.push({key:m+o*s,nonceAccount:i[m],authority:new v.PublicKey(h.data.parsed.info.authority),blockhash:h.data.parsed.info.blockhash,status:h.data.parsed.type});case 28:++m,e.next=22;break;case 31:if(!u){e.next=33;break}return e.abrupt("break",36);case 33:++o,e.next=4;break;case 36:return e.abrupt("return",r);case 37:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),me=(0,m.useCallback)(function(){var t=u()(c()().mark((function t(n,r){var a,o,u,i,l;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s(!0),"#####NonceCountAccount#####",t.next=5,v.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",v.SystemProgram.programId);case 5:return a=t.sent,t.next=8,r.getAccountInfo(a);case 8:if(o=t.sent,u=[],i=0,l=0,!o){t.next=19;break}return i=(0,w.sT)(o.lamports),t.next=16,fe(n,r);case 16:u=t.sent,(l=u.length)!==i&&M.error(de);case 19:s(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCountRecord(i)),e(h.N.setTotalCountCreate(l)),e(h.N.setNonceCountAccount(a)),t.next=30;break;case 26:t.prev=26,t.t0=t.catch(0),s(!1),(0,C.Tv)(t.t0,M,"handleUpdateNonceAccount");case 30:case"end":return t.stop()}}),t,null,[[0,26]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),he=(0,m.useCallback)(u()(c()().mark((function e(){var t,n,r,o,u,i,l,d,p,f,m,h,b,k,x,g,y,P,A,S,N,I,T,j,R,H,O,W,K,F;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&Q&&Y){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:if(D.length){e.next=5;break}return e.abrupt("return");case 5:return t=_,e.prev=6,n=D.toSorted((function(e,t){return Number(t)-Number(e)})),r=V.toReversed(),o=[],u="#####NonceCountAccount#####",e.next=13,$.getAccountInfo(Z);case 13:if(!(i=e.sent)){e.next=20;break}if(l=(0,w.sT)(i.lamports),V.length===l){e.next=20;break}return M.error(de),e.abrupt("return");case 20:d=0;case 21:if(!(d<n.length)){e.next=28;break}if(n[d]===r[d].key){e.next=24;break}return e.abrupt("return",M.error("".concat(ae)));case 24:o.push(r[d].nonceAccount);case 25:++d,e.next=21;break;case 28:p=100,f=0,m=[],h=[];case 32:return b=o.splice(0,p),e.next=35,$.getMultipleParsedAccounts(b);case 35:for(k=e.sent,x=0;x<k.value.length;++x)g=k.value[x].lamports,y=f*p+x,m.push(v.SystemProgram.nonceWithdraw({noncePubkey:r[y].nonceAccount,authorizedPubkey:r[y].authority,toPubkey:r[y].authority,lamports:g}));f+=1;case 38:if(o.length){e.next=32;break}case 39:for(r.length===n.length?(P=i.lamports,m.push(v.SystemProgram.transfer({fromPubkey:Z,basePubkey:t,toPubkey:t,lamports:P,seed:u,programId:v.SystemProgram.programId}))):m.push(v.SystemProgram.transfer({fromPubkey:Z,basePubkey:t,toPubkey:t,lamports:n.length,seed:u,programId:v.SystemProgram.programId})),14,A=Math.ceil(m.length/14),S=0;S<A;++S)h.push(m.splice(0,14));if(!h.length){e.next=79;break}return e.next=46,$.getLatestBlockhash();case 46:return N=e.sent,I=N.blockhash,T=N.lastValidBlockHeight,e.next=51,(0,w.Gw)($,Y,I,h,Q,E);case 51:j=e.sent,R=j.transactions,H=j.feeMode,O=a()(R),e.prev=55,O.s();case 57:if((W=O.n()).done){e.next=69;break}return K=W.value,e.next=61,(0,w.pR)($,Y,K,H);case 61:return F=e.sent,e.next=64,(0,w.fS)(z,$,{signature:F,blockhash:I,lastValidBlockHeight:T},"confirmed",B,M);case 64:if(e.sent){e.next=67;break}return e.abrupt("break",69);case 67:e.next=57;break;case 69:e.next=74;break;case 71:e.prev=71,e.t0=e.catch(55),O.e(e.t0);case 74:return e.prev=74,O.f(),e.finish(74);case 77:return e.next=79,me(t,$);case 79:e.next=87;break;case 81:return e.prev=81,e.t1=e.catch(6),s(!1),e.next=86,me(t,$);case 86:(0,C.Tv)(e.t1,M,"handleBatchDelete");case 87:case"end":return e.stop()}}),e,null,[[6,81],[55,71,74,77]])}))),[D,_,Q,V,Z,$,z,Y,E]),be=(0,m.useCallback)(u()(c()().mark((function e(){var t,n,r,a,s,o,u,i,l,d,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&Q&&Y){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:if(D.length){e.next=5;break}return e.abrupt("return");case 5:for(t=_,e.prev=6,20,n=[],r=[],D.forEach((function(e){var t=V[e].nonceAccount,r=V[e].authority;n.push(v.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),a=Math.ceil(n.length/20),s=0;s<a;++s)r.push(n.splice(0,20));if(!r.length){e.next=26;break}return e.next=16,$.getLatestBlockhash();case 16:return o=e.sent,u=o.blockhash,i=o.lastValidBlockHeight,e.next=21,(0,w.Gw)($,Y,u,r,Q,E);case 21:return l=e.sent,d=l.transactions,p=l.feeMode,e.next=26,(0,w.fv)({chain:z,connection:$,wallet:Y,transactions:d,blockhash:u,lastValidBlockHeight:i,notificationApi:B,feeMode:p});case 26:return e.next=28,me(t,$);case 28:e.next=35;break;case 30:return e.prev=30,e.t0=e.catch(6),e.next=34,me(t,$);case 34:(0,C.Tv)(e.t0,M,"handleUpdateNonce");case 35:case"end":return e.stop()}}),e,null,[[6,30]])}))),[D,_,Q,V,$,z,Y]),ke=(0,m.useCallback)(u()(c()().mark((function e(){var t,n,r,a,o,u,i,l,d,p,f,m,h,b,k,x,g;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&q&&Y){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:return t=_,e.prev=4,s(!0),n="#####NonceCountAccount#####",e.next=9,v.PublicKey.createWithSeed(t,n,v.SystemProgram.programId);case 9:return r=e.sent,e.next=12,$.getAccountInfo(r);case 12:if(a=e.sent,o=[],!a){e.next=41;break}return e.next=17,fe(t,$);case 17:if(u=e.sent,i=(0,w.sT)(a.lamports),l=u.length,i!==l){e.next=24;break}M.success(le),e.next=41;break;case 24:return i>l?(d=i-l,o.push(v.SystemProgram.transfer({fromPubkey:r,basePubkey:t,toPubkey:t,lamports:d,seed:n,programId:v.SystemProgram.programId}))):(p=l-i,o.push(v.SystemProgram.transfer({fromPubkey:t,toPubkey:r,lamports:p}))),e.next=27,$.getLatestBlockhash();case 27:return f=e.sent,m=f.blockhash,h=f.lastValidBlockHeight,e.next=32,(0,w.fC)($,Y,m,o,q,E);case 32:return b=e.sent,k=b.transaction,x=b.feeMode,e.next=37,(0,w.pR)($,Y,k,x);case 37:return g=e.sent,e.next=40,(0,w.fS)(z,$,{signature:g,blockhash:m,lastValidBlockHeight:h},"confirmed",B,M);case 40:me(t,$);case 41:s(!1),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(4),s(!1),me(t,$),(0,C.Tv)(e.t0,M,"handleUpdateNonceAccount");case 49:case"end":return e.stop()}}),e,null,[[4,44]])}))),[_,q,V,$,z,Y]);return(0,m.useEffect)((function(){_&&$&&me(_,$)}),[_,$]),(0,I.jsxs)(d._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,I.jsx)(p.Z,{scroll:{x:!0},size:"small",columns:pe,dataSource:V,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,I.jsxs)("div",{children:[(0,I.jsxs)(x.Z,{wrap:!0,className:"mb-[16px]",children:[(0,I.jsx)(g.ZP,{type:"primary",onClick:function(){return J.current.handleOpen()},children:se}),(0,I.jsx)(g.ZP,{type:"primary",onClick:function(){return he()},children:ce}),(0,I.jsx)(g.ZP,{type:"primary",onClick:function(){return be()},children:oe}),(0,I.jsx)(g.ZP,{type:"primary",onClick:function(){return ke()},children:ie}),(0,I.jsx)("div",{children:O})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(A.k,{copyable:!0,addressPrefix:"",address:Z.toString()}),"：",W]})]}),rowSelection:{type:"checkbox",selectedRowKeys:D,onChange:function(e){L(e)}}}),(0,I.jsx)(S.l,{ref:J,notificationApi:B,handleUpdateNonceAccount:me}),T,H]})}}}]);