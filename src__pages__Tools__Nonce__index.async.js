"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[262],{62741:function(e,t,n){n.d(t,{l:function(){return P}});var r=n(15009),a=n.n(r),o=n(99289),c=n.n(o),s=n(5574),u=n.n(s),i=n(64119),l=n(37476),m=n(5966),d=n(44718),h=n(54306),p=n(93233),f=n(88026),g=n(2453),k=n(67294),y=n(70609),b=n(85893),x=k.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,o=g.ZP.useMessage(),s=u()(o,2),x=s[0],P=s[1],v=(0,d.R)().connection,S=(0,h.O)(),A=S.publicKey,w=S.signTransaction,C=(0,f.useSelector)((function(e){return e.wallet.chain})),M=(0,f.useIntl)(),T=M.formatMessage({id:"common.intlInputException"}),N=M.formatMessage({id:"common.intlTxSuccess"}),I=M.formatMessage({id:"common.intlPleaseConnectWallet"}),j=M.formatMessage({id:"common.intlCreateAccount"}),B=M.formatMessage({id:"common.intlQuantity"}),V=(0,k.useRef)(),K=(0,k.useState)(!1),R=u()(K,2),H=R[0],O=R[1],E=(0,k.useCallback)((function(){O(!0)}),[]);(0,k.useImperativeHandle)(t,(function(){return{handleOpen:E}}));var U=(0,k.useCallback)(function(){var e=c()(a()().mark((function e(t){var o,c,s,u,l,m,d,h,f,g,k,P,S,M,T,j,B,V,K,R;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A&&w){e.next=2;break}return e.abrupt("return",x.error(I));case 2:return e.prev=2,o=A,c=Number(t.count),e.next=7,v.getMinimumBalanceForRentExemption(p.NONCE_ACCOUNT_LENGTH);case 7:return s=e.sent,u="#####NonceCountAccount#####",e.next=11,p.PublicKey.createWithSeed(o,u,p.SystemProgram.programId);case 11:return l=e.sent,e.next=14,v.getAccountInfo(l);case 14:m=e.sent,d=[],f=(h=1)+c,m?(h=Math.floor(m.lamports/1e6)+1,f=h+c,d.push(p.SystemProgram.transfer({fromPubkey:o,toPubkey:l,lamports:1e6*c}))):(f=(h=1)+c,d.push(p.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:l,basePubkey:o,seed:u,lamports:1e6*c,space:0,programId:p.SystemProgram.programId}))),g=h;case 20:if(!(g<f)){e.next=30;break}return k="#####NonceAccount".concat(g,"#####"),e.next=24,p.PublicKey.createWithSeed(o,k,p.SystemProgram.programId);case 24:P=e.sent,d.push(p.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:P,basePubkey:o,seed:k,lamports:s,space:p.NONCE_ACCOUNT_LENGTH,programId:p.SystemProgram.programId})),d.push(p.SystemProgram.nonceInitialize({noncePubkey:P,authorizedPubkey:o}));case 27:++g,e.next=20;break;case 30:return e.next=32,v.getLatestBlockhash();case 32:return S=e.sent,M=S.blockhash,T=S.lastValidBlockHeight,j=new p.TransactionMessage({payerKey:o,recentBlockhash:M,instructions:d}).compileToLegacyMessage(),B=new p.VersionedTransaction(j),e.next=39,w(B);case 39:return V=e.sent,e.next=42,v.sendTransaction(V);case 42:return K=e.sent,e.next=45,v.confirmTransaction({signature:K,blockhash:M,lastValidBlockHeight:T},"confirmed");case 45:return(R=e.sent).value.err?(console.log(R.value.err),x.error("".concat(R.value.err))):(n.success({message:N,description:(0,b.jsx)(y.VU,{type:"tx",content:K,chain:C}),placement:"top",showProgress:!0}),r(o,v),O(!1)),e.abrupt("return",!0);case 50:e.prev=50,e.t0=e.catch(2),(0,i.Tv)(e.t0,x,"handleFinish");case 53:case"end":return e.stop()}}),e,null,[[2,50]])})));return function(t){return e.apply(this,arguments)}}(),[A,w,v,C,n]);return(0,b.jsxs)(l.Y,{formRef:V,title:j,open:H,onFinish:U,onOpenChange:function(e){O(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,b.jsx)(m.Z,{name:"count",label:B,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(T),pattern:/^[1-9]\d*$/}]}),P]})})),P=(0,k.memo)(x)},96358:function(e,t,n){n.r(t),n.d(t,{default:function(){return C}});var r=n(15009),a=n.n(r),o=n(99289),c=n.n(o),s=n(5574),u=n.n(s),i=n(39380),l=n(30441),m=n(88026),d=n(67294),h=n(94036),p=n(2453),f=n(16568),g=n(42075),k=n(83622),y=n(54306),b=n(44718),x=n(93233),P=n(70606),v=n(62741),S=n(64119),A=n(70609),w=n(85893),C=function(){var e=(0,m.useDispatch)(),t=(0,d.useState)(!1),n=u()(t,2),r=n[0],o=n[1],s=p.ZP.useMessage(),C=u()(s,2),M=C[0],T=C[1],N=f.ZP.useNotification(),I=u()(N,2),j=I[0],B=I[1],V=(0,m.useSelector)((function(e){return e.nonce.dataSource})),K=(0,m.useSelector)((function(e){return e.nonce.totalCount})),R=(0,m.useSelector)((function(e){return e.nonce.nonceCountAccount})),H=(0,m.useSelector)((function(e){return e.wallet.chain})),O=(0,d.useState)([]),E=u()(O,2),U=E[0],W=E[1],Z=(0,y.O)(),z=Z.publicKey,L=Z.signTransaction,D=(0,b.R)().connection,F=(0,d.useRef)(),_=(0,m.useIntl)(),G=_.formatMessage({id:"common.intlPleaseConnectWallet"}),q=_.formatMessage({id:"common.intlTxSuccess"}),Q=_.formatMessage({id:"common.intlAuthorityAddress"}),Y=_.formatMessage({id:"common.intlNonceAddress"}),$=_.formatMessage({id:"common.intlBlockHash"}),J=_.formatMessage({id:"common.intlDelFromBackToFront"}),X=_.formatMessage({id:"common.intlCreateAccount"}),ee=_.formatMessage({id:"common.intlBatchDelete"}),te=_.formatMessage({id:"common.intlUpdateNonce"}),ne=_.formatMessage({id:"common.intlStatus"}),re=(0,d.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,w.jsx)("span",{children:n+1})}},{title:"".concat(Y),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,w.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.nonceAccount.toString()})}},{title:"".concat(Q),dataIndex:"authority",key:"authority",render:function(e,t){return(0,w.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.authority.toString()})}},{title:"".concat(ne),dataIndex:"status",key:"status",render:function(e,t){return(0,w.jsx)("span",{children:t.status})}},{title:"".concat($),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,w.jsx)(P.k,{copyable:!0,address:t.blockhash})}}]}),[]),ae=(0,d.useCallback)(function(){var t=c()(a()().mark((function t(n,r){var c,s,u,i,l,m,d,p;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o(!0),"#####NonceCountAccount#####",t.next=5,x.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",x.SystemProgram.programId);case 5:return c=t.sent,t.next=8,r.getAccountInfo(c);case 8:if(s=t.sent,u=[],i=[],l=0,!s){t.next=30;break}l=Math.floor(s.lamports/1e6),m=0;case 15:if(!(m<l)){t.next=25;break}return d="#####NonceAccount".concat(m+1,"#####"),t.next=20,x.PublicKey.createWithSeed(n,d,x.SystemProgram.programId);case 20:p=t.sent,i.push(p);case 22:++m,t.next=15;break;case 25:if(!i.length){t.next=30;break}return t.next=28,r.getMultipleParsedAccounts(i);case 28:t.sent.value.forEach((function(e,t){u.push({key:t,nonceAccount:i[t],authority:new x.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 30:o(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCount(l)),e(h.N.setNonceCountAccount(c)),t.next=40;break;case 36:t.prev=36,t.t0=t.catch(0),o(!1),(0,S.Tv)(t.t0,M,"handleUpdateNonceAccount");case 40:case"end":return t.stop()}}),t,null,[[0,36]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),oe=(0,d.useCallback)(c()(a()().mark((function e(){var t,n,r,c,s,u,i,l,m,d,h,p,f,g,k,y,b,P,v;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z&&L){e.next=2;break}return e.abrupt("return",M.error(G));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,t=z,n=U.toSorted().reverse(),r=V.toReversed(),c=[R],s="#####NonceCountAccount#####",u=0;case 11:if(!(u<n.length)){e.next=18;break}if(n[u]===r[u].key){e.next=14;break}return e.abrupt("return",M.error("".concat(J)));case 14:c.push(r[u].nonceAccount);case 15:++u,e.next=11;break;case 18:return i=[],e.next=21,D.getMultipleParsedAccounts(c);case 21:for(l=e.sent,m=1;m<l.value.length;++m)d=l.value[m].lamports,i.push(x.SystemProgram.nonceWithdraw({noncePubkey:r[m-1].nonceAccount,authorizedPubkey:r[m-1].authority,toPubkey:r[m-1].authority,lamports:d}));return r.length===n.length?(h=l.value[0].lamports,i.push(x.SystemProgram.transfer({fromPubkey:R,basePubkey:t,toPubkey:t,lamports:h,seed:s,programId:x.SystemProgram.programId}))):i.push(x.SystemProgram.transfer({fromPubkey:R,basePubkey:t,toPubkey:t,lamports:1e6*n.length,seed:s,programId:x.SystemProgram.programId})),e.next=26,D.getLatestBlockhash();case 26:return p=e.sent,f=p.blockhash,g=p.lastValidBlockHeight,k=new x.TransactionMessage({payerKey:t,recentBlockhash:f,instructions:i}).compileToLegacyMessage(),y=new x.VersionedTransaction(k),e.next=33,L(y);case 33:return b=e.sent,e.next=36,D.sendTransaction(b);case 36:return P=e.sent,e.next=39,D.confirmTransaction({signature:P,blockhash:f,lastValidBlockHeight:g},"confirmed");case 39:(v=e.sent).value.err?(console.log(v.value.err),M.error("".concat(v.value.err))):(j.success({message:q,description:(0,w.jsx)(A.VU,{type:"tx",content:P,chain:H}),placement:"top",showProgress:!0}),ae(t,D)),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(4),o(!1),(0,S.Tv)(e.t0,M,"handleBatchDelete");case 47:case"end":return e.stop()}}),e,null,[[4,43]])}))),[U,z,L,V,R,D,H]),ce=(0,d.useCallback)(c()(a()().mark((function e(){var t,n,r,o,c,s,u,i,l,m;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z&&L){e.next=2;break}return e.abrupt("return",M.error(G));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:return t=z,n=[],U.forEach((function(e){var t=V[e].nonceAccount,r=V[e].authority;n.push(x.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),e.next=9,D.getLatestBlockhash();case 9:return r=e.sent,o=r.blockhash,c=r.lastValidBlockHeight,s=new x.TransactionMessage({payerKey:t,recentBlockhash:o,instructions:n}).compileToLegacyMessage(),u=new x.VersionedTransaction(s),e.next=16,L(u);case 16:return i=e.sent,e.next=19,D.sendTransaction(i);case 19:return l=e.sent,e.next=22,D.confirmTransaction({signature:l,blockhash:o,lastValidBlockHeight:c},"confirmed");case 22:(m=e.sent).value.err?(console.log(m.value.err),M.error("".concat(m.value.err))):(j.success({message:q,description:(0,w.jsx)(A.VU,{type:"tx",content:l,chain:H}),placement:"top",showProgress:!0}),ae(t,D));case 24:case"end":return e.stop()}}),e)}))),[U,z,L,V,D,H]);return(0,d.useEffect)((function(){z&&D&&ae(z,D)}),[z,D]),(0,w.jsxs)(i._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,w.jsx)(l.Z,{scroll:{x:!0},size:"small",columns:re,dataSource:V,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,w.jsx)("div",{children:(0,w.jsxs)(g.Z,{wrap:!0,className:"mb-[16px]",children:[(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return F.current.handleOpen()},children:X}),(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return oe()},children:ee}),(0,w.jsx)(k.ZP,{type:"primary",onClick:function(){return ce()},children:te}),(0,w.jsx)("div",{children:K})]})}),rowSelection:{type:"checkbox",selectedRowKeys:U,onChange:function(e){W(e)}}}),(0,w.jsx)(v.l,{ref:F,notificationApi:j,handleUpdateNonceAccount:ae}),T,B]})}}}]);