"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[267],{65267:function(e,t,r){r.d(t,{VZ:function(){return be},aC:function(){return Pe},oc:function(){return ne},ZJ:function(){return Oe},am:function(){return Ve},Wo:function(){return d},PO:function(){return q},Af:function(){return B},Hp:function(){return J},Hm:function(){return X},ZH:function(){return K},Dm:function(){return U}});var n=r(67294),a=r(5574),s=r.n(a),c=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function u(e,t){var r=t.format,n=void 0===r?"":r,a=new Date(e).getTime(),u=Date.now();return function(e,t){var r=e,n=/\[[^\]]*]/g,a=(t.match(n)||[]).map((function(e){return e.slice(1,-1)})),u=t.replace(n,"[]"),l=c.reduce((function(e,t){var n=s()(t,2),a=n[0],c=n[1];if(e.includes(a)){var u=Math.floor(r/c);return r-=u*c,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return u.toString().padStart(t,"0")}))}return e}),u),o=0;return l.replace(n,(function(){var e=a[o];return o+=1,e}))}(Math.max(a-u,0),n)}var l=r(40165),o=r(85893);var i=function(e){var t,r=e.value,a=e.format,c=void 0===a?"HH:mm:ss":a,i=e.onChange,d=e.onFinish,f=e.className,p=(t=(0,n.useReducer)((function(e){return e+1}),0),s()(t,2)[1]),h=n.useRef(null),v=function(){var e=function(e){return new Date(e).getTime()}(r);e>=Date.now()&&(h.current=(0,l.Zi)((function(){p(),null==i||i(e-Date.now()),e<Date.now()&&(null==d||d(),h.current&&((0,l.cv)(h.current),h.current=null))}),33.333333333333336))};return n.useEffect((function(){return v(),function(){h.current&&((0,l.cv)(h.current),h.current=null)}}),[r]),(0,o.jsx)("div",{className:f,children:u(r,{format:c})})},d=n.memo(i),f=r(15009),p=r.n(f),h=r(99289),v=r.n(h),m=r(64599),x=r.n(m),b=r(40956),k=r(49591),j=r(64435),y=r(88026),S=r(2453),g=r(16568),P=r(83622),w=r(85137),C=r(27484),F=r.n(C),N=r(70178),L=r.n(N),R=r(70609),M=r(64119),O=r(29363),T=r(49717),_=r(54306),V=r(43651),I=r(44718),A=r(28704),Z=r(30527),D=r(52434),E=r(71874);F().extend(L());var z=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],l=c[1],i=g.ZP.useNotification(),f=s()(i,2),h=f[0],m=f[1],C=(0,_.O)(),F=C.publicKey,N=C.signTransaction,L=C.wallet,z=C.signMessage,q=(0,V.z)(),Y=(0,I.R)().connection,$=(0,T.A)(),B=$.chain,H=$.modalFeeRef,K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV1})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV1})),U=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),G=(0,n.useMemo)((function(){var e=new Set;K.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=x()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[K]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,n.useMemo)((function(){var e=new Set;return K.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[K]),X=(0,n.useMemo)((function(){var e=0;return K.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[K]),ee=(0,n.useMemo)((function(){var e=0;return K.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[K]),te=(0,n.useState)([]),re=s()(te,2),ne=re[0],ae=re[1],se=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ce=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=K.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV1(n))}),[K]),ue=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV1(W))}),[W]),le=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R,O,T,_,V,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:return e.next=5,(0,A.vo)(F.toString(),z);case 5:r=e.sent,n=r.user,a=n.referral,c=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),l=K.filter((function(e){return ne.includes(e.key)})),o=[],i=5,d=x()(l.entries()),e.prev=13,d.s();case 15:if((f=d.n()).done){e.next=47;break}return v=s()(f.value,2),m=v[0],b=v[1],k=b.nftPubkey,j=b.ownerPubkey,y=F,S=a,2,e.next=24,(0,A.zt)({program:c,nftPubkey:k,currentOwnerPubkey:j,payerPubkey:y,currentProjectDataSource:U,userReferral:S,payMode:2});case 24:if(g=e.sent,o.push(g),(P=m+1)%i!=0&&P!==l.length){e.next=45;break}return e.next=30,Y.getLatestBlockhash();case 30:return w=e.sent,C=w.blockhash,R=w.lastValidBlockHeight,e.next=35,(0,E.fC)(Y,L,C,o,N,H);case 35:return O=e.sent,T=O.transaction,_=O.feeMode,e.next=40,(0,E.pR)(Y,L,T,_);case 40:return V=e.sent,I={signature:V,blockhash:C,lastValidBlockHeight:R},e.next=44,(0,E.fS)(B,Y,I,"confirmed",h,u);case 44:o=[];case 45:e.next=15;break;case 47:e.next=52;break;case 49:e.prev=49,e.t0=e.catch(13),d.e(e.t0);case 52:return e.prev=52,d.f(),e.finish(52);case 55:t(U.mintPubkey),e.next=61;break;case 58:e.prev=58,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 61:case"end":return e.stop()}}),e,null,[[0,58],[13,49,52,55]])}))),[ne,K,U,F,N,L,z,Y,B]),oe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),n=K.filter((function(e){return ne.includes(e.key)})),a=[],c=20,l=x()(n.entries()),e.prev=8,l.s();case 10:if((o=l.n()).done){e.next=39;break}return i=s()(o.value,2),d=i[0],f=i[1],v=F,m=f,e.next=16,(0,A.Km)({program:r,payerPubkey:v,currentProjectDataSource:U,currentProjectNftDataSource:m,index:d});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,L,y,a,N,H);case 27:return g=e.sent,P=g.transaction,w=g.feeMode,e.next=32,(0,E.pR)(Y,L,P,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),l.e(e.t0);case 44:return e.prev=44,l.f(),e.finish(44);case 47:ae([]),t(U.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ne,K,U,F,N,L,z,Y,B]),ie=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),n=K.filter((function(e){return ne.includes(e.key)})),a=[],c=15,l=x()(n.entries()),e.prev=8,l.s();case 10:if((o=l.n()).done){e.next=39;break}return i=s()(o.value,2),d=i[0],f=i[1],v=F,m=f,e.next=16,(0,A.Q8)({program:r,payerPubkey:v,currentProjectDataSource:U,currentProjectNftDataSource:m});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,L,y,a,N,H);case 27:return g=e.sent,P=g.transaction,w=g.feeMode,e.next=32,(0,E.pR)(Y,L,P,w);case 32:return C=e.sent,R={signature:C,blockhash:y,lastValidBlockHeight:S},e.next=36,(0,E.fS)(B,Y,R,"confirmed",h,u);case 36:a=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),l.e(e.t0);case 44:return e.prev=44,l.f(),e.finish(44);case 47:ae([]),t(U.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ne,K,U,F,N,L,z,Y,B]),de=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:G,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(U.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,o.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,G,Q,ee,U]);return(0,o.jsxs)("div",{className:"ppp-tab-nft",children:[(0,o.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:de,dataSource:K,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,o.jsx)(P.ZP,{type:"primary",onClick:function(){t(U.mintPubkey),ae([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ne,onChange:function(e){ae(e)}},onSubmit:ce,onReset:ue,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ne.length&&(0,o.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,o.jsx)(k.Z,{}),shape:"square",children:[(0,o.jsx)(w.Z,{type:"primary",description:"购买",onClick:le,shape:"square"},"1"),(0,o.jsx)(w.Z,{type:"primary",description:"拆分",onClick:oe,shape:"square"},"2"),(0,o.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ie,shape:"square"},"3")]}),l,m]})},q=(0,n.memo)(z),Y=r(58868);F().extend(L());var $=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],l=c[1],i=g.ZP.useNotification(),f=s()(i,2),h=f[0],m=f[1],C=(0,_.O)(),F=C.publicKey,N=C.wallet,L=C.signMessage,D=C.signAllTransactions,z=(0,V.z)(),q=(0,I.R)().connection,$=(0,T.A)(),B=$.chain,H=$.modalFeeRef,K=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV2})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV2})),U=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),G=(0,n.useMemo)((function(){var e=new Set;K.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=x()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[K]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,n.useMemo)((function(){var e=new Set;return K.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[K]),X=(0,n.useMemo)((function(){var e=0;return K.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[K]),ee=(0,n.useMemo)((function(){var e=0;return K.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[K]),te=(0,n.useMemo)((function(){var e=0;if(K.length){var t=K[0].lastTrade;e=K[K.length-1].lastTrade-t}return 0===e?"":e<60?"".concat(e.toFixed(0),"秒"):e>=60&&e<3600?"".concat((0,M.uf)(e/60,1),"分"):"".concat((0,M.uf)(e/3600,1),"时")}),[K]),re=(0,n.useState)([]),ne=s()(re,2),ae=ne[0],se=ne[1],ce=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ue=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=K.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV2(n))}),[K]),le=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV2(W))}),[W]),oe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R,O,T,_,V,I,$;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(ce));case 3:return e.next=5,(0,A.qj)(F.toString(),L);case 5:r=e.sent,n=r.user,a=n.referral,c=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),l=K.filter((function(e){return ae.includes(e.key)})),o=5,i=[],d=[],f=x()(l.entries()),e.prev=14,f.s();case 16:if((v=f.n()).done){e.next=31;break}return m=s()(v.value,2),b=m[0],k=m[1],j=k.nftPubkey,y=k.ownerPubkey,S=F,g=a,2,e.next=25,(0,A.G4)({program:c,nftPubkey:j,currentOwnerPubkey:y,payerPubkey:S,currentProjectDataSource:U,userReferral:g,payMode:2});case 25:P=e.sent,i.push(P),(w=b+1)%o!=0&&w!==l.length||(d.push(i),i=[]);case 29:e.next=16;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(14),f.e(e.t0);case 36:return e.prev=36,f.f(),e.finish(36);case 39:return e.next=41,q.getLatestBlockhash();case 41:return C=e.sent,R=C.blockhash,O=C.lastValidBlockHeight,T=new Array(d.length).fill(R),e.next=47,(0,E.Gw)(q,N,T,d,D,H);case 47:return _=e.sent,V=_.transactions,I=_.feeMode,$=T.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:O}})),e.next=53,(0,E.fv)({chain:B,connection:q,wallet:N,transactions:V,strategys:$,notificationApi:h,feeMode:I});case 53:t(U.mintPubkey),e.next=59;break;case 56:e.prev=56,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBuy");case 59:case"end":return e.stop()}}),e,null,[[0,56],[14,33,36,39]])}))),[ae,K,U,F,D,N,L,q,B]),ie=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R,O,T,_,V,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(ce));case 3:r=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),n=K.filter((function(e){return ae.includes(e.key)})),a=18,c=[],l=[],o=x()(n.entries()),e.prev=9,o.s();case 11:if((i=o.n()).done){e.next=23;break}return d=s()(i.value,2),f=d[0],v=d[1],m=F,b=v,e.next=17,(0,A.Q9)({program:r,payerPubkey:m,currentProjectDataSource:U,currentProjectNftDataSource:b,index:f});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(l.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),o.e(e.t0);case 28:return e.prev=28,o.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,g=y.lastValidBlockHeight,P=new Array(l.length).fill(S),e.next=39,(0,E.Gw)(q,N,P,l,D,H);case 39:w=e.sent,C=w.transactions,R=w.feeMode,O=x()(C),e.prev=43,O.s();case 45:if((T=O.n()).done){e.next=55;break}return _=T.value,e.next=49,(0,E.pR)(q,N,_,R);case 49:return V=e.sent,I={signature:V,blockhash:S,lastValidBlockHeight:g},e.next=53,(0,E.fS)(B,q,I,"confirmed",h,u);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),O.e(e.t1);case 60:return e.prev=60,O.f(),e.finish(60);case 63:se([]),t(U.mintPubkey),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,u,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[ae,K,U,F,D,N,L,q,B]),de=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,o,i,d,f,v,m,b,k,j,y,S,g,P,w,C,R,O;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&D&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(ce));case 3:r=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),n=K.filter((function(e){return ae.includes(e.key)})),a=5,c=[],l=[],o=x()(n.entries()),e.prev=9,o.s();case 11:if((i=o.n()).done){e.next=23;break}return d=s()(i.value,2),f=d[0],v=d[1],m=F,b=v,e.next=17,(0,A.mn)({program:r,payerPubkey:m,currentProjectDataSource:U,currentProjectNftDataSource:b});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(l.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),o.e(e.t0);case 28:return e.prev=28,o.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,g=y.lastValidBlockHeight,P=new Array(l.length).fill(S),e.next=39,(0,E.Gw)(q,N,P,l,D,H);case 39:return w=e.sent,C=w.transactions,R=w.feeMode,O=P.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:g}})),e.next=45,(0,E.fv)({chain:B,connection:q,wallet:N,transactions:C,strategys:O,notificationApi:h,feeMode:R});case 45:se([]),t(U.mintPubkey),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,u,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[ae,K,U,F,D,N,L,q,B]),fe=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:G,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(U.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间(".concat(te,")"),dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.burnTimeLocalValue-t.burnTimeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,o.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,G,Q,ee,U]);return(0,o.jsxs)("div",{className:"ppp-tab-nft",children:[(0,o.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:fe,dataSource:K,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,o.jsx)(P.ZP,{type:"primary",onClick:function(){t(U.mintPubkey),se([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ae,onChange:function(e){se(e)}},onSubmit:ue,onReset:le,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ae.length&&(0,o.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,o.jsx)(k.Z,{}),shape:"square",children:[(0,o.jsx)(w.Z,{type:"primary",description:"购买",onClick:oe,shape:"square"},"1"),(0,o.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ie,shape:"square"},"2"),(0,o.jsx)(w.Z,{type:"primary",description:"销毁",onClick:de,shape:"square"},"3")]}),l,m]})},B=(0,n.memo)($);F().extend(L());var H=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),l=s()(u,2),i=l[0],f=l[1],h=g.ZP.useNotification(),m=s()(h,2),b=m[0],P=m[1],C=(0,_.O)(),F=C.publicKey,N=C.signTransaction,L=C.wallet,z=C.signMessage,q=(0,V.z)(),Y=(0,I.R)().connection,$=(0,T.A)(),B=$.chain,H=$.modalFeeRef,K=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=x()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),U=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),G=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,o,d,f,h,v,m,k,j,y,S,g,P,w,C,R,O,T;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",i.error(re));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],l=20,o=x()(c.entries()),e.prev=8,o.s();case 10:if((d=o.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],v=f[1],m=F,k=v,e.next=16,(0,A.Km)({program:n,payerPubkey:m,currentProjectDataSource:a,currentProjectNftDataSource:k,index:h});case 16:if(j=e.sent,u.push(j),(y=h+1)%l!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,g=S.blockhash,P=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,L,g,u,N,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,L,C,R);case 32:return O=e.sent,T={signature:O,blockhash:g,lastValidBlockHeight:P},e.next=36,(0,E.fS)(B,Y,T,"confirmed",b,i);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:te([]),t(a.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,i,"handleSplit");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,r,a,F,N,L,z,Y,B]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,o,d,f,h,v,m,k,j,y,S,g,P,w,C,R,O,T;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",i.error(re));case 3:n=new Z.$r(D,new Z.Y7(Y,q,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],l=15,o=x()(c.entries()),e.prev=8,o.s();case 10:if((d=o.n()).done){e.next=39;break}return f=s()(d.value,2),h=f[0],v=f[1],m=F,k=v,e.next=16,(0,A.Q8)({program:n,payerPubkey:m,currentProjectDataSource:a,currentProjectNftDataSource:k});case 16:if(j=e.sent,u.push(j),(y=h+1)%l!=0&&y!==c.length){e.next=37;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,g=S.blockhash,P=S.lastValidBlockHeight,e.next=27,(0,E.fC)(Y,L,g,u,N,H);case 27:return w=e.sent,C=w.transaction,R=w.feeMode,e.next=32,(0,E.pR)(Y,L,C,R);case 32:return O=e.sent,T={signature:O,blockhash:g,lastValidBlockHeight:P},e.next=36,(0,E.fS)(B,Y,T,"confirmed",b,i);case 36:u=[];case 37:e.next=10;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e.catch(8),o.e(e.t0);case 44:return e.prev=44,o.f(),e.finish(44);case 47:te([]),t(a.mintPubkey),e.next=54;break;case 51:e.prev=51,e.t1=e.catch(0),(0,M.Tv)(e.t1,i,"handleBurn");case 54:case"end":return e.stop()}}),e,null,[[0,51],[8,41,44,47]])}))),[ee,r,a,F,N,L,z,Y,B]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.status})}},{title:"持有者(".concat(U,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:K,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,o.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,K,U,J,a]);return(0,o.jsxs)("div",{className:"ppp-tab-nft",children:[(0,o.jsx)(j.Z,{loading:{spinning:W,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,o.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,o.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,o.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,o.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,P]})},K=(0,n.memo)(H);F().extend(L());var W=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),l=s()(u,2),i=l[0],f=l[1],h=g.ZP.useNotification(),m=s()(h,2),b=m[0],P=m[1],C=(0,_.O)(),F=C.publicKey,N=C.signAllTransactions,L=C.wallet,D=C.signMessage,z=(0,V.z)(),q=(0,I.R)().connection,$=(0,T.A)(),B=$.chain,H=$.modalFeeRef,K=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=x()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),U=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),G=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/O.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,o,d,f,h,v,m,k,j,y,S,g,P,w,C,R,O,T,_,V,I,$,K;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&D&&z){e.next=3;break}return e.abrupt("return",i.error(re));case 3:n=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=18,l=[],o=[],d=x()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],m=h[1],k=F,j=m,e.next=17,(0,A.Q9)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j,index:v});case 17:y=e.sent,l.push(y),(S=v+1)%u!=0&&S!==c.length||(o.push(l),l=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return g=e.sent,P=g.blockhash,w=g.lastValidBlockHeight,C=new Array(o.length).fill(P),e.next=39,(0,E.Gw)(q,L,C,o,N,H);case 39:R=e.sent,O=R.transactions,T=R.feeMode,_=x()(O),e.prev=43,_.s();case 45:if((V=_.n()).done){e.next=55;break}return I=V.value,e.next=49,(0,E.pR)(q,L,I,T);case 49:return $=e.sent,K={signature:$,blockhash:P,lastValidBlockHeight:w},e.next=53,(0,E.fS)(B,q,K,"confirmed",b,i);case 53:e.next=45;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(43),_.e(e.t1);case 60:return e.prev=60,_.f(),e.finish(60);case 63:te([]),t(a.mintPubkey),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(0),(0,M.Tv)(e.t2,i,"handleSplit");case 70:case"end":return e.stop()}}),e,null,[[0,67],[9,25,28,31],[43,57,60,63]])}))),[ee,r,a,F,N,L,D,q,B]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,o,d,f,h,v,m,k,j,y,S,g,P,w,C,R,O,T,_;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&D&&z){e.next=3;break}return e.abrupt("return",i.error(re));case 3:n=new Z.$r(Y,new Z.Y7(q,z,Z.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=5,l=[],o=[],d=x()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],m=h[1],k=F,j=m,e.next=17,(0,A.mn)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j});case 17:y=e.sent,l.push(y),(S=v+1)%u!=0&&S!==c.length||(o.push(l),l=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return g=e.sent,P=g.blockhash,w=g.lastValidBlockHeight,C=new Array(o.length).fill(P),e.next=39,(0,E.Gw)(q,L,C,o,N,H);case 39:return R=e.sent,O=R.transactions,T=R.feeMode,_=C.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:w}})),e.next=45,(0,E.fv)({chain:B,connection:q,wallet:L,transactions:O,strategys:_,notificationApi:b,feeMode:T});case 45:te([]),t(a.mintPubkey),e.next=52;break;case 49:e.prev=49,e.t1=e.catch(0),(0,M.Tv)(e.t1,i,"handleBurn");case 52:case"end":return e.stop()}}),e,null,[[0,49],[9,25,28,31]])}))),[ee,r,a,F,N,L,D,q,B]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.status})}},{title:"持有者(".concat(U,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:K,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:B})}},{title:"投入成本(".concat(G.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.price/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,o.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[G,K,U,J,a]);return(0,o.jsxs)("div",{className:"ppp-tab-nft",children:[(0,o.jsx)(j.Z,{loading:{spinning:W,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,o.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,o.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,o.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,o.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,P]})},U=(0,n.memo)(W);F().extend(L());var G=function(e){var t=(0,y.useDispatch)(),r=(0,T.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV1})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV1})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV1})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),l=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV1})),i=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=x()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV1(n))}),[s]),m=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV1(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,o.jsx)(P.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),S=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:i,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}}]}),[i,d,p,d,c,h,r]);return(0,o.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,o.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,o.jsx)(j.Z,{loading:{spinning:l,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:v,onReset:m,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},J=(0,n.memo)(G);F().extend(L());var Q=function(e){var t=(0,y.useDispatch)(),r=(0,T.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV2})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV2})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV2})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),l=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),i=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=x()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/O.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/O.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/O.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV2(n))}),[s]),m=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV2(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,o.jsx)(P.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),S=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,o.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:i,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,o.jsx)(R.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,o.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.balance/O.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.invest/O.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,o.jsx)("div",{children:(0,M.uf)(t.profit/O.LAMPORTS_PER_SOL,6)})}}]}),[i,d,p,d,c,h,r]);return(0,o.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,o.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,o.jsx)(j.Z,{loading:{spinning:l,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:v,onReset:m,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},X=(0,n.memo)(Q),ee=r(87603),te=r(38345),re=function(){return(0,o.jsxs)(te.Z,{title:(0,o.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"400px"},children:[(0,o.jsx)("div",{className:"font-semibold mb-2",children:"1. 操作步骤："}),(0,o.jsxs)("div",{className:"ml-3 mb-2",children:["1） 连接钱包 ",(0,o.jsx)(ee.Z,{})," 打开“PPP-Nonce账号”页面 ",(0,o.jsx)(ee.Z,{})," 创建Nonce账号：根据你要抢图的数量来创建；"]}),(0,o.jsxs)("div",{className:"ml-3 mb-2",children:["2）打开“PPP-自动抢图”页面 ",(0,o.jsx)(ee.Z,{})," 在“创建交易”表单输入：项目，购买方式，购买数量，每张图GAS费用（表单其项按需输入） ",(0,o.jsx)(ee.Z,{})," 点击“运行”按钮 ",(0,o.jsx)(ee.Z,{})," 签名（无时间限制）；"]}),(0,o.jsxs)("div",{className:"ml-3 mb-2",children:["3）在“发送交易”表单，抢图会自动进行倒计时 ",(0,o.jsx)(ee.Z,{})," 等待倒计时结束即可，表单输入项按需调整，发送设备要保持前台活跃状态；"]}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"4）倒计时结束后会自动进行发送，发送完成后可点击“校对”按钮，检查抢到的图片数量。"}),(0,o.jsx)("div",{className:"font-semibold mb-2",children:"2. 注意事项："}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"1）只需在抢图前进行签名即可，无时间限制；"}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"2）不支持OK钱包，因为预检交易通不过，钱包不让提前签名；"}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"3）Nonce账号的数量需要根据你一次性抢多少图来决定，例如你想一次性抢10，就需要至少创建10个Nonce账号，只需要创建一次，账号可重复使用，也可以随时回收；Nonce账号数量决定当前账号抢图数量的上限，Nonce账号数量多一些，有利于提高抢图成功率；"}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"4）关于每张图GAS费用，费用越高，出块节点打包你交易的优先权就也越高，抢图成功率就越大。交易失败，不会扣除任何费用。"}),(0,o.jsx)("div",{className:"font-semibold mb-2",children:"3. 费用说明："}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"有两种方式可选择"}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"1）免费：填写本工具的邀请码，工具会自动填入，无需手动操作；"}),(0,o.jsx)("div",{className:"ml-3 mb-2",children:"2）付费：按账号实际绑定的邀请码进行填写，无需手动操作。用户使用工具抢到的NFT，每个收取0.1%费用。例如工具抢到一个价值为0.1 SOL的NFT，则工具会收取0.0001 SOL作为费用，抢购成功了，才会收取。"})]})},ne=(0,n.memo)(re),ae=r(19632),se=r.n(ae),ce=r(98165),ue=r(25035),le=r(97269),oe=r(64317),ie=r(31199),de=r(25054),fe=r(5966),pe=r(39678),he=r(7134),ve=r(83062),me=r(48764).Buffer,xe=function(){var e,t,r,a,c,u,l,i,d,f,h,m=(0,y.useIntl)(),k=m.formatMessage({id:"common.intlInputException"}),j=m.formatMessage({id:"common.intlPleaseConnectWallet"}),g=(0,y.useDispatch)(),P=S.ZP.useMessage(),w=s()(P,2),C=w[0],N=w[1],L=(0,n.useRef)(),R=(0,_.O)(),T=R.publicKey,z=R.signTransaction,q=R.signMessage,Y=R.wallet,$=(0,I.R)().connection,B=(0,V.z)(),H=(0,n.useState)(0),K=s()(H,2),W=K[0],U=K[1],G=(0,n.useState)(0),J=s()(G,2),Q=J[0],X=J[1],ee=(0,n.useState)(0),re=s()(ee,2),ne=re[0],ae=re[1],xe=(0,n.useState)(!1),be=s()(xe,2),ke=be[0],je=be[1],ye=(0,n.useState)(!1),Se=s()(ye,2),ge=Se[0],Pe=Se[1],we=(0,n.useState)(),Ce=s()(we,2),Fe=Ce[0],Ne=Ce[1],Le=(0,n.useState)([]),Re=s()(Le,2),Me=Re[0],Oe=Re[1],Te=(0,n.useState)([]),_e=s()(Te,2),Ve=_e[0],Ie=_e[1],Ae=(0,n.useState)(0),Ze=s()(Ae,2),De=Ze[0],Ee=Ze[1],ze=(0,n.useState)(!1),qe=s()(ze,2),Ye=qe[0],$e=qe[1],Be=(0,n.useState)(!1),He=s()(Be,2),Ke=He[0],We=He[1],Ue=(0,n.useState)(1),Ge=s()(Ue,2),Je=Ge[0],Qe=Ge[1],Xe=(0,n.useState)([]),et=s()(Xe,2),tt=et[0],rt=et[1],nt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV1})),at=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),st=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),ct=(0,n.useState)([]),ut=s()(ct,2),lt=ut[0],ot=ut[1],it=(0,n.useState)({}),dt=s()(it,2),ft=dt[0],pt=dt[1],ht=(0,n.useState)([]),vt=s()(ht,2),mt=vt[0],xt=vt[1],bt=(0,n.useState)([]),kt=s()(bt,2),jt=kt[0],yt=kt[1],St=(0,n.useState)(0),gt=s()(St,2),Pt=gt[0],wt=gt[1],Ct=(0,n.useCallback)((function(){wt(0),yt([]),xt([]),Ee(0),We(!1),$e(!1),Ne(void 0),Oe([]),Ie([])}),[]),Ft=(0,n.useCallback)((function(){var e,t,r=null===(e=L.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=L.current)||void 0===t||t.resetFields(n),Ct()}),[]),Nt=(0,n.useCallback)((function(){var e;null===(e=L.current)||void 0===e||e.resetFields(),Ct()}),[]),Lt=(0,n.useMemo)((function(){var e=(0,M.uf)(W/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(W/O.LAMPORTS_PER_SOL*Q,6);return Q?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[W,Q]),Rt=(0,n.useMemo)((function(){var e=(0,M.uf)(ne/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(ne/O.LAMPORTS_PER_SOL*Q,6);return Q?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[W,Q]),Mt=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e){var n,a=null===(n=L.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(7===e){var s,c=null===(s=L.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(8===e){var u,l=null===(u=L.current)||void 0===u?void 0:u.getFieldValue("nftIds");l=l||[],r=t.filter((function(e){return l.includes(e.nftId)}))}return Ie(r),r}),[]),Ot=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,o,i,d,f,h,v,m,b,k,j,y,S;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.buyCount,c=n.startNumber,u=n.endNumber,l=n.buyMode,o=Mt(l,a),!(c>o.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(o.length));case 4:if(!u){e.next=11;break}if(!(c>u)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:i=o.length>u?u:o.length,o=o.slice(c-1,i),e.next=12;break;case 11:o=o.slice(c-1);case 12:return d=function(e){var t,n=0,a=x()(e);try{for(a.s();!(t=a.n()).done;){if(t.value.ownerPubkey!==r.toString()){if(n>=s)return n;if(n>=1e3)return n;n+=1}}}catch(e){a.e(e)}finally{a.f()}return n},f=d(o),"#####NonceCountAccount#####",e.next=17,O.PublicKey.createWithSeed(r,"#####NonceCountAccount#####",O.SystemProgram.programId);case 17:return h=e.sent,e.next=20,t.getAccountInfo(h);case 20:if(v=e.sent,m=[],b=[],k=0,v){e.next=26;break}throw Error("请先创建Nonce账号");case 26:if(k=(0,E.sT)(v.lamports),!(f>k)){e.next=29;break}throw Error("Nonce账号数量不足，需要大于等于图片购买数量");case 29:j=0;case 30:if(!(j<k)){e.next=40;break}return y="#####NonceAccount".concat(j+1,"#####"),e.next=35,O.PublicKey.createWithSeed(r,y,O.SystemProgram.programId);case 35:S=e.sent,m.push(S);case 37:++j,e.next=30;break;case 40:if(!m.length){e.next=45;break}return e.next=43,t.getMultipleParsedAccounts(m);case 43:e.sent.value.forEach((function(e,t){b.push({key:t,nonceAccount:m[t],authority:new O.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 45:return e.abrupt("return",{nonceAccounts:m,nonceAccountsData:b,nftsDataSource:o});case 46:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),Tt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l,o,i,d,f,h,v,m,b,k,j,y,S,g,P,w,C,F,N,L,R,M,T,_,V,I,z,q,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.payer,a=t.anchorWallet,s=t.signMessage,c=t.signTransaction,u=t.nftsDataSource,l=t.formData,o=t.nonceAccounts,i=t.nonceAccountsData,d=t.currentProjectDataSource,f=t.tipAccounts,h=t.tipFee,v=0,m=0,b=0,k=[],j=l.buyCount,y=l.payMode,e.next=8,(0,A.vo)(n.toString(),s);case 8:S=e.sent,g=S.user,P=g.referral,w=new Z.$r(D,new Z.Y7(r,a,Z.Y7.defaultOptions())),C=x()(u),e.prev=13,C.s();case 15:if((F=C.n()).done){e.next=48;break}if(N=F.value,N.ownerPubkey!==n.toString()){e.next=20;break}return e.abrupt("continue",46);case 20:if(!(v>=j)){e.next=22;break}return e.abrupt("break",48);case 22:return v+=1,(L=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:i[b].nonceAccount,authorizedPubkey:i[b].authority})),L.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:132284})),R=N.nftPubkey,M=N.ownerPubkey,T=n,_=P,e.next=32,(0,A.zt)({program:w,nftPubkey:R,currentOwnerPubkey:M,payerPubkey:T,currentProjectDataSource:d,userReferral:_,payMode:y});case 32:return V=e.sent,L.push(V),2===y&&P&&(I=Number((.001*N.price).toFixed(0)),L.push(O.SystemProgram.transfer({fromPubkey:n,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:I}))),L.push(O.SystemProgram.transfer({fromPubkey:n,toPubkey:new O.PublicKey(f[m]),lamports:h<1e3?1e3:Number(h.toFixed(0))})),z=new O.TransactionMessage({payerKey:n,recentBlockhash:i[b].blockhash,instructions:L}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),e.next=41,c(q);case 41:Y=e.sent,k.push({instructions:L,transaction:Y,transactionBase64:me.from(Y.serialize()).toString("base64"),nft:N,tipFee:h,referral:P}),b=(b+1)%o.length,m=(m+1)%f.length,Ee(v);case 46:e.next=15;break;case 48:e.next=53;break;case 50:e.prev=50,e.t0=e.catch(13),C.e(e.t0);case 53:return e.prev=53,C.f(),e.finish(53);case 56:return e.abrupt("return",k);case 57:case"end":return e.stop()}}),e,null,[[13,50,53,56]])})));return function(t){return e.apply(this,arguments)}}(),[]),_t=(0,n.useCallback)((function(e,t,r,n,a){var s,c,u=0,l=t.projectId,o=t.splitCount,i=n.tokenSymbol,d=n.nextRoundLocalFormat,f=r.length,p=e.toString(),h=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),v=r[0].referral;r.forEach((function(e){u+=e.nft.price}));for(var m=a.includes(p)?(0,M.uf)(u/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*u/O.LAMPORTS_PER_SOL,8,"SOL"),x=F()().format("YYYY-MM-DDTHH:mm:ss"),b=Math.ceil(r.length/o),k=1,j=function(){var e=0,s=[],c=r.splice(0,b),u=c.length;c.forEach((function(t){s.push(t.nft.nftId),e+=t.nft.price}));var f=a.includes(p)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");s.sort((function(e,t){return e-t}));var m={projectId:l,instruction:"buy",totalTxCount:u,totalAmount:f,tipFee:h,referral:v,tokenSymbol:i,from:p,startNftId:s[0],endNftId:s[s.length-1],nftIds:s,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:n,transactions:c},j=JSON.stringify(m,null,2),y="data:,".concat(j),S=document.createElement("a");S.href=y,S.download=1===o||1===b?"".concat(i,"_").concat(l.slice(0,4),"_").concat(l.slice(-4),"_").concat(u,"_").concat(x,"_buy.json"):"".concat(i,"_").concat(l.slice(0,4),"_").concat(l.slice(-4),"_").concat(u,"_part").concat(k++,"_").concat(x,"_buy.json"),S.click()};r.length;)j();null===(s=L.current)||void 0===s||s.setFieldValue("totalAmountCreate",m),null===(c=L.current)||void 0===c||c.setFieldValue("totalTxCount",f),C.success("创建完成")}),[]),Vt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Y&&T&&z&&B&&q&&Fe){e.next=4;break}return C.error(j),e.abrupt("return",!0);case 4:if("Simple Wallet"===Y.adapter.name){e.next=7;break}return C.error("只支持Simple Wallet"),e.abrupt("return",!0);case 7:return e.next=9,Ot($,T,t,Me);case 9:return r=e.sent,n=r.nonceAccounts,a=r.nonceAccountsData,s=r.nftsDataSource,e.next=15,Tt({connection:$,payer:T,anchorWallet:B,signMessage:q,signTransaction:z,nftsDataSource:s,formData:t,nonceAccounts:n,nonceAccountsData:a,currentProjectDataSource:Fe,tipAccounts:at,tipFee:W});case 15:if((c=e.sent).length){e.next=19;break}return C.info("没有需要创建的内容"),e.abrupt("return",!0);case 19:_t(T,t,c,Fe,st),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),Ee(0),(0,M.Tv)(e.t0,C,"handleFinish");case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),[W,T,Y,z,B,q,Fe,Me,$,at,st]),It=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,se()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*O.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),U(s),ae(a)}),[]),At=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,i,d,f,h,v,m,x,b,k,j,y,S,g;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Pe(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,l={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},i=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),m=c(a["99th"]),x=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),l["25th"]={sol:i,usd:x},l["50th"]={sol:d,usd:b},l["50th_ema"]={sol:f,usd:k},l["75th"]={sol:h,usd:j},l["95th"]={sol:v,usd:y},l["99th"]={sol:m,usd:S},(g=[]).push({value:"25th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"25%"}),(0,o.jsx)("div",{children:c(a["25th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["25th"])})})]})}),g.push({value:"50th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"50%"}),(0,o.jsx)("div",{children:c(a["50th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["50th"])})})]})}),g.push({value:"50th_ema",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"50% EMA"}),(0,o.jsx)("div",{children:c(a["50th_ema"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["50th_ema"])})})]})}),g.push({value:"75th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"75%"}),(0,o.jsx)("div",{children:c(a["75th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["75th"])})})]})}),g.push({value:"95th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"95%"}),(0,o.jsx)("div",{children:c(a["95th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["95th"])})})]})}),g.push({value:"99th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"99%"}),(0,o.jsx)("div",{children:c(a["99th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["99th"])})})]})}),pt(a),ot(g),Pe(!1),null===(n=L.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),It(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),Pe(!1),(0,M.Tv)(e.t0,C,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Zt=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=Mt(a,e);return It(u,s,c,t),wt(u.length),u.length}),[]),Dt=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e})})})),xt(n)}),[]),Et=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,o.jsxs)("div",{className:"grid grid-cols-2",children:[(0,o.jsxs)("div",{children:["#",e.nftId]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),yt(t)}),[]),zt=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=L.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;6===c||7===c?($e(!0),Dt(e)):($e(!1),xt([]),null===(a=L.current)||void 0===a||a.setFieldValue("accounts",void 0));8===c?(We(!0),Et(e)):(We(!1),yt([]),null===(s=L.current)||void 0===s||s.setFieldValue("nftIds",void 0));Zt(e,t),null===(n=L.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),qt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),a=null===(n=L.current)||void 0===n?void 0:n.getFieldsValue(),s=a.projectId,Ft(),c=t.find((function(e){return e.mintPubkey===s})),e.next=7,(0,A.LE)(s,c);case 7:u=e.sent,l=u.currentProjectNftsDataSource,Zt(l,r),Oe(l),Ne(c),je(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),je(!1),(0,M.Tv)(e.t0,C,"handleCurrentProjectNfts");case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Yt=(0,n.useCallback)((function(e,t){var r,n,a=Zt(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),$t=(0,n.useCallback)((function(e,t){var r,n,a=Zt(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),Bt=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;It(e,a,s,t)}),[]),Ht=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=L.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=L.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),It(e,.1,a,t)}else if(2===a)At(e,r);else if(3===a){var c,u="0.000001";null===(c=L.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),It(e,u,a,t)}Qe(a)}),[]),Kt=(0,n.useCallback)((function(e){e.projectId&&qt(nt,ft),e.buyMode&&zt(Me,ft),e.nftIds&&Yt(Me,ft),e.accounts&&$t(Me,ft),e.tipMode&&Ht(Me,ft,Q),e.tipFeeCreate&&Bt(Ve,ft)}),[nt,Me,Pt,Ve,ft,Q]),Wt=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(0!==e.round&&r!==n){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(he.C,{className:"mr-2",size:"default",src:a}),(0,o.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),rt(t)}),[]),Ut=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),e.next=4,(0,A.p5)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,Wt(n),X(a),g(b.N.setProjectsV1(r)),g(b.N.setProjectsDataSourceV1(n)),je(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),je(!1),(0,M.Tv)(e.t0,C,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]);return(0,n.useEffect)((function(){Ut()}),[]),(0,o.jsxs)(te.Z,{title:(0,o.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,o.jsxs)(le.A,{formRef:L,onFinish:Vt,onValuesChange:Kt,onReset:Nt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:.1,payMode:1,tipMode:1,splitCount:1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],t[0],(0,o.jsx)("div",{children:De||""},"sign")]}},children:[(0,o.jsx)(oe.Z,{name:"projectId",label:(0,o.jsxs)("div",{children:["项目",(0,o.jsx)(ce.Z,{spin:ke,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:Ut})]}),options:tt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(he.C,{className:"mr-2",size:"default",src:n}),(0,M.Mn)()?(0,o.jsx)("div",{children:"".concat(r)}):(0,o.jsx)("div",{children:"".concat(r," - ").concat((0,M.LH)(t))})]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,o.jsx)(oe.Z,{name:"buyMode",label:"购买方式",options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 指定账号(顺序)"},{value:7,label:"7 指定账号(随机)"},{value:8,label:"8 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(e=L.current)&&void 0!==e&&e.getFieldValue("projectId"))}}),!!Ye&&(0,o.jsx)(oe.Z,{name:"accounts",label:"选择账号",options:mt,fieldProps:{mode:"multiple",disabled:!(null!==(t=L.current)&&void 0!==t&&t.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),!!Ke&&(0,o.jsx)(oe.Z,{name:"nftIds",label:"选择序号",options:jt,fieldProps:{mode:"multiple",disabled:!(null!==(r=L.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),(0,o.jsx)(ie.Z,{name:"buyCount",label:(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:"购买数量 "}),(0,o.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=L.current)||void 0===e||e.setFieldValue("buyCount",Pt),null===(t=L.current)||void 0===t||t.validateFields(["buyCount"])},children:Pt?"(".concat(Pt,")"):""})]}),placeholder:"",min:1,max:Pt,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(a=L.current)&&void 0!==a&&a.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"startNumber",label:(0,o.jsxs)("div",{children:["开始序号#",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=L.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"endNumber",label:(0,o.jsxs)("div",{children:["结束序号#",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=L.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,o.jsx)(oe.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(l=L.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),1===Je?(0,o.jsx)(de.Z,{name:"tipFeeCreate",label:Lt,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(i=L.current)&&void 0!==i&&i.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.*$/}],help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,2===Je?(0,o.jsx)(oe.Z,{name:"tipFeeCreate",label:(0,o.jsxs)("div",{children:["每张图GAS费用",(0,o.jsx)(ce.Z,{spin:ge,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return At(Me,Q)}})]}),options:lt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,3===Je?(0,o.jsx)(fe.Z,{name:"tipFeeCreate",label:Lt,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Rt})}):null,(0,o.jsx)(oe.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(d=L.current)&&void 0!==d&&d.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"splitCount",label:(0,o.jsxs)("div",{children:["交易文件数量",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,o.jsx)(fe.Z,{name:"totalAmountCreate",label:(0,o.jsxs)("div",{children:["交易总金额",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(f=L.current)&&void 0!==f&&f.getFieldValue("projectId"))}}),(0,o.jsx)(fe.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(h=L.current)&&void 0!==h&&h.getFieldValue("projectId"))}})]}),N]})},be=(0,n.memo)(xe),ke=r(84567),je=r(20640),ye=r.n(je),Se=r(48764).Buffer,ge=function(e){var t,r,a,c,u,l,i,d,f,h,m,k,j,g=e.autoSweepSendRef,w=(0,y.useIntl)(),C=w.formatMessage({id:"common.intlInputException"}),N=w.formatMessage({id:"common.intlPleaseConnectWallet"}),L=(0,y.useDispatch)(),R=S.ZP.useMessage(),T=s()(R,2),D=T[0],z=T[1],q=(0,n.useRef)(),$=(0,_.O)(),B=$.publicKey,H=$.signAllTransactions,K=$.signMessage,W=$.wallet,U=(0,I.R)().connection,G=(0,V.z)(),J=(0,n.useState)(0),Q=s()(J,2),X=Q[0],ee=Q[1],re=(0,n.useState)(0),ne=s()(re,2),ae=ne[0],me=ne[1],xe=(0,n.useState)(0),be=s()(xe,2),je=be[0],ge=be[1],Pe=(0,n.useState)(!1),we=s()(Pe,2),Ce=we[0],Fe=we[1],Ne=(0,n.useState)(!1),Le=s()(Ne,2),Re=Le[0],Me=Le[1],Oe=(0,n.useState)(),Te=s()(Oe,2),_e=Te[0],Ve=Te[1],Ie=(0,n.useState)([]),Ae=s()(Ie,2),Ze=Ae[0],De=Ae[1],Ee=(0,n.useState)([]),ze=s()(Ee,2),qe=ze[0],Ye=ze[1],$e=(0,n.useState)(0),Be=s()($e,2),He=Be[0],Ke=Be[1],We=(0,n.useState)(!1),Ue=s()(We,2),Ge=Ue[0],Je=Ue[1],Qe=(0,n.useState)(!1),Xe=s()(Qe,2),et=Xe[0],tt=Xe[1],rt=(0,n.useState)(2),nt=s()(rt,2),at=nt[0],st=nt[1],ct=(0,n.useState)(!0),ut=s()(ct,2),lt=ut[0],ot=ut[1],it=(0,n.useState)(),dt=s()(it,2),ft=dt[0],pt=dt[1],ht=(0,n.useState)([]),vt=s()(ht,2),mt=vt[0],xt=vt[1],bt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV2})),kt=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),jt=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),yt=(0,n.useState)([]),St=s()(yt,2),gt=St[0],Pt=St[1],wt=(0,n.useState)({}),Ct=s()(wt,2),Ft=Ct[0],Nt=Ct[1],Lt=(0,n.useState)([]),Rt=s()(Lt,2),Mt=Rt[0],Ot=Rt[1],Tt=(0,n.useState)([]),_t=s()(Tt,2),Vt=_t[0],It=_t[1],At=(0,n.useState)(0),Zt=s()(At,2),Dt=Zt[0],Et=Zt[1],zt=(0,n.useCallback)((function(){Et(0),It([]),Ot([]),Ke(0),tt(!1),Je(!1),Ve(void 0),De([]),Ye([]),pt(void 0)}),[]),qt=(0,n.useCallback)((function(){var e,t,r=null===(e=q.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=q.current)||void 0===t||t.resetFields(n),zt()}),[]),Yt=(0,n.useCallback)((function(){var e;null===(e=q.current)||void 0===e||e.resetFields(),zt()}),[]),$t=(0,n.useMemo)((function(){var e=(0,M.uf)(X/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(X/O.LAMPORTS_PER_SOL*ae,6);return ae?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[X,ae]),Bt=(0,n.useMemo)((function(){var e=(0,M.uf)(je/O.LAMPORTS_PER_SOL,8,"SOL"),t=(0,M.uf)(je/O.LAMPORTS_PER_SOL*ae,6);return ae?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[X,ae]),Ht=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e)r=t.filter((function(e){return!e.split})).sort((function(){return Math.random()-.5}));else if(7===e){var n,a=null===(n=q.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(8===e){var s,c=null===(s=q.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(9===e){var u,l=null===(u=q.current)||void 0===u?void 0:u.getFieldValue("nftIds");l=l||[],r=t.filter((function(e){return l.includes(e.nftId)}))}return Ye(r),r}),[]),Kt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,o,i,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.startNumber,c=n.endNumber,u=n.buyMode,l=Ht(u,a),!(s>l.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(l.length));case 4:if(!c){e.next=11;break}if(!(s>c)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:o=l.length>c?c:l.length,l=l.slice(s-1,o),e.next=12;break;case 11:l=l.slice(s-1);case 12:return i=[],e.next=15,(0,E.JH)(r,t);case 15:if((d=e.sent).forEach((function(e){i.push(e.nonceAccount)})),d.length){e.next=20;break}throw Error("请先创建Nonce账号");case 20:return e.abrupt("return",{nonceAccounts:i,nonceAccountsData:d,nftsDataSource:l});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),Wt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l,o,i,d,f,h,v,m,b,k,j,y,S,g,P,w,C,F,N,L,R,M,T,_,V,I,D,z,q,$;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.wallet,a=t.payer,s=t.anchorWallet,c=t.signMessage,u=t.signAllTransactions,l=t.nftsDataSource,o=t.formData,i=t.nonceAccounts,d=t.nonceAccountsData,f=t.currentProjectDataSource,h=t.tipAccounts,v=t.tipFee,m=0,b=0,k=0,j=[],y=o.buyCount,S=o.payMode,e.next=8,(0,A.qj)(a.toString(),c);case 8:g=e.sent,P=g.user,w=P.referral,C=new Z.$r(Y,new Z.Y7(r,s,Z.Y7.defaultOptions())),F=x()(l),e.prev=13,F.s();case 15:if((N=F.n()).done){e.next=43;break}if(L=N.value,!(m>=y)){e.next=19;break}return e.abrupt("break",43);case 19:return m+=1,(R=[]).push(O.SystemProgram.nonceAdvance({noncePubkey:d[k].nonceAccount,authorizedPubkey:d[k].authority})),R.push(O.ComputeBudgetProgram.setComputeUnitLimit({units:47258})),"Simple Wallet"!==n.adapter.name&&R.push(O.ComputeBudgetProgram.setComputeUnitPrice({microLamports:0})),M=L.nftPubkey,T=L.ownerPubkey,_=a,V=w,e.next=30,(0,A.G4)({program:C,nftPubkey:M,currentOwnerPubkey:T,payerPubkey:_,currentProjectDataSource:f,userReferral:V,payMode:S});case 30:I=e.sent,R.push(I),2===S&&w&&(D=Number((.001*L.price).toFixed(0)),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:D}))),R.push(O.SystemProgram.transfer({fromPubkey:a,toPubkey:new O.PublicKey(h[b]),lamports:v<1e3?1e3:Number(v.toFixed(0))})),z=new O.TransactionMessage({payerKey:a,recentBlockhash:d[k].blockhash,instructions:R}).compileToLegacyMessage(),q=new O.VersionedTransaction(z),(0,E.hU)(q),j.push({instructions:R,transaction:q,transactionBase64:"",nft:L,tipFee:v,referral:w}),k=(k+1)%i.length,b=(b+1)%h.length,Ke(m);case 41:e.next=15;break;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(13),F.e(e.t0);case 48:return e.prev=48,F.f(),e.finish(48);case 51:return $=j.map((function(e){return e.transaction})),e.next=54,u($);case 54:return e.sent.forEach((function(e,t){j[t].transaction=e,j[t].transactionBase64=Se.from(e.serialize()).toString("base64")})),e.abrupt("return",j);case 57:case"end":return e.stop()}}),e,null,[[13,45,48,51]])})));return function(t){return e.apply(this,arguments)}}(),[]),Ut=(0,n.useCallback)((function(e,t,r,n,a,s){var c,u,l=0,o=t.projectId,i=t.splitCount,d=n.tokenSymbol,f=n.nextRoundLocalFormat,p=r.length,h=a.length,v=e.toString(),m=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),x=r[0].referral;r.forEach((function(e){l+=e.nft.price}));for(var b=s.includes(v)?(0,M.uf)(l/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*l/O.LAMPORTS_PER_SOL,8,"SOL"),k=F()().format("YYYY-MM-DDTHH:mm:ss"),j=Math.ceil(r.length/i),y=1,S=function(){var e=0,a=[],c=r.splice(0,j),u=c.length;c.forEach((function(t){a.push(t.nft.nftId),e+=t.nft.price}));var l=s.includes(v)?(0,M.uf)(e/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*e/O.LAMPORTS_PER_SOL,8,"SOL");a.sort((function(e,t){return e-t}));var p={projectId:o,instruction:"buy",totalTxCount:u,totalAmount:l,totalNonceCount:h,tipFee:m,referral:x,tokenSymbol:d,from:v,startNftId:a[0],endNftId:a[a.length-1],nftIds:a,nextRoundLocalFormat:f,formData:t,currentProjectDataSource:n,transactions:c},b=JSON.stringify(p,null,2),S="data:,".concat(b),g=document.createElement("a");g.href=S,g.download=1===i||1===j?"".concat(d,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_").concat(k,"_buy.json"):"".concat(d,"_").concat(o.slice(0,4),"_").concat(o.slice(-4),"_").concat(u,"_part").concat(y++,"_").concat(k,"_buy.json"),g.click()};r.length;)S();null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",p),pt(void 0),D.success("创建完成")}),[]),Gt=(0,n.useCallback)((function(e,t,r,n,a,s){var c,u,l=0,o=t.projectId,i=n.tokenSymbol,d=n.nextRoundLocalFormat,f=r.length,p=a.length,h=e.toString(),v=(0,M.uf)(r[0].tipFee/O.LAMPORTS_PER_SOL,8,"SOL"),m=r[0].referral,x=[];r.forEach((function(e){x.push(e.nft.nftId),l+=e.nft.price}));var b=s.includes(h)?(0,M.uf)(l/O.LAMPORTS_PER_SOL,8,"SOL"):(0,M.uf)(1.001*l/O.LAMPORTS_PER_SOL,8,"SOL");x.sort((function(e,t){return e-t}));var k={projectId:o,instruction:"buy",totalTxCount:f,totalAmount:b,totalNonceCount:p,tipFee:v,referral:m,tokenSymbol:i,from:h,startNftId:x[0],endNftId:x[x.length-1],nftIds:x,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:n,transactions:r};null===(c=q.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=q.current)||void 0===u||u.setFieldValue("totalTxCount",f),g.current.handleReset(),g.current.handleTransactionFileContent(k),pt(k),D.success("开始成功")}),[]),Jt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s,c,u;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=null===(t=q.current)||void 0===t?void 0:t.getFieldsValue(),W&&B&&H&&G&&K&&_e){e.next=5;break}return D.error(N),e.abrupt("return",!0);case 5:if("OKX Wallet"!==W.adapter.name){e.next=8;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 8:return e.next=10,Kt(U,B,r,Ze);case 10:return n=e.sent,a=n.nonceAccounts,s=n.nonceAccountsData,c=n.nftsDataSource,e.next=16,Wt({connection:U,wallet:W,payer:B,anchorWallet:G,signMessage:K,signAllTransactions:H,nftsDataSource:c,formData:r,nonceAccounts:a,nonceAccountsData:s,currentProjectDataSource:_e,tipAccounts:kt,tipFee:X});case 16:if((u=e.sent).length){e.next=20;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 20:Gt(B,r,u,_e,a,jt),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),Ke(0),(0,M.Tv)(e.t0,D,"handleFinishRun");case 27:case"end":return e.stop()}}),e,null,[[0,23]])}))),[X,B,W,H,G,K,_e,Ze,U,kt,jt]),Qt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s,c,u,l;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=q.current)||void 0===t?void 0:t.validateFields();case 2:if(e.prev=2,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),W&&B&&H&&G&&K&&_e){e.next=7;break}return D.error(N),e.abrupt("return",!0);case 7:if("OKX Wallet"!==W.adapter.name){e.next=10;break}return D.error("不支持OKX Wallet"),e.abrupt("return",!0);case 10:return e.next=12,Kt(U,B,n,Ze);case 12:return a=e.sent,s=a.nonceAccounts,c=a.nonceAccountsData,u=a.nftsDataSource,e.next=18,Wt({connection:U,wallet:W,payer:B,anchorWallet:G,signMessage:K,signAllTransactions:H,nftsDataSource:u,formData:n,nonceAccounts:s,nonceAccountsData:c,currentProjectDataSource:_e,tipAccounts:kt,tipFee:X});case 18:if((l=e.sent).length){e.next=22;break}return D.info("没有需要创建的内容"),e.abrupt("return",!0);case 22:Ut(B,n,l,_e,s,jt),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(2),Ke(0),(0,M.Tv)(e.t0,D,"handleFinishCreate");case 29:case"end":return e.stop()}}),e,null,[[2,25]])}))),[X,B,W,H,G,K,_e,Ze,U,kt,jt]),Xt=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,se()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*O.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*O.LAMPORTS_PER_SOL)<1e3?1e3:s),ee(s),ge(a)}),[]),er=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,i,d,f,h,v,m,x,b,k,j,y,S,g;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Me(!0),a={},e.next=5,(0,A.HF)();case 5:return s=e.sent,c=function(e){return(0,M.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,M.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,l={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},i=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),m=c(a["99th"]),x=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),l["25th"]={sol:i,usd:x},l["50th"]={sol:d,usd:b},l["50th_ema"]={sol:f,usd:k},l["75th"]={sol:h,usd:j},l["95th"]={sol:v,usd:y},l["99th"]={sol:m,usd:S},(g=[]).push({value:"25th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"25%"}),(0,o.jsx)("div",{children:c(a["25th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["25th"])})})]})}),g.push({value:"50th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"50%"}),(0,o.jsx)("div",{children:c(a["50th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["50th"])})})]})}),g.push({value:"50th_ema",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"50% EMA"}),(0,o.jsx)("div",{children:c(a["50th_ema"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["50th_ema"])})})]})}),g.push({value:"75th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"75%"}),(0,o.jsx)("div",{children:c(a["75th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["75th"])})})]})}),g.push({value:"95th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"95%"}),(0,o.jsx)("div",{children:c(a["95th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["95th"])})})]})}),g.push({value:"99th",label:(0,o.jsxs)("div",{className:"grid grid-cols-3",children:[(0,o.jsx)("div",{children:"99%"}),(0,o.jsx)("div",{children:c(a["99th"])}),(0,o.jsx)("div",{className:"justify-items-end",children:(0,o.jsx)("div",{children:u(a["99th"])})})]})}),Nt(a),Pt(g),Me(!1),null===(n=q.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),Xt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),Me(!1),(0,M.Tv)(e.t0,D,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),tr=(0,n.useCallback)((function(e,t){var r,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=Ht(a,e);return Xt(u,s,c,t),Et(u.length),u.length}),[]),rr=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e})})})),Ot(n)}),[]),nr=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,o.jsxs)("div",{className:"grid grid-cols-2",children:[(0,o.jsxs)("div",{children:["#",e.nftId]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),It(t)}),[]),ar=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=q.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;7===c||8===c?(Je(!0),rr(e)):(Je(!1),Ot([]),null===(a=q.current)||void 0===a||a.setFieldValue("accounts",void 0));9===c?(tt(!0),nr(e)):(tt(!1),It([]),null===(s=q.current)||void 0===s||s.setFieldValue("nftIds",void 0));tr(e,t),null===(n=q.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),sr=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,o,i,d,f;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Fe(!0),c=null===(s=q.current)||void 0===s?void 0:s.getFieldsValue(),u=c.projectId,qt(),l=t.find((function(e){return e.mintPubkey===u})),e.next=7,(0,A.D3)(u,l);case 7:return o=e.sent,i=o.currentProjectNftsDataSource,d=[],d=n&&r?i.filter((function(e){return e.ownerPubkey!==r.toString()})):i,e.next=13,er(d,a);case 13:f=e.sent,tr(d,f.levels),De(d),Ve(l),Fe(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),Fe(!1),(0,M.Tv)(e.t0,D,"handleCurrentProjectNfts");case 24:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),cr=(0,n.useCallback)((function(e,t){var r,n,a=tr(e,t);a?null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),ur=(0,n.useCallback)((function(e,t){var r,n,a=tr(e,t);a?null===(r=q.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=q.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),lr=(0,n.useCallback)((function(e,t){var r,n=null===(r=q.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;Xt(e,a,s,t)}),[]),or=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=q.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=q.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),Xt(e,.1,a,t)}else if(2===a)er(e,r);else if(3===a){var c,u="0.000001";null===(c=q.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),Xt(e,u,a,t)}st(a)}),[]),ir=(0,n.useCallback)((function(e){e.projectId&&sr(bt,B,lt,ae),e.buyMode&&ar(Ze,Ft),e.nftIds&&cr(Ze,Ft),e.accounts&&ur(Ze,Ft),e.tipMode&&or(Ze,Ft,ae),e.tipFeeCreate&&lr(qe,Ft)}),[bt,Ze,Dt,qe,Ft,ae,lt,B]),dr=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(!(e.initNftSupply>r||n>0)){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(he.C,{className:"mr-2",size:"default",src:a}),(0,o.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),xt(t)}),[]),fr=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Fe(!0),e.next=4,(0,A.yC)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,M.o8)();case 9:a=e.sent,dr(n),me(a),L(b.N.setProjectsV2(r)),L(b.N.setProjectsDataSourceV2(n)),Fe(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),Fe(!1),(0,M.Tv)(e.t0,D,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]),pr=(0,n.useCallback)((function(e){var t=e.target.checked;ot(t),Yt()}),[]),hr=(0,n.useCallback)((function(){ft?ye()(JSON.stringify(ft,null,2))?D.success("复制成功"):D.error("复制失败"):D.info("先运行，再进行复制")}),[ft]);return(0,n.useEffect)((function(){fr()}),[]),(0,o.jsxs)(te.Z,{title:(0,o.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,o.jsxs)(le.A,{formRef:q,onFinish:Jt,onValuesChange:ir,onReset:Yt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:"50th_ema",payMode:1,tipMode:2,splitCount:1},submitter:{searchConfig:{submitText:"运行"},render:function(e,t){return[t[1],(0,o.jsx)(P.ZP,{onClick:Qt,children:"创建"},"create"),(0,o.jsx)(P.ZP,{onClick:hr,children:"复制"},"copy"),t[0],(0,o.jsx)("div",{children:He||""},"sign")]}},children:[(0,o.jsx)(oe.Z,{name:"projectId",label:(0,o.jsxs)("div",{children:["项目",(0,o.jsx)(ce.Z,{spin:Ce,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:fr})]}),options:mt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(he.C,{className:"mr-2",size:"default",src:n}),(0,M.Mn)()?(0,o.jsx)("div",{children:"".concat(r)}):(0,o.jsx)("div",{children:"".concat(r," - ").concat((0,M.LH)(t))})]}),(0,o.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,o.jsx)(oe.Z,{name:"buyMode",label:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("div",{children:"购买方式"}),(0,o.jsx)(ke.Z,{checked:lt,onChange:pr,className:"ml-4",children:"不含本账号图片"})]}),options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 不抢拆分(随机)"},{value:7,label:"7 指定账号(顺序)"},{value:8,label:"8 指定账号(随机)"},{value:9,label:"9 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(t=q.current)&&void 0!==t&&t.getFieldValue("projectId"))}}),!!Ge&&(0,o.jsx)(oe.Z,{name:"accounts",label:"选择账号",options:Mt,fieldProps:{mode:"multiple",disabled:!(null!==(r=q.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),!!et&&(0,o.jsx)(oe.Z,{name:"nftIds",label:"选择序号",options:Vt,fieldProps:{mode:"multiple",disabled:!(null!==(a=q.current)&&void 0!==a&&a.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}]}),(0,o.jsx)(ie.Z,{name:"buyCount",label:(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:"购买数量 "}),(0,o.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=q.current)||void 0===e||e.setFieldValue("buyCount",Dt),null===(t=q.current)||void 0===t||t.validateFields(["buyCount"])},children:Dt?"(".concat(Dt,")"):""})]}),placeholder:"",min:1,max:Dt,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=q.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"startNumber",label:(0,o.jsxs)("div",{children:["开始序号#",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=q.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"endNumber",label:(0,o.jsxs)("div",{children:["结束序号#",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(l=q.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),(0,o.jsx)(oe.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(i=q.current)&&void 0!==i&&i.getFieldValue("projectId"))}}),1===at?(0,o.jsx)(de.Z,{name:"tipFeeCreate",label:$t,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(d=q.current)&&void 0!==d&&d.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.*$/}],help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,2===at?(0,o.jsx)(oe.Z,{name:"tipFeeCreate",label:(0,o.jsxs)("div",{children:["每张图GAS费用",(0,o.jsx)(ce.Z,{spin:Re,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return er(Ze,ae)}})]}),options:gt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(f=q.current)&&void 0!==f&&f.getFieldValue("projectId"))},help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,3===at?(0,o.jsx)(fe.Z,{name:"tipFeeCreate",label:$t,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1,disabled:!(null!==(h=q.current)&&void 0!==h&&h.getFieldValue("projectId"))},help:(0,o.jsx)("div",{className:"text-red-600 mb-5",children:Bt})}):null,(0,o.jsx)(oe.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(C),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(m=q.current)&&void 0!==m&&m.getFieldValue("projectId"))}}),(0,o.jsx)(ie.Z,{name:"splitCount",label:(0,o.jsxs)("div",{children:["拆分文件数量",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(C),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,o.jsx)(fe.Z,{name:"totalAmountCreate",label:(0,o.jsxs)("div",{children:["交易总金额",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(k=q.current)&&void 0!==k&&k.getFieldValue("projectId"))}}),(0,o.jsx)(fe.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(j=q.current)&&void 0!==j&&j.getFieldValue("projectId"))}})]}),z]})},Pe=(0,n.memo)(ge),we=r(91604),Ce=r(52688),Fe=r(66309),Ne=r(9669),Le=r.n(Ne),Re=[],Me=function(){var e=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),t=S.ZP.useMessage(),r=s()(t,2),a=r[0],c=r[1],u=(0,n.useRef)(),l=(0,n.useRef)(),i=(0,n.useState)([]),f=s()(i,2),h=f[0],m=f[1],x=(0,n.useState)(),b=s()(x,2),k=b[0],j=b[1],g=(0,n.useState)(0),w=s()(g,2),C=w[0],N=w[1],L=(0,n.useState)(0),O=s()(L,2),T=O[0],_=O[1],V=(0,n.useState)(0),I=s()(V,2),Z=I[0],D=I[1],E=(0,n.useState)(0),z=s()(E,2),q=z[0],Y=z[1],$=(0,n.useState)(0),B=s()($,2),H=B[0],K=B[1],W=(0,n.useState)(0),U=s()(W,2),G=U[0],J=U[1],Q=(0,n.useState)(!1),X=s()(Q,2),ee=X[0],re=X[1],ne=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),ae=(0,n.useRef)(!0),se=(0,n.useRef)({}),ce=(0,n.useState)({}),oe=s()(ce,2),de=oe[0],pe=oe[1],he=(0,n.useMemo)((function(){return k?"(".concat(k.tokenSymbol," ").concat(k.projectId.slice(0,4),"...").concat(k.projectId.slice(-4),")"):""}),[k]),me=(0,n.useMemo)((function(){return k?"".concat(null==k?void 0:k.currentProjectDataSource.nextRoundLocalFormat):""}),[k]),xe=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=u.current)||void 0===r||r.resetFields(a),e){var s,c,l=e.currentProjectDataSource.lastRoundLocalValue,o=e.currentProjectDataSource.secPerRound,i=e.totalAmount,d=e.tipFee;N(l+1e3*o),j(e),null===(s=u.current)||void 0===s||s.setFieldValue("totalAmountSend",i),null===(c=u.current)||void 0===c||c.setFieldValue("tipFeeSend",d);var f={};e.nftIds.forEach((function(e){se.current[e]="default",f[e]="default"})),pe(f)}else{var p,h;N(0),j(void 0),null===(p=u.current)||void 0===p||p.setFieldValue("totalAmountSend",""),null===(h=u.current)||void 0===h||h.setFieldValue("tipFeeSend",""),se.current={},pe({})}_(0),D(0),Y(0),K(0),J(0)}),[]),be=(0,n.useCallback)((function(){var e,t,r;null===(e=u.current)||void 0===e||e.resetFields(),m([]),N(0),j(void 0),null===(t=u.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=u.current)||void 0===r||r.setFieldValue("tipFeeSend",""),se.current={},pe({}),_(0),D(0),Y(0),K(0),J(0)}),[]),ke=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return m(t.fileList),xe(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(m(t.fileList),xe(e),a.success("上传成功")):a.error("指令类型错误"):a.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,a,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),je=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var a in se.current)"success"===se.current[a]?t+=1:"error"===se.current[a]?r+=1:"processing"===se.current[a]?n+=1:"default"===se.current[a]&&(e+=1);_(t),D(r),Y(n),K(e)}),[]),ye=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0;case 1:if(!(s<n)){e.next=16;break}Object.keys(se.current).forEach((function(e){se.current[e]="processing"})),je();case 4:return t.transactions.forEach(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,o;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.transactionBase64,a=t.nft.nftId,"success"!==(s=se.current[a])&&"error"!==s){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,c=r%ne.length,u=ne[c]+"/api/v1/transactions?bundleOnly=true",e.next=10,Le().post(u,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[n,{encoding:"base64",maxTry:0}]},{timeout:5e3});case 10:200===(l=e.sent).status?se.current[a]="success":(se.current[a]="error",Re.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(l),pos:"try"})),e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(o=e.t0.response)||void 0===o?void 0:o.status)){e.next=18;break}return e.abrupt("return");case 18:se.current[a]="error",Re.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(e.t0),pos:"catch"});case 20:je();case 21:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,r){return e.apply(this,arguments)}}()),e.next=8,new Promise((function(e){setTimeout(e,r)}));case 8:if(0!==Object.values(se.current).filter((function(e){return"processing"===e})).length){e.next=11;break}return e.abrupt("break",13);case 11:e.next=4;break;case 13:++s,e.next=1;break;case 16:a.success("发送完成");case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[a]),Se=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.disorderSend,n=t.intervalSend,r&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),ge=(0,n.useCallback)((function(){var e;if(!k)return a.error("请先上传交易文件"),!1;var t=(null===(e=u.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;ye(k,t,1)}),[k]),Pe=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),n=r.disorderSend,a=r.repeatSend,s=r.intervalSend,r.autoSend&&k){e.next=3;break}return e.abrupt("return");case 3:return n&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[k]),Ne=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&ae.current&&(ae.current=!1,null===(r=u.current)||void 0===r||r.submit())}),[]),Me=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,re(!0),t={},e.next=9,(0,A.tt)({mintPubkey:k.projectId});case 9:r=e.sent,n=0,k.nftIds.forEach((function(e){var a=k.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),J(n),pe(t),re(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),re(!1),(0,M.Tv)(e.t0,a,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[a,k]),Oe=(0,n.useCallback)((function(){if(k&&Re.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Re,null,2),r="data:,".concat(t),n=document.createElement("a"),s=k.tokenSymbol,c=k.projectId;n.href=r,n.download="Log_".concat(s,"_").concat(c.slice(0,4),"_").concat(c.slice(-4),"_").concat(e,".json"),n.click()}else a.info("无日志信息")}),[k]);return(0,o.jsxs)(te.Z,{title:(0,o.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,o.jsxs)(le.A,{formRef:u,onFinish:Se,onReset:be,layout:"vertical",initialValues:{disorderSend:!0,autoSend:!0,repeatSend:3,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,o.jsx)(P.ZP,{onClick:ge,children:"预检"},"preflight"),(0,o.jsx)(P.ZP,{loading:ee,onClick:Me,children:"校对"},"check"),(0,o.jsx)(P.ZP,{onClick:Oe,children:"日志"},"log"),t[0]]}},children:[(0,o.jsx)(we.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:ke,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return l.current.handleOpen(e)},fileList:h},rules:[{required:!0,whitespace:!0,message:"".concat(e),pattern:/.*/}]}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["整体重复发送次数",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!k}}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:300,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!k}}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["提前发送时间(毫秒)",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!k}}),(0,o.jsx)(Ce.Z,{name:"disorderSend",label:(0,o.jsxs)("div",{children:["是否乱序",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"是否以乱序的方式来发送交易",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,o.jsx)(Ce.Z,{name:"autoSend",label:(0,o.jsxs)("div",{children:["是否自动发送",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,o.jsx)(fe.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,o.jsx)(fe.Z,{name:"totalAmountSend",label:(0,o.jsxs)("div",{children:["总金额",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,o.jsx)(le.A.Item,{label:(0,o.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,o.jsx)("span",{className:"hardline",children:"倒计时 "}),he]}),children:(0,o.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,o.jsx)(d,{className:"text-2xl",value:C,onFinish:Pe,onChange:Ne}),(0,o.jsx)("div",{className:"text-2xl",children:me})]})}),(0,o.jsxs)(le.A.Item,{label:(0,o.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,o.jsx)("span",{children:"结果 "}),k?"(".concat(k.totalTxCount,")"):""]}),children:[(0,o.jsx)("div",{children:"完成：".concat(T,"，失败：").concat(Z,"，处理中：").concat(q,"，待处理：").concat(H)}),!!k&&(0,o.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(se.current).map((function(e,t){return(0,o.jsx)(Fe.Z,{color:se.current[e],children:"#".concat(e)},t)}))})]}),(0,o.jsxs)(le.A.Item,{label:(0,o.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:"校对 "}),k?"(".concat(k.totalTxCount,")"):"",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,o.jsx)("div",{children:"拥有：".concat(G)}),!!k&&(0,o.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(de).map((function(e,t){return(0,o.jsx)(Fe.Z,{color:de[e],children:"#".concat(e)},t)}))})]})]}),(0,o.jsx)(R.VY,{ref:l}),c]})},Oe=(0,n.memo)(Me),Te=[],_e=(0,n.forwardRef)((function(e,t){var r=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],l=c[1],i=(0,n.useRef)(),f=(0,n.useRef)(),h=(0,n.useState)([]),m=s()(h,2),x=m[0],b=m[1],k=(0,n.useState)(),j=s()(k,2),g=j[0],w=j[1],C=(0,n.useState)(0),N=s()(C,2),L=N[0],O=N[1],T=(0,n.useState)(0),_=s()(T,2),V=_[0],I=_[1],Z=(0,n.useState)(0),D=s()(Z,2),E=D[0],z=D[1],q=(0,n.useState)(0),Y=s()(q,2),$=Y[0],B=Y[1],H=(0,n.useState)(0),K=s()(H,2),W=K[0],U=K[1],G=(0,n.useState)(0),J=s()(G,2),Q=J[0],X=J[1],ee=(0,n.useState)(0),re=s()(ee,2),ne=re[0],ae=re[1],se=(0,n.useState)(!1),ce=s()(se,2),oe=ce[0],de=ce[1],pe=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),he=(0,n.useRef)(0),me=(0,n.useRef)(!0),xe=(0,n.useRef)({}),be=(0,n.useState)({}),ke=s()(be,2),je=ke[0],ye=ke[1],Se=(0,n.useMemo)((function(){return g?"(".concat(g.tokenSymbol," ").concat(g.projectId.slice(0,4),"...").concat(g.projectId.slice(-4),")"):""}),[g]),ge=(0,n.useMemo)((function(){return g?"".concat(null==g?void 0:g.currentProjectDataSource.nextRoundLocalFormat):""}),[g]),Pe=(0,n.useCallback)((function(e){var t,r,n=null===(t=i.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=i.current)||void 0===r||r.resetFields(a),e){var s,c,u=e.currentProjectDataSource.nextRoundLocalValue,l=e.totalAmount,o=e.tipFee;O(u),w(e),null===(s=i.current)||void 0===s||s.setFieldValue("totalAmountSend",l),null===(c=i.current)||void 0===c||c.setFieldValue("tipFeeSend",o);var d={};xe.current={},e.nftIds.forEach((function(e){xe.current[e]="default",d[e]="default"})),ye(d)}else{var f,p;O(0),w(void 0),null===(f=i.current)||void 0===f||f.setFieldValue("totalAmountSend",""),null===(p=i.current)||void 0===p||p.setFieldValue("tipFeeSend",""),xe.current={},ye({})}I(0),z(0),B(0),U(0),X(0),ae(0)}),[]),Ne=(0,n.useCallback)((function(){var e,t,r;null===(e=i.current)||void 0===e||e.resetFields(),b([]),O(0),w(void 0),null===(t=i.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=i.current)||void 0===r||r.setFieldValue("tipFeeSend",""),xe.current={},ye({}),I(0),z(0),B(0),U(0),X(0),ae(0)}),[]);(0,n.useImperativeHandle)(t,(function(){return{handleTransactionFileContent:Pe,handleReset:Ne}}));var Re=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return b(t.fileList),Pe(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(b(t.fileList),Pe(e),u.success("上传成功")):u.error("指令类型错误"):u.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,M.Tv)(e.t0,u,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),Me=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0,a=0;for(var s in xe.current)"success"===xe.current[s]?t+=1:"error"===xe.current[s]?r+=1:"processing"===xe.current[s]?a+=1:"default"===xe.current[s]?e+=1:"warning"===xe.current[s]&&(n+=1);I(t),z(r),B(n),U(a),X(e)}),[]),Oe=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var a,s,c,l,o,i,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:he.current=0,a=0;case 2:if(!(a<n)){e.next=24;break}Object.keys(xe.current).forEach((function(e){xe.current[e]="processing"})),Me(),s=t.totalNonceCount,c=t.totalTxCount,l=Math.ceil(c/s),o=0;case 9:if(!(o<l)){e.next=21;break}i=t.transactions.slice(o*s,(o+1)*s),d=p()().mark((function e(){var t;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.forEach(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.transactionBase64,n=t.nft.nftId,"success"!==(a=xe.current[n])&&"error"!==a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,s=he.current++%pe.length,c=pe[s]+"/api/v1/transactions?bundleOnly=true",e.next=10,Le().post(c,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[r,{encoding:"base64",maxRetries:0}]},{timeout:3e3});case 10:200===(u=e.sent).status?xe.current[n]="success":(xe.current[n]="error",Te.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(u),pos:"try"})),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(l=e.t0.response)||void 0===l?void 0:l.status)){e.next=19;break}return xe.current[n]="default",e.abrupt("return");case 19:xe.current[n]="error",Te.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(e.t0),pos:"catch"});case 21:Me();case 22:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}()),e.next=3,new Promise((function(e){setTimeout(e,r)}));case 3:if(t=0,i.forEach((function(e){var r=e.nft.nftId,n=xe.current[r];"processing"===n?(t+=1,xe.current[r]="warning"):"default"===n?xe.current[r]="processing":t+=1})),t!==i.length){e.next=7;break}return e.abrupt("return",1);case 7:case"end":return e.stop()}}),e)}));case 12:return e.delegateYield(d(),"t0",14);case 14:if(!e.t0){e.next=16;break}return e.abrupt("break",18);case 16:e.next=12;break;case 18:++o,e.next=9;break;case 21:++a,e.next=2;break;case 24:u.success("发送完成");case 25:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[u]),_e=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=3;break}return u.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.reverseOrder,n=t.intervalSend,r&&(g.transactions=g.transactions.toReversed()),Oe(g,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[g]),Ve=(0,n.useCallback)((function(){var e;if(!g)return u.error("请先上传交易文件"),!1;var t=(null===(e=i.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;Oe(g,t,1)}),[g]),Ie=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=i.current)||void 0===t?void 0:t.getFieldsValue(),n=r.reverseOrder,a=r.repeatSend,s=r.intervalSend,r.autoSend&&g){e.next=3;break}return e.abrupt("return");case 3:return n&&(g.transactions=g.transactions.toReversed()),Oe(g,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[g]),Ae=(0,n.useCallback)((function(e){var t,r,n=null===(t=i.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&me.current&&(me.current=!1,null===(r=i.current)||void 0===r||r.submit())}),[]),Ze=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g){e.next=3;break}return u.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,de(!0),t={},e.next=9,(0,A.II)({mintPubkey:g.projectId});case 9:r=e.sent,n=0,g.nftIds.forEach((function(e){var a=g.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),ae(n),ye(t),de(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),de(!1),(0,M.Tv)(e.t0,u,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[u,g]),De=(0,n.useCallback)((function(){if(g&&Te.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Te,null,2),r="data:,".concat(t),n=document.createElement("a"),a=g.tokenSymbol,s=g.projectId;n.href=r,n.download="Log_".concat(a,"_").concat(s.slice(0,4),"_").concat(s.slice(-4),"_").concat(e,".json"),n.click()}else u.info("无日志信息")}),[g]);return(0,o.jsxs)(te.Z,{title:(0,o.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,o.jsxs)(le.A,{formRef:i,onFinish:_e,onReset:Ne,layout:"vertical",initialValues:{reverseOrder:!1,autoSend:!0,repeatSend:2,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,o.jsx)(P.ZP,{loading:oe,onClick:Ze,children:"校对"},"check"),(0,o.jsx)(P.ZP,{onClick:Ve,children:"预检"},"preflight"),(0,o.jsx)(P.ZP,{onClick:De,children:"日志"},"log"),t[0]]}},children:[(0,o.jsx)(we.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:Re,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return f.current.handleOpen(e)},fileList:x},rules:[{whitespace:!0,message:"".concat(r),pattern:/.*/}]}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["整体重复发送次数",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!g}}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:100,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!g}}),(0,o.jsx)(ie.Z,{label:(0,o.jsxs)("div",{children:["提前发送时间(毫秒)",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!g}}),(0,o.jsx)(Ce.Z,{name:"reverseOrder",label:(0,o.jsxs)("div",{children:["是否倒序",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"是否以倒序的方式来发送交易",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!g}}),(0,o.jsx)(Ce.Z,{name:"autoSend",label:(0,o.jsxs)("div",{children:["是否自动发送",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(r),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!g}}),(0,o.jsx)(fe.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!g}}),(0,o.jsx)(fe.Z,{name:"totalAmountSend",label:(0,o.jsxs)("div",{children:["总金额",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!g}}),(0,o.jsx)(le.A.Item,{label:(0,o.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,o.jsx)("span",{className:"hardline",children:"倒计时 "}),Se]}),children:(0,o.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,o.jsx)(d,{className:"text-2xl",value:L,onFinish:Ie,onChange:Ae}),(0,o.jsx)("div",{className:"text-2xl",children:ge})]})}),(0,o.jsxs)(le.A.Item,{label:(0,o.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,o.jsx)("span",{children:"结果 "}),g?"(".concat(g.totalTxCount,")"):""]}),children:[(0,o.jsx)("div",{children:"完成：".concat(V,"，失败：").concat(E,"，超时：").concat($,"，处理中：").concat(W,"，待处理：").concat(Q)}),!!g&&(0,o.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(xe.current).map((function(e,t){return(0,o.jsx)(Fe.Z,{color:xe.current[e],children:"#".concat(e)},t)}))})]}),(0,o.jsxs)(le.A.Item,{label:(0,o.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:"校对 "}),g?"(".concat(g.totalTxCount,")"):"",(0,o.jsx)(ve.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,o.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,o.jsx)("div",{children:"拥有：".concat(ne)}),!!g&&(0,o.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(je).map((function(e,t){return(0,o.jsx)(Fe.Z,{color:je[e],children:"#".concat(e)},t)}))})]})]}),(0,o.jsx)(R.VY,{ref:f}),l]})})),Ve=(0,n.memo)(_e)}}]);