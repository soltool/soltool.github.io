"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[262],{54159:function(e,t,n){n.r(t),n.d(t,{default:function(){return N}});var r=n(15009),a=n.n(r),o=n(99289),s=n.n(o),c=n(5574),u=n.n(c),i=n(90930),l=n(64350),m=n(88026),d=n(67294),h=n(94036),p=n(2453),f=n(16568),g=n(42075),k=n(83622),y=n(54306),b=n(44718),x=n(93233),P=n(70606),v=n(64119),S=n(37476),A=n(5966),w=n(70609),C=n(85893),M=d.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,o=p.ZP.useMessage(),c=u()(o,2),i=c[0],l=c[1],h=(0,b.R)().connection,f=(0,y.O)(),g=f.publicKey,k=f.signTransaction,P=(0,m.useSelector)((function(e){return e.wallet.chain})),M=(0,m.useIntl)(),T=M.formatMessage({id:"common.intlInputException"}),N=M.formatMessage({id:"common.intlTxSuccess"}),I=M.formatMessage({id:"common.intlPleaseConnectWallet"}),j=M.formatMessage({id:"common.intlCreateAccount"}),B=M.formatMessage({id:"common.intlQuantity"}),V=(0,d.useRef)(),K=(0,d.useState)(!1),R=u()(K,2),H=R[0],O=R[1],E=(0,d.useCallback)((function(){O(!0)}),[]);(0,d.useImperativeHandle)(t,(function(){return{handleOpen:E}}));var U=(0,d.useCallback)(function(){var e=s()(a()().mark((function e(t){var o,s,c,u,l,m,d,p,f,y,b,S,A,M,T,j,B,V,K,R;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g&&k){e.next=2;break}return e.abrupt("return",i.error(I));case 2:return e.prev=2,o=g,s=Number(t.count),e.next=7,h.getMinimumBalanceForRentExemption(x.NONCE_ACCOUNT_LENGTH);case 7:return c=e.sent,u="#####NonceCountAccount#####",e.next=11,x.PublicKey.createWithSeed(o,u,x.SystemProgram.programId);case 11:return l=e.sent,e.next=14,h.getAccountInfo(l);case 14:m=e.sent,d=[],f=(p=1)+s,m?(p=Math.floor(m.lamports/1e6)+1,f=p+s,d.push(x.SystemProgram.transfer({fromPubkey:o,toPubkey:l,lamports:1e6*s}))):(f=(p=1)+s,d.push(x.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:l,basePubkey:o,seed:u,lamports:1e6*s,space:0,programId:x.SystemProgram.programId}))),y=p;case 20:if(!(y<f)){e.next=30;break}return b="#####NonceAccount".concat(y,"#####"),e.next=24,x.PublicKey.createWithSeed(o,b,x.SystemProgram.programId);case 24:S=e.sent,d.push(x.SystemProgram.createAccountWithSeed({fromPubkey:o,newAccountPubkey:S,basePubkey:o,seed:b,lamports:c,space:x.NONCE_ACCOUNT_LENGTH,programId:x.SystemProgram.programId})),d.push(x.SystemProgram.nonceInitialize({noncePubkey:S,authorizedPubkey:o}));case 27:++y,e.next=20;break;case 30:return e.next=32,h.getLatestBlockhash();case 32:return A=e.sent,M=A.blockhash,T=A.lastValidBlockHeight,j=new x.TransactionMessage({payerKey:o,recentBlockhash:M,instructions:d}).compileToLegacyMessage(),B=new x.VersionedTransaction(j),e.next=39,k(B);case 39:return V=e.sent,e.next=42,h.sendTransaction(V);case 42:return K=e.sent,e.next=45,h.confirmTransaction({signature:K,blockhash:M,lastValidBlockHeight:T},"confirmed");case 45:return(R=e.sent).value.err?(console.log(R.value.err),i.error("".concat(R.value.err))):(n.success({message:N,description:(0,C.jsx)(w.VU,{type:"tx",content:K,chain:P}),placement:"top",showProgress:!0}),r(o,h),O(!1)),e.abrupt("return",!0);case 50:e.prev=50,e.t0=e.catch(2),(0,v.Tv)(e.t0,i,"handleFinish");case 53:case"end":return e.stop()}}),e,null,[[2,50]])})));return function(t){return e.apply(this,arguments)}}(),[g,k,h,P,n]);return(0,C.jsxs)(S.Y,{formRef:V,title:j,open:H,onFinish:U,onOpenChange:function(e){O(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,C.jsx)(A.Z,{name:"count",label:B,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(T),pattern:/^[1-9]\d*$/}]}),l]})})),T=(0,d.memo)(M),N=function(){var e=(0,m.useDispatch)(),t=(0,d.useState)(!1),n=u()(t,2),r=n[0],o=n[1],c=p.ZP.useMessage(),S=u()(c,2),A=S[0],M=S[1],N=f.ZP.useNotification(),I=u()(N,2),j=I[0],B=I[1],V=(0,m.useSelector)((function(e){return e.nonce.dataSource})),K=(0,m.useSelector)((function(e){return e.nonce.totalCount})),R=(0,m.useSelector)((function(e){return e.nonce.nonceCountAccount})),H=(0,m.useSelector)((function(e){return e.wallet.chain})),O=(0,d.useState)([]),E=u()(O,2),U=E[0],W=E[1],Z=(0,y.O)(),z=Z.publicKey,L=Z.signTransaction,D=(0,b.R)().connection,F=(0,d.useRef)(),_=(0,m.useIntl)(),G=_.formatMessage({id:"common.intlPleaseConnectWallet"}),q=_.formatMessage({id:"common.intlTxSuccess"}),Q=_.formatMessage({id:"common.intlAuthorityAddress"}),Y=_.formatMessage({id:"common.intlNonceAddress"}),$=_.formatMessage({id:"common.intlBlockHash"}),J=_.formatMessage({id:"common.intlDelFromBackToFront"}),X=_.formatMessage({id:"common.intlCreateAccount"}),ee=_.formatMessage({id:"common.intlBatchDelete"}),te=_.formatMessage({id:"common.intlUpdateNonce"}),ne=_.formatMessage({id:"common.intlStatus"}),re=(0,d.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,C.jsx)("span",{children:n+1})}},{title:"".concat(Y),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,C.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.nonceAccount.toString()})}},{title:"".concat(Q),dataIndex:"authority",key:"authority",render:function(e,t){return(0,C.jsx)(P.k,{ellipsis:!0,copyable:!0,address:t.authority.toString()})}},{title:"".concat(ne),dataIndex:"status",key:"status",render:function(e,t){return(0,C.jsx)("span",{children:t.status})}},{title:"".concat($),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,C.jsx)(P.k,{copyable:!0,address:t.blockhash})}}]}),[]),ae=(0,d.useCallback)(function(){var t=s()(a()().mark((function t(n,r){var s,c,u,i,l,m,d,p;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o(!0),"#####NonceCountAccount#####",t.next=5,x.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",x.SystemProgram.programId);case 5:return s=t.sent,t.next=8,r.getAccountInfo(s);case 8:if(c=t.sent,u=[],i=[],l=0,!c){t.next=30;break}l=Math.floor(c.lamports/1e6),m=0;case 15:if(!(m<l)){t.next=25;break}return d="#####NonceAccount".concat(m+1,"#####"),t.next=20,x.PublicKey.createWithSeed(n,d,x.SystemProgram.programId);case 20:p=t.sent,i.push(p);case 22:++m,t.next=15;break;case 25:if(!i.length){t.next=30;break}return t.next=28,r.getMultipleParsedAccounts(i);case 28:t.sent.value.forEach((function(e,t){u.push({key:t,nonceAccount:i[t],authority:new x.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 30:o(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCount(l)),e(h.N.setNonceCountAccount(s)),t.next=40;break;case 36:t.prev=36,t.t0=t.catch(0),o(!1),(0,v.Tv)(t.t0,A,"handleUpdateNonceAccount");case 40:case"end":return t.stop()}}),t,null,[[0,36]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),oe=(0,d.useCallback)(s()(a()().mark((function e(){var t,n,r,s,c,u,i,l,m,d,h,p,f,g,k,y,b,P,S;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z&&L){e.next=2;break}return e.abrupt("return",A.error(G));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,t=z,n=U.toSorted().reverse(),r=V.toReversed(),s=[R],c="#####NonceCountAccount#####",u=0;case 11:if(!(u<n.length)){e.next=18;break}if(n[u]===r[u].key){e.next=14;break}return e.abrupt("return",A.error("".concat(J)));case 14:s.push(r[u].nonceAccount);case 15:++u,e.next=11;break;case 18:return i=[],e.next=21,D.getMultipleParsedAccounts(s);case 21:for(l=e.sent,m=1;m<l.value.length;++m)d=l.value[m].lamports,i.push(x.SystemProgram.nonceWithdraw({noncePubkey:r[m-1].nonceAccount,authorizedPubkey:r[m-1].authority,toPubkey:r[m-1].authority,lamports:d}));return r.length===n.length?(h=l.value[0].lamports,i.push(x.SystemProgram.transfer({fromPubkey:R,basePubkey:t,toPubkey:t,lamports:h,seed:c,programId:x.SystemProgram.programId}))):i.push(x.SystemProgram.transfer({fromPubkey:R,basePubkey:t,toPubkey:t,lamports:1e6*n.length,seed:c,programId:x.SystemProgram.programId})),e.next=26,D.getLatestBlockhash();case 26:return p=e.sent,f=p.blockhash,g=p.lastValidBlockHeight,k=new x.TransactionMessage({payerKey:t,recentBlockhash:f,instructions:i}).compileToLegacyMessage(),y=new x.VersionedTransaction(k),e.next=33,L(y);case 33:return b=e.sent,e.next=36,D.sendTransaction(b);case 36:return P=e.sent,e.next=39,D.confirmTransaction({signature:P,blockhash:f,lastValidBlockHeight:g},"confirmed");case 39:(S=e.sent).value.err?(console.log(S.value.err),A.error("".concat(S.value.err))):(j.success({message:q,description:(0,C.jsx)(w.VU,{type:"tx",content:P,chain:H}),placement:"top",showProgress:!0}),ae(t,D)),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(4),o(!1),(0,v.Tv)(e.t0,A,"handleBatchDelete");case 47:case"end":return e.stop()}}),e,null,[[4,43]])}))),[U,z,L,V,R,D,H]),se=(0,d.useCallback)(s()(a()().mark((function e(){var t,n,r,o,s,c,u,i,l,m;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z&&L){e.next=2;break}return e.abrupt("return",A.error(G));case 2:if(U.length){e.next=4;break}return e.abrupt("return");case 4:return t=z,n=[],U.forEach((function(e){var t=V[e].nonceAccount,r=V[e].authority;n.push(x.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),e.next=9,D.getLatestBlockhash();case 9:return r=e.sent,o=r.blockhash,s=r.lastValidBlockHeight,c=new x.TransactionMessage({payerKey:t,recentBlockhash:o,instructions:n}).compileToLegacyMessage(),u=new x.VersionedTransaction(c),e.next=16,L(u);case 16:return i=e.sent,e.next=19,D.sendTransaction(i);case 19:return l=e.sent,e.next=22,D.confirmTransaction({signature:l,blockhash:o,lastValidBlockHeight:s},"confirmed");case 22:(m=e.sent).value.err?(console.log(m.value.err),A.error("".concat(m.value.err))):(j.success({message:q,description:(0,C.jsx)(w.VU,{type:"tx",content:l,chain:H}),placement:"top",showProgress:!0}),ae(t,D));case 24:case"end":return e.stop()}}),e)}))),[U,z,L,V,D,H]);return(0,d.useEffect)((function(){z&&D&&ae(z,D)}),[z,D]),(0,C.jsxs)(i._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,C.jsx)(l.Z,{scroll:{x:!0},size:"small",columns:re,dataSource:V,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,C.jsx)("div",{children:(0,C.jsxs)(g.Z,{wrap:!0,className:"mb-[16px]",children:[(0,C.jsx)(k.ZP,{type:"primary",onClick:function(){return F.current.handleOpen()},children:X}),(0,C.jsx)(k.ZP,{type:"primary",onClick:function(){return oe()},children:ee}),(0,C.jsx)(k.ZP,{type:"primary",onClick:function(){return se()},children:te}),(0,C.jsx)("div",{children:K})]})}),rowSelection:{type:"checkbox",selectedRowKeys:U,onChange:function(e){W(e)}}}),(0,C.jsx)(T,{ref:F,notificationApi:j,handleUpdateNonceAccount:ae}),M,B]})}}}]);