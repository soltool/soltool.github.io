"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5666],{62741:function(e,t,n){n.d(t,{l:function(){return S}});var r=n(15009),a=n.n(r),s=n(64599),c=n.n(s),o=n(99289),u=n.n(o),i=n(5574),l=n.n(i),d=n(64119),m=n(13451),f=n(5966),p=n(44718),h=n(54306),k=n(29363),b=n(88026),g=n(2453),x=n(67294),y=n(49717),P=n(71874),v=n(85893),A=x.forwardRef((function(e,t){var n=e.notificationApi,r=e.handleUpdateNonceAccount,s=g.ZP.useMessage(),o=l()(s,2),i=o[0],A=o[1],S=(0,p.R)().connection,C=(0,h.O)(),N=C.publicKey,w=C.signAllTransactions,I=C.wallet,M=(0,y.A)(),T=M.chain,j=M.modalFeeRef,R=(0,b.useIntl)(),B=R.formatMessage({id:"common.intlInputException"}),H=R.formatMessage({id:"common.intlPleaseConnectWallet"}),V=R.formatMessage({id:"common.intlCreateAccount"}),O=R.formatMessage({id:"common.intlQuantity"}),Z=(0,x.useRef)(),W=(0,x.useState)(!1),z=l()(W,2),E=z[0],F=z[1],U=(0,x.useCallback)((function(){F(!0)}),[]);(0,x.useImperativeHandle)(t,(function(){return{handleOpen:U}}));var K=(0,x.useCallback)(function(){var e=u()(a()().mark((function e(t){var s,o,u,l,m,f,p,h,b,g,x,y,v,A,C,M,R,B,V,O,Z,W,z,E,U,K,D,L,G,_;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N&&w&&I){e.next=3;break}return i.error(H),e.abrupt("return",!0);case 3:return s=N,e.prev=4,o=Number(t.count),e.next=8,S.getMinimumBalanceForRentExemption(k.NONCE_ACCOUNT_LENGTH);case 8:return u=e.sent,l="#####NonceCountAccount#####",e.next=12,k.PublicKey.createWithSeed(s,l,k.SystemProgram.programId);case 12:return m=e.sent,e.next=15,S.getAccountInfo(m);case 15:f=e.sent,p=[],h=[],g=(b=1)+o,f?(b=(0,P.sT)(f.lamports)+1,g=b+o):(g=(b=1)+o,0,890880,(x=[]).push(k.SystemProgram.createAccountWithSeed({fromPubkey:s,newAccountPubkey:m,basePubkey:s,seed:l,lamports:890880,space:0,programId:k.SystemProgram.programId})),h.push(x)),y=0,v=4,A=b;case 24:if(!(A<g)){e.next=36;break}return C="#####NonceAccount".concat(A,"#####"),e.next=28,k.PublicKey.createWithSeed(s,C,k.SystemProgram.programId);case 28:M=e.sent,p.push(k.SystemProgram.createAccountWithSeed({fromPubkey:s,newAccountPubkey:M,basePubkey:s,seed:C,lamports:u,space:k.NONCE_ACCOUNT_LENGTH,programId:k.SystemProgram.programId})),p.push(k.SystemProgram.nonceInitialize({noncePubkey:M,authorizedPubkey:s})),(y+=1)%v!=0&&y+b!==g||(B=0===(R=y%v)?v:R,p.push(k.SystemProgram.transfer({fromPubkey:s,toPubkey:m,lamports:B})),h.push(p),p=[]);case 33:++A,e.next=24;break;case 36:if(!h.length){e.next=74;break}return e.next=39,S.getLatestBlockhash();case 39:return V=e.sent,O=V.blockhash,Z=V.lastValidBlockHeight,W=new Array(h.length).fill(O),e.next=45,(0,P.Gw)(S,I,W,h,w,j);case 45:z=e.sent,E=z.transactions,U=z.feeMode,K=c()(E),e.prev=49,K.s();case 51:if((D=K.n()).done){e.next=64;break}return L=D.value,e.next=55,(0,P.pR)(S,I,L,U);case 55:return G=e.sent,_={signature:G,blockhash:O,lastValidBlockHeight:Z},e.next=59,(0,P.fS)(T,S,_,"confirmed",n,i);case 59:if(e.sent){e.next=62;break}return e.abrupt("break",64);case 62:e.next=51;break;case 64:e.next=69;break;case 66:e.prev=66,e.t0=e.catch(49),K.e(e.t0);case 69:return e.prev=69,K.f(),e.finish(69);case 72:r(s,S),F(!1);case 74:return e.abrupt("return",!0);case 77:return e.prev=77,e.t1=e.catch(4),r(s,S),(0,d.Tv)(e.t1,i,"handleFinish"),e.abrupt("return",!0);case 82:case"end":return e.stop()}}),e,null,[[4,77],[49,66,69,72]])})));return function(t){return e.apply(this,arguments)}}(),[N,S,T,n,I,j]);return(0,v.jsxs)(m.Y,{formRef:Z,title:V,open:E,onFinish:K,onOpenChange:function(e){F(e)},layout:"vertical",width:"400px",initialValues:{count:1},submitter:{render:function(e,t){return[t[0],t[1]]}},children:[(0,v.jsx)(f.Z,{name:"count",label:O,placeholder:"",fieldProps:{size:"large",autoFocus:!1},rules:[{required:!0,whitespace:!0,message:"".concat(B),pattern:/^[1-9]\d*$/}]}),A]})})),S=(0,x.memo)(A)},12038:function(e,t,n){n.r(t);var r=n(64599),a=n.n(r),s=n(15009),c=n.n(s),o=n(99289),u=n.n(o),i=n(5574),l=n.n(i),d=(n(8849),n(39380)),m=n(32427),f=n(88026),p=n(67294),h=n(94036),k=n(2453),b=n(16568),g=n(78957),x=n(83622),y=n(54306),P=n(44718),v=n(29363),A=n(39678),S=n(62741),C=n(64119),N=n(9437),w=n(71874),I=n(85893);t.default=function(){var e=(0,f.useDispatch)(),t=(0,p.useState)(!1),n=l()(t,2),r=n[0],s=n[1],o=k.ZP.useMessage(),i=l()(o,2),M=i[0],T=i[1],j=b.ZP.useNotification(),R=l()(j,2),B=R[0],H=R[1],V=(0,f.useSelector)((function(e){return e.nonce.dataSource})),O=(0,f.useSelector)((function(e){return e.nonce.totalCountCreate})),Z=(0,f.useSelector)((function(e){return e.nonce.totalCountRecord})),W=(0,f.useSelector)((function(e){return e.nonce.nonceCountAccount})),z=(0,N.Ab)(),E=z.chain,F=z.modalFeeRef,U=(0,p.useState)([]),K=l()(U,2),D=K[0],L=K[1],G=(0,y.O)(),_=G.publicKey,J=G.signTransaction,q=G.signAllTransactions,Q=G.wallet,Y=(0,P.R)().connection,$=(0,p.useRef)(),X=(0,f.useIntl)(),ee=X.formatMessage({id:"common.intlPleaseConnectWallet"}),te=X.formatMessage({id:"common.intlAuthorityAddress"}),ne=X.formatMessage({id:"common.intlNonceAddress"}),re=X.formatMessage({id:"common.intlBlockHash"}),ae=X.formatMessage({id:"common.intlDelFromBackToFront"}),se=X.formatMessage({id:"common.intlCreateAccount"}),ce=X.formatMessage({id:"common.intlBatchDelete"}),oe=X.formatMessage({id:"common.intlUpdateNonce"}),ue=X.formatMessage({id:"common.intlStatus"}),ie=X.formatMessage({id:"common.intlVerifyNonce"}),le=X.formatMessage({id:"common.intlVerifyComplete"}),de=X.formatMessage({id:"common.intlPleaseVerify"}),me=(0,p.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",render:function(e,t,n){return(0,I.jsx)("span",{children:n+1})}},{title:"".concat(ne),dataIndex:"nonceAccount",key:"nonceAccount",render:function(e,t){return(0,I.jsx)(A.k,{ellipsis:!0,copyable:!0,addressPrefix:"",address:t.nonceAccount.toString()})}},{title:"".concat(te),dataIndex:"authority",key:"authority",render:function(e,t){return(0,I.jsx)(A.k,{ellipsis:!0,copyable:!0,addressPrefix:"",address:t.authority.toString()})}},{title:"".concat(ue),dataIndex:"status",key:"status",render:function(e,t){return(0,I.jsx)("span",{children:t.status})}},{title:"".concat(re),dataIndex:"blockhash",key:"blockhash",render:function(e,t){return(0,I.jsx)(A.k,{copyable:!0,addressPrefix:"",address:t.blockhash})}}]}),[]),fe=(0,p.useCallback)(function(){var t=u()(c()().mark((function t(n,r){var a,o,u,i,l;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s(!0),"#####NonceCountAccount#####",t.next=5,v.PublicKey.createWithSeed(n,"#####NonceCountAccount#####",v.SystemProgram.programId);case 5:return a=t.sent,t.next=8,r.getAccountInfo(a);case 8:if(o=t.sent,u=[],i=0,l=0,!o){t.next=19;break}return i=(0,w.sT)(o.lamports),t.next=16,(0,w.JH)(r,n);case 16:u=t.sent,(l=u.length)!==i&&M.error(de);case 19:s(!1),e(h.N.setDataSource(u)),e(h.N.setTotalCountRecord(i)),e(h.N.setTotalCountCreate(l)),e(h.N.setNonceCountAccount(a)),t.next=30;break;case 26:t.prev=26,t.t0=t.catch(0),s(!1),(0,C.Tv)(t.t0,M,"handleUpdateNonceAccount");case 30:case"end":return t.stop()}}),t,null,[[0,26]])})));return function(e,n){return t.apply(this,arguments)}}(),[]),pe=(0,p.useCallback)(u()(c()().mark((function e(){var t,n,r,o,u,i,l,d,m,f,p,h,k,b,g,x,y,P,A,S,N,I,T,j,R,H,O,Z,z,U,K,L;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&q&&Q){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:if(D.length){e.next=5;break}return e.abrupt("return");case 5:return t=_,e.prev=6,n=D.toSorted((function(e,t){return Number(t)-Number(e)})),r=V.toReversed(),o=[],u="#####NonceCountAccount#####",e.next=13,Y.getAccountInfo(W);case 13:if(!(i=e.sent)){e.next=20;break}if(l=(0,w.sT)(i.lamports),V.length===l){e.next=20;break}return M.error(de),e.abrupt("return");case 20:d=0;case 21:if(!(d<n.length)){e.next=28;break}if(n[d]===r[d].key){e.next=24;break}return e.abrupt("return",M.error("".concat(ae)));case 24:o.push(r[d].nonceAccount);case 25:++d,e.next=21;break;case 28:m=100,f=0,p=[],h=[];case 32:return k=o.splice(0,m),e.next=35,Y.getMultipleParsedAccounts(k);case 35:for(b=e.sent,g=0;g<b.value.length;++g)x=b.value[g].lamports,y=f*m+g,p.push(v.SystemProgram.nonceWithdraw({noncePubkey:r[y].nonceAccount,authorizedPubkey:r[y].authority,toPubkey:r[y].authority,lamports:x}));f+=1;case 38:if(o.length){e.next=32;break}case 39:for(r.length===n.length?(P=i.lamports,p.push(v.SystemProgram.transfer({fromPubkey:W,basePubkey:t,toPubkey:t,lamports:P,seed:u,programId:v.SystemProgram.programId}))):p.push(v.SystemProgram.transfer({fromPubkey:W,basePubkey:t,toPubkey:t,lamports:n.length,seed:u,programId:v.SystemProgram.programId})),14,A=Math.ceil(p.length/14),S=0;S<A;++S)h.push(p.splice(0,14));if(!h.length){e.next=81;break}return e.next=46,Y.getLatestBlockhash();case 46:return N=e.sent,I=N.blockhash,T=N.lastValidBlockHeight,j=new Array(h.length).fill(I),e.next=52,(0,w.Gw)(Y,Q,j,h,q,F);case 52:R=e.sent,H=R.transactions,O=R.feeMode,Z=a()(H),e.prev=56,Z.s();case 58:if((z=Z.n()).done){e.next=71;break}return U=z.value,e.next=62,(0,w.pR)(Y,Q,U,O);case 62:return K=e.sent,L={signature:K,blockhash:I,lastValidBlockHeight:T},e.next=66,(0,w.fS)(E,Y,L,"confirmed",B,M);case 66:if(e.sent){e.next=69;break}return e.abrupt("break",71);case 69:e.next=58;break;case 71:e.next=76;break;case 73:e.prev=73,e.t0=e.catch(56),Z.e(e.t0);case 76:return e.prev=76,Z.f(),e.finish(76);case 79:return e.next=81,fe(t,Y);case 81:e.next=89;break;case 83:return e.prev=83,e.t1=e.catch(6),s(!1),e.next=88,fe(t,Y);case 88:(0,C.Tv)(e.t1,M,"handleBatchDelete");case 89:case"end":return e.stop()}}),e,null,[[6,83],[56,73,76,79]])}))),[D,_,q,V,W,Y,E,Q,F]),he=(0,p.useCallback)(u()(c()().mark((function e(){var t,n,r,a,s,o,u,i,l,d,m,f,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&q&&Q){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:if(D.length){e.next=5;break}return e.abrupt("return");case 5:for(t=_,e.prev=6,20,n=[],r=[],D.forEach((function(e){var t=V[e].nonceAccount,r=V[e].authority;n.push(v.SystemProgram.nonceAdvance({noncePubkey:t,authorizedPubkey:r}))})),a=Math.ceil(n.length/20),s=0;s<a;++s)r.push(n.splice(0,20));if(!r.length){e.next=28;break}return e.next=16,Y.getLatestBlockhash();case 16:return o=e.sent,u=o.blockhash,i=o.lastValidBlockHeight,l=new Array(r.length).fill(u),e.next=22,(0,w.Gw)(Y,Q,l,r,q,F);case 22:return d=e.sent,m=d.transactions,f=d.feeMode,p=l.map((function(e){return{signature:"",blockhash:e,lastValidBlockHeight:i}})),e.next=28,(0,w.fv)({chain:E,connection:Y,wallet:Q,transactions:m,strategys:p,notificationApi:B,feeMode:f});case 28:return e.next=30,fe(t,Y);case 30:e.next=37;break;case 32:return e.prev=32,e.t0=e.catch(6),e.next=36,fe(t,Y);case 36:(0,C.Tv)(e.t0,M,"handleUpdateNonce");case 37:case"end":return e.stop()}}),e,null,[[6,32]])}))),[D,_,q,V,Y,E,Q]),ke=(0,p.useCallback)(u()(c()().mark((function e(){var t,n,r,a,o,u,i,l,d,m,f,p,h,k,b,g,x,y;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_&&J&&Q){e.next=3;break}return M.error(ee),e.abrupt("return",!1);case 3:return t=_,e.prev=4,s(!0),n="#####NonceCountAccount#####",e.next=9,v.PublicKey.createWithSeed(t,n,v.SystemProgram.programId);case 9:return r=e.sent,e.next=12,Y.getAccountInfo(r);case 12:if(a=e.sent,o=[],!a){e.next=42;break}return e.next=17,(0,w.JH)(Y,t);case 17:if(u=e.sent,i=(0,w.sT)(a.lamports),l=u.length,i!==l){e.next=24;break}M.success(le),e.next=42;break;case 24:return i>l?(d=i-l,o.push(v.SystemProgram.transfer({fromPubkey:r,basePubkey:t,toPubkey:t,lamports:d,seed:n,programId:v.SystemProgram.programId}))):(m=l-i,o.push(v.SystemProgram.transfer({fromPubkey:t,toPubkey:r,lamports:m}))),e.next=27,Y.getLatestBlockhash();case 27:return f=e.sent,p=f.blockhash,h=f.lastValidBlockHeight,e.next=32,(0,w.fC)(Y,Q,p,o,J,F);case 32:return k=e.sent,b=k.transaction,g=k.feeMode,e.next=37,(0,w.pR)(Y,Q,b,g);case 37:return x=e.sent,y={signature:x,blockhash:p,lastValidBlockHeight:h},e.next=41,(0,w.fS)(E,Y,y,"confirmed",B,M);case 41:fe(t,Y);case 42:s(!1),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(4),s(!1),fe(t,Y),(0,C.Tv)(e.t0,M,"handleUpdateNonceAccount");case 50:case"end":return e.stop()}}),e,null,[[4,45]])}))),[_,J,V,Y,E,Q]);return(0,p.useEffect)((function(){_&&Y&&fe(_,Y)}),[_,Y]),(0,I.jsxs)(d._z,{className:"pages-tools-nonce",ghost:!0,children:[(0,I.jsx)(m.Z,{scroll:{x:!0},size:"small",columns:me,dataSource:V,defaultData:[],loading:{spinning:r,size:"large"},search:!1,options:!1,pagination:!1,tableAlertRender:!1,tableAlertOptionRender:!1,headerTitle:(0,I.jsxs)("div",{children:[(0,I.jsxs)(g.Z,{wrap:!0,className:"mb-[16px]",children:[(0,I.jsx)(x.ZP,{type:"primary",onClick:function(){return $.current.handleOpen()},children:se}),(0,I.jsx)(x.ZP,{type:"primary",onClick:function(){return pe()},children:ce}),(0,I.jsx)(x.ZP,{type:"primary",onClick:function(){return he()},children:oe}),(0,I.jsx)(x.ZP,{type:"primary",onClick:function(){return ke()},children:ie}),(0,I.jsx)("div",{children:O})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(A.k,{copyable:!0,addressPrefix:"",address:W.toString()}),"：",Z]})]}),rowSelection:{type:"checkbox",selectedRowKeys:D,onChange:function(e){L(e)}}}),(0,I.jsx)(S.l,{ref:$,notificationApi:B,handleUpdateNonceAccount:fe}),T,H]})}},8849:function(){}}]);