"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[401],{53401:function(e,t,r){r.d(t,{Wo:function(){return d},pb:function(){return be},E4:function(){return Se},tC:function(){return ne},h:function(){return Me},W6:function(){return Oe},PO:function(){return q},Af:function(){return H},Hp:function(){return J},Hm:function(){return X},ZH:function(){return U},Dm:function(){return G}});var n=r(67294),a=r(5574),s=r.n(a),c=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function u(e,t){var r=t.format,n=void 0===r?"":r,a=new Date(e).getTime(),u=Date.now();return function(e,t){var r=e,n=/\[[^\]]*]/g,a=(t.match(n)||[]).map((function(e){return e.slice(1,-1)})),u=t.replace(n,"[]"),l=c.reduce((function(e,t){var n=s()(t,2),a=n[0],c=n[1];if(e.includes(a)){var u=Math.floor(r/c);return r-=u*c,e.replace(new RegExp("".concat(a,"+"),"g"),(function(e){var t=e.length;return u.toString().padStart(t,"0")}))}return e}),u),i=0;return l.replace(n,(function(){var e=a[i];return i+=1,e}))}(Math.max(a-u,0),n)}var l=r(40165),i=r(85893);var o=function(e){var t,r=e.value,a=e.format,c=void 0===a?"HH:mm:ss":a,o=e.onChange,d=e.onFinish,f=e.className,p=(t=(0,n.useReducer)((function(e){return e+1}),0),s()(t,2)[1]),h=n.useRef(null),v=function(){var e=function(e){return new Date(e).getTime()}(r);e>=Date.now()&&(h.current=(0,l.Zi)((function(){p(),null==o||o(e-Date.now()),e<Date.now()&&(null==d||d(),h.current&&((0,l.cv)(h.current),h.current=null))}),33.333333333333336))};return n.useEffect((function(){return v(),function(){h.current&&((0,l.cv)(h.current),h.current=null)}}),[r]),(0,i.jsx)("div",{className:f,children:u(r,{format:c})})},d=n.memo(o),f=r(15009),p=r.n(f),h=r(99289),v=r.n(h),x=r(64599),m=r.n(x),b=r(40956),k=r(49591),j=r(64435),y=r(88026),S=r(2453),g=r(16568),P=r(83622),w=r(85137),C=r(27484),F=r.n(C),N=r(70178),L=r.n(N),M=r(70609),R=r(64119),_=r(29363),O=r(49717),T=r(54306),V=r(43651),I=r(44718),Z=r(28704),A=r(30527),E=r(52434),D=r(71874);F().extend(L());var z=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],l=c[1],o=g.ZP.useNotification(),f=s()(o,2),h=f[0],x=f[1],C=(0,T.O)(),F=C.publicKey,N=C.signTransaction,L=C.wallet,z=C.signMessage,q=(0,V.z)(),Y=(0,I.R)().connection,$=(0,O.A)(),H=$.chain,B=$.modalFeeRef,U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV1})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV1})),G=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),K=(0,n.useMemo)((function(){var e=new Set;U.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[U]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,n.useMemo)((function(){var e=new Set;return U.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[U]),X=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[U]),ee=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.price})),e/_.LAMPORTS_PER_SOL}),[U]),te=(0,n.useState)([]),re=s()(te,2),ne=re[0],ae=re[1],se=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ce=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=U.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV1(n))}),[U]),ue=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV1(W))}),[W]),le=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C,M,_,O,T,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:return e.next=5,(0,Z.vo)(F.toString(),z);case 5:r=e.sent,n=r.user,a=n.referral,c=new A.$r(E,new A.Y7(Y,q,A.Y7.defaultOptions())),l=U.filter((function(e){return ne.includes(e.key)})),i=[],o=5,d=m()(l.entries()),e.prev=13,d.s();case 15:if((f=d.n()).done){e.next=46;break}return v=s()(f.value,2),x=v[0],b=v[1],k=b.nftPubkey,j=b.ownerPubkey,y=F,S=a,2,e.next=24,(0,Z.zt)({program:c,nftPubkey:k,currentOwnerPubkey:j,payerPubkey:y,currentProjectDataSource:G,userReferral:S,payMode:2});case 24:if(g=e.sent,i.push(g),(P=x+1)%o!=0&&P!==l.length){e.next=44;break}return e.next=30,Y.getLatestBlockhash();case 30:return w=e.sent,C=w.blockhash,M=w.lastValidBlockHeight,e.next=35,(0,D.fC)(Y,L,C,i,N,B);case 35:return _=e.sent,O=_.transaction,T=_.feeMode,e.next=40,(0,D.pR)(Y,L,O,T);case 40:return V=e.sent,e.next=43,(0,D.fS)(H,Y,{signature:V,blockhash:C,lastValidBlockHeight:M},"confirmed",h,u);case 43:i=[];case 44:e.next=15;break;case 46:e.next=51;break;case 48:e.prev=48,e.t0=e.catch(13),d.e(e.t0);case 51:return e.prev=51,d.f(),e.finish(51);case 54:t(G.mintPubkey),e.next=60;break;case 57:e.prev=57,e.t1=e.catch(0),(0,R.Tv)(e.t1,u,"handleBuy");case 60:case"end":return e.stop()}}),e,null,[[0,57],[13,48,51,54]])}))),[ne,U,G,F,N,L,z,Y,H]),ie=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new A.$r(E,new A.Y7(Y,q,A.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=[],c=20,l=m()(n.entries()),e.prev=8,l.s();case 10:if((i=l.n()).done){e.next=38;break}return o=s()(i.value,2),d=o[0],f=o[1],v=F,x=f,e.next=16,(0,Z.Km)({program:r,payerPubkey:v,currentProjectDataSource:G,currentProjectNftDataSource:x,index:d});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=36;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,D.fC)(Y,L,y,a,N,B);case 27:return g=e.sent,P=g.transaction,w=g.feeMode,e.next=32,(0,D.pR)(Y,L,P,w);case 32:return C=e.sent,e.next=35,(0,D.fS)(H,Y,{signature:C,blockhash:y,lastValidBlockHeight:S},"confirmed",h,u);case 35:a=[];case 36:e.next=10;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(8),l.e(e.t0);case 43:return e.prev=43,l.f(),e.finish(43);case 46:ae([]),t(G.mintPubkey),e.next=53;break;case 50:e.prev=50,e.t1=e.catch(0),(0,R.Tv)(e.t1,u,"handleSplit");case 53:case"end":return e.stop()}}),e,null,[[0,50],[8,40,43,46]])}))),[ne,U,G,F,N,L,z,Y,H]),oe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new A.$r(E,new A.Y7(Y,q,A.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=[],c=15,l=m()(n.entries()),e.prev=8,l.s();case 10:if((i=l.n()).done){e.next=38;break}return o=s()(i.value,2),d=o[0],f=o[1],v=F,x=f,e.next=16,(0,Z.Q8)({program:r,payerPubkey:v,currentProjectDataSource:G,currentProjectNftDataSource:x});case 16:if(b=e.sent,a.push(b),(k=d+1)%c!=0&&k!==n.length){e.next=36;break}return e.next=22,Y.getLatestBlockhash();case 22:return j=e.sent,y=j.blockhash,S=j.lastValidBlockHeight,e.next=27,(0,D.fC)(Y,L,y,a,N,B);case 27:return g=e.sent,P=g.transaction,w=g.feeMode,e.next=32,(0,D.pR)(Y,L,P,w);case 32:return C=e.sent,e.next=35,(0,D.fS)(H,Y,{signature:C,blockhash:y,lastValidBlockHeight:S},"confirmed",h,u);case 35:a=[];case 36:e.next=10;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(8),l.e(e.t0);case 43:return e.prev=43,l.f(),e.finish(43);case 46:ae([]),t(G.mintPubkey),e.next=53;break;case 50:e.prev=50,e.t1=e.catch(0),(0,R.Tv)(e.t1,u,"handleBurn");case 53:case"end":return e.stop()}}),e,null,[[0,50],[8,40,43,46]])}))),[ne,U,G,F,N,L,z,Y,H]),de=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:K,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:H})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.price/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(G.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,K,Q,ee,G]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:de,dataSource:U,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,i.jsx)(P.ZP,{type:"primary",onClick:function(){t(G.mintPubkey),ae([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ne,onChange:function(e){ae(e)}},onSubmit:ce,onReset:ue,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ne.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:le,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ie,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:oe,shape:"square"},"3")]}),l,x]})},q=(0,n.memo)(z),Y=r(58868);F().extend(L());var $=function(e){var t=e.handleCurrentProjectNfts,r=(0,y.useDispatch)(),a=S.ZP.useMessage(),c=s()(a,2),u=c[0],l=c[1],o=g.ZP.useNotification(),f=s()(o,2),h=f[0],x=f[1],C=(0,T.O)(),F=C.publicKey,N=C.wallet,L=C.signMessage,E=C.signAllTransactions,z=(0,V.z)(),q=(0,I.R)().connection,$=(0,O.A)(),H=$.chain,B=$.modalFeeRef,U=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceV2})),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsDataSourceResetV2})),G=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),K=(0,n.useMemo)((function(){var e=new Set;U.forEach((function(t){e.add(t.ownerPubkey)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[U]),J=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),Q=(0,n.useMemo)((function(){var e=new Set;return U.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[U]),X=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[U]),ee=(0,n.useMemo)((function(){var e=0;return U.forEach((function(t){e+=t.price})),e/_.LAMPORTS_PER_SOL}),[U]),te=(0,n.useState)([]),re=s()(te,2),ne=re[0],ae=re[1],se=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ce=(0,n.useCallback)((function(e){var t=e.ownerPubkey,n=U.filter((function(e){return e.ownerPubkey===t}));r(b.N.setCurrentProjectNftsDataSourceV2(n))}),[U]),ue=(0,n.useCallback)((function(){r(b.N.setCurrentProjectNftsDataSourceV2(W))}),[W]),le=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C,M,_,O,T,V;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&E&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(se));case 3:return e.next=5,(0,Z.qj)(F.toString(),L);case 5:r=e.sent,n=r.user,a=n.referral,c=new A.$r(Y,new A.Y7(q,z,A.Y7.defaultOptions())),l=U.filter((function(e){return ne.includes(e.key)})),i=5,o=[],d=[],f=m()(l.entries()),e.prev=14,f.s();case 16:if((v=f.n()).done){e.next=31;break}return x=s()(v.value,2),b=x[0],k=x[1],j=k.nftPubkey,y=k.ownerPubkey,S=F,g=a,2,e.next=25,(0,Z.G4)({program:c,nftPubkey:j,currentOwnerPubkey:y,payerPubkey:S,currentProjectDataSource:G,userReferral:g,payMode:2});case 25:P=e.sent,o.push(P),(w=b+1)%i!=0&&w!==l.length||(d.push(o),o=[]);case 29:e.next=16;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(14),f.e(e.t0);case 36:return e.prev=36,f.f(),e.finish(36);case 39:return e.next=41,q.getLatestBlockhash();case 41:return C=e.sent,M=C.blockhash,_=C.lastValidBlockHeight,e.next=46,(0,D.Gw)(q,N,M,d,E,B);case 46:return O=e.sent,T=O.transactions,V=O.feeMode,e.next=51,(0,D.fv)({chain:H,connection:q,wallet:N,transactions:T,blockhash:M,lastValidBlockHeight:_,notificationApi:h,feeMode:V});case 51:t(G.mintPubkey),e.next=57;break;case 54:e.prev=54,e.t1=e.catch(0),(0,R.Tv)(e.t1,u,"handleBuy");case 57:case"end":return e.stop()}}),e,null,[[0,54],[14,33,36,39]])}))),[ne,U,G,F,E,N,L,q,H]),ie=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C,M,_,O,T;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&E&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new A.$r(Y,new A.Y7(q,z,A.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=18,c=[],l=[],i=m()(n.entries()),e.prev=9,i.s();case 11:if((o=i.n()).done){e.next=23;break}return d=s()(o.value,2),f=d[0],v=d[1],x=F,b=v,e.next=17,(0,Z.Q9)({program:r,payerPubkey:x,currentProjectDataSource:G,currentProjectNftDataSource:b,index:f});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(l.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,g=y.lastValidBlockHeight,e.next=38,(0,D.Gw)(q,N,S,l,E,B);case 38:P=e.sent,w=P.transactions,C=P.feeMode,M=m()(w),e.prev=42,M.s();case 44:if((_=M.n()).done){e.next=53;break}return O=_.value,e.next=48,(0,D.pR)(q,N,O,C);case 48:return T=e.sent,e.next=51,(0,D.fS)(H,q,{signature:T,blockhash:S,lastValidBlockHeight:g},"confirmed",h,u);case 51:e.next=44;break;case 53:e.next=58;break;case 55:e.prev=55,e.t1=e.catch(42),M.e(e.t1);case 58:return e.prev=58,M.f(),e.finish(58);case 61:ae([]),t(G.mintPubkey),e.next=68;break;case 65:e.prev=65,e.t2=e.catch(0),(0,R.Tv)(e.t2,u,"handleSplit");case 68:case"end":return e.stop()}}),e,null,[[0,65],[9,25,28,31],[42,55,58,61]])}))),[ne,U,G,F,E,N,L,q,H]),oe=(0,n.useCallback)(v()(p()().mark((function e(){var r,n,a,c,l,i,o,d,f,v,x,b,k,j,y,S,g,P,w,C;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&E&&N&&L&&z){e.next=3;break}return e.abrupt("return",u.error(se));case 3:r=new A.$r(Y,new A.Y7(q,z,A.Y7.defaultOptions())),n=U.filter((function(e){return ne.includes(e.key)})),a=5,c=[],l=[],i=m()(n.entries()),e.prev=9,i.s();case 11:if((o=i.n()).done){e.next=23;break}return d=s()(o.value,2),f=d[0],v=d[1],x=F,b=v,e.next=17,(0,Z.mn)({program:r,payerPubkey:x,currentProjectDataSource:G,currentProjectNftDataSource:b});case 17:k=e.sent,c.push(k),(j=f+1)%a!=0&&j!==n.length||(l.push(c),c=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return y=e.sent,S=y.blockhash,g=y.lastValidBlockHeight,e.next=38,(0,D.Gw)(q,N,S,l,E,B);case 38:return P=e.sent,w=P.transactions,C=P.feeMode,e.next=43,(0,D.fv)({chain:H,connection:q,wallet:N,transactions:w,blockhash:S,lastValidBlockHeight:g,notificationApi:h,feeMode:C});case 43:ae([]),t(G.mintPubkey),e.next=50;break;case 47:e.prev=47,e.t1=e.catch(0),(0,R.Tv)(e.t1,u,"handleBurn");case 50:case"end":return e.stop()}}),e,null,[[0,47],[9,25,28,31]])}))),[ne,U,G,F,E,N,L,q,H]),de=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(Q,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:K,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:H})}},{title:"投入成本(".concat(X.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(ee.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.price/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(G.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return e.burnTimeLocalValue-t.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[X,K,Q,ee,G]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:J,size:"large"},scroll:{x:!0},size:"small",columns:de,dataSource:U,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:function(e,r,n){return[n[1],(0,i.jsx)(P.ZP,{type:"primary",onClick:function(){t(G.mintPubkey),ae([])},children:"更新"},"update"),n[0]]}},rowSelection:{type:"checkbox",selectedRowKeys:ne,onChange:function(e){ae(e)}},onSubmit:ce,onReset:ue,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1}),!!ne.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:[(0,i.jsx)(w.Z,{type:"primary",description:"购买",onClick:le,shape:"square"},"1"),(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ie,shape:"square"},"2"),(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:oe,shape:"square"},"3")]}),l,x]})},H=(0,n.memo)($);F().extend(L());var B=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),l=s()(u,2),o=l[0],f=l[1],h=g.ZP.useNotification(),x=s()(h,2),b=x[0],P=x[1],C=(0,T.O)(),F=C.publicKey,N=C.signTransaction,L=C.wallet,z=C.signMessage,q=(0,V.z)(),Y=(0,I.R)().connection,$=(0,O.A)(),H=$.chain,B=$.modalFeeRef,U=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=m()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),G=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),K=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/_.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,i,d,f,h,v,x,k,j,y,S,g,P,w,C,M,_;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",o.error(re));case 3:n=new A.$r(E,new A.Y7(Y,q,A.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],l=20,i=m()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=38;break}return f=s()(d.value,2),h=f[0],v=f[1],x=F,k=v,e.next=16,(0,Z.Km)({program:n,payerPubkey:x,currentProjectDataSource:a,currentProjectNftDataSource:k,index:h});case 16:if(j=e.sent,u.push(j),(y=h+1)%l!=0&&y!==c.length){e.next=36;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,g=S.blockhash,P=S.lastValidBlockHeight,e.next=27,(0,D.fC)(Y,L,g,u,N,B);case 27:return w=e.sent,C=w.transaction,M=w.feeMode,e.next=32,(0,D.pR)(Y,L,C,M);case 32:return _=e.sent,e.next=35,(0,D.fS)(H,Y,{signature:_,blockhash:g,lastValidBlockHeight:P},"confirmed",b,o);case 35:u=[];case 36:e.next=10;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(8),i.e(e.t0);case 43:return e.prev=43,i.f(),e.finish(43);case 46:te([]),t(a.mintPubkey),e.next=53;break;case 50:e.prev=50,e.t1=e.catch(0),(0,R.Tv)(e.t1,o,"handleSplit");case 53:case"end":return e.stop()}}),e,null,[[0,50],[8,40,43,46]])}))),[ee,r,a,F,N,L,z,Y,H]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,i,d,f,h,v,x,k,j,y,S,g,P,w,C,M,_;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&z&&q){e.next=3;break}return e.abrupt("return",o.error(re));case 3:n=new A.$r(E,new A.Y7(Y,q,A.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=[],l=15,i=m()(c.entries()),e.prev=8,i.s();case 10:if((d=i.n()).done){e.next=38;break}return f=s()(d.value,2),h=f[0],v=f[1],x=F,k=v,e.next=16,(0,Z.Q8)({program:n,payerPubkey:x,currentProjectDataSource:a,currentProjectNftDataSource:k});case 16:if(j=e.sent,u.push(j),(y=h+1)%l!=0&&y!==c.length){e.next=36;break}return e.next=22,Y.getLatestBlockhash();case 22:return S=e.sent,g=S.blockhash,P=S.lastValidBlockHeight,e.next=27,(0,D.fC)(Y,L,g,u,N,B);case 27:return w=e.sent,C=w.transaction,M=w.feeMode,e.next=32,(0,D.pR)(Y,L,C,M);case 32:return _=e.sent,e.next=35,(0,D.fS)(H,Y,{signature:_,blockhash:g,lastValidBlockHeight:P},"confirmed",b,o);case 35:u=[];case 36:e.next=10;break;case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(8),i.e(e.t0);case 43:return e.prev=43,i.f(),e.finish(43);case 46:te([]),t(a.mintPubkey),e.next=53;break;case 50:e.prev=50,e.t1=e.catch(0),(0,R.Tv)(e.t1,o,"handleBurn");case 53:case"end":return e.stop()}}),e,null,[[0,50],[8,40,43,46]])}))),[ee,r,a,F,N,L,z,Y,H]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(G,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:U,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:H})}},{title:"投入成本(".concat(K.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.price/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[K,U,G,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:W,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,P]})},U=(0,n.memo)(B);F().extend(L());var W=function(e){var t=e.handleCurrentProjectUserNfts,r=e.currentProjectUserNftsDataSource,a=e.currentProjectDataSource,c=e.kind,u=S.ZP.useMessage(),l=s()(u,2),o=l[0],f=l[1],h=g.ZP.useNotification(),x=s()(h,2),b=x[0],P=x[1],C=(0,T.O)(),F=C.publicKey,N=C.signAllTransactions,L=C.wallet,E=C.signMessage,z=(0,V.z)(),q=(0,I.R)().connection,$=(0,O.A)(),H=$.chain,B=$.modalFeeRef,U=(0,n.useMemo)((function(){var e=new Set;r.forEach((function(t){e.add(t.ownerPubkey)}));var t,n=[],a=m()(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push({text:s,value:s})}}catch(e){a.e(e)}finally{a.f()}return n}),[r]),W=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoading})),G=(0,n.useMemo)((function(){var e=new Set;return r.forEach((function(t){e.add(t.ownerPubkey)})),e.size}),[r]),K=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[r]),J=(0,n.useMemo)((function(){var e=0;return r.forEach((function(t){e+=t.price})),e/_.LAMPORTS_PER_SOL}),[r]),Q=(0,n.useState)([]),X=s()(Q,2),ee=X[0],te=X[1],re=(0,y.useIntl)().formatMessage({id:"common.intlPleaseConnectWallet"}),ne=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,i,d,f,h,v,x,k,j,y,S,g,P,w,C,M,_,O,T,V,I;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&E&&z){e.next=3;break}return e.abrupt("return",o.error(re));case 3:n=new A.$r(Y,new A.Y7(q,z,A.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=18,l=[],i=[],d=m()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],x=h[1],k=F,j=x,e.next=17,(0,Z.Q9)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j,index:v});case 17:y=e.sent,l.push(y),(S=v+1)%u!=0&&S!==c.length||(i.push(l),l=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return g=e.sent,P=g.blockhash,w=g.lastValidBlockHeight,e.next=38,(0,D.Gw)(q,L,P,i,N,B);case 38:C=e.sent,M=C.transactions,_=C.feeMode,O=m()(M),e.prev=42,O.s();case 44:if((T=O.n()).done){e.next=53;break}return V=T.value,e.next=48,(0,D.pR)(q,L,V,_);case 48:return I=e.sent,e.next=51,(0,D.fS)(H,q,{signature:I,blockhash:P,lastValidBlockHeight:w},"confirmed",b,o);case 51:e.next=44;break;case 53:e.next=58;break;case 55:e.prev=55,e.t1=e.catch(42),O.e(e.t1);case 58:return e.prev=58,O.f(),e.finish(58);case 61:te([]),t(a.mintPubkey),e.next=68;break;case 65:e.prev=65,e.t2=e.catch(0),(0,R.Tv)(e.t2,o,"handleSplit");case 68:case"end":return e.stop()}}),e,null,[[0,65],[9,25,28,31],[42,55,58,61]])}))),[ee,r,a,F,N,L,E,q,H]),ae=(0,n.useCallback)(v()(p()().mark((function e(){var n,c,u,l,i,d,f,h,v,x,k,j,y,S,g,P,w,C,M,_;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F&&N&&L&&E&&z){e.next=3;break}return e.abrupt("return",o.error(re));case 3:n=new A.$r(Y,new A.Y7(q,z,A.Y7.defaultOptions())),c=r.filter((function(e){return ee.includes(e.key)})),u=5,l=[],i=[],d=m()(c.entries()),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=23;break}return h=s()(f.value,2),v=h[0],x=h[1],k=F,j=x,e.next=17,(0,Z.mn)({program:n,payerPubkey:k,currentProjectDataSource:a,currentProjectNftDataSource:j});case 17:y=e.sent,l.push(y),(S=v+1)%u!=0&&S!==c.length||(i.push(l),l=[]);case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),d.e(e.t0);case 28:return e.prev=28,d.f(),e.finish(28);case 31:return e.next=33,q.getLatestBlockhash();case 33:return g=e.sent,P=g.blockhash,w=g.lastValidBlockHeight,e.next=38,(0,D.Gw)(q,L,P,i,N,B);case 38:return C=e.sent,M=C.transactions,_=C.feeMode,e.next=43,(0,D.fv)({chain:H,connection:q,wallet:L,transactions:M,blockhash:P,lastValidBlockHeight:w,notificationApi:b,feeMode:_});case 43:te([]),t(a.mintPubkey),e.next=50;break;case 47:e.prev=47,e.t1=e.catch(0),(0,R.Tv)(e.t1,o,"handleBurn");case 50:case"end":return e.stop()}}),e,null,[[0,47],[9,25,28,31]])}))),[ee,r,a,F,N,L,E,q,H]),se=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"ID",dataIndex:"nftId",key:"nftId",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:["#",t.nftId]})}},{title:"状态",dataIndex:"status",key:"status",filters:[{text:"可买",value:"buy"},{text:"已售",value:"sell"},{text:"可拆分",value:"split"},{text:"可销毁",value:"burn"}],onFilter:function(e,t){return"buy"===e?t.status.includes("可买"):"sell"===e?"已售"===t.status:"split"===e?"可拆分"===t.status:"burn"!==e||t.status.includes("可销毁")},sorter:function(e,t){return e.status.localeCompare(t.status)},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.status})}},{title:"持有者(".concat(G,")"),dataIndex:"ownerPubkey",key:"ownerPubkey",filters:U,onFilter:function(e,t){return e===t.ownerPubkey},sorter:function(e,t){return e.ownerPubkey.localeCompare(t.ownerPubkey)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.ownerPubkey,copyable:{tooltips:!1,text:t.ownerPubkey},chain:H})}},{title:"投入成本(".concat(K.toFixed(0),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"当前价格(".concat(J.toFixed(0),")"),dataIndex:"price",key:"price",sorter:function(e,t){return e.price-t.price},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.price/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(a.profitRate.toFixed(2),"%)"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}},{title:"购买时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.lastTradeLocalValue-e.lastTradeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.lastTradeLocalFormat})}},{title:"销毁时间",dataIndex:"lastTrade",key:"lastTrade",sorter:function(e,t){return t.burnTimeLocalValue-e.burnTimeLocalValue},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.burnTimeLocalFormat})}},{title:"销毁倒计时",dataIndex:"lastTrade",key:"lastTrade",search:!1,render:function(e,t){return(0,i.jsx)(d,{value:t.burnTimeLocalValue})}}]}),[K,U,G,J,a]);return(0,i.jsxs)("div",{className:"ppp-tab-nft",children:[(0,i.jsx)(j.Z,{loading:{spinning:W,size:"large"},scroll:{x:!0},size:"small",columns:se,dataSource:r,defaultData:[],rowSelection:{type:"checkbox",selectedRowKeys:ee,onChange:function(e){te(e)}},search:!1,options:!1,pagination:!1}),!!ee.length&&(0,i.jsxs)(w.Z.Group,{trigger:"click",type:"primary",style:{insetInlineEnd:50},icon:(0,i.jsx)(k.Z,{}),shape:"square",children:["split"===c?(0,i.jsx)(w.Z,{type:"primary",description:"拆分",onClick:ne,shape:"square"},"2"):null,"burn"===c?(0,i.jsx)(w.Z,{type:"primary",description:"销毁",onClick:ae,shape:"square"},"3"):null]}),f,P]})},G=(0,n.memo)(W);F().extend(L());var K=function(e){var t=(0,y.useDispatch)(),r=(0,O.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV1})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV1})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV1})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV1})),l=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV1})),o=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/_.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/_.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV1(n))}),[s]),x=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV1(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,i.jsx)(P.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),S=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:o,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.balance/_.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}}]}),[o,d,p,d,c,h,r]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:l,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:v,onReset:x,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},J=(0,n.memo)(K);F().extend(L());var Q=function(e){var t=(0,y.useDispatch)(),r=(0,O.A)().chain,a=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceResetV2})),s=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsRankDataSourceV2})),c=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsStatusV2})),u=(0,y.useSelector)((function(e){return e.ppp.currentProjectDataSourceV2})),l=(0,y.useSelector)((function(e){return e.ppp.currentProjectNftsLoadingV2})),o=(0,n.useMemo)((function(){var e=new Set;s.forEach((function(t){e.add(t.owner)}));var t,r=[],n=m()(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.push({text:a,value:a})}}catch(e){n.e(e)}finally{n.f()}return r}),[s]),d=(0,n.useMemo)((function(){var e=new Set;return s.forEach((function(t){e.add(t.owner)})),e.size}),[s]),f=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.invest})),e/_.LAMPORTS_PER_SOL}),[s]),p=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.profit})),e/_.LAMPORTS_PER_SOL}),[s]),h=(0,n.useMemo)((function(){var e=0;return s.forEach((function(t){e+=t.balance})),e/_.LAMPORTS_PER_SOL}),[s]),v=(0,n.useCallback)((function(e){var r=e.owner,n=s.filter((function(e){return e.owner===r}));t(b.N.setCurrentProjectNftsRankDataSourceV2(n))}),[s]),x=(0,n.useCallback)((function(){t(b.N.setCurrentProjectNftsRankDataSourceV2(a))}),[a]),k=(0,n.useCallback)((function(t,r,n){return[n[1],(0,i.jsx)(P.ZP,{type:"primary",onClick:function(){e.handleCurrentProjectNfts(u.mintPubkey)},children:"更新"},"update"),n[0]]}),[e,u]),S=(0,n.useMemo)((function(){return[{title:"#",dataIndex:"key",key:"key",search:!1,render:function(e,t,r){return(0,i.jsx)("span",{children:r+1})}},{title:"持有者(".concat(d,")"),dataIndex:"owner",key:"owner",filters:o,onFilter:function(e,t){return e===t.owner},sorter:function(e,t){return e.owner.localeCompare(t.owner)},render:function(e,t){return(0,i.jsx)(M.VU,{ellipsis:!0,content:t.owner,copyable:{tooltips:!1,text:t.owner},chain:r})}},{title:"持有数量(".concat(c.nftNumber,")"),dataIndex:"number",key:"number",sorter:function(e,t){return e.number-t.number},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:t.number})}},{title:"持有占比",dataIndex:"percent",key:"percent",search:!1,render:function(e,t){return(0,i.jsxs)("div",{children:[t.percent.toFixed(2),"%"]})}},{title:"账号余额(".concat(h.toFixed(4),")"),dataIndex:"balance",key:"balance",search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.balance/_.LAMPORTS_PER_SOL,6)})}},{title:"投入成本(".concat(f.toFixed(4),")"),dataIndex:"invest",key:"invest",sorter:function(e,t){return e.invest-t.invest},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.invest/_.LAMPORTS_PER_SOL,6)})}},{title:"卖出利润(".concat(p.toFixed(4),")"),dataIndex:"profit",key:"profit",sorter:function(e,t){return e.profit-t.profit},search:!1,render:function(e,t){return(0,i.jsx)("div",{children:(0,R.uf)(t.profit/_.LAMPORTS_PER_SOL,6)})}}]}),[o,d,p,d,c,h,r]);return(0,i.jsxs)("div",{className:"ppp-tab-rank mt-3",children:[(0,i.jsx)("div",{className:"font-semibold text-base hardline ml-2",children:"持有者排名"}),(0,i.jsx)(j.Z,{loading:{spinning:l,size:"large"},scroll:{x:!0},size:"small",columns:S,dataSource:s,defaultData:[],search:{defaultCollapsed:!1,layout:"horizontal",labelWidth:"auto",collapseRender:!1,className:"p-[0px]",optionRender:k},onSubmit:v,onReset:x,options:!1,tableAlertRender:!1,tableAlertOptionRender:!1,pagination:!1})]})},X=(0,n.memo)(Q),ee=r(87603),te=r(38345),re=function(){return(0,i.jsxs)(te.Z,{title:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:"使用说明"}),style:{maxWidth:"400px"},children:[(0,i.jsx)("div",{children:"1. 操作步骤如下："}),(0,i.jsxs)("div",{className:"ml-3 mt-2",children:["1）打开“PPP-简易钱包”页面 ",(0,i.jsx)(ee.Z,{})," 创建钱包 ",(0,i.jsx)(ee.Z,{})," 选择钱包 ",(0,i.jsx)(ee.Z,{})," 创建地址 ",(0,i.jsx)(ee.Z,{})," 用手机钱包转账SOL给地址 ",(0,i.jsx)(ee.Z,{})," 刷新后重新选择钱包，查看账号是否已生成；"]}),(0,i.jsxs)("div",{className:"ml-3 mt-2",children:["2）打开“PPP-Nonce账号”页面 ",(0,i.jsx)(ee.Z,{})," 点击页面右上角“连接钱包” ",(0,i.jsx)(ee.Z,{})," 选择“Simple Wallet” ",(0,i.jsx)(ee.Z,{})," 输入钱包，账号和密码 ",(0,i.jsx)(ee.Z,{})," 创建Nonce账号，按照你要抢图的数量来创建；"]}),(0,i.jsxs)("div",{className:"ml-3 mt-2",children:["3）打开“PPP-批量抢图”页面 ",(0,i.jsx)(ee.Z,{})," 创建交易表单输入：项目，购买方式，购买数量，开始序号，每张图GAS费用 ",(0,i.jsx)(ee.Z,{})," 点击“创建”按钮进行创建 ",(0,i.jsx)(ee.Z,{})," 保存好交易文件；"]}),(0,i.jsxs)("div",{className:"ml-3 mt-2",children:["4）打开“PPP-批量抢图”页面 ",(0,i.jsx)(ee.Z,{})," 发送交易表单，交易文件栏位输入刚才生成的交易文件 ",(0,i.jsx)(ee.Z,{})," 等待倒计时结整即可，其它输入按需进行修改，发送设备要保持工作状态，发送前可以点击一下“预检”按钮；"]}),(0,i.jsx)("div",{className:"ml-3 mt-2",children:"5）倒计时结束后会自动进行发送，发送完成后可点击“校验”按钮进行检查， 或者到链上浏览器去检查。"}),(0,i.jsx)("div",{className:"mt-3",children:"2. 注意事项："}),(0,i.jsx)("div",{className:"ml-3",children:"1）交易文件需要提前生成"}),(0,i.jsx)("div",{className:"ml-3",children:"2）Nonce账号的数量需要根据你一次性抢多少图来决定，例如你想一次性抢10，就需要创建10个Nonce账号，只需要创建一次，账号可重复使用，也可以随时回收；"}),(0,i.jsx)("div",{className:"ml-3",children:"3）关于GAS费用的设置，查看最近抢图的交易记录，根据交易信息中“Priority Fee”的大小来设置合理的值。"}),(0,i.jsx)("div",{className:"mt-3",children:"3. 费用说明："}),(0,i.jsx)("div",{className:"ml-3",children:"有两种方式可选择"}),(0,i.jsx)("div",{className:"ml-3",children:"1）免费：填写本工具的邀请码，工具会自动填入，无需手动操作；"}),(0,i.jsx)("div",{className:"ml-3",children:"2）付费：按账号实际绑定的邀请码进行填写，无需手动操作。用户使用工具抢到的NFT，每个收取0.3%费用。例如工具抢到一个价值为0.1 SOL的NFT，则工具会收取0.0003 SOL作为费用，抢购成功了，才会收取。"})]})},ne=(0,n.memo)(re),ae=r(19632),se=r.n(ae),ce=r(98165),ue=r(25035),le=r(97269),ie=r(64317),oe=r(31199),de=r(25054),fe=r(5966),pe=r(39678),he=r(7134),ve=r(83062),xe=r(48764).Buffer,me=function(){var e,t,r,a,c,u,l,o,d,f,h,x=(0,y.useIntl)(),k=x.formatMessage({id:"common.intlInputException"}),j=x.formatMessage({id:"common.intlPleaseConnectWallet"}),g=(0,y.useDispatch)(),P=S.ZP.useMessage(),w=s()(P,2),C=w[0],N=w[1],L=(0,n.useRef)(),M=(0,T.O)(),O=M.publicKey,z=M.signTransaction,q=M.signMessage,Y=M.wallet,$=(0,I.R)().connection,H=(0,V.z)(),B=(0,n.useState)(0),U=s()(B,2),W=U[0],G=U[1],K=(0,n.useState)(0),J=s()(K,2),Q=J[0],X=J[1],ee=(0,n.useState)(0),re=s()(ee,2),ne=re[0],ae=re[1],me=(0,n.useState)(!1),be=s()(me,2),ke=be[0],je=be[1],ye=(0,n.useState)(!1),Se=s()(ye,2),ge=Se[0],Pe=Se[1],we=(0,n.useState)(),Ce=s()(we,2),Fe=Ce[0],Ne=Ce[1],Le=(0,n.useState)([]),Me=s()(Le,2),Re=Me[0],_e=Me[1],Oe=(0,n.useState)([]),Te=s()(Oe,2),Ve=Te[0],Ie=Te[1],Ze=(0,n.useState)(0),Ae=s()(Ze,2),Ee=Ae[0],De=Ae[1],ze=(0,n.useState)(!1),qe=s()(ze,2),Ye=qe[0],$e=qe[1],He=(0,n.useState)(!1),Be=s()(He,2),Ue=Be[0],We=Be[1],Ge=(0,n.useState)(1),Ke=s()(Ge,2),Je=Ke[0],Qe=Ke[1],Xe=(0,n.useState)([]),et=s()(Xe,2),tt=et[0],rt=et[1],nt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV1})),at=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),st=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),ct=(0,n.useState)([]),ut=s()(ct,2),lt=ut[0],it=ut[1],ot=(0,n.useState)({}),dt=s()(ot,2),ft=dt[0],pt=dt[1],ht=(0,n.useState)([]),vt=s()(ht,2),xt=vt[0],mt=vt[1],bt=(0,n.useState)([]),kt=s()(bt,2),jt=kt[0],yt=kt[1],St=(0,n.useState)(0),gt=s()(St,2),Pt=gt[0],wt=gt[1],Ct=(0,n.useCallback)((function(){wt(0),yt([]),mt([]),De(0),We(!1),$e(!1),Ne(void 0),_e([]),Ie([])}),[]),Ft=(0,n.useCallback)((function(){var e,t,r=null===(e=L.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=L.current)||void 0===t||t.resetFields(n),Ct()}),[]),Nt=(0,n.useCallback)((function(){var e;null===(e=L.current)||void 0===e||e.resetFields(),Ct()}),[]),Lt=(0,n.useMemo)((function(){var e=(0,R.uf)(W/_.LAMPORTS_PER_SOL,8,"SOL"),t=(0,R.uf)(W/_.LAMPORTS_PER_SOL*Q,6);return Q?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[W,Q]),Mt=(0,n.useMemo)((function(){var e=(0,R.uf)(ne/_.LAMPORTS_PER_SOL,8,"SOL"),t=(0,R.uf)(ne/_.LAMPORTS_PER_SOL*Q,6);return Q?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[W,Q]),Rt=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e){var n,a=null===(n=L.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(7===e){var s,c=null===(s=L.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(8===e){var u,l=null===(u=L.current)||void 0===u?void 0:u.getFieldValue("nftIds");l=l||[],r=t.filter((function(e){return l.includes(e.nftId)}))}return Ie(r),r}),[]),_t=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,i,o,d,f,h,v,x,b,k,j,y,S;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.buyCount,c=n.startNumber,u=n.endNumber,l=n.buyMode,i=Rt(l,a),!(c>i.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(i.length));case 4:if(!u){e.next=11;break}if(!(c>u)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:o=i.length>u?u:i.length,i=i.slice(c-1,o),e.next=12;break;case 11:i=i.slice(c-1);case 12:return d=function(e){var t,n=0,a=m()(e);try{for(a.s();!(t=a.n()).done;){if(t.value.ownerPubkey!==r.toString()){if(n>=s)return n;if(n>=1e3)return n;n+=1}}}catch(e){a.e(e)}finally{a.f()}return n},f=d(i),"#####NonceCountAccount#####",e.next=17,_.PublicKey.createWithSeed(r,"#####NonceCountAccount#####",_.SystemProgram.programId);case 17:return h=e.sent,e.next=20,t.getAccountInfo(h);case 20:if(v=e.sent,x=[],b=[],k=0,v){e.next=26;break}throw Error("请先创建Nonce账号");case 26:if(k=(0,D.sT)(v.lamports),!(f>k)){e.next=29;break}throw Error("Nonce账号数量不足，需要大于等于图片购买数量");case 29:j=0;case 30:if(!(j<k)){e.next=40;break}return y="#####NonceAccount".concat(j+1,"#####"),e.next=35,_.PublicKey.createWithSeed(r,y,_.SystemProgram.programId);case 35:S=e.sent,x.push(S);case 37:++j,e.next=30;break;case 40:if(!x.length){e.next=45;break}return e.next=43,t.getMultipleParsedAccounts(x);case 43:e.sent.value.forEach((function(e,t){b.push({key:t,nonceAccount:x[t],authority:new _.PublicKey(e.data.parsed.info.authority),blockhash:e.data.parsed.info.blockhash,status:e.data.parsed.type})}));case 45:return e.abrupt("return",{nonceAccounts:x,nonceAccountsData:b,nftsDataSource:i});case 46:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),Ot=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l,i,o,d,f,h,v,x,b,k,j,y,S,g,P,w,C,F,N,L,M,R,O,T,V,I,z,q,Y;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.payer,a=t.anchorWallet,s=t.signMessage,c=t.signTransaction,u=t.nftsDataSource,l=t.formData,i=t.nonceAccounts,o=t.nonceAccountsData,d=t.currentProjectDataSource,f=t.tipAccounts,h=t.tipFee,v=0,x=0,b=0,k=[],j=l.buyCount,y=l.payMode,e.next=8,(0,Z.vo)(n.toString(),s);case 8:S=e.sent,g=S.user,P=g.referral,w=new A.$r(E,new A.Y7(r,a,A.Y7.defaultOptions())),C=m()(u),e.prev=13,C.s();case 15:if((F=C.n()).done){e.next=50;break}if(N=F.value,N.ownerPubkey!==n.toString()){e.next=20;break}return e.abrupt("continue",48);case 20:if(!(v>=j)){e.next=22;break}return e.abrupt("break",50);case 22:if(!(v>=3e3)){e.next=24;break}return e.abrupt("break",50);case 24:return v+=1,(L=[]).push(_.SystemProgram.nonceAdvance({noncePubkey:o[b].nonceAccount,authorizedPubkey:o[b].authority})),L.push(_.ComputeBudgetProgram.setComputeUnitLimit({units:132284})),M=N.nftPubkey,R=N.ownerPubkey,O=n,T=P,e.next=34,(0,Z.zt)({program:w,nftPubkey:M,currentOwnerPubkey:R,payerPubkey:O,currentProjectDataSource:d,userReferral:T,payMode:y});case 34:return V=e.sent,L.push(V),2===y&&P&&(I=Number((.003*N.price).toFixed(0)),L.push(_.SystemProgram.transfer({fromPubkey:n,toPubkey:new _.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:I}))),L.push(_.SystemProgram.transfer({fromPubkey:n,toPubkey:new _.PublicKey(f[x]),lamports:h<1e3?1e3:Number(h.toFixed(0))})),z=new _.TransactionMessage({payerKey:n,recentBlockhash:o[b].blockhash,instructions:L}).compileToLegacyMessage(),q=new _.VersionedTransaction(z),(0,D.hU)(q),e.next=43,c(q);case 43:Y=e.sent,k.push({instructions:L,transaction:Y,transactionBase64:xe.from(Y.serialize()).toString("base64"),nft:N,tipFee:h,referral:P}),b=(b+1)%i.length,x=(x+1)%f.length,De(v);case 48:e.next=15;break;case 50:e.next=55;break;case 52:e.prev=52,e.t0=e.catch(13),C.e(e.t0);case 55:return e.prev=55,C.f(),e.finish(55);case 58:return e.abrupt("return",k);case 59:case"end":return e.stop()}}),e,null,[[13,52,55,58]])})));return function(t){return e.apply(this,arguments)}}(),[]),Tt=(0,n.useCallback)((function(e,t,r,n,a){var s,c,u=0,l=t.projectId,i=t.splitCount,o=n.tokenSymbol,d=n.nextRoundLocalFormat,f=r.length,p=e.toString(),h=(0,R.uf)(r[0].tipFee/_.LAMPORTS_PER_SOL,8,"SOL"),v=r[0].referral;r.forEach((function(e){u+=e.nft.price}));for(var x=a.includes(p)?(0,R.uf)(u/_.LAMPORTS_PER_SOL,8,"SOL"):(0,R.uf)(1.003*u/_.LAMPORTS_PER_SOL,8,"SOL"),m=F()().format("YYYY-MM-DDTHH:mm:ss"),b=Math.ceil(r.length/i),k=1,j=function(){var e=0,s=[],c=r.splice(0,b),u=c.length;c.forEach((function(t){s.push(t.nft.nftId),e+=t.nft.price}));var f=a.includes(p)?(0,R.uf)(e/_.LAMPORTS_PER_SOL,8,"SOL"):(0,R.uf)(1.003*e/_.LAMPORTS_PER_SOL,8,"SOL");s.sort((function(e,t){return e-t}));var x={projectId:l,instruction:"buy",totalTxCount:u,totalAmount:f,tipFee:h,referral:v,tokenSymbol:o,from:p,startNftId:s[0],endNftId:s[s.length-1],nftIds:s,nextRoundLocalFormat:d,formData:t,currentProjectDataSource:n,transactions:c},j=JSON.stringify(x,null,2),y="data:,".concat(j),S=document.createElement("a");S.href=y,S.download=1===i||1===b?"".concat(o,"_").concat(l.slice(0,4),"_").concat(l.slice(-4),"_").concat(u,"_").concat(m,"_buy.json"):"".concat(o,"_").concat(l.slice(0,4),"_").concat(l.slice(-4),"_").concat(u,"_part").concat(k++,"_").concat(m,"_buy.json"),S.click()};r.length;)j();null===(s=L.current)||void 0===s||s.setFieldValue("totalAmountCreate",x),null===(c=L.current)||void 0===c||c.setFieldValue("totalTxCount",f),C.success("创建完成")}),[]),Vt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Y&&O&&z&&H&&q&&Fe){e.next=4;break}return C.error(j),e.abrupt("return",!0);case 4:if("Simple Wallet"===Y.adapter.name){e.next=7;break}return C.error("只支持Simple Wallet"),e.abrupt("return",!0);case 7:return e.next=9,_t($,O,t,Re);case 9:return r=e.sent,n=r.nonceAccounts,a=r.nonceAccountsData,s=r.nftsDataSource,e.next=15,Ot({connection:$,payer:O,anchorWallet:H,signMessage:q,signTransaction:z,nftsDataSource:s,formData:t,nonceAccounts:n,nonceAccountsData:a,currentProjectDataSource:Fe,tipAccounts:at,tipFee:W});case 15:if((c=e.sent).length){e.next=19;break}return C.info("没有需要创建的内容"),e.abrupt("return",!0);case 19:Tt(O,t,c,Fe,st),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),De(0),(0,R.Tv)(e.t0,C,"handleFinish");case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),[W,O,Y,z,H,q,Fe,Re,$,at,st]),It=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,se()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*_.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*_.LAMPORTS_PER_SOL)<1e3?1e3:s),G(s),ae(a)}),[]),Zt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,o,d,f,h,v,x,m,b,k,j,y,S,g;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Pe(!0),a={},e.next=5,(0,Z.HF)();case 5:return s=e.sent,c=function(e){return(0,R.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,R.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,l={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},o=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),x=c(a["99th"]),m=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),l["25th"]={sol:o,usd:m},l["50th"]={sol:d,usd:b},l["50th_ema"]={sol:f,usd:k},l["75th"]={sol:h,usd:j},l["95th"]={sol:v,usd:y},l["99th"]={sol:x,usd:S},(g=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),g.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),g.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),g.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),g.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),g.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),pt(a),it(g),Pe(!1),null===(n=L.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),It(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),Pe(!1),(0,R.Tv)(e.t0,C,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),At=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=Rt(a,e);return It(u,s,c,t),wt(u.length),u.length}),[]),Et=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e})})})),mt(n)}),[]),Dt=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),yt(t)}),[]),zt=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=L.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;6===c||7===c?($e(!0),Et(e)):($e(!1),mt([]),null===(a=L.current)||void 0===a||a.setFieldValue("accounts",void 0));8===c?(We(!0),Dt(e)):(We(!1),yt([]),null===(s=L.current)||void 0===s||s.setFieldValue("nftIds",void 0));At(e,t),null===(n=L.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),qt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),a=null===(n=L.current)||void 0===n?void 0:n.getFieldsValue(),s=a.projectId,Ft(),c=t.find((function(e){return e.mintPubkey===s})),e.next=7,(0,Z.LE)(s,c);case 7:u=e.sent,l=u.currentProjectNftsDataSource,At(l,r),_e(l),Ne(c),je(!1),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),je(!1),(0,R.Tv)(e.t0,C,"handleCurrentProjectNfts");case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Yt=(0,n.useCallback)((function(e,t){var r,n,a=At(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),$t=(0,n.useCallback)((function(e,t){var r,n,a=At(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),Ht=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;It(e,a,s,t)}),[]),Bt=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=L.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=L.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),It(e,.1,a,t)}else if(2===a)Zt(e,r);else if(3===a){var c,u="0.000001";null===(c=L.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),It(e,u,a,t)}Qe(a)}),[]),Ut=(0,n.useCallback)((function(e){e.projectId&&qt(nt,ft),e.buyMode&&zt(Re,ft),e.nftIds&&Yt(Re,ft),e.accounts&&$t(Re,ft),e.tipMode&&Bt(Re,ft,Q),e.tipFeeCreate&&Ht(Ve,ft)}),[nt,Re,Pt,Ve,ft,Q]),Wt=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(0!==e.round&&r!==n){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(he.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),rt(t)}),[]),Gt=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,je(!0),e.next=4,(0,Z.p5)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,R.o8)();case 9:a=e.sent,Wt(n),X(a),g(b.N.setProjectsV1(r)),g(b.N.setProjectsDataSourceV1(n)),je(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),je(!1),(0,R.Tv)(e.t0,C,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]);return(0,n.useEffect)((function(){Gt()}),[]),(0,i.jsxs)(te.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(le.A,{formRef:L,onFinish:Vt,onValuesChange:Ut,onReset:Nt,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:.1,payMode:1,tipMode:1,splitCount:1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],t[0],(0,i.jsx)("div",{children:Ee||""},"sign")]}},children:[(0,i.jsx)(ie.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(ce.Z,{spin:ke,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:Gt})]}),options:tt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(he.C,{className:"mr-2",size:"default",src:n}),(0,R.Mn)()?(0,i.jsx)("div",{children:"".concat(r)}):(0,i.jsx)("div",{children:"".concat(r," - ").concat((0,R.LH)(t))})]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(ie.Z,{name:"buyMode",label:"购买方式",options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 指定账号(顺序)"},{value:7,label:"7 指定账号(随机)"},{value:8,label:"8 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(e=L.current)&&void 0!==e&&e.getFieldValue("projectId"))}}),!!Ye&&(0,i.jsx)(ie.Z,{name:"accounts",label:"选择账号",options:xt,fieldProps:{mode:"multiple",disabled:!(null!==(t=L.current)&&void 0!==t&&t.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),!!Ue&&(0,i.jsx)(ie.Z,{name:"nftIds",label:"选择序号",options:jt,fieldProps:{mode:"multiple",disabled:!(null!==(r=L.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),(0,i.jsx)(oe.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=L.current)||void 0===e||e.setFieldValue("buyCount",Pt),null===(t=L.current)||void 0===t||t.validateFields(["buyCount"])},children:Pt?"(".concat(Pt,")"):""})]}),placeholder:"",min:1,max:Pt,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(a=L.current)&&void 0!==a&&a.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=L.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=L.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(ie.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(l=L.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),1===Je?(0,i.jsx)(de.Z,{name:"tipFeeCreate",label:Lt,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(o=L.current)&&void 0!==o&&o.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Mt})}):null,2===Je?(0,i.jsx)(ie.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(ce.Z,{spin:ge,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return Zt(Re,Q)}})]}),options:lt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Mt})}):null,3===Je?(0,i.jsx)(fe.Z,{name:"tipFeeCreate",label:Lt,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Mt})}):null,(0,i.jsx)(ie.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(d=L.current)&&void 0!==d&&d.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["交易文件数量",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(fe.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(f=L.current)&&void 0!==f&&f.getFieldValue("projectId"))}}),(0,i.jsx)(fe.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(h=L.current)&&void 0!==h&&h.getFieldValue("projectId"))}})]}),N]})},be=(0,n.memo)(me),ke=r(84567),je=r(48764).Buffer,ye=function(){var e,t,r,a,c,u,l,o,d,f,h,x=(0,y.useIntl)(),k=x.formatMessage({id:"common.intlInputException"}),j=x.formatMessage({id:"common.intlPleaseConnectWallet"}),g=(0,y.useDispatch)(),P=S.ZP.useMessage(),w=s()(P,2),C=w[0],N=w[1],L=(0,n.useRef)(),M=(0,T.O)(),O=M.publicKey,E=M.signTransaction,z=M.signMessage,q=M.wallet,$=(0,I.R)().connection,H=(0,V.z)(),B=(0,n.useState)(0),U=s()(B,2),W=U[0],G=U[1],K=(0,n.useState)(0),J=s()(K,2),Q=J[0],X=J[1],ee=(0,n.useState)(0),re=s()(ee,2),ne=re[0],ae=re[1],xe=(0,n.useState)(!1),me=s()(xe,2),be=me[0],ye=me[1],Se=(0,n.useState)(!1),ge=s()(Se,2),Pe=ge[0],we=ge[1],Ce=(0,n.useState)(),Fe=s()(Ce,2),Ne=Fe[0],Le=Fe[1],Me=(0,n.useState)([]),Re=s()(Me,2),_e=Re[0],Oe=Re[1],Te=(0,n.useState)([]),Ve=s()(Te,2),Ie=Ve[0],Ze=Ve[1],Ae=(0,n.useState)(0),Ee=s()(Ae,2),De=Ee[0],ze=Ee[1],qe=(0,n.useState)(!1),Ye=s()(qe,2),$e=Ye[0],He=Ye[1],Be=(0,n.useState)(!1),Ue=s()(Be,2),We=Ue[0],Ge=Ue[1],Ke=(0,n.useState)(1),Je=s()(Ke,2),Qe=Je[0],Xe=Je[1],et=(0,n.useState)(!0),tt=s()(et,2),rt=tt[0],nt=tt[1],at=(0,n.useState)([]),st=s()(at,2),ct=st[0],ut=st[1],lt=(0,y.useSelector)((function(e){return e.ppp.projectsDataSourceV2})),it=(0,y.useSelector)((function(e){return e.wallet.tipAccounts})),ot=(0,y.useSelector)((function(e){return e.ppp.vipAccounts})),dt=(0,n.useState)([]),ft=s()(dt,2),pt=ft[0],ht=ft[1],vt=(0,n.useState)({}),xt=s()(vt,2),mt=xt[0],bt=xt[1],kt=(0,n.useState)([]),jt=s()(kt,2),yt=jt[0],St=jt[1],gt=(0,n.useState)([]),Pt=s()(gt,2),wt=Pt[0],Ct=Pt[1],Ft=(0,n.useState)(0),Nt=s()(Ft,2),Lt=Nt[0],Mt=Nt[1],Rt=(0,n.useCallback)((function(){Mt(0),Ct([]),St([]),ze(0),Ge(!1),He(!1),Le(void 0),Oe([]),Ze([])}),[]),_t=(0,n.useCallback)((function(){var e,t,r=null===(e=L.current)||void 0===e?void 0:e.getFieldsValue(),n=Object.keys(r).filter((function(e){return"projectId"!==e}));null===(t=L.current)||void 0===t||t.resetFields(n),Rt()}),[]),Ot=(0,n.useCallback)((function(){var e;null===(e=L.current)||void 0===e||e.resetFields(),Rt()}),[]),Tt=(0,n.useMemo)((function(){var e=(0,R.uf)(W/_.LAMPORTS_PER_SOL,8,"SOL"),t=(0,R.uf)(W/_.LAMPORTS_PER_SOL*Q,6);return Q?"每张图GAS费用：".concat(e,"，$").concat(t," "):"每张图GAS费用：".concat(e)}),[W,Q]),Vt=(0,n.useMemo)((function(){var e=(0,R.uf)(ne/_.LAMPORTS_PER_SOL,8,"SOL"),t=(0,R.uf)(ne/_.LAMPORTS_PER_SOL*Q,6);return Q?"最小图片利润：".concat(e,"，$").concat(t):"最小图片利润：".concat(e)}),[W,Q]),It=(0,n.useCallback)((function(e,t){var r=[];if(1===e)r=t.toSorted((function(){return Math.random()-.5}));else if(2===e)r=t.toSorted((function(e,t){return e.price-t.price}));else if(3===e)r=t.toSorted((function(e,t){var r=e.price;return t.price-r}));else if(4===e)r=t.toSorted((function(e,t){return e.lastTradeLocalValue-t.lastTradeLocalValue}));else if(5===e)r=t.filter((function(e){return e.split}));else if(6===e)r=t.filter((function(e){return!e.split})).sort((function(){return Math.random()-.5}));else if(7===e){var n,a=null===(n=L.current)||void 0===n?void 0:n.getFieldValue("accounts");a=a||[],r=t.filter((function(e){return a.includes(e.ownerPubkey)}))}else if(8===e){var s,c=null===(s=L.current)||void 0===s?void 0:s.getFieldValue("accounts");c=c||[],(r=t.filter((function(e){return c.includes(e.ownerPubkey)}))).sort((function(){return Math.random()-.5}))}else if(9===e){var u,l=null===(u=L.current)||void 0===u?void 0:u.getFieldValue("nftIds");l=l||[],r=t.filter((function(e){return l.includes(e.nftId)}))}return Ze(r),r}),[]),Zt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,i,o,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.startNumber,c=n.endNumber,u=n.buyMode,l=It(u,a),!(s>l.length)){e.next=4;break}throw Error("开始序号超过当前项目最大值".concat(l.length));case 4:if(!c){e.next=11;break}if(!(s>c)){e.next=7;break}throw Error("开始序号超过结束序号");case 7:i=l.length>c?c:l.length,l=l.slice(s-1,i),e.next=12;break;case 11:l=l.slice(s-1);case 12:return o=[],e.next=15,(0,D.JH)(r,t);case 15:if((d=e.sent).forEach((function(e){o.push(e.nonceAccount)})),d.length){e.next=20;break}throw Error("请先创建Nonce账号");case 20:return e.abrupt("return",{nonceAccounts:o,nonceAccountsData:d,nftsDataSource:l});case 21:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),At=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l,i,o,d,f,h,v,x,b,k,j,y,S,g,P,w,C,F,N,L,M,R,O,T,V,I,E,z,q;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.payer,a=t.anchorWallet,s=t.signMessage,c=t.signTransaction,u=t.nftsDataSource,l=t.formData,i=t.nonceAccounts,o=t.nonceAccountsData,d=t.currentProjectDataSource,f=t.tipAccounts,h=t.tipFee,v=0,x=0,b=0,k=[],j=l.buyCount,y=l.payMode,e.next=8,(0,Z.qj)(n.toString(),s);case 8:S=e.sent,g=S.user,P=g.referral,w=new A.$r(Y,new A.Y7(r,a,A.Y7.defaultOptions())),C=m()(u),e.prev=13,C.s();case 15:if((F=C.n()).done){e.next=47;break}if(N=F.value,!(v>=j)){e.next=19;break}return e.abrupt("break",47);case 19:if(!(v>=3e3)){e.next=21;break}return e.abrupt("break",47);case 21:return v+=1,(L=[]).push(_.SystemProgram.nonceAdvance({noncePubkey:o[b].nonceAccount,authorizedPubkey:o[b].authority})),L.push(_.ComputeBudgetProgram.setComputeUnitLimit({units:47258})),M=N.nftPubkey,R=N.ownerPubkey,O=n,T=P,e.next=31,(0,Z.G4)({program:w,nftPubkey:M,currentOwnerPubkey:R,payerPubkey:O,currentProjectDataSource:d,userReferral:T,payMode:y});case 31:return V=e.sent,L.push(V),2===y&&P&&(I=Number((.003*N.price).toFixed(0)),L.push(_.SystemProgram.transfer({fromPubkey:n,toPubkey:new _.PublicKey("56d6qq9KAWcuUAHqPCK5yQAZ9PT5vqdCedJLiA5WaGgQ"),lamports:I}))),L.push(_.SystemProgram.transfer({fromPubkey:n,toPubkey:new _.PublicKey(f[x]),lamports:h<1e3?1e3:Number(h.toFixed(0))})),E=new _.TransactionMessage({payerKey:n,recentBlockhash:o[b].blockhash,instructions:L}).compileToLegacyMessage(),z=new _.VersionedTransaction(E),(0,D.hU)(z),e.next=40,c(z);case 40:q=e.sent,k.push({instructions:L,transaction:q,transactionBase64:je.from(q.serialize()).toString("base64"),nft:N,tipFee:h,referral:P}),b=(b+1)%i.length,x=(x+1)%f.length,ze(v);case 45:e.next=15;break;case 47:e.next=52;break;case 49:e.prev=49,e.t0=e.catch(13),C.e(e.t0);case 52:return e.prev=52,C.f(),e.finish(52);case 55:return e.abrupt("return",k);case 56:case"end":return e.stop()}}),e,null,[[13,49,52,55]])})));return function(t){return e.apply(this,arguments)}}(),[]),Et=(0,n.useCallback)((function(e,t,r,n,a,s){var c,u,l=0,i=t.projectId,o=t.splitCount,d=n.tokenSymbol,f=n.nextRoundLocalFormat,p=r.length,h=a.length,v=e.toString(),x=(0,R.uf)(r[0].tipFee/_.LAMPORTS_PER_SOL,8,"SOL"),m=r[0].referral;r.forEach((function(e){l+=e.nft.price}));for(var b=s.includes(v)?(0,R.uf)(l/_.LAMPORTS_PER_SOL,8,"SOL"):(0,R.uf)(1.003*l/_.LAMPORTS_PER_SOL,8,"SOL"),k=F()().format("YYYY-MM-DDTHH:mm:ss"),j=Math.ceil(r.length/o),y=1,S=function(){var e=0,a=[],c=r.splice(0,j),u=c.length;c.forEach((function(t){a.push(t.nft.nftId),e+=t.nft.price}));var l=s.includes(v)?(0,R.uf)(e/_.LAMPORTS_PER_SOL,8,"SOL"):(0,R.uf)(1.003*e/_.LAMPORTS_PER_SOL,8,"SOL");a.sort((function(e,t){return e-t}));var p={projectId:i,instruction:"buy",totalTxCount:u,totalAmount:l,totalNonceCount:h,tipFee:x,referral:m,tokenSymbol:d,from:v,startNftId:a[0],endNftId:a[a.length-1],nftIds:a,nextRoundLocalFormat:f,formData:t,currentProjectDataSource:n,transactions:c},b=JSON.stringify(p,null,2),S="data:,".concat(b),g=document.createElement("a");g.href=S,g.download=1===o||1===j?"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_").concat(k,"_buy.json"):"".concat(d,"_").concat(i.slice(0,4),"_").concat(i.slice(-4),"_").concat(u,"_part").concat(y++,"_").concat(k,"_buy.json"),g.click()};r.length;)S();null===(c=L.current)||void 0===c||c.setFieldValue("totalAmountCreate",b),null===(u=L.current)||void 0===u||u.setFieldValue("totalTxCount",p),C.success("创建完成")}),[]),Dt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,q&&O&&E&&H&&z&&Ne){e.next=4;break}return C.error(j),e.abrupt("return",!0);case 4:if("Simple Wallet"===q.adapter.name){e.next=7;break}return C.error("只支持Simple Wallet"),e.abrupt("return",!0);case 7:return e.next=9,Zt($,O,t,_e);case 9:return r=e.sent,n=r.nonceAccounts,a=r.nonceAccountsData,s=r.nftsDataSource,e.next=15,At({connection:$,payer:O,anchorWallet:H,signMessage:z,signTransaction:E,nftsDataSource:s,formData:t,nonceAccounts:n,nonceAccountsData:a,currentProjectDataSource:Ne,tipAccounts:it,tipFee:W});case 15:if((c=e.sent).length){e.next=19;break}return C.info("没有需要创建的内容"),e.abrupt("return",!0);case 19:Et(O,t,c,Ne,n,ot),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),ze(0),(0,R.Tv)(e.t0,C,"handleFinish");case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(t){return e.apply(this,arguments)}}(),[W,O,q,E,H,z,Ne,_e,$,it,ot]),zt=(0,n.useCallback)((function(e,t,r,n){var a=Math.min.apply(Math,se()(e.map((function(e){return e.profit})))),s=0;1===r?s=a*t/100:2===r?s=n[t]*_.LAMPORTS_PER_SOL:3===r&&(s=(s=Number(t)*_.LAMPORTS_PER_SOL)<1e3?1e3:s),G(s),ae(a)}),[]),qt=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,o,d,f,h,v,x,m,b,k,j,y,S,g;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,we(!0),a={},e.next=5,(0,Z.HF)();case 5:return s=e.sent,c=function(e){return(0,R.uf)(Math.max(e,1e-6),8,"SOL")},u=function(e){return"$"+(0,R.uf)(Math.max(e,1e-6)*r,6)},a["25th"]=s.landed_tips_25th_percentile,a["50th"]=s.landed_tips_50th_percentile,a["50th_ema"]=s.ema_landed_tips_50th_percentile,a["75th"]=s.landed_tips_75th_percentile,a["95th"]=s.landed_tips_95th_percentile,a["99th"]=s.landed_tips_99th_percentile,l={"25th":{sol:"",usd:""},"50th":{sol:"",usd:""},"50th_ema":{sol:"",usd:""},"75th":{sol:"",usd:""},"95th":{sol:"",usd:""},"99th":{sol:"",usd:""}},o=c(a["25th"]),d=c(a["50th"]),f=c(a["50th_ema"]),h=c(a["75th"]),v=c(a["95th"]),x=c(a["99th"]),m=u(a["25th"]),b=u(a["50th"]),k=u(a["50th_ema"]),j=u(a["75th"]),y=u(a["95th"]),S=u(a["99th"]),l["25th"]={sol:o,usd:m},l["50th"]={sol:d,usd:b},l["50th_ema"]={sol:f,usd:k},l["75th"]={sol:h,usd:j},l["95th"]={sol:v,usd:y},l["99th"]={sol:x,usd:S},(g=[]).push({value:"25th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"25%"}),(0,i.jsx)("div",{children:c(a["25th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["25th"])})})]})}),g.push({value:"50th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50%"}),(0,i.jsx)("div",{children:c(a["50th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th"])})})]})}),g.push({value:"50th_ema",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"50% EMA"}),(0,i.jsx)("div",{children:c(a["50th_ema"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["50th_ema"])})})]})}),g.push({value:"75th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"75%"}),(0,i.jsx)("div",{children:c(a["75th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["75th"])})})]})}),g.push({value:"95th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"95%"}),(0,i.jsx)("div",{children:c(a["95th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["95th"])})})]})}),g.push({value:"99th",label:(0,i.jsxs)("div",{className:"grid grid-cols-3",children:[(0,i.jsx)("div",{children:"99%"}),(0,i.jsx)("div",{children:c(a["99th"])}),(0,i.jsx)("div",{className:"justify-items-end",children:(0,i.jsx)("div",{children:u(a["99th"])})})]})}),bt(a),ht(g),we(!1),null===(n=L.current)||void 0===n||n.setFieldValue("tipFeeCreate","50th_ema"),zt(t,"50th_ema",2,a),e.abrupt("return",{levels:a,tipFeeCreate:"50th_ema"});case 48:e.prev=48,e.t0=e.catch(0),we(!1),(0,R.Tv)(e.t0,C,"handleUpdateTipFee");case 52:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,r){return e.apply(this,arguments)}}(),[]),Yt=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.buyMode,s=n.tipFeeCreate,c=n.tipMode,u=It(a,e);return zt(u,s,c,t),Mt(u.length),u.length}),[]),$t=(0,n.useCallback)((function(e){var t=new Set;e.forEach((function(e){t.add(e.ownerPubkey)}));var r=Array.from(t),n=[];r.forEach((function(e){n.push({value:e,label:(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e})})})),St(n)}),[]),Ht=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){t.push({value:e.nftId,label:(0,i.jsxs)("div",{className:"grid grid-cols-2",children:[(0,i.jsxs)("div",{children:["#",e.nftId]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:e.ownerPubkey})]})})})),t.sort((function(e,t){return e.value-t.value})),Ct(t)}),[]),Bt=(0,n.useCallback)((function(e,t){var r,n,a,s,c=(null===(r=L.current)||void 0===r?void 0:r.getFieldsValue()).buyMode;7===c||8===c?(He(!0),$t(e)):(He(!1),St([]),null===(a=L.current)||void 0===a||a.setFieldValue("accounts",void 0));9===c?(Ge(!0),Ht(e)):(Ge(!1),Ct([]),null===(s=L.current)||void 0===s||s.setFieldValue("nftIds",void 0));Yt(e,t),null===(n=L.current)||void 0===n||n.resetFields(["buyCount","startNumber","endNumber"])}),[]),Ut=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n,a){var s,c,u,l,i,o,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ye(!0),c=null===(s=L.current)||void 0===s?void 0:s.getFieldsValue(),u=c.projectId,_t(),l=t.find((function(e){return e.mintPubkey===u})),e.next=7,(0,Z.D3)(u,l);case 7:i=e.sent,o=i.currentProjectNftsDataSource,d=[],d=a&&n?o.filter((function(e){return e.ownerPubkey!==n.toString()})):o,Yt(d,r),Oe(d),Le(l),ye(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),ye(!1),(0,R.Tv)(e.t0,C,"handleCurrentProjectNfts");case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),[]),Wt=(0,n.useCallback)((function(e,t){var r,n,a=Yt(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),Gt=(0,n.useCallback)((function(e,t){var r,n,a=Yt(e,t);a?null===(r=L.current)||void 0===r||r.setFieldValue("buyCount",a):null===(n=L.current)||void 0===n||n.setFieldValue("buyCount",void 0)}),[]),Kt=(0,n.useCallback)((function(e,t){var r,n=null===(r=L.current)||void 0===r?void 0:r.getFieldsValue(),a=n.tipFeeCreate,s=n.tipMode;zt(e,a,s,t)}),[]),Jt=(0,n.useCallback)((function(e,t,r){var n,a=(null===(n=L.current)||void 0===n?void 0:n.getFieldsValue()).tipMode;if(1===a){var s;null===(s=L.current)||void 0===s||s.setFieldValue("tipFeeCreate",.1),zt(e,.1,a,t)}else if(2===a)qt(e,r);else if(3===a){var c,u="0.000001";null===(c=L.current)||void 0===c||c.setFieldValue("tipFeeCreate",u),zt(e,u,a,t)}Xe(a)}),[]),Qt=(0,n.useCallback)((function(e){e.projectId&&Ut(lt,mt,O,rt),e.buyMode&&Bt(_e,mt),e.nftIds&&Wt(_e,mt),e.accounts&&Gt(_e,mt),e.tipMode&&Jt(_e,mt,Q),e.tipFeeCreate&&Kt(Ie,mt)}),[lt,_e,Lt,Ie,mt,Q,rt,O]),Xt=(0,n.useCallback)((function(e){var t=[];e.forEach((function(e){var r=e.nftIssueCount,n=e.nftBurnCount;if(!(e.initNftSupply>r||n>0)){var a=e.nftImageUrl,s=e.tokenSymbol,c=e.projectName,u=e.mintPubkey;t.push({value:u,label:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(he.C,{className:"mr-2",size:"default",src:a}),(0,i.jsx)("div",{children:"".concat(s," - ").concat(c)})]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:u})]}),nftImageUrl:a,projectName:c,tokenSymbol:s,mintPubkey:u})}})),ut(t)}),[]),er=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ye(!0),e.next=4,(0,Z.yC)();case 4:return t=e.sent,r=t.projects,n=t.projectsDataSource,e.next=9,(0,R.o8)();case 9:a=e.sent,Xt(n),X(a),g(b.N.setProjectsV2(r)),g(b.N.setProjectsDataSourceV2(n)),ye(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),ye(!1),(0,R.Tv)(e.t0,C,"handleProjects");case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),[]),tr=(0,n.useCallback)((function(e){var t=e.target.checked;nt(t),Ot()}),[]);return(0,n.useEffect)((function(){er()}),[]),(0,i.jsxs)(te.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"创建交易"}),style:{width:"400px"},children:[(0,i.jsxs)(le.A,{formRef:L,onFinish:Dt,onValuesChange:Qt,onReset:Ot,layout:"vertical",initialValues:{buyMode:1,startNumber:1,tipFeeCreate:.1,payMode:1,tipMode:1,splitCount:1},submitter:{searchConfig:{submitText:"创建"},render:function(e,t){return[t[1],t[0],(0,i.jsx)("div",{children:De||""},"sign")]}},children:[(0,i.jsx)(ie.Z,{name:"projectId",label:(0,i.jsxs)("div",{children:["项目",(0,i.jsx)(ce.Z,{spin:be,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:er})]}),options:ct,placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,filterOption:function(e,t){return(t.projectName+t.tokenSymbol).toLowerCase().includes(e.toLowerCase())},optionItemRender:function(e){var t=e.projectName,r=e.tokenSymbol,n=e.nftImageUrl,a=e.mintPubkey;return(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(he.C,{className:"mr-2",size:"default",src:n}),(0,R.Mn)()?(0,i.jsx)("div",{children:"".concat(r)}):(0,i.jsx)("div",{children:"".concat(r," - ").concat((0,R.LH)(t))})]}),(0,i.jsx)(pe.k,{ellipsis:!0,tooltip:!1,address:a})]})}}}),(0,i.jsx)(ie.Z,{name:"buyMode",label:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("div",{children:"购买方式"}),(0,i.jsx)(ke.Z,{checked:rt,onChange:tr,className:"ml-4",children:"不含本账号图片"})]}),options:[{value:1,label:"1 随机"},{value:2,label:"2 价格低到高"},{value:3,label:"3 价格高到低"},{value:4,label:"4 时间优先"},{value:5,label:"5 只抢拆分"},{value:6,label:"6 不抢拆分(随机)"},{value:7,label:"7 指定账号(顺序)"},{value:8,label:"8 指定账号(随机)"},{value:9,label:"9 指定序号"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(e=L.current)&&void 0!==e&&e.getFieldValue("projectId"))}}),!!$e&&(0,i.jsx)(ie.Z,{name:"accounts",label:"选择账号",options:yt,fieldProps:{mode:"multiple",disabled:!(null!==(t=L.current)&&void 0!==t&&t.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),!!We&&(0,i.jsx)(ie.Z,{name:"nftIds",label:"选择序号",options:wt,fieldProps:{mode:"multiple",disabled:!(null!==(r=L.current)&&void 0!==r&&r.getFieldValue("projectId"))},placeholder:"",rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}]}),(0,i.jsx)(oe.Z,{name:"buyCount",label:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"购买数量 "}),(0,i.jsx)("span",{className:"hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){var e,t;null===(e=L.current)||void 0===e||e.setFieldValue("buyCount",Lt),null===(t=L.current)||void 0===t||t.validateFields(["buyCount"])},children:Lt?"(".concat(Lt,")"):""})]}),placeholder:"",min:1,max:Lt,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(a=L.current)&&void 0!==a&&a.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"startNumber",label:(0,i.jsxs)("div",{children:["开始序号#",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"从具体某个序号开始进行购买",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(c=L.current)&&void 0!==c&&c.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"endNumber",label:(0,i.jsxs)("div",{children:["结束序号#",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"只购买当前序号之前的NFT",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"可选，默认是当前序号的最大值",min:1,rules:[{required:!1,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",disabled:!(null!==(u=L.current)&&void 0!==u&&u.getFieldValue("projectId"))}}),(0,i.jsx)(ie.Z,{name:"tipMode",label:"GAS费用输入方式",options:[{value:1,label:"利润百分比"},{value:2,label:"实时Tip费用"},{value:3,label:"手动输入"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(l=L.current)&&void 0!==l&&l.getFieldValue("projectId"))}}),1===Qe?(0,i.jsx)(de.Z,{name:"tipFeeCreate",label:Tt,min:.1,max:20,step:.1,fieldProps:{tooltip:{formatter:function(e){return"".concat(e,"%")}},disabled:!(null!==(o=L.current)&&void 0!==o&&o.getFieldValue("projectId"))},rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.*$/}],help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Vt})}):null,2===Qe?(0,i.jsx)(ie.Z,{name:"tipFeeCreate",label:(0,i.jsxs)("div",{children:["每张图GAS费用",(0,i.jsx)(ce.Z,{spin:Pe,className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"},onClick:function(){return qt(_e,Q)}})]}),options:pt,placeholder:"",rules:[{required:!0,whitespace:!0,message:"输入异常",pattern:/^.*$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Vt})}):null,3===Qe?(0,i.jsx)(fe.Z,{name:"tipFeeCreate",label:Tt,placeholder:"至少为0.000001 SOL",rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+(\.\d{1,8})?$/}],fieldProps:{size:"large",autoFocus:!1},help:(0,i.jsx)("div",{className:"text-red-600 mb-5",children:Vt})}):null,(0,i.jsx)(ie.Z,{name:"payMode",label:"工具费用",options:[{value:1,label:"免费"},{value:2,label:"0.3%"}],rules:[{required:!0,whitespace:!0,message:"".concat(k),pattern:/^.+$/}],fieldProps:{size:"large",autoFocus:!1,showSearch:!0,disabled:!(null!==(d=L.current)&&void 0!==d&&d.getFieldValue("projectId"))}}),(0,i.jsx)(oe.Z,{name:"splitCount",label:(0,i.jsxs)("div",{children:["创建文件数量",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"将所有交易分配在多个文件进行保存，可方便在多个设备上进行发送",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"",min:1,rules:[{required:!0,message:"".concat(k),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1}}),(0,i.jsx)(fe.Z,{name:"totalAmountCreate",label:(0,i.jsxs)("div",{children:["交易总金额",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费。",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(f=L.current)&&void 0!==f&&f.getFieldValue("projectId"))}}),(0,i.jsx)(fe.Z,{name:"totalTxCount",label:"交易总笔数",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!(null!==(h=L.current)&&void 0!==h&&h.getFieldValue("projectId"))}})]}),N]})},Se=(0,n.memo)(ye),ge=r(91604),Pe=r(52688),we=r(66309),Ce=r(9669),Fe=r.n(Ce),Ne=[],Le=function(){var e=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),t=S.ZP.useMessage(),r=s()(t,2),a=r[0],c=r[1],u=(0,n.useRef)(),l=(0,n.useRef)(),o=(0,n.useState)([]),f=s()(o,2),h=f[0],x=f[1],m=(0,n.useState)(),b=s()(m,2),k=b[0],j=b[1],g=(0,n.useState)(0),w=s()(g,2),C=w[0],N=w[1],L=(0,n.useState)(0),_=s()(L,2),O=_[0],T=_[1],V=(0,n.useState)(0),I=s()(V,2),A=I[0],E=I[1],D=(0,n.useState)(0),z=s()(D,2),q=z[0],Y=z[1],$=(0,n.useState)(0),H=s()($,2),B=H[0],U=H[1],W=(0,n.useState)(0),G=s()(W,2),K=G[0],J=G[1],Q=(0,n.useState)(!1),X=s()(Q,2),ee=X[0],re=X[1],ne=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),ae=(0,n.useRef)(!0),se=(0,n.useRef)({}),ce=(0,n.useState)({}),ie=s()(ce,2),de=ie[0],pe=ie[1],he=(0,n.useMemo)((function(){return k?"(".concat(k.tokenSymbol," ").concat(k.projectId.slice(0,4),"...").concat(k.projectId.slice(-4),")"):""}),[k]),xe=(0,n.useMemo)((function(){return k?"".concat(null==k?void 0:k.currentProjectDataSource.nextRoundLocalFormat):""}),[k]),me=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=u.current)||void 0===r||r.resetFields(a),e){var s,c,l=e.currentProjectDataSource.lastRoundLocalValue,i=e.currentProjectDataSource.secPerRound,o=e.totalAmount,d=e.tipFee;N(l+1e3*i),j(e),null===(s=u.current)||void 0===s||s.setFieldValue("totalAmountSend",o),null===(c=u.current)||void 0===c||c.setFieldValue("tipFeeSend",d);var f={};e.nftIds.forEach((function(e){se.current[e]="default",f[e]="default"})),pe(f)}else{var p,h;N(0),j(void 0),null===(p=u.current)||void 0===p||p.setFieldValue("totalAmountSend",""),null===(h=u.current)||void 0===h||h.setFieldValue("tipFeeSend",""),se.current={},pe({})}T(0),E(0),Y(0),U(0),J(0)}),[]),be=(0,n.useCallback)((function(){var e,t,r;null===(e=u.current)||void 0===e||e.resetFields(),x([]),N(0),j(void 0),null===(t=u.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=u.current)||void 0===r||r.setFieldValue("tipFeeSend",""),se.current={},pe({}),T(0),E(0),Y(0),U(0),J(0)}),[]),ke=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return x(t.fileList),me(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(x(t.fileList),me(e),a.success("上传成功")):a.error("指令类型错误"):a.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,R.Tv)(e.t0,a,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),je=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0;for(var a in se.current)"success"===se.current[a]?t+=1:"error"===se.current[a]?r+=1:"processing"===se.current[a]?n+=1:"default"===se.current[a]&&(e+=1);T(t),E(r),Y(n),U(e)}),[]),ye=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0;case 1:if(!(s<n)){e.next=16;break}Object.keys(se.current).forEach((function(e){se.current[e]="processing"})),je();case 4:return t.transactions.forEach(function(){var e=v()(p()().mark((function e(t,r){var n,a,s,c,u,l,i;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.transactionBase64,a=t.nft.nftId,"success"!==(s=se.current[a])&&"error"!==s){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,c=r%ne.length,u=ne[c]+"/api/v1/transactions?bundleOnly=true",e.next=10,Fe().post(u,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[n,{encoding:"base64",maxTry:0}]},{timeout:5e3});case 10:200===(l=e.sent).status?se.current[a]="success":(se.current[a]="error",Ne.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(l),pos:"try"})),e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(i=e.t0.response)||void 0===i?void 0:i.status)){e.next=18;break}return e.abrupt("return");case 18:se.current[a]="error",Ne.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:a,error:JSON.stringify(e.t0),pos:"catch"});case 20:je();case 21:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t,r){return e.apply(this,arguments)}}()),e.next=8,new Promise((function(e){setTimeout(e,r)}));case 8:if(0!==Object.values(se.current).filter((function(e){return"processing"===e})).length){e.next=11;break}return e.abrupt("break",13);case 11:e.next=4;break;case 13:++s,e.next=1;break;case 16:a.success("发送完成");case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[a]),Se=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.disorderSend,n=t.intervalSend,r&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),Ce=(0,n.useCallback)((function(){var e;if(!k)return a.error("请先上传交易文件"),!1;var t=(null===(e=u.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;ye(k,t,1)}),[k]),Le=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),n=r.disorderSend,a=r.repeatSend,s=r.intervalSend,r.autoSend&&k){e.next=3;break}return e.abrupt("return");case 3:return n&&k.transactions.sort((function(){return Math.random()-.5})),ye(k,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[k]),Me=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&ae.current&&(ae.current=!1,null===(r=u.current)||void 0===r||r.submit())}),[]),Re=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,re(!0),t={},e.next=9,(0,Z.tt)({mintPubkey:k.projectId});case 9:r=e.sent,n=0,k.nftIds.forEach((function(e){var a=k.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),J(n),pe(t),re(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),re(!1),(0,R.Tv)(e.t0,a,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[a,k]),_e=(0,n.useCallback)((function(){if(k&&Ne.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Ne,null,2),r="data:,".concat(t),n=document.createElement("a"),s=k.tokenSymbol,c=k.projectId;n.href=r,n.download="Log_".concat(s,"_").concat(c.slice(0,4),"_").concat(c.slice(-4),"_").concat(e,".json"),n.click()}else a.info("无日志信息")}),[k]);return(0,i.jsxs)(te.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(le.A,{formRef:u,onFinish:Se,onReset:be,layout:"vertical",initialValues:{disorderSend:!0,autoSend:!0,repeatSend:3,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(P.ZP,{onClick:Ce,children:"预检"},"preflight"),(0,i.jsx)(P.ZP,{loading:ee,onClick:Re,children:"校对"},"check"),(0,i.jsx)(P.ZP,{onClick:_e,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(ge.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:ke,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return l.current.handleOpen(e)},fileList:h},rules:[{required:!0,whitespace:!0,message:"".concat(e),pattern:/.*/}]}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!k}}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:300,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!k}}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!k}}),(0,i.jsx)(Pe.Z,{name:"disorderSend",label:(0,i.jsxs)("div",{children:["是否乱序",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"是否以乱序的方式来发送交易",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(Pe.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(fe.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(fe.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(le.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),he]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:C,onFinish:Le,onChange:Me}),(0,i.jsx)("div",{className:"text-2xl",children:xe})]})}),(0,i.jsxs)(le.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),k?"(".concat(k.totalTxCount,")"):""]}),children:[(0,i.jsx)("div",{children:"完成：".concat(O,"，失败：").concat(A,"，处理中：").concat(q,"，待处理：").concat(B)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(se.current).map((function(e,t){return(0,i.jsx)(we.Z,{color:se.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(le.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),k?"(".concat(k.totalTxCount,")"):"",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(K)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(de).map((function(e,t){return(0,i.jsx)(we.Z,{color:de[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(M.VY,{ref:l}),c]})},Me=(0,n.memo)(Le),Re=[],_e=function(){var e=(0,y.useIntl)().formatMessage({id:"common.intlInputException"}),t=S.ZP.useMessage(),r=s()(t,2),a=r[0],c=r[1],u=(0,n.useRef)(),l=(0,n.useRef)(),o=(0,n.useState)([]),f=s()(o,2),h=f[0],x=f[1],m=(0,n.useState)(),b=s()(m,2),k=b[0],j=b[1],g=(0,n.useState)(0),w=s()(g,2),C=w[0],N=w[1],L=(0,n.useState)(0),_=s()(L,2),O=_[0],T=_[1],V=(0,n.useState)(0),I=s()(V,2),A=I[0],E=I[1],D=(0,n.useState)(0),z=s()(D,2),q=z[0],Y=z[1],$=(0,n.useState)(0),H=s()($,2),B=H[0],U=H[1],W=(0,n.useState)(0),G=s()(W,2),K=G[0],J=G[1],Q=(0,n.useState)(0),X=s()(Q,2),ee=X[0],re=X[1],ne=(0,n.useState)(!1),ae=s()(ne,2),se=ae[0],ce=ae[1],ie=(0,y.useSelector)((function(e){return e.wallet.jitoRpcs})),de=(0,n.useRef)(0),pe=(0,n.useRef)(!0),he=(0,n.useRef)({}),xe=(0,n.useState)({}),me=s()(xe,2),be=me[0],ke=me[1],je=(0,n.useMemo)((function(){return k?"(".concat(k.tokenSymbol," ").concat(k.projectId.slice(0,4),"...").concat(k.projectId.slice(-4),")"):""}),[k]),ye=(0,n.useMemo)((function(){return k?"".concat(null==k?void 0:k.currentProjectDataSource.nextRoundLocalFormat):""}),[k]),Se=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),a=Object.keys(n).filter((function(e){return"transactionFile"!==e}));if(null===(r=u.current)||void 0===r||r.resetFields(a),e){var s,c,l=e.currentProjectDataSource.nextRoundLocalValue,i=e.totalAmount,o=e.tipFee;N(l),j(e),null===(s=u.current)||void 0===s||s.setFieldValue("totalAmountSend",i),null===(c=u.current)||void 0===c||c.setFieldValue("tipFeeSend",o);var d={};he.current={},e.nftIds.forEach((function(e){he.current[e]="default",d[e]="default"})),ke(d)}else{var f,p;N(0),j(void 0),null===(f=u.current)||void 0===f||f.setFieldValue("totalAmountSend",""),null===(p=u.current)||void 0===p||p.setFieldValue("tipFeeSend",""),he.current={},ke({})}T(0),E(0),Y(0),U(0),J(0),re(0)}),[]),Ce=(0,n.useCallback)((function(){var e,t,r;null===(e=u.current)||void 0===e||e.resetFields(),x([]),N(0),j(void 0),null===(t=u.current)||void 0===t||t.setFieldValue("totalAmountSend",""),null===(r=u.current)||void 0===r||r.setFieldValue("tipFeeSend",""),he.current={},ke({}),T(0),E(0),Y(0),U(0),J(0),re(0)}),[]),Ne=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"removed"!==t.file.status){e.next=5;break}return x(t.fileList),Se(void 0),e.abrupt("return");case 5:(r=new FileReader).readAsText(t.fileList[t.fileList.length-1].originFileObj),r.onload=function(){var e=JSON.parse(r.result);e?e.hasOwnProperty("instruction")&&"buy"===e.instruction?(x(t.fileList),Se(e),a.success("上传成功")):a.error("指令类型错误"):a.error("上传失败")},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),(0,R.Tv)(e.t0,a,"handleUpload");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),[]),Le=(0,n.useCallback)((function(){var e=0,t=0,r=0,n=0,a=0;for(var s in he.current)"success"===he.current[s]?t+=1:"error"===he.current[s]?r+=1:"processing"===he.current[s]?a+=1:"default"===he.current[s]?e+=1:"warning"===he.current[s]&&(n+=1);T(t),E(r),Y(n),U(a),J(e)}),[]),Me=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t,r,n){var s,c,u,l,i,o,d;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:de.current=0,s=0;case 2:if(!(s<n)){e.next=24;break}Object.keys(he.current).forEach((function(e){he.current[e]="processing"})),Le(),c=t.totalNonceCount,u=t.totalTxCount,l=Math.ceil(u/c),i=0;case 9:if(!(i<l)){e.next=21;break}o=t.transactions.slice(i*c,(i+1)*c),d=p()().mark((function e(){var t;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.forEach(function(){var e=v()(p()().mark((function e(t){var r,n,a,s,c,u,l;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.transactionBase64,n=t.nft.nftId,"success"!==(a=he.current[n])&&"error"!==a){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,s=de.current++%ie.length,c=ie[s]+"/api/v1/transactions?bundleOnly=true",e.next=10,Fe().post(c,{jsonrpc:"2.0",id:"1",method:"sendTransaction",params:[r,{encoding:"base64",maxRetries:0}]},{timeout:3e3});case 10:200===(u=e.sent).status?he.current[n]="success":(he.current[n]="error",Re.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(u),pos:"try"})),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(5),429!==(null===(l=e.t0.response)||void 0===l?void 0:l.status)){e.next=19;break}return he.current[n]="default",e.abrupt("return");case 19:he.current[n]="error",Re.push({data:F()().format("YYYY-MM-DDTHH:mm:ss.SSS"),nftId:n,error:JSON.stringify(e.t0),pos:"catch"});case 21:Le();case 22:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}()),e.next=3,new Promise((function(e){setTimeout(e,r)}));case 3:if(t=0,o.forEach((function(e){var r=e.nft.nftId,n=he.current[r];"processing"===n?(t+=1,he.current[r]="warning"):"default"===n?he.current[r]="processing":t+=1})),t!==o.length){e.next=7;break}return e.abrupt("return",1);case 7:case"end":return e.stop()}}),e)}));case 12:return e.delegateYield(d(),"t0",14);case 14:if(!e.t0){e.next=16;break}return e.abrupt("break",18);case 16:e.next=12;break;case 18:++i,e.next=9;break;case 21:++s,e.next=2;break;case 24:a.success("发送完成");case 25:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),[a]),_e=(0,n.useCallback)(function(){var e=v()(p()().mark((function e(t){var r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.error("请先上传交易文件"),e.abrupt("return",!1);case 3:return r=t.reverseOrder,n=t.intervalSend,r&&(k.transactions=k.transactions.toReversed()),Me(k,n,1),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),Oe=(0,n.useCallback)((function(){var e;if(!k)return a.error("请先上传交易文件"),!1;var t=(null===(e=u.current)||void 0===e?void 0:e.getFieldsValue()).intervalSend;Me(k,t,1)}),[k]),Te=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n,a,s;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=u.current)||void 0===t?void 0:t.getFieldsValue(),n=r.reverseOrder,a=r.repeatSend,s=r.intervalSend,r.autoSend&&k){e.next=3;break}return e.abrupt("return");case 3:return n&&(k.transactions=k.transactions.toReversed()),Me(k,s,a),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)}))),[k]),Ve=(0,n.useCallback)((function(e){var t,r,n=null===(t=u.current)||void 0===t?void 0:t.getFieldValue("leadTimeSend");n&&e<n&&pe.current&&(pe.current=!1,null===(r=u.current)||void 0===r||r.submit())}),[]),Ie=(0,n.useCallback)(v()(p()().mark((function e(){var t,r,n;return p()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k){e.next=3;break}return a.info("无待校验数据"),e.abrupt("return",!0);case 3:return e.prev=4,ce(!0),t={},e.next=9,(0,Z.II)({mintPubkey:k.projectId});case 9:r=e.sent,n=0,k.nftIds.forEach((function(e){var a=k.from,s=r.find((function(t){return t.nft_id===e}));s&&s.owner_pubkey===a?(t[e]="success",n+=1):t[e]="default"})),re(n),ke(t),ce(!1),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),ce(!1),(0,R.Tv)(e.t0,a,"handleCheckOwnCount");case 21:case"end":return e.stop()}}),e,null,[[4,17]])}))),[a,k]),Ze=(0,n.useCallback)((function(){if(k&&Re.length){var e=F()().format("YYYY-MM-DDTHH:mm:ss"),t=JSON.stringify(Re,null,2),r="data:,".concat(t),n=document.createElement("a"),s=k.tokenSymbol,c=k.projectId;n.href=r,n.download="Log_".concat(s,"_").concat(c.slice(0,4),"_").concat(c.slice(-4),"_").concat(e,".json"),n.click()}else a.info("无日志信息")}),[k]);return(0,i.jsxs)(te.Z,{title:(0,i.jsx)("div",{className:"font-semibold text-lg hardline",children:"发送交易"}),style:{width:"400px"},children:[(0,i.jsxs)(le.A,{formRef:u,onFinish:_e,onReset:Ce,layout:"vertical",initialValues:{reverseOrder:!1,autoSend:!0,repeatSend:2,intervalSend:500,leadTimeSend:0,fixedTimeSend:!1},submitter:{searchConfig:{submitText:"发送"},render:function(e,t){return[t[1],(0,i.jsx)(P.ZP,{loading:se,onClick:Ie,children:"校对"},"check"),(0,i.jsx)(P.ZP,{onClick:Oe,children:"预检"},"preflight"),(0,i.jsx)(P.ZP,{onClick:Ze,children:"日志"},"log"),t[0]]}},children:[(0,i.jsx)(ge.Z,{label:"交易文件",name:"transactionFile",action:"upload.do",fieldProps:{accept:".json",onChange:Ne,beforeUpload:function(){return!1},listType:"picture",maxCount:1,onPreview:function(e){return l.current.handleOpen(e)},fileList:h},rules:[{required:!0,whitespace:!0,message:"".concat(e),pattern:/.*/}]}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["整体重复发送次数",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"整体全部发送完成算一次，这里指定重复次数。重复发送失败了，不会影响金额",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"repeatSend",placeholder:"",min:1,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:3,disabled:!k}}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["重复发送间隔(毫秒)",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"超过接口发送次数后，延时多长时间进行重新发送",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"intervalSend",placeholder:"",min:100,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:1e3,disabled:!k}}),(0,i.jsx)(oe.Z,{label:(0,i.jsxs)("div",{children:["提前发送时间(毫秒)",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"在下一轮开始前多少毫秒发送交易",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),name:"leadTimeSend",placeholder:"",max:3e3,min:0,rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^\d+$/}],fieldProps:{autoFocus:!1,size:"large",defaultValue:0,disabled:!k}}),(0,i.jsx)(Pe.Z,{name:"reverseOrder",label:(0,i.jsxs)("div",{children:["是否倒序",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"是否以倒序的方式来发送交易",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(Pe.Z,{name:"autoSend",label:(0,i.jsxs)("div",{children:["是否自动发送",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"倒计时结束后，是否自动发送交易。开启与否，不影响手动操作来发",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),rules:[{required:!0,message:"".concat(e),whitespace:!0,pattern:/^true|false$/}],fieldProps:{autoFocus:!1,defaultValue:!0,disabled:!k}}),(0,i.jsx)(fe.Z,{name:"tipFeeSend",label:"每张图GAS费用",placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(fe.Z,{name:"totalAmountSend",label:(0,i.jsxs)("div",{children:["总金额",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"此次全部交易所需要的总金额，包含手续费",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]}),placeholder:"自动生成，无需输入",fieldProps:{size:"large",autoFocus:!1,defaultValue:"",readOnly:!0,disabled:!k}}),(0,i.jsx)(le.A.Item,{label:(0,i.jsxs)("div",{className:"font-semibold text-lg ",children:[(0,i.jsx)("span",{className:"hardline",children:"倒计时 "}),je]}),children:(0,i.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,i.jsx)(d,{className:"text-2xl",value:C,onFinish:Te,onChange:Ve}),(0,i.jsx)("div",{className:"text-2xl",children:ye})]})}),(0,i.jsxs)(le.A.Item,{label:(0,i.jsxs)("div",{className:" font-semibold text-lg hardline",children:[(0,i.jsx)("span",{children:"结果 "}),k?"(".concat(k.totalTxCount,")"):""]}),children:[(0,i.jsx)("div",{children:"完成：".concat(O,"，失败：").concat(A,"，超时：").concat(q,"，处理中：").concat(B,"，待处理：").concat(K)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(he.current).map((function(e,t){return(0,i.jsx)(we.Z,{color:he.current[e],children:"#".concat(e)},t)}))})]}),(0,i.jsxs)(le.A.Item,{label:(0,i.jsx)("div",{className:" font-semibold text-lg hardline",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:"校对 "}),k?"(".concat(k.totalTxCount,")"):"",(0,i.jsx)(ve.Z,{placement:"topLeft",title:"交易结束后，可点击校对按钮，判断交易结果是否跟链上数据匹配",children:(0,i.jsx)(ue.Z,{className:"ml-[8px] hover:cursor-pointer",style:{color:"#1677ff"}})})]})}),children:[(0,i.jsx)("div",{children:"拥有：".concat(ee)}),!!k&&(0,i.jsx)("div",{className:"flex flex-wrap gap-5 mt-3",children:Object.keys(be).map((function(e,t){return(0,i.jsx)(we.Z,{color:be[e],children:"#".concat(e)},t)}))})]})]}),(0,i.jsx)(M.VY,{ref:l}),c]})},Oe=(0,n.memo)(_e)}}]);